{"version":3,"file":"index.cjs","sources":["../lib/extensions/read-only.js","../lib/utils/markdown.js","../lib/utils/syntax-highlight.js","../lib/extensions/hybrid-preview.js","../lib/extensions/actions.js","../lib/extensions/keymaps.js","../lib/extensions/selected-line.js","../lib/extensions/typewriter.js","../lib/extensions/focus-mode.js","../lib/extensions/word-count.js","../lib/extensions/bottom-toolbar.js","../lib/extensions/backlinks.js","../lib/extensions/frontmatter-sheet.js","../lib/theme/base.js","../lib/theme/light.js","../lib/theme/dark.js","../lib/theme/raw-mode.js","../lib/extensions/tag-autocomplete.js","../lib/extensions/wiki-link-autocomplete.js","../lib/extensions/more-menu.js","../lib/index.js"],"sourcesContent":["import { Annotation } from '@codemirror/state';\n\nexport const allowReadOnlyEdit = Annotation.define();\n","import MarkdownIt from 'markdown-it';\nimport { full as markdownItEmoji } from 'markdown-it-emoji';\nimport katex from 'katex';\n\nexport const CUSTOM_TASK_TYPES = ['i', '!', '?', '*', '>', '<'];\n\nconst CUSTOM_TASK_META = {\n  i: { emoji: 'üß†', label: 'Idea', className: 'idea' },\n  '!': { emoji: '‚ö†Ô∏è', label: 'Urgent', className: 'urgent' },\n  '?': { emoji: '‚ùì', label: 'Question', className: 'question' },\n  '*': { emoji: '‚≠ê', label: 'Important', className: 'important' },\n  '>': { emoji: '‚û°Ô∏è', label: 'Forwarded', className: 'forwarded' },\n  '<': { emoji: 'üìÖ', label: 'Scheduled', className: 'scheduled' },\n};\n\nconst WIKI_LINK_OPEN = '[[';\nconst WIKI_LINK_CLOSE = ']]';\n\nfunction isTrimmed(value) {\n  return value === value.trim();\n}\n\nfunction parseWikiLinkContent(content) {\n  if (!content || !isTrimmed(content)) return null;\n  if (content.includes('\\n')) return null;\n  if (content.includes('[') || content.includes(']')) return null;\n\n  const pipeIndex = content.indexOf('|');\n  const target = pipeIndex === -1 ? content : content.slice(0, pipeIndex);\n  const alias = pipeIndex === -1 ? null : content.slice(pipeIndex + 1);\n\n  if (!target || (alias !== null && (!alias || !isTrimmed(alias)))) return null;\n\n  const hashIndex = target.indexOf('#');\n  const title = hashIndex === -1 ? target : target.slice(0, hashIndex);\n  const section = hashIndex === -1 ? null : target.slice(hashIndex + 1);\n\n  if (!title || !isTrimmed(title)) return null;\n  if (section !== null && (!section || !isTrimmed(section))) return null;\n\n  const display = alias ?? (section ?? title);\n\n  return {\n    raw: `${WIKI_LINK_OPEN}${content}${WIKI_LINK_CLOSE}`,\n    title,\n    section,\n    alias,\n    display,\n  };\n}\n\nfunction findClosingBackticks(text, start, tickCount) {\n  const ticks = '`'.repeat(tickCount);\n  return text.indexOf(ticks, start + tickCount);\n}\n\nexport function findWikiLinks(text) {\n  const matches = [];\n  let i = 0;\n\n  while (i < text.length) {\n    if (text[i] === '`') {\n      let tickCount = 1;\n      while (text[i + tickCount] === '`') {\n        tickCount += 1;\n      }\n      const end = findClosingBackticks(text, i, tickCount);\n      if (end === -1) {\n        i += tickCount;\n        continue;\n      }\n      i = end + tickCount;\n      continue;\n    }\n\n    if (text.startsWith(WIKI_LINK_OPEN, i)) {\n      const end = text.indexOf(WIKI_LINK_CLOSE, i + 2);\n      if (end === -1) {\n        i += 2;\n        continue;\n      }\n\n      const content = text.slice(i + 2, end);\n      const meta = parseWikiLinkContent(content);\n      if (meta) {\n        matches.push({ from: i, to: end + 2, meta });\n        i = end + 2;\n        continue;\n      }\n\n      i += 2;\n      continue;\n    }\n\n    i += 1;\n  }\n\n  return matches;\n}\n\nconst FIND_TAGS_REGEX = /(?:^|(?<=\\s))#([a-zA-Z][\\w/-]*)/g;\n\n/**\n * Find all tags in a line of text, returning their positions\n * Skips tags inside backtick code spans\n */\nexport function findTags(text) {\n  const matches = [];\n  // First, find code span ranges to exclude\n  const codeRanges = [];\n  let tickMatch;\n  const tickRegex = /`+/g;\n  while ((tickMatch = tickRegex.exec(text)) !== null) {\n    const tickCount = tickMatch[0].length;\n    const closePos = findClosingBackticks(text, tickMatch.index, tickCount);\n    if (closePos !== -1) {\n      codeRanges.push({ from: tickMatch.index, to: closePos + tickCount });\n      tickRegex.lastIndex = closePos + tickCount;\n    }\n  }\n\n  const isInCode = (pos) => codeRanges.some(r => pos >= r.from && pos < r.to);\n\n  FIND_TAGS_REGEX.lastIndex = 0;\n  let m;\n  while ((m = FIND_TAGS_REGEX.exec(text)) !== null) {\n    const hashPos = m.index + (m[0].startsWith('#') ? 0 : m[0].indexOf('#'));\n    if (!isInCode(hashPos)) {\n      matches.push({ from: hashPos, to: hashPos + 1 + m[1].length, tag: m[1] });\n    }\n  }\n\n  return matches;\n}\n\nconst md = new MarkdownIt({\n  html: false,\n  linkify: true,\n  breaks: false,\n  typographer: false,\n});\n\nmd.use(markdownItEmoji);\n\nfunction addWikiLinkRule(markdown) {\n  markdown.inline.ruler.before('link', 'wikilink', (state, silent) => {\n    if (!state.env || state.env.enableWikiLinks !== true) return false;\n\n    const start = state.pos;\n    if (state.src.charCodeAt(start) !== 0x5b || state.src.charCodeAt(start + 1) !== 0x5b) {\n      return false;\n    }\n\n    const end = state.src.indexOf(WIKI_LINK_CLOSE, start + 2);\n    if (end === -1) return false;\n\n    const content = state.src.slice(start + 2, end);\n    const meta = parseWikiLinkContent(content);\n    if (!meta) return false;\n\n    if (!silent) {\n      const token = state.push('wikilink', '', 0);\n      token.meta = meta;\n    }\n\n    state.pos = end + 2;\n    return true;\n  });\n\n  markdown.renderer.rules.wikilink = (tokens, idx) => {\n    const meta = tokens[idx].meta || {};\n    const escape = markdown.utils.escapeHtml;\n    const attrs = [\n      'class=\"md-wikilink\"',\n      `data-wikilink=\"${escape(meta.raw || '')}\"`,\n      `data-wikilink-title=\"${escape(meta.title || '')}\"`,\n    ];\n\n    if (meta.section) {\n      attrs.push(`data-wikilink-section=\"${escape(meta.section)}\"`);\n    }\n    if (meta.alias) {\n      attrs.push(`data-wikilink-alias=\"${escape(meta.alias)}\"`);\n    }\n\n    const label = escape(meta.display || meta.title || '');\n    return `<span ${attrs.join(' ')}>${label}</span>`;\n  };\n}\n\n// Tag regex: #tag or #tag/subtag, must have at least one letter\nconst TAG_REGEX = /^#([a-zA-Z][\\w/-]*)/;\n\nfunction addTagRule(markdown) {\n  markdown.inline.ruler.before('link', 'tag', (state, silent) => {\n    if (!state.env || state.env.enableTags !== true) return false;\n\n    const start = state.pos;\n    if (state.src.charCodeAt(start) !== 0x23) return false; // #\n\n    // Must be at start of string or preceded by whitespace\n    if (start > 0) {\n      const prev = state.src.charCodeAt(start - 1);\n      // Space, tab, newline, or start of line\n      if (prev !== 0x20 && prev !== 0x09 && prev !== 0x0a && prev !== 0x0d) return false;\n    }\n\n    const remaining = state.src.slice(start);\n    const match = remaining.match(TAG_REGEX);\n    if (!match) return false;\n\n    const tagName = match[1];\n\n    if (!silent) {\n      const token = state.push('tag', '', 0);\n      token.meta = { tag: tagName };\n    }\n\n    state.pos = start + 1 + tagName.length;\n    return true;\n  });\n\n  markdown.renderer.rules.tag = (tokens, idx) => {\n    const meta = tokens[idx].meta || {};\n    const escape = markdown.utils.escapeHtml;\n    const tagName = escape(meta.tag || '');\n    return `<span class=\"md-tag\" data-tag=\"${tagName}\">#${tagName}</span>`;\n  };\n}\n\nfunction addInlineMathRule(markdown) {\n  markdown.inline.ruler.before('escape', 'katex_inline', (state, silent) => {\n    const start = state.pos;\n    if (state.src.charCodeAt(start) !== 0x24) return false; // $\n    if (state.src.charCodeAt(start + 1) === 0x24) return false; // $$\n\n    let end = start + 1;\n    while ((end = state.src.indexOf('$', end)) !== -1) {\n      if (state.src.charCodeAt(end - 1) !== 0x5c) break; // ignore escaped $\n      end += 1;\n    }\n\n    if (end === -1) return false;\n\n    const content = state.src.slice(start + 1, end);\n    if (!content || content.includes('\\n')) return false;\n\n    if (!silent) {\n      const token = state.push('math_inline', '', 0);\n      token.content = content;\n    }\n\n    state.pos = end + 1;\n    return true;\n  });\n\n  markdown.renderer.rules.math_inline = (tokens, idx) => {\n    try {\n      return katex.renderToString(tokens[idx].content, { displayMode: false, throwOnError: false });\n    } catch (e) {\n      return tokens[idx].content;\n    }\n  };\n}\n\nfunction addHighlightRule(markdown) {\n  markdown.inline.ruler.before('emphasis', 'highlight', (state, silent) => {\n    const start = state.pos;\n    if (state.src.charCodeAt(start) !== 0x3d || state.src.charCodeAt(start + 1) !== 0x3d) {\n      return false; // ==\n    }\n\n    let end = start + 2;\n    while ((end = state.src.indexOf('==', end)) !== -1) {\n      if (end > start + 2) break;\n      end += 2;\n    }\n\n    if (end === -1) return false;\n\n    const content = state.src.slice(start + 2, end);\n    if (!content || content.includes('\\n')) return false;\n\n    if (!silent) {\n      const token = state.push('mark_open', 'mark', 1);\n      token.attrSet('class', 'md-highlight');\n      markdown.inline.parse(content, markdown, state.env, state.tokens);\n      state.push('mark_close', 'mark', -1);\n    }\n\n    state.pos = end + 2;\n    return true;\n  });\n}\n\nfunction addSubscriptRule(markdown) {\n  markdown.inline.ruler.before('emphasis', 'subscript', (state, silent) => {\n    const start = state.pos;\n    if (state.src.charCodeAt(start) !== 0x7e) return false; // ~\n    if (state.src.charCodeAt(start + 1) === 0x7e) return false; // ~~\n\n    let end = start + 1;\n    while ((end = state.src.indexOf('~', end)) !== -1) {\n      if (state.src.charCodeAt(end - 1) === 0x5c) {\n        end += 1;\n        continue;\n      }\n      if (state.src.charCodeAt(end + 1) === 0x7e) {\n        end += 1;\n        continue;\n      }\n      break;\n    }\n\n    if (end === -1) return false;\n\n    const content = state.src.slice(start + 1, end);\n    if (!content || content.includes('\\n')) return false;\n\n    if (!silent) {\n      const token = state.push('sub_open', 'sub', 1);\n      token.attrSet('class', 'md-subscript');\n      markdown.inline.parse(content, markdown, state.env, state.tokens);\n      state.push('sub_close', 'sub', -1);\n    }\n\n    state.pos = end + 1;\n    return true;\n  });\n}\n\nfunction addSuperscriptRule(markdown) {\n  markdown.inline.ruler.before('emphasis', 'superscript', (state, silent) => {\n    const start = state.pos;\n    if (state.src.charCodeAt(start) !== 0x5e) return false; // ^\n    if (state.src.charCodeAt(start + 1) === 0x5e) return false; // ^^ (ignore)\n\n    let end = start + 1;\n    while ((end = state.src.indexOf('^', end)) !== -1) {\n      if (state.src.charCodeAt(end - 1) === 0x5c) {\n        end += 1;\n        continue;\n      }\n      break;\n    }\n\n    if (end === -1) return false;\n\n    const content = state.src.slice(start + 1, end);\n    if (!content || content.includes('\\n')) return false;\n\n    if (!silent) {\n      const token = state.push('sup_open', 'sup', 1);\n      token.attrSet('class', 'md-superscript');\n      markdown.inline.parse(content, markdown, state.env, state.tokens);\n      state.push('sup_close', 'sup', -1);\n    }\n\n    state.pos = end + 1;\n    return true;\n  });\n}\n\nfunction addFootnoteReferenceRule(markdown) {\n  markdown.inline.ruler.before('link', 'footnote_ref', (state, silent) => {\n    const start = state.pos;\n    if (state.src.charCodeAt(start) !== 0x5b) return false; // [\n    if (state.src.charCodeAt(start + 1) !== 0x5e) return false; // ^\n\n    const end = state.src.indexOf(']', start + 2);\n    if (end === -1) return false;\n\n    const id = state.src.slice(start + 2, end);\n    if (!id) return false;\n\n    if (!silent) {\n      const token = state.push('footnote_ref', '', 0);\n      token.meta = { id };\n    }\n\n    state.pos = end + 1;\n    return true;\n  });\n\n  markdown.renderer.rules.footnote_ref = (tokens, idx) => {\n    const id = tokens[idx].meta.id;\n    return `<sup class=\"footnote-ref\"><span class=\"footnote-link\" data-footnote=\"${id}\">[${id}]</span></sup>`;\n  };\n}\n\naddInlineMathRule(md);\naddHighlightRule(md);\naddSubscriptRule(md);\naddSuperscriptRule(md);\naddFootnoteReferenceRule(md);\naddWikiLinkRule(md);\naddTagRule(md);\n\n/**\n * Render block math $$...$$\n */\nexport function renderBlockMath(content) {\n  try {\n    return katex.renderToString(content, { displayMode: true, throwOnError: false });\n  } catch (e) {\n    return `<span class=\"math-error\">${content}</span>`;\n  }\n}\n\n/**\n * Render a footnote reference [^id]\n */\nexport function renderFootnoteRef(id) {\n  return `<sup class=\"footnote-ref\"><span class=\"footnote-link\" data-footnote=\"${id}\">[${id}]</span></sup>`;\n}\n\n/**\n * Render a footnote definition [^id]: content\n */\nexport function renderFootnoteDef(id, content, options = {}) {\n  const rendered = renderInline(content, options);\n  return `<span class=\"footnote-def\">[${id}]: ${rendered} <span class=\"md-footnote-backref-link\" data-footnote-ref=\"${id}\" title=\"Back to reference\">‚Ü©</span></span>`;\n}\n\n/**\n * Render inline content with extensions\n */\nfunction renderInline(text, options = {}) {\n  const env = {\n    enableWikiLinks: options.enableWikiLinks === true,\n    enableTags: options.enableTags === true,\n  };\n  return md.renderInline(text, env);\n}\n\n/**\n * Render a multi-line footnote definition block\n */\nexport function renderFootnoteBlock(id, lines, options = {}) {\n  if (!lines.length) return '';\n  const firstMatch = lines[0].match(/^\\[\\^([^\\]]+)\\]:\\s*(.*)$/);\n  const firstContent = firstMatch ? firstMatch[2] : lines[0];\n  const parts = [];\n\n  const firstRendered = renderInline(firstContent, options);\n  parts.push(`<div class=\"md-footnote-line md-footnote-first\">[${id}]: ${firstRendered}</div>`);\n\n  for (let i = 1; i < lines.length; i++) {\n    const line = lines[i].replace(/^\\s{2,}|\\t/, '');\n    const rendered = line.trim() ? renderInline(line, options) : '';\n    parts.push(`<div class=\"md-footnote-line md-footnote-continuation\">${rendered}</div>`);\n  }\n\n  parts.push(`<div class=\"md-footnote-backref\"><span class=\"md-footnote-backref-link\" data-footnote-ref=\"${id}\" title=\"Back to reference\">‚Ü©</span></div>`);\n\n  return `<div class=\"md-footnote-block\" data-footnote=\"${id}\">${parts.join('')}</div>`;\n}\n\n/**\n * Render a definition list block (single term with one or more definitions)\n */\nexport function renderDefinitionList(lines, options = {}) {\n  if (lines.length === 0) return '';\n  const term = lines[0].trim();\n  const definitions = [];\n  let current = null;\n\n  for (let i = 1; i < lines.length; i++) {\n    const line = lines[i];\n    const defMatch = line.match(/^\\s*:\\s*(.*)$/);\n    if (defMatch) {\n      if (current) {\n        definitions.push(current);\n      }\n      current = [defMatch[1]];\n      continue;\n    }\n\n    if (current) {\n      const continuation = line.replace(/^\\s{2,}|\\t/, '');\n      current.push(continuation);\n    }\n  }\n\n  if (current) {\n    definitions.push(current);\n  }\n\n  const termHtml = renderInline(term, options);\n  const defHtml = definitions.map((defLines) => {\n    const rendered = defLines.map((line) => renderInline(line, options)).join('<br>');\n    return `<dd>${rendered}</dd>`;\n  }).join('');\n\n  return `<dl class=\"md-definition-list\"><dt>${termHtml}</dt>${defHtml}</dl>`;\n}\n\n/**\n * Render a single line of markdown to HTML\n * Handles both block elements (headers) and inline elements\n */\nexport function renderMarkdownLine(content, options = {}) {\n  if (!content.trim()) {\n    return content;\n  }\n\n  const enableCustomTasks = options.enableCustomTasks === true;\n  const customTaskTypes = Array.isArray(options.customTaskTypes)\n    ? options.customTaskTypes\n    : CUSTOM_TASK_TYPES;\n  const customTaskSet = options.customTaskTypeSet ?? new Set(customTaskTypes);\n  const enableWikiLinks = options.enableWikiLinks === true;\n  const renderOptions = { ...options, enableWikiLinks };\n\n  // Check if it's a footnote definition [^id]: content\n  const footnoteDefMatch = content.match(/^\\[\\^([^\\]]+)\\]:\\s*(.*)$/);\n  if (footnoteDefMatch) {\n    return renderFootnoteDef(footnoteDefMatch[1], footnoteDefMatch[2], renderOptions);\n  }\n\n  // Check if it's a header line\n  const headerMatch = content.match(/^(#{1,6})\\s+(.*)$/);\n  if (headerMatch) {\n    const level = headerMatch[1].length;\n    let text = headerMatch[2];\n    let headingId = null;\n    const idMatch = text.match(/^(.*)\\s+(?:\\[#([A-Za-z0-9_-]+)\\]|\\{#([A-Za-z0-9_-]+)\\})\\s*$/);\n    if (idMatch) {\n      text = idMatch[1];\n      headingId = idMatch[2] || idMatch[3];\n    }\n    const idAttr = headingId ? ` id=\"${headingId}\" data-heading-id=\"${headingId}\"` : '';\n    return `<span class=\"md-header md-h${level}\"${idAttr}>${renderInline(text, renderOptions)}</span>`;\n  }\n\n  // Check if it's a blockquote\n  if (content.startsWith('>')) {\n    const text = content.replace(/^>\\s*/, '');\n    return `<span class=\"md-blockquote\">${renderInline(text, renderOptions)}</span>`;\n  }\n\n  // Check if it's a list item\n  const listMatch = content.match(/^(\\s*)([-*+]|\\d+\\.)\\s+(.*)$/);\n  if (listMatch) {\n    const marker = listMatch[2];\n    const text = listMatch[3];\n    // Check for task list\n    const taskMatch = text.match(/^\\[([ xX])\\]\\s*(.*)$/);\n    if (taskMatch) {\n      const checked = taskMatch[1].toLowerCase() === 'x';\n      const emoji = checked ? '‚úÖ' : '‚¨úÔ∏è';\n      const label = checked ? 'Completed' : 'Incomplete';\n      const stateClass = checked ? 'complete' : 'incomplete';\n      const token = checked ? 'x' : ' ';\n      return `<span class=\"md-list-item md-task-item\"><span class=\"md-list-marker\">${marker}</span> <span class=\"md-task-icon md-task-${stateClass}\" data-task=\"${token}\" role=\"button\" aria-label=\"${label}\" title=\"${label}\">${emoji}</span> ${renderInline(taskMatch[2], renderOptions)}</span>`;\n    }\n\n    if (enableCustomTasks) {\n      const customTaskMatch = text.match(/^\\[([!?>i*<])\\]\\s*(.*)$/);\n      if (customTaskMatch) {\n        const token = customTaskMatch[1];\n        const meta = CUSTOM_TASK_META[token];\n        if (meta && customTaskSet.has(token)) {\n          return `<span class=\"md-list-item md-task-item\"><span class=\"md-list-marker\">${marker}</span> <span class=\"md-task-icon md-task-${meta.className}\" data-task=\"${token}\" role=\"button\" aria-label=\"${meta.label}\" title=\"${meta.label}\">${meta.emoji}</span> ${renderInline(customTaskMatch[2], renderOptions)}</span>`;\n        }\n      }\n    }\n    return `<span class=\"md-list-item\"><span class=\"md-list-marker\">${marker}</span> ${renderInline(text, renderOptions)}</span>`;\n  }\n\n  // Check if it's a horizontal rule\n  if (/^(-{3,}|_{3,}|\\*{3,})$/.test(content.trim())) {\n    return '<hr class=\"md-hr\">';\n  }\n\n  // Check if it's a table row\n  if (content.trim().startsWith('|') && content.trim().endsWith('|')) {\n    const trimmed = content.trim();\n    // Check if it's a separator row (|---|---|) - only contains |, -, :, and spaces\n    if (/^\\|[-:\\s|]+\\|$/.test(trimmed) && trimmed.includes('-')) {\n      return `<span class=\"md-table-separator\"></span>`;\n    }\n    // Parse cells\n    const cells = trimmed.slice(1, -1).split('|').map(cell => cell.trim());\n    const renderedCells = cells.map(cell => {\n      return `<span class=\"md-table-cell\">${renderInline(cell, renderOptions)}</span>`;\n    }).join('');\n    return `<span class=\"md-table-row\">${renderedCells}</span>`;\n  }\n\n  // Default: render as inline markdown with extensions\n  return renderInline(content, renderOptions);\n}\n\n/**\n * Render a full markdown document\n */\nexport function renderDocument(content, options = {}) {\n  const env = {\n    enableWikiLinks: options.enableWikiLinks === true,\n  };\n  return md.render(content, env);\n}\n\n/**\n * Render a table from an array of row strings\n */\nexport function renderTable(rows, options = {}) {\n  if (rows.length === 0) return '';\n\n  const parseRow = (row) => {\n    const trimmed = row.trim();\n    if (!trimmed.startsWith('|') || !trimmed.endsWith('|')) return null;\n    return trimmed.slice(1, -1).split('|').map(cell => cell.trim());\n  };\n\n  const isSeparator = (row) => {\n    const trimmed = row.trim();\n    return /^\\|[-:\\s|]+\\|$/.test(trimmed) && trimmed.includes('-');\n  };\n\n  // Find header and body rows\n  let headerRow = null;\n  let bodyRows = [];\n  let separatorFound = false;\n\n  for (const row of rows) {\n    if (isSeparator(row)) {\n      separatorFound = true;\n      continue;\n    }\n\n    const cells = parseRow(row);\n    if (!cells) continue;\n\n    if (!separatorFound && !headerRow) {\n      headerRow = cells;\n    } else {\n      bodyRows.push(cells);\n    }\n  }\n\n  // Build HTML table\n  let html = '<table class=\"md-table\">';\n\n  if (headerRow) {\n    html += '<thead><tr>';\n    for (const cell of headerRow) {\n      html += `<th>${renderInline(cell, options)}</th>`;\n    }\n    html += '</tr></thead>';\n  }\n\n  if (bodyRows.length > 0) {\n    html += '<tbody>';\n    for (const row of bodyRows) {\n      html += '<tr>';\n      for (const cell of row) {\n        html += `<td>${renderInline(cell, options)}</td>`;\n      }\n      html += '</tr>';\n    }\n    html += '</tbody>';\n  }\n\n  html += '</table>';\n  return html;\n}\n","import { highlightTree, classHighlighter } from '@lezer/highlight';\nimport { javascript } from '@codemirror/lang-javascript';\nimport { python } from '@codemirror/lang-python';\nimport { css } from '@codemirror/lang-css';\nimport { html } from '@codemirror/lang-html';\nimport { json } from '@codemirror/lang-json';\n\nconst languageMap = {\n  javascript: javascript,\n  js: javascript,\n  typescript: () => javascript({ typescript: true }),\n  ts: () => javascript({ typescript: true }),\n  jsx: () => javascript({ jsx: true }),\n  tsx: () => javascript({ jsx: true, typescript: true }),\n  python: python,\n  py: python,\n  css: css,\n  html: html,\n  json: json,\n};\n\nfunction escapeHtml(text) {\n  return text\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;');\n}\n\nexport function highlightCode(code, language) {\n  const langFn = languageMap[language?.toLowerCase()];\n\n  if (!langFn) {\n    return escapeHtml(code);\n  }\n\n  const lang = typeof langFn === 'function' ? langFn() : langFn();\n  const tree = lang.language.parser.parse(code);\n\n  let result = '';\n  let pos = 0;\n\n  highlightTree(tree, classHighlighter, (from, to, classes) => {\n    if (from > pos) {\n      result += escapeHtml(code.slice(pos, from));\n    }\n    result += `<span class=\"${classes}\">${escapeHtml(code.slice(from, to))}</span>`;\n    pos = to;\n  });\n\n  if (pos < code.length) {\n    result += escapeHtml(code.slice(pos));\n  }\n\n  return result;\n}\n\nexport function getSupportedLanguages() {\n  return Object.keys(languageMap);\n}\n","/**\n * Hybrid Preview Extension for CodeMirror 6\n *\n * This extension provides \"hybrid\" markdown editing where:\n * - Lines WITHOUT cursor/selection show rendered preview (headings, bold, etc.)\n * - Lines WITH cursor/selection show raw markdown for editing\n *\n * ============================================================================\n * FOCUS/DECORATION INTERACTION\n * ============================================================================\n *\n * The key concept is \"focused lines\" - lines that contain any part of the\n * cursor or selection. These lines show raw markdown; all others show preview.\n *\n * Focus determination:\n * 1. Get all selection ranges from state.selection.ranges\n * 2. For each range, find start/end line numbers\n * 3. All lines in between are \"focused\" (added to Set)\n *\n * Decoration rules:\n * - Focused lines: No decoration (show raw markdown)\n * - Unfocused lines: Replace with MarkdownPreviewWidget (rendered HTML)\n * - Code blocks: Entire block focused if ANY line has cursor\n * - Tables: Entire table focused if ANY line has cursor\n * - Math blocks: Entire block focused if ANY line has cursor\n * - Mermaid diagrams: Entire block focused if ANY line has cursor\n *\n * When editor loses focus (hasFocus=false):\n * - ALL lines render as preview (no editing happening)\n *\n * Click handling:\n * - Clicking on preview calculates approximate character position\n * - Dispatches selection change to position cursor\n * - This triggers rebuild, showing raw markdown for that line\n *\n * ============================================================================\n */\n\nimport { EditorView, Decoration, WidgetType, ViewPlugin } from '@codemirror/view';\nimport { StateField, StateEffect, Facet } from '@codemirror/state';\nimport yaml from 'js-yaml';\nimport { allowReadOnlyEdit } from './read-only.js';\nimport {\n  renderMarkdownLine,\n  renderTable,\n  renderBlockMath,\n  renderFootnoteBlock,\n  renderDefinitionList,\n  CUSTOM_TASK_TYPES,\n  findWikiLinks,\n  findTags,\n} from '../utils/markdown.js';\n\n/**\n * Facet to configure whether collapse functionality is enabled\n */\nconst enableCollapseFacet = Facet.define({\n  combine(values) {\n    return values.length > 0 ? values[values.length - 1] : true;\n  },\n});\n\nconst DEFAULT_CUSTOM_TASK_TYPES = CUSTOM_TASK_TYPES;\nconst TASK_TOKEN_REGEX = /^(\\s*(?:[-*+]|\\d+\\.)\\s+)\\[([ xX!?>i*<])\\]/;\n\nfunction normalizeCustomTaskTypes(types) {\n  if (!Array.isArray(types)) {\n    return [...DEFAULT_CUSTOM_TASK_TYPES];\n  }\n\n  const normalized = [];\n  const seen = new Set();\n  for (const raw of types) {\n    if (typeof raw !== 'string' || raw.length === 0) continue;\n    const token = raw.toLowerCase();\n    if (!DEFAULT_CUSTOM_TASK_TYPES.includes(token)) continue;\n    if (seen.has(token)) continue;\n    seen.add(token);\n    normalized.push(token);\n  }\n\n  return normalized;\n}\n\nfunction getTaskCycle(customTaskTypes) {\n  return [' ', 'x', ...customTaskTypes];\n}\n\nfunction buildCustomTasksConfig(enableCustomTasks, customTaskTypes) {\n  const normalizedTypes = normalizeCustomTaskTypes(customTaskTypes);\n  return {\n    enableCustomTasks: enableCustomTasks === true,\n    customTaskTypes: normalizedTypes,\n    customTaskTypeSet: new Set(normalizedTypes),\n    taskCycle: getTaskCycle(normalizedTypes),\n  };\n}\n\nconst customTasksFacet = Facet.define({\n  combine(values) {\n    if (values.length === 0) {\n      return buildCustomTasksConfig(false, DEFAULT_CUSTOM_TASK_TYPES);\n    }\n    return values[values.length - 1];\n  },\n});\n\nfunction buildWikiLinksConfig(enableWikiLinks, renderWikiLinks, onWikiLinkClick) {\n  const enabled = enableWikiLinks === true;\n  const render = enabled && renderWikiLinks !== false;\n  const handler = typeof onWikiLinkClick === 'function' ? onWikiLinkClick : null;\n  return {\n    enableWikiLinks: enabled,\n    renderWikiLinks: render,\n    onWikiLinkClick: handler,\n  };\n}\n\nconst wikiLinksFacet = Facet.define({\n  combine(values) {\n    if (values.length === 0) {\n      return buildWikiLinksConfig(false, false, null);\n    }\n    return values[values.length - 1];\n  },\n});\n\nfunction buildTagsConfig(enableTags, onTagClick) {\n  const enabled = enableTags === true;\n  const handler = typeof onTagClick === 'function' ? onTagClick : null;\n  return { enableTags: enabled, onTagClick: handler };\n}\n\nconst tagsFacet = Facet.define({\n  combine(values) {\n    if (values.length === 0) {\n      return buildTagsConfig(false, null);\n    }\n    return values[values.length - 1];\n  },\n});\n\nfunction getListTaskToken(content, config) {\n  const match = content.match(TASK_TOKEN_REGEX);\n  if (!match) return null;\n\n  const token = match[2].toLowerCase();\n  if (token === ' ' || token === 'x') {\n    return token;\n  }\n\n  if (!config.enableCustomTasks) return null;\n\n  return config.customTaskTypeSet.has(token) ? token : null;\n}\n\nfunction getNextTaskToken(currentToken, cycle) {\n  if (!Array.isArray(cycle) || cycle.length === 0) return currentToken;\n  const index = cycle.indexOf(currentToken);\n  if (index === -1) return cycle[0];\n  return cycle[(index + 1) % cycle.length];\n}\n\nfunction replaceTaskToken(content, nextToken) {\n  return content.replace(TASK_TOKEN_REGEX, `$1[${nextToken}]`);\n}\n\nfunction getWikiLinkData(element) {\n  return {\n    raw: element.getAttribute('data-wikilink') || '',\n    title: element.getAttribute('data-wikilink-title') || '',\n    section: element.getAttribute('data-wikilink-section') || '',\n    alias: element.getAttribute('data-wikilink-alias') || '',\n    display: element.textContent || '',\n  };\n}\n\n// ============================================================================\n// HEADING COLLAPSE STATE\n// ============================================================================\n\n/**\n * StateEffect to toggle collapse state of a heading\n */\nexport const toggleCollapseEffect = StateEffect.define();\n\n/**\n * StateField that tracks which headings are collapsed.\n * Stores a Set of line numbers (1-based) that are collapsed.\n */\nexport const collapsedHeadingsField = StateField.define({\n  create() {\n    return new Set();\n  },\n  update(collapsed, tr) {\n    let newCollapsed = collapsed;\n\n    // Handle toggle effects\n    for (const effect of tr.effects) {\n      if (effect.is(toggleCollapseEffect)) {\n        newCollapsed = new Set(collapsed);\n        if (newCollapsed.has(effect.value)) {\n          newCollapsed.delete(effect.value);\n        } else {\n          newCollapsed.add(effect.value);\n        }\n      }\n    }\n\n    // Handle document changes - need to adjust line numbers\n    if (tr.docChanged && newCollapsed.size > 0) {\n      const adjustedSet = new Set();\n      for (const lineNum of newCollapsed) {\n        // Try to find the new line number after the change\n        // Map the old position to new position\n        const oldDoc = tr.startState.doc;\n        if (lineNum <= oldDoc.lines) {\n          const oldLine = oldDoc.line(lineNum);\n          const newPos = tr.changes.mapPos(oldLine.from);\n          const newLineNum = tr.newDoc.lineAt(newPos).number;\n          // Verify it's still a heading\n          const newLineText = tr.newDoc.line(newLineNum).text;\n          if (/^#{1,6}\\s/.test(newLineText)) {\n            adjustedSet.add(newLineNum);\n          }\n        }\n      }\n      newCollapsed = adjustedSet;\n    }\n\n    return newCollapsed;\n  },\n});\nimport { highlightCode } from '../utils/syntax-highlight.js';\nimport mermaid from 'mermaid';\n\n// Initialize mermaid\nmermaid.initialize({\n  startOnLoad: false,\n  theme: 'base',\n  securityLevel: 'loose',\n  themeVariables: {\n    primaryColor: '#f5f5f5',\n    secondaryColor: '#f5f5f5',\n    tertiaryColor: '#f5f5f5',\n    primaryBorderColor: '#ddd',\n    secondaryBorderColor: '#ddd',\n    tertiaryBorderColor: '#ddd',\n    lineColor: '#aaa',\n    edgeLabelBackground: '#fff',\n  },\n});\n\n/**\n * Widget that renders a markdown line as HTML\n * Handles click events to position cursor correctly\n */\nclass MarkdownPreviewWidget extends WidgetType {\n  constructor(content, lineFrom, lineTo) {\n    super();\n    this.content = content;\n    this.lineFrom = lineFrom;\n    this.lineTo = lineTo;\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('span');\n    wrapper.className = 'cm-markdown-preview';\n    const customTasksConfig = view.state.facet(customTasksFacet);\n    const wikiLinksConfig = view.state.facet(wikiLinksFacet);\n    const tagsConfig = view.state.facet(tagsFacet);\n    wrapper.innerHTML = renderMarkdownLine(this.content, {\n      ...customTasksConfig,\n      enableWikiLinks: wikiLinksConfig.renderWikiLinks,\n      enableTags: tagsConfig.enableTags,\n    });\n\n    // Store references for click handler\n    const lineFrom = this.lineFrom;\n    const lineTo = this.lineTo;\n    const content = this.content;\n\n    // Handle click to position cursor\n    wrapper.addEventListener('mousedown', (e) => {\n      // Check if clicked on a tag\n      const tagEl = e.target.closest('[data-tag]');\n      if (tagEl && tagsConfig.onTagClick) {\n        e.preventDefault();\n        e.stopPropagation();\n        tagsConfig.onTagClick(tagEl.getAttribute('data-tag'));\n        return;\n      }\n\n      // Check if clicked on a footnote link\n      const footnoteLink = e.target.closest('[data-footnote]');\n      if (footnoteLink) {\n        e.preventDefault();\n        e.stopPropagation();\n        const footnoteId = footnoteLink.getAttribute('data-footnote');\n        // Find the footnote definition line [^id]:\n        const doc = view.state.doc;\n        for (let i = 1; i <= doc.lines; i++) {\n          const line = doc.line(i);\n          if (line.text.match(new RegExp(`^\\\\[\\\\^${footnoteId}\\\\]:`))) {\n            view.dispatch({\n              selection: { anchor: line.from },\n              scrollIntoView: true,\n            });\n            view.focus();\n            return;\n          }\n        }\n        return;\n      }\n\n      // Check if clicked on a footnote back reference\n      const footnoteBackref = e.target.closest('[data-footnote-ref]');\n      if (footnoteBackref) {\n        e.preventDefault();\n        e.stopPropagation();\n        const footnoteId = footnoteBackref.getAttribute('data-footnote-ref');\n        const doc = view.state.doc;\n        for (let i = 1; i <= doc.lines; i++) {\n          const line = doc.line(i);\n          if (line.text.match(new RegExp(`\\\\[\\\\^${footnoteId}\\\\](?!:)`))) {\n            view.dispatch({\n              selection: { anchor: line.from },\n              scrollIntoView: true,\n            });\n            view.focus();\n            return;\n          }\n        }\n        return;\n      }\n\n      // Check if clicked on a wiki link (only if handler provided)\n      const wikiLink = e.target.closest('[data-wikilink]');\n      if (wikiLink && wikiLinksConfig.onWikiLinkClick) {\n        e.preventDefault();\n        e.stopPropagation();\n        wikiLinksConfig.onWikiLinkClick(getWikiLinkData(wikiLink));\n        return;\n      }\n\n      // Check if clicked on a link\n      const link = e.target.closest('a');\n      if (link && link.href) {\n        e.preventDefault();\n        e.stopPropagation();\n        window.open(link.href, '_blank', 'noopener,noreferrer');\n        return;\n      }\n\n      // Check if clicked on a task toggle (checkbox or custom task icon)\n      const taskToggle = e.target.closest('input[type=\"checkbox\"], .md-task-icon');\n      if (taskToggle) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const taskConfig = view.state.facet(customTasksFacet);\n        const currentToken = getListTaskToken(content, taskConfig);\n        if (!currentToken) {\n          return;\n        }\n\n        const nextToken = taskConfig.enableCustomTasks\n          ? getNextTaskToken(currentToken, taskConfig.taskCycle)\n          : (currentToken === 'x' ? ' ' : 'x');\n\n        const newContent = replaceTaskToken(content, nextToken);\n        if (newContent !== content) {\n          view.dispatch({\n            changes: { from: lineFrom, to: lineTo, insert: newContent },\n            annotations: allowReadOnlyEdit.of(true),\n          });\n        }\n        return;\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      // Get click position relative to the wrapper\n      const rect = wrapper.getBoundingClientRect();\n      const clickX = e.clientX - rect.left;\n      const totalWidth = rect.width;\n\n      // Estimate character position based on click location\n      const textLength = content.length;\n      let charPos;\n\n      if (totalWidth > 0 && textLength > 0) {\n        // Calculate position proportionally\n        const ratio = clickX / totalWidth;\n        charPos = Math.round(ratio * textLength);\n        charPos = Math.max(0, Math.min(charPos, textLength));\n      } else {\n        charPos = 0;\n      }\n\n      const cursorPos = lineFrom + charPos;\n\n      // Dispatch selection change\n      view.dispatch({\n        selection: { anchor: cursorPos },\n        scrollIntoView: true,\n      });\n\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    return other.content === this.content &&\n           other.lineFrom === this.lineFrom &&\n           other.lineTo === this.lineTo;\n  }\n\n  ignoreEvent(event) {\n    // We handle mousedown ourselves\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Widget that renders a heading with a collapse toggle button\n */\nclass HeadingPreviewWidget extends WidgetType {\n  constructor(content, lineFrom, lineTo, lineNumber, level, isCollapsed, hasContent) {\n    super();\n    this.content = content;\n    this.lineFrom = lineFrom;\n    this.lineTo = lineTo;\n    this.lineNumber = lineNumber;\n    this.level = level;\n    this.isCollapsed = isCollapsed;\n    this.hasContent = hasContent; // Whether this heading has content under it\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('span');\n    wrapper.className = 'cm-markdown-preview cm-heading-preview';\n\n    // Create collapse toggle button (only if heading has content)\n    if (this.hasContent) {\n      const toggle = document.createElement('span');\n      toggle.className = `cm-collapse-toggle ${this.isCollapsed ? 'collapsed' : 'expanded'}`;\n      toggle.textContent = '‚Ä∫';\n      toggle.title = this.isCollapsed ? 'Expand' : 'Collapse';\n\n      const lineNumber = this.lineNumber;\n\n      // Use click instead of mousedown to avoid focus issues\n      toggle.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        e.stopImmediatePropagation();\n\n        // Dispatch the toggle effect without changing selection\n        view.dispatch({\n          effects: toggleCollapseEffect.of(lineNumber),\n        });\n      });\n\n      // Also prevent mousedown from affecting focus\n      toggle.addEventListener('mousedown', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        e.stopImmediatePropagation();\n      });\n\n      wrapper.appendChild(toggle);\n    }\n\n    // Render the heading content\n    const headingContent = document.createElement('span');\n    const customTasksConfig = view.state.facet(customTasksFacet);\n    const wikiLinksConfig = view.state.facet(wikiLinksFacet);\n    const tagsConfig = view.state.facet(tagsFacet);\n    headingContent.innerHTML = renderMarkdownLine(this.content, {\n      ...customTasksConfig,\n      enableWikiLinks: wikiLinksConfig.renderWikiLinks,\n      enableTags: tagsConfig.enableTags,\n    });\n    wrapper.appendChild(headingContent);\n\n    // Store references for click handler\n    const lineFrom = this.lineFrom;\n    const lineTo = this.lineTo;\n    const content = this.content;\n\n    // Handle click to position cursor (on the heading text, not toggle)\n    headingContent.addEventListener('mousedown', (e) => {\n      // Check if clicked on a tag\n      const tagEl = e.target.closest('[data-tag]');\n      if (tagEl && tagsConfig.onTagClick) {\n        e.preventDefault();\n        e.stopPropagation();\n        tagsConfig.onTagClick(tagEl.getAttribute('data-tag'));\n        return;\n      }\n\n      // Check if clicked on a wiki link (only if handler provided)\n      const wikiLink = e.target.closest('[data-wikilink]');\n      if (wikiLink && wikiLinksConfig.onWikiLinkClick) {\n        e.preventDefault();\n        e.stopPropagation();\n        wikiLinksConfig.onWikiLinkClick(getWikiLinkData(wikiLink));\n        return;\n      }\n\n      // Check if clicked on a link\n      const link = e.target.closest('a');\n      if (link && link.href) {\n        e.preventDefault();\n        e.stopPropagation();\n        window.open(link.href, '_blank', 'noopener,noreferrer');\n        return;\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      // Get click position relative to the wrapper\n      const rect = headingContent.getBoundingClientRect();\n      const clickX = e.clientX - rect.left;\n      const totalWidth = rect.width;\n\n      // Estimate character position based on click location\n      const textLength = content.length;\n      let charPos;\n\n      if (totalWidth > 0 && textLength > 0) {\n        const ratio = clickX / totalWidth;\n        charPos = Math.round(ratio * textLength);\n        charPos = Math.max(0, Math.min(charPos, textLength));\n      } else {\n        charPos = 0;\n      }\n\n      const cursorPos = lineFrom + charPos;\n\n      view.dispatch({\n        selection: { anchor: cursorPos },\n        scrollIntoView: true,\n      });\n\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    return other.content === this.content &&\n           other.lineFrom === this.lineFrom &&\n           other.lineTo === this.lineTo &&\n           other.isCollapsed === this.isCollapsed &&\n           other.hasContent === this.hasContent;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Get the set of line numbers that contain the cursor or selection\n */\nfunction getFocusedLines(state) {\n  const focused = new Set();\n\n  for (const range of state.selection.ranges) {\n    const startLine = state.doc.lineAt(range.from).number;\n    const endLine = state.doc.lineAt(range.to).number;\n\n    for (let i = startLine; i <= endLine; i++) {\n      focused.add(i);\n    }\n  }\n\n  return focused;\n}\n\n// ============================================================================\n// SHARED STATE FOR BLOCK RANGES (Performance Optimization)\n// ============================================================================\n//\n// Block ranges (code blocks, tables, math, mermaid) are computed ONCE per\n// document change and shared across all ViewPlugins via a StateField.\n// This avoids redundant O(n) document scans on every keystroke.\n//\n// The StateField also provides O(1) Set-based lookups for line membership.\n// ============================================================================\n\n/**\n * Detect YAML frontmatter at the start of the document.\n * Frontmatter must start on line 1 with `---` and end with a closing `---`.\n * @returns {{ start: number, end: number } | null}\n */\nfunction computeFrontmatterRange(doc) {\n  if (doc.lines < 2) return null;\n  const firstLine = doc.line(1).text.trim();\n  if (firstLine !== '---') return null;\n\n  for (let i = 2; i <= doc.lines; i++) {\n    const text = doc.line(i).text.trim();\n    if (text === '---' || text === '...') {\n      return { start: 1, end: i };\n    }\n  }\n\n  return null;\n}\n\n/**\n * Detect code blocks in the document and return line ranges with language\n */\nfunction computeCodeBlockRanges(doc) {\n  const ranges = [];\n  let inCodeBlock = false;\n  let blockStart = 0;\n  let blockLanguage = '';\n\n  for (let i = 1; i <= doc.lines; i++) {\n    const line = doc.line(i);\n    const text = line.text;\n\n    if (text.startsWith('```')) {\n      if (!inCodeBlock) {\n        inCodeBlock = true;\n        blockStart = i;\n        blockLanguage = text.slice(3).trim();\n      } else {\n        ranges.push({ start: blockStart, end: i, language: blockLanguage });\n        inCodeBlock = false;\n        blockLanguage = '';\n      }\n    }\n  }\n\n  // Handle unclosed code block\n  if (inCodeBlock) {\n    ranges.push({ start: blockStart, end: doc.lines, language: blockLanguage });\n  }\n\n  return ranges;\n}\n\n/**\n * Detect math blocks ($$...$$) in the document\n */\nfunction computeMathBlockRanges(doc, codeBlockLineSet) {\n  const ranges = [];\n  let mathStart = null;\n\n  for (let i = 1; i <= doc.lines; i++) {\n    // Skip lines inside code blocks (O(1) lookup)\n    if (codeBlockLineSet.has(i)) {\n      if (mathStart !== null) {\n        mathStart = null; // Reset if we enter a code block\n      }\n      continue;\n    }\n\n    const line = doc.line(i);\n    const text = line.text.trim();\n\n    if (text === '$$') {\n      if (mathStart === null) {\n        mathStart = i;\n      } else {\n        ranges.push({ start: mathStart, end: i });\n        mathStart = null;\n      }\n    }\n  }\n\n  return ranges;\n}\n\n/**\n * Detect table blocks in the document\n */\nfunction computeTableRanges(doc, codeBlockLineSet) {\n  const ranges = [];\n  let tableStart = null;\n\n  for (let i = 1; i <= doc.lines; i++) {\n    // Skip lines inside code blocks (O(1) lookup)\n    if (codeBlockLineSet.has(i)) {\n      if (tableStart !== null) {\n        ranges.push({ start: tableStart, end: i - 1 });\n        tableStart = null;\n      }\n      continue;\n    }\n\n    const line = doc.line(i);\n    const text = line.text.trim();\n    const isTableLine = text.startsWith('|') && text.endsWith('|');\n\n    if (isTableLine) {\n      if (tableStart === null) {\n        tableStart = i;\n      }\n    } else {\n      if (tableStart !== null) {\n        ranges.push({ start: tableStart, end: i - 1 });\n        tableStart = null;\n      }\n    }\n  }\n\n  // Handle table at end of document\n  if (tableStart !== null) {\n    ranges.push({ start: tableStart, end: doc.lines });\n  }\n\n  return ranges;\n}\n\nfunction isIndentedContinuation(text) {\n  return /^(\\s{2,}|\\t)/.test(text);\n}\n\n/**\n * Detect footnote definition blocks in the document (multi-line)\n */\nfunction computeFootnoteDefinitionRanges(doc, codeBlockLineSet) {\n  const ranges = [];\n\n  for (let i = 1; i <= doc.lines; i++) {\n    if (codeBlockLineSet.has(i)) continue;\n\n    const line = doc.line(i);\n    const match = line.text.match(/^\\[\\^([^\\]]+)\\]:\\s*(.*)$/);\n    if (!match) continue;\n\n    const id = match[1];\n    let end = i;\n\n    for (let j = i + 1; j <= doc.lines; j++) {\n      if (codeBlockLineSet.has(j)) break;\n      const nextLine = doc.line(j).text;\n      if (!isIndentedContinuation(nextLine)) {\n        break;\n      }\n      end = j;\n    }\n\n    ranges.push({ start: i, end, id });\n    i = end;\n  }\n\n  return ranges;\n}\n\n/**\n * Detect definition list blocks in the document\n */\nfunction computeDefinitionListRanges(doc, codeBlockLineSet, footnoteLineSet) {\n  const ranges = [];\n\n  const isDefinitionLine = (text) => /^\\s*:\\s*/.test(text);\n  const isTermCandidate = (text) => {\n    if (!text.trim()) return false;\n    if (/^\\s/.test(text)) return false;\n    if (/^[-*+]\\s+/.test(text)) return false;\n    if (/^\\d+\\.\\s+/.test(text)) return false;\n    if (/^>/.test(text)) return false;\n    if (/^#{1,6}\\s+/.test(text)) return false;\n    const trimmed = text.trim();\n    if (trimmed.startsWith('|') && trimmed.endsWith('|')) return false;\n    if (/^\\[\\^([^\\]]+)\\]:/.test(text)) return false;\n    return true;\n  };\n\n  for (let i = 1; i <= doc.lines; i++) {\n    if (codeBlockLineSet.has(i) || footnoteLineSet.has(i)) continue;\n\n    const line = doc.line(i).text;\n    if (!isTermCandidate(line)) continue;\n\n    const nextLineNum = i + 1;\n    if (nextLineNum > doc.lines) continue;\n    if (codeBlockLineSet.has(nextLineNum) || footnoteLineSet.has(nextLineNum)) continue;\n\n    const nextLine = doc.line(nextLineNum).text;\n    if (!isDefinitionLine(nextLine)) continue;\n\n    let end = nextLineNum;\n    for (let j = nextLineNum + 1; j <= doc.lines; j++) {\n      if (codeBlockLineSet.has(j) || footnoteLineSet.has(j)) break;\n      const text = doc.line(j).text;\n      if (isDefinitionLine(text) || isIndentedContinuation(text)) {\n        end = j;\n        continue;\n      }\n      break;\n    }\n\n    ranges.push({ start: i, end });\n    i = end;\n  }\n\n  return ranges;\n}\n\n/**\n * Build a Set of line numbers from an array of ranges (for O(1) lookup)\n */\nfunction buildLineSet(ranges) {\n  const lineSet = new Set();\n  for (const range of ranges) {\n    for (let i = range.start; i <= range.end; i++) {\n      lineSet.add(i);\n    }\n  }\n  return lineSet;\n}\n\n/**\n * Compute heading ranges - for each heading, determine which lines belong to it\n * A heading's content extends until the next heading of equal or higher level\n * @returns {Array<{line: number, level: number, endLine: number}>}\n */\nfunction computeHeadingRanges(doc, codeBlockLines) {\n  const headings = [];\n\n  // First pass: find all headings\n  for (let i = 1; i <= doc.lines; i++) {\n    if (codeBlockLines.has(i)) continue;\n\n    const line = doc.line(i);\n    const match = line.text.match(/^(#{1,6})\\s+/);\n    if (match) {\n      headings.push({\n        line: i,\n        level: match[1].length,\n        endLine: doc.lines, // Will be adjusted in second pass\n      });\n    }\n  }\n\n  // Second pass: determine end lines for each heading\n  for (let i = 0; i < headings.length; i++) {\n    const current = headings[i];\n    // Find next heading of equal or higher level (lower number)\n    for (let j = i + 1; j < headings.length; j++) {\n      if (headings[j].level <= current.level) {\n        current.endLine = headings[j].line - 1;\n        break;\n      }\n    }\n  }\n\n  return headings;\n}\n\n/**\n * Build a map from line number to its parent heading (for collapse checking)\n * @returns {Map<number, number>} Map from line number to heading line number\n */\nfunction buildHeadingMap(headings) {\n  const map = new Map();\n  for (const heading of headings) {\n    // Map all lines in this heading's range to the heading line\n    for (let i = heading.line + 1; i <= heading.endLine; i++) {\n      // Only set if not already set (deeper headings take precedence)\n      if (!map.has(i)) {\n        map.set(i, heading.line);\n      }\n    }\n  }\n  return map;\n}\n\n/**\n * StateField that computes and caches all block ranges.\n * Recomputed only when the document changes.\n */\nexport const blockRangesField = StateField.define({\n  create(state) {\n    return computeBlockRanges(state.doc);\n  },\n  update(value, tr) {\n    // Only recompute if document changed\n    if (tr.docChanged) {\n      return computeBlockRanges(tr.newDoc);\n    }\n    return value;\n  },\n});\n\n/**\n * Compute all block ranges and line sets for the document\n */\nfunction computeBlockRanges(doc) {\n  const frontmatter = computeFrontmatterRange(doc);\n  const frontmatterLines = frontmatter ? buildLineSet([frontmatter]) : new Set();\n\n  const codeBlocks = computeCodeBlockRanges(doc);\n  const codeBlockLines = buildLineSet(codeBlocks);\n\n  const mathBlocks = computeMathBlockRanges(doc, codeBlockLines);\n  const mathBlockLines = buildLineSet(mathBlocks);\n\n  const tables = computeTableRanges(doc, codeBlockLines);\n  const tableLines = buildLineSet(tables);\n\n  const footnoteBlocks = computeFootnoteDefinitionRanges(doc, codeBlockLines);\n  const footnoteBlockLines = buildLineSet(footnoteBlocks);\n\n  const definitionLists = computeDefinitionListRanges(doc, codeBlockLines, footnoteBlockLines);\n  const definitionListLines = buildLineSet(definitionLists);\n\n  const mermaidBlocks = codeBlocks.filter(r => r.language === 'mermaid');\n  const mermaidBlockLines = buildLineSet(mermaidBlocks);\n\n  // Compute heading ranges for collapse functionality\n  const headings = computeHeadingRanges(doc, codeBlockLines);\n  const headingMap = buildHeadingMap(headings);\n\n  return {\n    frontmatter,\n    frontmatterLines,\n    codeBlocks,\n    codeBlockLines,\n    mathBlocks,\n    mathBlockLines,\n    tables,\n    tableLines,\n    footnoteBlocks,\n    footnoteBlockLines,\n    definitionLists,\n    definitionListLines,\n    mermaidBlocks,\n    mermaidBlockLines,\n    headings,\n    headingMap,\n  };\n}\n\n/**\n * Widget that renders a math block\n */\nclass MathBlockWidget extends WidgetType {\n  constructor(content, mathFrom, mathTo) {\n    super();\n    this.content = content;\n    this.mathFrom = mathFrom;\n    this.mathTo = mathTo;\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'cm-math-preview';\n    wrapper.innerHTML = renderBlockMath(this.content);\n\n    const mathFrom = this.mathFrom;\n\n    wrapper.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      view.dispatch({\n        selection: { anchor: mathFrom },\n        scrollIntoView: true,\n      });\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    return other.content === this.content;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Widget that renders a mermaid diagram\n */\nclass MermaidBlockWidget extends WidgetType {\n  constructor(content, mermaidFrom, mermaidTo) {\n    super();\n    this.content = content;\n    this.mermaidFrom = mermaidFrom;\n    this.mermaidTo = mermaidTo;\n    this.id = 'mermaid-' + Math.random().toString(36).substr(2, 9);\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'cm-mermaid-preview';\n\n    const mermaidFrom = this.mermaidFrom;\n    const content = this.content;\n    const id = this.id;\n\n    // Render mermaid diagram asynchronously\n    (async () => {\n      try {\n        const { svg } = await mermaid.render(id, content);\n        wrapper.innerHTML = svg;\n      } catch (e) {\n        wrapper.innerHTML = `<pre class=\"mermaid-error\">${e.message}</pre>`;\n      }\n    })();\n\n    wrapper.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      view.dispatch({\n        selection: { anchor: mermaidFrom },\n        scrollIntoView: true,\n      });\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    return other.content === this.content;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n\n/**\n * Widget that renders a complete table\n */\nclass TableWidget extends WidgetType {\n  constructor(rows, tableFrom, tableTo) {\n    super();\n    this.rows = rows;\n    this.tableFrom = tableFrom;\n    this.tableTo = tableTo;\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'cm-table-preview';\n    const wikiLinksConfig = view.state.facet(wikiLinksFacet);\n    wrapper.innerHTML = renderTable(this.rows, { enableWikiLinks: wikiLinksConfig.renderWikiLinks });\n\n    const tableFrom = this.tableFrom;\n\n    wrapper.addEventListener('mousedown', (e) => {\n      const wikiLink = e.target.closest('[data-wikilink]');\n      if (wikiLink && wikiLinksConfig.onWikiLinkClick) {\n        e.preventDefault();\n        e.stopPropagation();\n        wikiLinksConfig.onWikiLinkClick(getWikiLinkData(wikiLink));\n        return;\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      // Position cursor at start of table\n      view.dispatch({\n        selection: { anchor: tableFrom },\n        scrollIntoView: true,\n      });\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    // Fast array comparison without JSON.stringify\n    if (other.rows.length !== this.rows.length) return false;\n    for (let i = 0; i < this.rows.length; i++) {\n      if (other.rows[i] !== this.rows[i]) return false;\n    }\n    return true;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Widget that renders a footnote definition block\n */\nclass FootnoteBlockWidget extends WidgetType {\n  constructor(id, lines, from, to) {\n    super();\n    this.id = id;\n    this.lines = lines;\n    this.from = from;\n    this.to = to;\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'cm-footnote-preview';\n    const wikiLinksConfig = view.state.facet(wikiLinksFacet);\n    wrapper.innerHTML = renderFootnoteBlock(this.id, this.lines, { enableWikiLinks: wikiLinksConfig.renderWikiLinks });\n\n    const from = this.from;\n\n    wrapper.addEventListener('mousedown', (e) => {\n      const wikiLink = e.target.closest('[data-wikilink]');\n      if (wikiLink && wikiLinksConfig.onWikiLinkClick) {\n        e.preventDefault();\n        e.stopPropagation();\n        wikiLinksConfig.onWikiLinkClick(getWikiLinkData(wikiLink));\n        return;\n      }\n\n      const footnoteBackref = e.target.closest('[data-footnote-ref]');\n      if (footnoteBackref) {\n        e.preventDefault();\n        e.stopPropagation();\n        const footnoteId = footnoteBackref.getAttribute('data-footnote-ref');\n        const doc = view.state.doc;\n        for (let i = 1; i <= doc.lines; i++) {\n          const line = doc.line(i);\n          if (line.text.match(new RegExp(`\\\\[\\\\^${footnoteId}\\\\](?!:)`))) {\n            view.dispatch({\n              selection: { anchor: line.from },\n              scrollIntoView: true,\n            });\n            view.focus();\n            return;\n          }\n        }\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      view.dispatch({\n        selection: { anchor: from },\n        scrollIntoView: true,\n      });\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    if (other.id !== this.id) return false;\n    if (other.lines.length !== this.lines.length) return false;\n    for (let i = 0; i < this.lines.length; i++) {\n      if (other.lines[i] !== this.lines[i]) return false;\n    }\n    return true;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Widget that renders a definition list block\n */\nclass DefinitionListWidget extends WidgetType {\n  constructor(lines, from, to) {\n    super();\n    this.lines = lines;\n    this.from = from;\n    this.to = to;\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'cm-definition-list-preview';\n    const wikiLinksConfig = view.state.facet(wikiLinksFacet);\n    wrapper.innerHTML = renderDefinitionList(this.lines, { enableWikiLinks: wikiLinksConfig.renderWikiLinks });\n\n    const from = this.from;\n\n    wrapper.addEventListener('mousedown', (e) => {\n      const wikiLink = e.target.closest('[data-wikilink]');\n      if (wikiLink && wikiLinksConfig.onWikiLinkClick) {\n        e.preventDefault();\n        e.stopPropagation();\n        wikiLinksConfig.onWikiLinkClick(getWikiLinkData(wikiLink));\n        return;\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      view.dispatch({\n        selection: { anchor: from },\n        scrollIntoView: true,\n      });\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    if (other.lines.length !== this.lines.length) return false;\n    for (let i = 0; i < this.lines.length; i++) {\n      if (other.lines[i] !== this.lines[i]) return false;\n    }\n    return true;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Check if a line should be hidden due to a collapsed heading\n * @param {number} lineNum - Line number to check\n * @param {Array} headings - Array of heading objects\n * @param {Set} collapsed - Set of collapsed heading line numbers\n * @returns {boolean} True if line should be hidden\n */\nfunction isLineCollapsed(lineNum, headings, collapsed) {\n  for (const heading of headings) {\n    // Check if this heading is collapsed and contains the line\n    if (collapsed.has(heading.line) && lineNum > heading.line && lineNum <= heading.endLine) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Get heading info for a line if it's a heading\n */\nfunction getHeadingInfo(lineNum, headings) {\n  for (const heading of headings) {\n    if (heading.line === lineNum) {\n      return heading;\n    }\n  }\n  return null;\n}\n\n/**\n * Build decorations for all non-focused lines (viewport-aware)\n * @param {EditorView} view - The editor view\n * @param {Object} blockRanges - Precomputed block ranges from StateField\n */\nfunction buildDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  // If editor doesn't have focus, render preview for all lines\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n  const {\n    frontmatterLines,\n    codeBlockLines,\n    tableLines,\n    mathBlockLines,\n    footnoteBlockLines,\n    definitionListLines,\n    headings,\n  } = blockRanges;\n  const decorations = [];\n\n  // Check if collapse functionality is enabled\n  const collapseEnabled = state.facet(enableCollapseFacet);\n\n  // Get collapsed headings state (only if collapse is enabled)\n  const collapsed = collapseEnabled ? state.field(collapsedHeadingsField) : new Set();\n\n  // Only process lines in the visible viewport (+ small buffer)\n  for (const { from, to } of view.visibleRanges) {\n    const startLine = state.doc.lineAt(from).number;\n    const endLine = state.doc.lineAt(to).number;\n\n    for (let i = startLine; i <= endLine; i++) {\n      // Check if line is hidden due to collapsed heading (only if collapse enabled)\n      if (collapseEnabled && isLineCollapsed(i, headings, collapsed)) {\n        // Hide the line with a line decoration (CSS handles animation)\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-collapsed-line' }).range(line.from)\n        );\n        continue;\n      }\n\n      // Skip frontmatter lines (handled by frontmatterDecorations plugin)\n      if (frontmatterLines.has(i)) {\n        continue;\n      }\n\n      // Skip lines that contain the cursor/selection\n      if (focusedLines.has(i)) {\n        continue;\n      }\n\n      // Skip lines inside code blocks (show raw with styling) - O(1) lookup\n      if (codeBlockLines.has(i)) {\n        continue;\n      }\n\n      // Skip table lines (handled by separate tableDecorations plugin) - O(1) lookup\n      if (tableLines.has(i)) {\n        continue;\n      }\n\n      // Skip math block lines (handled by mathBlockDecorations plugin) - O(1) lookup\n      if (mathBlockLines.has(i)) {\n        continue;\n      }\n\n      // Skip footnote definition lines (handled by footnoteBlockDecorations plugin)\n      if (footnoteBlockLines.has(i)) {\n        continue;\n      }\n\n      // Skip definition list lines (handled by definitionListDecorations plugin)\n      if (definitionListLines.has(i)) {\n        continue;\n      }\n\n      const line = state.doc.line(i);\n      const content = line.text;\n\n      // Skip standalone image lines (handled by imageDecorations plugin)\n      if (parseImageLine(content)) {\n        continue;\n      }\n\n      // Skip empty lines\n      if (!content.trim()) {\n        continue;\n      }\n\n      // Check if this is a heading line (use special widget only if collapse is enabled)\n      if (collapseEnabled) {\n        const headingInfo = getHeadingInfo(i, headings);\n        if (headingInfo) {\n          // Check if heading has content (endLine > line)\n          const hasContent = headingInfo.endLine > headingInfo.line;\n          const isCollapsed = collapsed.has(i);\n\n          decorations.push(\n            Decoration.replace({\n              widget: new HeadingPreviewWidget(\n                content,\n                line.from,\n                line.to,\n                i,\n                headingInfo.level,\n                isCollapsed,\n                hasContent\n              ),\n              inclusive: false,\n              block: false,\n            }).range(line.from, line.to)\n          );\n          continue;\n        }\n      }\n\n      // Create replace decoration for the line content\n      decorations.push(\n        Decoration.replace({\n          widget: new MarkdownPreviewWidget(content, line.from, line.to),\n          inclusive: false,\n          block: false,\n        }).range(line.from, line.to)\n      );\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\n/**\n * Build decorations for wiki links in focused lines\n */\nfunction buildWikiLinkDecorations(view, blockRanges) {\n  const wikiLinksConfig = view.state.facet(wikiLinksFacet);\n  if (!wikiLinksConfig.enableWikiLinks) {\n    return Decoration.none;\n  }\n\n  if (!view.hasFocus) {\n    return Decoration.none;\n  }\n\n  const { state } = view;\n  const focusedLines = getFocusedLines(state);\n  const { codeBlockLines } = blockRanges;\n  const decorations = [];\n\n  for (const { from, to } of view.visibleRanges) {\n    const startLine = state.doc.lineAt(from).number;\n    const endLine = state.doc.lineAt(to).number;\n\n    for (let i = startLine; i <= endLine; i++) {\n      if (!focusedLines.has(i)) continue;\n      if (codeBlockLines.has(i)) continue;\n\n      const line = state.doc.line(i);\n      if (!line.text.includes('[[')) continue;\n\n      const matches = findWikiLinks(line.text);\n      for (const match of matches) {\n        decorations.push(\n          Decoration.mark({ class: 'cm-wikilink' }).range(\n            line.from + match.from,\n            line.from + match.to\n          )\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\n/**\n * ViewPlugin to manage preview decorations\n */\nconst hybridPreviewPlugin = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      // Check if any collapse effects were dispatched\n      const hasCollapseEffect = update.transactions.some(tr =>\n        tr.effects.some(e => e.is(toggleCollapseEffect))\n      );\n\n      // Rebuild on doc changes, selection changes, viewport changes, focus changes, or collapse changes\n      if (update.docChanged || update.selectionSet || update.viewportChanged || update.focusChanged || hasCollapseEffect) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\nconst wikiLinkDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildWikiLinkDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.viewportChanged || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildWikiLinkDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * Build decorations for tags in focused lines\n */\nfunction buildTagDecorations(view, blockRanges) {\n  const tagsConfig = view.state.facet(tagsFacet);\n  if (!tagsConfig.enableTags) {\n    return Decoration.none;\n  }\n\n  if (!view.hasFocus) {\n    return Decoration.none;\n  }\n\n  const { state } = view;\n  const focusedLines = getFocusedLines(state);\n  const { codeBlockLines } = blockRanges;\n  const decorations = [];\n\n  for (const { from, to } of view.visibleRanges) {\n    const startLine = state.doc.lineAt(from).number;\n    const endLine = state.doc.lineAt(to).number;\n\n    for (let i = startLine; i <= endLine; i++) {\n      if (!focusedLines.has(i)) continue;\n      if (codeBlockLines.has(i)) continue;\n\n      const line = state.doc.line(i);\n      if (!line.text.includes('#')) continue;\n\n      const matches = findTags(line.text);\n      for (const match of matches) {\n        decorations.push(\n          Decoration.mark({ class: 'cm-tag-mark' }).range(\n            line.from + match.from,\n            line.from + match.to\n          )\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst tagDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildTagDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.viewportChanged || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildTagDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * Widget that renders a syntax-highlighted code line\n */\nclass HighlightedCodeWidget extends WidgetType {\n  constructor(content, language, lineFrom, lineTo) {\n    super();\n    this.content = content;\n    this.language = language;\n    this.lineFrom = lineFrom;\n    this.lineTo = lineTo;\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('span');\n    wrapper.className = 'cm-highlighted-code';\n    wrapper.innerHTML = highlightCode(this.content, this.language);\n\n    const lineFrom = this.lineFrom;\n    const lineTo = this.lineTo;\n    const content = this.content;\n\n    wrapper.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      // Estimate character position based on click location\n      const rect = wrapper.getBoundingClientRect();\n      const clickX = e.clientX - rect.left;\n      const totalWidth = rect.width;\n      const textLength = content.length;\n\n      let charPos = 0;\n      if (totalWidth > 0 && textLength > 0) {\n        const ratio = clickX / totalWidth;\n        charPos = Math.round(ratio * textLength);\n        charPos = Math.max(0, Math.min(charPos, textLength));\n      }\n\n      const cursorPos = lineFrom + charPos;\n\n      view.dispatch({\n        selection: { anchor: cursorPos },\n        scrollIntoView: true,\n      });\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    return other.content === this.content && other.language === this.language;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Build line decorations for code blocks (adds background styling and syntax highlighting)\n * @param {EditorView} view - The editor view\n * @param {Object} blockRanges - Precomputed block ranges from StateField\n */\nfunction buildCodeBlockDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  const decorations = [];\n  const { codeBlocks } = blockRanges;\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n\n  for (const range of codeBlocks) {\n    // Skip mermaid blocks - they're handled separately\n    if (range.language === 'mermaid') {\n      continue;\n    }\n    // Check if any line in this code block is focused\n    let blockFocused = false;\n    for (let j = range.start; j <= range.end; j++) {\n      if (focusedLines.has(j)) {\n        blockFocused = true;\n        break;\n      }\n    }\n\n    // Check if block has content lines (not just fences)\n    const hasContent = range.end - range.start > 1;\n\n    for (let i = range.start; i <= range.end; i++) {\n      const line = state.doc.line(i);\n      const isFence = i === range.start || i === range.end;\n\n      // Hide fence lines when not focused and block has content\n      if (isFence && !blockFocused && hasContent) {\n        decorations.push(\n          Decoration.replace({}).range(line.from, line.to)\n        );\n        continue;\n      }\n\n      // Add background styling - use focused style if block is being edited\n      const lineClass = blockFocused ? 'cm-code-block-line cm-code-block-focused' : 'cm-code-block-line';\n      decorations.push(\n        Decoration.line({ class: lineClass }).range(line.from)\n      );\n\n      // Add syntax highlighting for content lines (not fences, not focused)\n      const isFocused = focusedLines.has(i);\n\n      if (!isFence && !isFocused && line.text.length > 0) {\n        decorations.push(\n          Decoration.replace({\n            widget: new HighlightedCodeWidget(line.text, range.language, line.from, line.to),\n          }).range(line.from, line.to)\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst codeBlockDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildCodeBlockDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildCodeBlockDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * Build decorations for tables\n * @param {EditorView} view - The editor view\n * @param {Object} blockRanges - Precomputed block ranges from StateField\n */\nfunction buildTableDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  const decorations = [];\n  const { tables } = blockRanges;\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n\n  for (const range of tables) {\n    // Check if any line in this table is focused\n    let tableFocused = false;\n    for (let j = range.start; j <= range.end; j++) {\n      if (focusedLines.has(j)) {\n        tableFocused = true;\n        break;\n      }\n    }\n\n    if (tableFocused) {\n      // Show raw table lines with background styling\n      for (let i = range.start; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-table-line' }).range(line.from)\n        );\n      }\n    } else {\n      // Render table as widget on first line, hide other lines\n      const rows = [];\n      for (let j = range.start; j <= range.end; j++) {\n        rows.push(state.doc.line(j).text);\n      }\n      const firstLine = state.doc.line(range.start);\n\n      // Replace first line with widget\n      decorations.push(\n        Decoration.replace({\n          widget: new TableWidget(rows, firstLine.from, firstLine.to),\n        }).range(firstLine.from, firstLine.to)\n      );\n\n      // Hide remaining table lines\n      for (let i = range.start + 1; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-hidden-line' }).range(line.from),\n          Decoration.replace({}).range(line.from, line.to)\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst tableDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildTableDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildTableDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * Build decorations for footnote definition blocks\n * @param {EditorView} view - The editor view\n * @param {Object} blockRanges - Precomputed block ranges from StateField\n */\nfunction buildFootnoteBlockDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  const decorations = [];\n  const { footnoteBlocks } = blockRanges;\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n\n  for (const range of footnoteBlocks) {\n    let blockFocused = false;\n    for (let j = range.start; j <= range.end; j++) {\n      if (focusedLines.has(j)) {\n        blockFocused = true;\n        break;\n      }\n    }\n\n    if (blockFocused) {\n      for (let i = range.start; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-footnote-line' }).range(line.from)\n        );\n      }\n    } else {\n      const lines = [];\n      for (let j = range.start; j <= range.end; j++) {\n        lines.push(state.doc.line(j).text);\n      }\n      const firstLine = state.doc.line(range.start);\n\n      decorations.push(\n        Decoration.replace({\n          widget: new FootnoteBlockWidget(range.id, lines, firstLine.from, firstLine.to),\n        }).range(firstLine.from, firstLine.to)\n      );\n\n      for (let i = range.start + 1; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-hidden-line' }).range(line.from),\n          Decoration.replace({}).range(line.from, line.to)\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst footnoteBlockDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildFootnoteBlockDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildFootnoteBlockDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * Build decorations for definition list blocks\n * @param {EditorView} view - The editor view\n * @param {Object} blockRanges - Precomputed block ranges from StateField\n */\nfunction buildDefinitionListDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  const decorations = [];\n  const { definitionLists } = blockRanges;\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n\n  for (const range of definitionLists) {\n    let blockFocused = false;\n    for (let j = range.start; j <= range.end; j++) {\n      if (focusedLines.has(j)) {\n        blockFocused = true;\n        break;\n      }\n    }\n\n    if (blockFocused) {\n      for (let i = range.start; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-definition-list-line' }).range(line.from)\n        );\n      }\n    } else {\n      const lines = [];\n      for (let j = range.start; j <= range.end; j++) {\n        lines.push(state.doc.line(j).text);\n      }\n      const firstLine = state.doc.line(range.start);\n\n      decorations.push(\n        Decoration.replace({\n          widget: new DefinitionListWidget(lines, firstLine.from, firstLine.to),\n        }).range(firstLine.from, firstLine.to)\n      );\n\n      for (let i = range.start + 1; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-hidden-line' }).range(line.from),\n          Decoration.replace({}).range(line.from, line.to)\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst definitionListDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildDefinitionListDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildDefinitionListDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * Build decorations for math blocks\n * @param {EditorView} view - The editor view\n * @param {Object} blockRanges - Precomputed block ranges from StateField\n */\nfunction buildMathBlockDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  const decorations = [];\n  const { mathBlocks } = blockRanges;\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n\n  for (const range of mathBlocks) {\n    // Check if any line in this math block is focused\n    let mathFocused = false;\n    for (let j = range.start; j <= range.end; j++) {\n      if (focusedLines.has(j)) {\n        mathFocused = true;\n        break;\n      }\n    }\n\n    if (mathFocused) {\n      // Show raw math lines with background styling\n      for (let i = range.start; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-math-block-line' }).range(line.from)\n        );\n      }\n    } else {\n      // Collect math content (excluding $$ delimiters)\n      const mathLines = [];\n      for (let j = range.start + 1; j < range.end; j++) {\n        mathLines.push(state.doc.line(j).text);\n      }\n      const mathContent = mathLines.join('\\n');\n      const firstLine = state.doc.line(range.start);\n\n      // Replace first line with widget, hide other lines with empty replacements\n      decorations.push(\n        Decoration.replace({\n          widget: new MathBlockWidget(mathContent, firstLine.from, firstLine.to),\n        }).range(firstLine.from, firstLine.to)\n      );\n\n      // Hide remaining lines (content and closing $$)\n      for (let i = range.start + 1; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-hidden-line' }).range(line.from),\n          Decoration.replace({}).range(line.from, line.to)\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst mathBlockDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildMathBlockDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildMathBlockDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * Build decorations for mermaid blocks\n * @param {EditorView} view - The editor view\n * @param {Object} blockRanges - Precomputed block ranges from StateField\n */\nfunction buildMermaidBlockDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  const decorations = [];\n  const { mermaidBlocks } = blockRanges;\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n\n  for (const range of mermaidBlocks) {\n    // Check if any line in this mermaid block is focused\n    let mermaidFocused = false;\n    for (let j = range.start; j <= range.end; j++) {\n      if (focusedLines.has(j)) {\n        mermaidFocused = true;\n        break;\n      }\n    }\n\n    if (mermaidFocused) {\n      // Show raw mermaid lines with background styling\n      for (let i = range.start; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-mermaid-block-line' }).range(line.from)\n        );\n      }\n    } else {\n      // Collect mermaid content (excluding ``` fences)\n      const mermaidLines = [];\n      for (let j = range.start + 1; j < range.end; j++) {\n        mermaidLines.push(state.doc.line(j).text);\n      }\n      const mermaidContent = mermaidLines.join('\\n');\n      const firstLine = state.doc.line(range.start);\n\n      // Replace first line with widget\n      decorations.push(\n        Decoration.replace({\n          widget: new MermaidBlockWidget(mermaidContent, firstLine.from, firstLine.to),\n        }).range(firstLine.from, firstLine.to)\n      );\n\n      // Hide remaining lines\n      for (let i = range.start + 1; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-hidden-line' }).range(line.from),\n          Decoration.replace({}).range(line.from, line.to)\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst mermaidBlockDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildMermaidBlockDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildMermaidBlockDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n// ============================================================================\n// INLINE IMAGE PREVIEW\n// ============================================================================\n\nconst IMAGE_LINE_REGEX = /^!\\[([^\\]]*)\\]\\(([^)]+)\\)$/;\n\n/**\n * Check if a line contains only an image markdown syntax\n * @returns {{ alt: string, url: string } | null}\n */\nfunction parseImageLine(text) {\n  const match = text.trim().match(IMAGE_LINE_REGEX);\n  if (!match) return null;\n  return { alt: match[1], url: match[2].trim() };\n}\n\n/**\n * Widget that renders an image preview\n */\nclass ImagePreviewWidget extends WidgetType {\n  constructor(alt, url, lineFrom, lineTo) {\n    super();\n    this.alt = alt;\n    this.url = url;\n    this.lineFrom = lineFrom;\n    this.lineTo = lineTo;\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'cm-image-preview';\n\n    const img = document.createElement('img');\n    img.src = this.url;\n    img.alt = this.alt;\n    img.loading = 'lazy';\n\n    img.addEventListener('error', () => {\n      wrapper.textContent = '';\n      const error = document.createElement('div');\n      error.className = 'cm-image-error';\n      error.textContent = `Image not found: ${this.url}`;\n      wrapper.appendChild(error);\n    });\n\n    wrapper.appendChild(img);\n\n    if (this.alt) {\n      const altText = document.createElement('span');\n      altText.className = 'cm-image-alt';\n      altText.textContent = this.alt;\n      wrapper.appendChild(altText);\n    }\n\n    const lineFrom = this.lineFrom;\n    wrapper.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      view.dispatch({\n        selection: { anchor: lineFrom },\n        scrollIntoView: true,\n      });\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    return other.url === this.url && other.alt === this.alt;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Build decorations for standalone image lines\n */\nfunction buildImageDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  const decorations = [];\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n  const {\n    frontmatterLines,\n    codeBlockLines,\n    tableLines,\n    mathBlockLines,\n    footnoteBlockLines,\n    definitionListLines,\n    mermaidBlockLines,\n  } = blockRanges;\n\n  for (const { from, to } of view.visibleRanges) {\n    const startLine = state.doc.lineAt(from).number;\n    const endLine = state.doc.lineAt(to).number;\n\n    for (let i = startLine; i <= endLine; i++) {\n      if (focusedLines.has(i)) continue;\n      if (frontmatterLines.has(i)) continue;\n      if (codeBlockLines.has(i)) continue;\n      if (tableLines.has(i)) continue;\n      if (mathBlockLines.has(i)) continue;\n      if (footnoteBlockLines.has(i)) continue;\n      if (definitionListLines.has(i)) continue;\n      if (mermaidBlockLines.has(i)) continue;\n\n      const line = state.doc.line(i);\n      const imageData = parseImageLine(line.text);\n      if (!imageData) continue;\n\n      decorations.push(\n        Decoration.replace({\n          widget: new ImagePreviewWidget(imageData.alt, imageData.url, line.from, line.to),\n        }).range(line.from, line.to)\n      );\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst imageDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildImageDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.viewportChanged || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildImageDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n// ============================================================================\n// FRONTMATTER SHEET STATE\n// ============================================================================\n// Defined here (not in frontmatter-sheet.js) to avoid circular imports.\n// The sheet plugin imports these from here; buildFrontmatterDecorations reads\n// the field to decide between full table vs collapsed indicator.\n\n/**\n * StateEffect for toggling the frontmatter sheet open/closed\n * @type {StateEffectType<boolean>}\n */\nexport const toggleSheetEffect = StateEffect.define();\n\n/**\n * StateField tracking whether the frontmatter sheet overlay is open\n */\nexport const frontmatterSheetField = StateField.define({\n  create() {\n    return false;\n  },\n  update(open, tr) {\n    for (const effect of tr.effects) {\n      if (effect.is(toggleSheetEffect)) {\n        return effect.value;\n      }\n    }\n    return open;\n  },\n});\n\n// ============================================================================\n// YAML FRONTMATTER PROPERTIES EDITOR\n// ============================================================================\n\n/**\n * Serialize a parsed YAML object back to frontmatter YAML string.\n * Produces clean output without trailing newline.\n */\nfunction serializeYaml(obj) {\n  if (!obj || typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    return '';\n  }\n  // js-yaml.dump always adds a trailing newline, trim it since the document\n  // structure already has newlines between content and the closing ---\n  return yaml.dump(obj, {\n    indent: 2,\n    lineWidth: -1,\n    noRefs: true,\n    quotingType: '\"',\n    forceQuotes: false,\n  }).trimEnd();\n}\n\n/**\n * Create a DOM element for displaying/editing a YAML value based on its type\n */\nfunction createValueEditor(key, value, parsedYaml, fmContentFrom, fmContentTo, view) {\n  const container = document.createElement('span');\n  container.className = 'cm-frontmatter-value';\n\n  if (typeof value === 'boolean') {\n    const checkbox = document.createElement('input');\n    checkbox.type = 'checkbox';\n    checkbox.checked = value;\n    checkbox.className = 'cm-frontmatter-checkbox';\n    checkbox.addEventListener('change', (e) => {\n      e.stopPropagation();\n      const updated = { ...parsedYaml, [key]: checkbox.checked };\n      const newYaml = serializeYaml(updated);\n      view.dispatch({\n        changes: { from: fmContentFrom, to: fmContentTo, insert: newYaml },\n        annotations: allowReadOnlyEdit.of(true),\n      });\n    });\n    container.appendChild(checkbox);\n    return container;\n  }\n\n  if (Array.isArray(value)) {\n    for (let i = 0; i < value.length; i++) {\n      const tag = document.createElement('span');\n      tag.className = 'cm-frontmatter-tag';\n      tag.textContent = String(value[i]);\n      tag.contentEditable = 'true';\n      tag.spellcheck = false;\n\n      const idx = i;\n      tag.addEventListener('blur', (e) => {\n        e.stopPropagation();\n        const newArr = [...value];\n        const newVal = tag.textContent.trim();\n        if (newVal === '') {\n          newArr.splice(idx, 1);\n        } else {\n          newArr[idx] = newVal;\n        }\n        const updated = { ...parsedYaml, [key]: newArr };\n        const newYaml = serializeYaml(updated);\n        view.dispatch({\n          changes: { from: fmContentFrom, to: fmContentTo, insert: newYaml },\n          annotations: allowReadOnlyEdit.of(true),\n        });\n      });\n      tag.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter') {\n          e.preventDefault();\n          tag.blur();\n        }\n        e.stopPropagation();\n      });\n      tag.addEventListener('mousedown', (e) => e.stopPropagation());\n      container.appendChild(tag);\n    }\n\n    // Add tag button\n    const addTag = document.createElement('span');\n    addTag.className = 'cm-frontmatter-add-tag';\n    addTag.textContent = '+';\n    addTag.title = 'Add item';\n    addTag.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n    });\n    addTag.addEventListener('click', (e) => {\n      e.stopPropagation();\n      const newArr = [...value, 'new'];\n      const updated = { ...parsedYaml, [key]: newArr };\n      const newYaml = serializeYaml(updated);\n      view.dispatch({\n        changes: { from: fmContentFrom, to: fmContentTo, insert: newYaml },\n        annotations: allowReadOnlyEdit.of(true),\n      });\n    });\n    container.appendChild(addTag);\n    return container;\n  }\n\n  if (value !== null && typeof value === 'object') {\n    // Nested object: render as JSON-like text, editable\n    const input = document.createElement('input');\n    input.type = 'text';\n    input.className = 'cm-frontmatter-input';\n    input.value = JSON.stringify(value);\n    input.addEventListener('blur', (e) => {\n      e.stopPropagation();\n      try {\n        const parsed = JSON.parse(input.value);\n        const updated = { ...parsedYaml, [key]: parsed };\n        const newYaml = serializeYaml(updated);\n        view.dispatch({\n          changes: { from: fmContentFrom, to: fmContentTo, insert: newYaml },\n          annotations: allowReadOnlyEdit.of(true),\n        });\n      } catch {\n        // Invalid JSON, revert\n        input.value = JSON.stringify(value);\n      }\n    });\n    input.addEventListener('keydown', (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        input.blur();\n      }\n      e.stopPropagation();\n    });\n    input.addEventListener('mousedown', (e) => e.stopPropagation());\n    container.appendChild(input);\n    return container;\n  }\n\n  // String, number, date, null ‚Äî text input\n  const input = document.createElement('input');\n  input.type = 'text';\n  input.className = 'cm-frontmatter-input';\n  input.value = value === null ? '' : String(value);\n  input.placeholder = value === null ? 'empty' : '';\n  input.addEventListener('blur', (e) => {\n    e.stopPropagation();\n    const raw = input.value;\n    // Try to preserve types: numbers, booleans, null\n    let newValue;\n    if (raw === '' || raw === 'null') {\n      newValue = null;\n    } else if (raw === 'true') {\n      newValue = true;\n    } else if (raw === 'false') {\n      newValue = false;\n    } else if (!isNaN(raw) && raw.trim() !== '') {\n      newValue = Number(raw);\n    } else {\n      newValue = raw;\n    }\n    const updated = { ...parsedYaml, [key]: newValue };\n    const newYaml = serializeYaml(updated);\n    view.dispatch({\n      changes: { from: fmContentFrom, to: fmContentTo, insert: newYaml },\n      annotations: allowReadOnlyEdit.of(true),\n    });\n  });\n  input.addEventListener('keydown', (e) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      input.blur();\n    }\n    e.stopPropagation();\n  });\n  input.addEventListener('mousedown', (e) => e.stopPropagation());\n  container.appendChild(input);\n  return container;\n}\n\n/**\n * Build the frontmatter property table DOM.\n * Used by the frontmatter sheet overlay.\n *\n * @param {string} yamlContent - raw YAML between fences\n * @param {number} contentFrom - doc position of first content line\n * @param {number} contentTo - doc position of last content line\n * @param {number} blockFrom - doc position of opening ---\n * @param {EditorView} view\n * @param {Object} [options]\n * @param {string[]} [options.knownKeys] - Known property names for autocomplete suggestions\n * @returns {{ dom: HTMLElement, error: boolean }}\n */\nexport function buildFrontmatterPropertyTable(yamlContent, contentFrom, contentTo, blockFrom, view, options = {}) {\n  const { knownKeys = [] } = options;\n  const wrapper = document.createElement('div');\n  wrapper.className = 'cm-frontmatter-preview';\n\n  let parsedYaml;\n  try {\n    parsedYaml = yaml.load(yamlContent);\n  } catch {\n    const error = document.createElement('div');\n    error.className = 'cm-frontmatter-error';\n    error.textContent = 'Invalid YAML frontmatter \\u2014 click to edit';\n    wrapper.appendChild(error);\n    return { dom: wrapper, error: true };\n  }\n\n  if (!parsedYaml || typeof parsedYaml !== 'object') {\n    parsedYaml = {};\n  }\n\n  const table = document.createElement('table');\n  table.className = 'cm-frontmatter-table';\n\n  // Create datalist for key autocomplete suggestions\n  const datalistId = 'cm-fm-keys-' + Math.random().toString(36).slice(2, 8);\n  const datalist = document.createElement('datalist');\n  datalist.id = datalistId;\n  const currentKeys = new Set(Object.keys(parsedYaml));\n  for (const k of knownKeys) {\n    if (!currentKeys.has(k)) {\n      const opt = document.createElement('option');\n      opt.value = k;\n      datalist.appendChild(opt);\n    }\n  }\n  wrapper.appendChild(datalist);\n\n  const keys = Object.keys(parsedYaml);\n\n  for (const key of keys) {\n    const row = document.createElement('tr');\n\n    const keyCell = document.createElement('td');\n    keyCell.className = 'cm-frontmatter-key';\n    const keyInput = document.createElement('input');\n    keyInput.type = 'text';\n    keyInput.className = 'cm-frontmatter-key-input';\n    keyInput.value = key;\n    keyInput.size = Math.max(key.length, 1);\n    keyInput.spellcheck = false;\n    keyInput.setAttribute('list', datalistId);\n    keyInput.addEventListener('blur', (e) => {\n      e.stopPropagation();\n      const newKey = keyInput.value.trim();\n      if (newKey === '' || newKey === key) {\n        keyInput.value = key;\n        return;\n      }\n      // Rename: build new object preserving order\n      const updated = {};\n      for (const k of Object.keys(parsedYaml)) {\n        if (k === key) {\n          updated[newKey] = parsedYaml[k];\n        } else {\n          updated[k] = parsedYaml[k];\n        }\n      }\n      const newYaml = serializeYaml(updated);\n      view.dispatch({\n        changes: { from: contentFrom, to: contentTo, insert: newYaml },\n        annotations: allowReadOnlyEdit.of(true),\n      });\n    });\n    keyInput.addEventListener('keydown', (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        keyInput.blur();\n      }\n      e.stopPropagation();\n    });\n    keyInput.addEventListener('mousedown', (e) => e.stopPropagation());\n    keyCell.appendChild(keyInput);\n    row.appendChild(keyCell);\n\n    const valueCell = document.createElement('td');\n    valueCell.className = 'cm-frontmatter-value-cell';\n    valueCell.appendChild(\n      createValueEditor(key, parsedYaml[key], parsedYaml, contentFrom, contentTo, view)\n    );\n    row.appendChild(valueCell);\n\n    const deleteCell = document.createElement('td');\n    deleteCell.className = 'cm-frontmatter-action-cell';\n    const deleteBtn = document.createElement('span');\n    deleteBtn.className = 'cm-frontmatter-delete';\n    deleteBtn.textContent = '\\u00d7';\n    deleteBtn.title = 'Remove property';\n    deleteBtn.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n    });\n    deleteBtn.addEventListener('click', (e) => {\n      e.stopPropagation();\n      const updated = { ...parsedYaml };\n      delete updated[key];\n      const newYaml = serializeYaml(updated);\n      view.dispatch({\n        changes: { from: contentFrom, to: contentTo, insert: newYaml },\n        annotations: allowReadOnlyEdit.of(true),\n      });\n    });\n    deleteCell.appendChild(deleteBtn);\n    row.appendChild(deleteCell);\n\n    table.appendChild(row);\n  }\n\n  wrapper.appendChild(table);\n\n  const addRow = document.createElement('div');\n  addRow.className = 'cm-frontmatter-add';\n  addRow.textContent = '+ Add property';\n  addRow.addEventListener('mousedown', (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n  });\n  addRow.addEventListener('click', (e) => {\n    e.stopPropagation();\n    let newKey = 'property';\n    let counter = 1;\n    while (parsedYaml[newKey] !== undefined) {\n      newKey = `property${counter}`;\n      counter++;\n    }\n    const updated = { ...parsedYaml, [newKey]: '' };\n    const newYaml = serializeYaml(updated);\n    view.dispatch({\n      changes: { from: contentFrom, to: contentTo, insert: newYaml },\n      annotations: allowReadOnlyEdit.of(true),\n    });\n  });\n  wrapper.appendChild(addRow);\n\n  return { dom: wrapper, error: false };\n}\n\n/**\n * Build decorations for YAML frontmatter\n */\nfunction buildFrontmatterDecorations(view, blockRanges) {\n  const { state } = view;\n  const { frontmatter } = blockRanges;\n\n  if (!frontmatter) {\n    return Decoration.none;\n  }\n\n  // Frontmatter is always hidden in the editor ‚Äî editing happens in the sheet overlay\n  const decorations = [];\n  const firstLine = state.doc.line(frontmatter.start);\n\n  // Replace the opening --- with an empty widget so it takes no space\n  decorations.push(\n    Decoration.replace({}).range(firstLine.from, firstLine.to)\n  );\n  decorations.push(\n    Decoration.line({ class: 'cm-hidden-line' }).range(firstLine.from)\n  );\n\n  // Hide remaining lines\n  for (let i = frontmatter.start + 1; i <= frontmatter.end; i++) {\n    const line = state.doc.line(i);\n    decorations.push(\n      Decoration.line({ class: 'cm-hidden-line' }).range(line.from),\n      Decoration.replace({}).range(line.from, line.to)\n    );\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst frontmatterDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildFrontmatterDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildFrontmatterDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * The hybrid preview extension\n * @param {Object} options - Configuration options\n * @param {boolean} [options.enableCollapse=true] - Enable heading collapse functionality\n */\nexport function hybridPreview(options = {}) {\n  const {\n    enableCollapse = true,\n    enableCustomTasks = false,\n    customTaskTypes,\n    enableWikiLinks = false,\n    renderWikiLinks = true,\n    onWikiLinkClick,\n    enableTags = false,\n    onTagClick,\n  } = options;\n\n  const customTasksConfig = buildCustomTasksConfig(enableCustomTasks, customTaskTypes);\n  const wikiLinksConfig = buildWikiLinksConfig(enableWikiLinks, renderWikiLinks, onWikiLinkClick);\n  const tagsConfig = buildTagsConfig(enableTags, onTagClick);\n\n  return [\n    // Configuration facet for collapse functionality\n    enableCollapseFacet.of(enableCollapse),\n    // Configuration facet for custom task types\n    customTasksFacet.of(customTasksConfig),\n    // Configuration facet for wiki links\n    wikiLinksFacet.of(wikiLinksConfig),\n    // Configuration facet for tags\n    tagsFacet.of(tagsConfig),\n    // State for tracking collapsed headings (always included, but only used if collapse enabled)\n    collapsedHeadingsField,\n    // Frontmatter sheet open/closed state\n    frontmatterSheetField,\n    // Shared state for block ranges (computed once per doc change)\n    blockRangesField,\n    // ViewPlugins that read from the shared state\n    frontmatterDecorations,\n    imageDecorations,\n    hybridPreviewPlugin,\n    wikiLinkDecorations,\n    tagDecorations,\n    codeBlockDecorations,\n    tableDecorations,\n    footnoteBlockDecorations,\n    definitionListDecorations,\n    mathBlockDecorations,\n    mermaidBlockDecorations,\n  ];\n}\n","import { undo, redo } from '@codemirror/commands';\nimport { openSearchPanel, selectNextOccurrence as cmSelectNextOccurrence, selectSelectionMatches as cmSelectSelectionMatches } from '@codemirror/search';\n\nfunction focusReplaceField(view) {\n  requestAnimationFrame(() => {\n    const panel = view.dom.querySelector('.cm-search');\n    const replaceField = panel?.querySelector('input[name=\"replace\"]');\n    if (replaceField instanceof HTMLInputElement) {\n      replaceField.focus();\n      replaceField.select();\n    }\n  });\n}\n\n/**\n * Wrap selected text with prefix and suffix\n */\nfunction wrapSelection(view, before, after) {\n  const { from, to } = view.state.selection.main;\n  const text = view.state.sliceDoc(from, to);\n\n  view.dispatch({\n    changes: { from, to, insert: before + text + after },\n    selection: { anchor: from + before.length, head: to + before.length },\n  });\n}\n\n/**\n * Add prefix to the beginning of the current line\n */\nfunction prefixLine(view, prefix) {\n  const { from } = view.state.selection.main;\n  const line = view.state.doc.lineAt(from);\n\n  view.dispatch({\n    changes: { from: line.from, to: line.from, insert: prefix },\n  });\n}\n\n/**\n * Toggle heading prefix on the current line\n * If line has this heading, remove it\n * If line has different heading or no heading, set to this level\n */\nfunction toggleHeading(view, level) {\n  const { from } = view.state.selection.main;\n  const line = view.state.doc.lineAt(from);\n  const text = line.text;\n\n  // Match any heading prefix (# to ######)\n  const headingMatch = text.match(/^(#{1,6})\\s/);\n  const targetPrefix = '#'.repeat(level) + ' ';\n\n  if (headingMatch) {\n    const currentPrefix = headingMatch[0];\n    if (currentPrefix === targetPrefix) {\n      // Same heading level - remove it\n      view.dispatch({\n        changes: { from: line.from, to: line.from + currentPrefix.length, insert: '' },\n      });\n    } else {\n      // Different heading level - replace it\n      view.dispatch({\n        changes: { from: line.from, to: line.from + currentPrefix.length, insert: targetPrefix },\n      });\n    }\n  } else {\n    // No heading - add it\n    view.dispatch({\n      changes: { from: line.from, to: line.from, insert: targetPrefix },\n    });\n  }\n}\n\n/**\n * Toggle list prefix on the current line\n * Handles bullet (-), numbered (1.), and task (- [ ]) lists\n */\nfunction toggleList(view, type) {\n  const { from } = view.state.selection.main;\n  const line = view.state.doc.lineAt(from);\n  const text = line.text;\n\n  // Match list prefixes: bullet (- ), numbered (1. ), or task (- [ ] or - [x] )\n  const bulletMatch = text.match(/^(-|\\*|\\+)\\s(?!\\[[ xX]\\])/);\n  const numberedMatch = text.match(/^(\\d+)\\.\\s/);\n  const taskMatch = text.match(/^(-|\\*|\\+)\\s\\[[ xX]\\]\\s/);\n\n  const prefixes = {\n    bullet: '- ',\n    numbered: '1. ',\n    task: '- [ ] ',\n  };\n\n  const targetPrefix = prefixes[type];\n  let currentMatch = null;\n  let currentType = null;\n\n  if (taskMatch) {\n    currentMatch = taskMatch[0];\n    currentType = 'task';\n  } else if (numberedMatch) {\n    currentMatch = numberedMatch[0];\n    currentType = 'numbered';\n  } else if (bulletMatch) {\n    currentMatch = bulletMatch[0];\n    currentType = 'bullet';\n  }\n\n  if (currentMatch) {\n    if (currentType === type) {\n      // Same list type - remove it\n      view.dispatch({\n        changes: { from: line.from, to: line.from + currentMatch.length, insert: '' },\n      });\n    } else {\n      // Different list type - replace it\n      view.dispatch({\n        changes: { from: line.from, to: line.from + currentMatch.length, insert: targetPrefix },\n      });\n    }\n  } else {\n    // No list prefix - add it\n    view.dispatch({\n      changes: { from: line.from, to: line.from, insert: targetPrefix },\n    });\n  }\n}\n\n/**\n * Insert text at cursor position\n */\nfunction insertAt(view, text) {\n  const { from, to } = view.state.selection.main;\n  view.dispatch({\n    changes: { from, to, insert: text },\n  });\n}\n\n/**\n * Get currently selected text\n */\nfunction getSelection(view) {\n  const { from, to } = view.state.selection.main;\n  return from !== to ? view.state.sliceDoc(from, to) : null;\n}\n\n/**\n * Toolbar formatting actions\n */\nexport const actions = {\n  undo(view) {\n    undo(view);\n  },\n\n  redo(view) {\n    redo(view);\n  },\n\n  search(view) {\n    openSearchPanel(view);\n  },\n\n  replace(view) {\n    openSearchPanel(view);\n    focusReplaceField(view);\n  },\n\n  selectNextOccurrence(view) {\n    cmSelectNextOccurrence(view);\n  },\n\n  selectAllOccurrences(view) {\n    if (view.state.selection.main.empty) {\n      cmSelectNextOccurrence(view);\n    }\n    cmSelectSelectionMatches(view);\n  },\n\n  bold(view) {\n    wrapSelection(view, '**', '**');\n  },\n\n  italic(view) {\n    wrapSelection(view, '_', '_');\n  },\n\n  strikethrough(view) {\n    wrapSelection(view, '~~', '~~');\n  },\n\n  h1(view) {\n    toggleHeading(view, 1);\n  },\n\n  h2(view) {\n    toggleHeading(view, 2);\n  },\n\n  h3(view) {\n    toggleHeading(view, 3);\n  },\n\n  link(view) {\n    const selection = getSelection(view);\n    const exampleUrl = 'https://example.com';\n    if (selection) {\n      const { from, to } = view.state.selection.main;\n      view.dispatch({\n        changes: { from, to, insert: `[${selection}](${exampleUrl})` },\n        selection: { anchor: from + selection.length + 3, head: from + selection.length + 3 + exampleUrl.length },\n      });\n    } else {\n      const { from } = view.state.selection.main;\n      view.dispatch({\n        changes: { from, insert: `[link text](${exampleUrl})` },\n        selection: { anchor: from + 1, head: from + 10 },\n      });\n    }\n  },\n\n  image(view) {\n    const { from } = view.state.selection.main;\n    const exampleUrl = 'https://placehold.co/400x200';\n    view.dispatch({\n      changes: { from, insert: `![alt text](${exampleUrl})` },\n      selection: { anchor: from + 2, head: from + 10 },\n    });\n  },\n\n  bulletList(view) {\n    toggleList(view, 'bullet');\n  },\n\n  numberedList(view) {\n    toggleList(view, 'numbered');\n  },\n\n  taskList(view) {\n    toggleList(view, 'task');\n  },\n\n  inlineCode(view) {\n    wrapSelection(view, '`', '`');\n  },\n\n  codeBlock(view) {\n    const { from, to } = view.state.selection.main;\n    const text = view.state.sliceDoc(from, to);\n    const sampleCode = `javascript\nfunction hello() {\n  alert(\"hello world\");\n}\nhello();`;\n    const newText = text ? '```\\n' + text + '\\n```' : '```' + sampleCode + '\\n```';\n\n    view.dispatch({\n      changes: { from, to, insert: newText },\n      selection: { anchor: from + 4 },\n    });\n  },\n\n  hr(view) {\n    const { from } = view.state.selection.main;\n    const line = view.state.doc.lineAt(from);\n\n    view.dispatch({\n      changes: { from: line.to, insert: '\\n\\n---\\n' },\n    });\n  },\n\n  quote(view) {\n    prefixLine(view, '> ');\n  },\n\n  table(view) {\n    const { from } = view.state.selection.main;\n    const line = view.state.doc.lineAt(from);\n    const sampleTable = `| Column 1 | Column 2 | Column 3 |\n|----------|----------|----------|\n| Cell 1   | Cell 2   | Cell 3   |\n| Cell 4   | Cell 5   | Cell 6   |`;\n\n    view.dispatch({\n      changes: { from: line.to, insert: '\\n\\n' + sampleTable + '\\n' },\n      selection: { anchor: line.to + 4 },\n    });\n  },\n\n  diagram(view) {\n    const { from } = view.state.selection.main;\n    const line = view.state.doc.lineAt(from);\n    const sampleDiagram = `\\`\\`\\`mermaid\nflowchart LR\n    A[Start] --> B[Process]\n    B --> C{Decision}\n    C -->|Yes| D[Result 1]\n    C -->|No| E[Result 2]\n\\`\\`\\``;\n\n    view.dispatch({\n      changes: { from: line.to, insert: '\\n\\n' + sampleDiagram + '\\n' },\n      selection: { anchor: line.to + 4 },\n    });\n  },\n\n  emoji(view) {\n    const { from } = view.state.selection.main;\n    view.dispatch({\n      changes: { from, insert: ':smile:' },\n      selection: { anchor: from + 1, head: from + 6 },\n    });\n  },\n};\n","import { keymap } from '@codemirror/view';\nimport { actions } from './actions.js';\n\nexport const markdownKeymap = keymap.of([\n  {\n    key: 'Mod-b',\n    run: (view) => {\n      actions.bold(view);\n      return true;\n    },\n  },\n  {\n    key: 'Mod-i',\n    run: (view) => {\n      actions.italic(view);\n      return true;\n    },\n  },\n  {\n    key: 'Mod-k',\n    run: (view) => {\n      actions.link(view);\n      return true;\n    },\n  },\n  {\n    key: 'Mod-`',\n    run: (view) => {\n      actions.inlineCode(view);\n      return true;\n    },\n  },\n  {\n    key: 'Mod-Shift-`',\n    run: (view) => {\n      actions.codeBlock(view);\n      return true;\n    },\n  },\n]);\n","import { Decoration, ViewPlugin } from '@codemirror/view';\n\n/**\n * Custom extension to highlight all selected lines (only when editor is focused)\n */\nconst selectedLineDecoration = Decoration.line({ class: 'cm-selectedLine' });\n\nexport const highlightSelectedLines = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      this.decorations = this.buildDecorations(view);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.focusChanged) {\n        this.decorations = this.buildDecorations(update.view);\n      }\n    }\n\n    buildDecorations(view) {\n      // Only highlight when editor is focused\n      if (!view.hasFocus) {\n        return Decoration.none;\n      }\n\n      const decorations = [];\n      const selectedLines = new Set();\n      const state = view.state;\n\n      for (const range of state.selection.ranges) {\n        const startLine = state.doc.lineAt(range.from).number;\n        const endLine = state.doc.lineAt(range.to).number;\n        for (let i = startLine; i <= endLine; i++) {\n          selectedLines.add(i);\n        }\n      }\n\n      for (const lineNum of selectedLines) {\n        const line = state.doc.line(lineNum);\n        decorations.push(selectedLineDecoration.range(line.from));\n      }\n\n      return Decoration.set(decorations, true);\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n","import { ViewPlugin } from '@codemirror/view';\n\n/**\n * Typewriter mode plugin - keeps the cursor line vertically centered\n * in the viewport while typing or navigating.\n *\n * Uses requestMeasure to avoid layout thrashing and infinite update loops.\n */\nexport const typewriterPlugin = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      this.view = view;\n    }\n\n    update(update) {\n      if (!update.selectionSet && !update.docChanged && !update.geometryChanged) {\n        return;\n      }\n\n      this.view.requestMeasure({\n        key: 'typewriter-scroll',\n        read: (view) => {\n          const head = view.state.selection.main.head;\n          const coords = view.coordsAtPos(head);\n          if (!coords) return null;\n\n          const rect = view.scrollDOM.getBoundingClientRect();\n          const viewportCenter = rect.top + rect.height / 2;\n          const diff = coords.top - viewportCenter;\n\n          if (Math.abs(diff) < 2) return null;\n          return diff;\n        },\n        write: (diff, view) => {\n          if (diff == null) return;\n          view.scrollDOM.scrollBy({ top: diff, behavior: 'auto' });\n        },\n      });\n    }\n  }\n);\n","import { ViewPlugin, Decoration } from '@codemirror/view';\nimport { RangeSet } from '@codemirror/state';\n\nconst unfocusedLine = Decoration.line({ class: 'cm-unfocused-line' });\n\n/**\n * Find the paragraph boundaries (blank-line delimited) around a position.\n * Returns { from: lineNumber, to: lineNumber } (1-based line numbers).\n */\nfunction findParagraphRange(doc, pos) {\n  const line = doc.lineAt(pos);\n  let from = line.number;\n  let to = line.number;\n\n  // Walk up to find first blank line or start of doc\n  while (from > 1) {\n    const prev = doc.line(from - 1);\n    if (prev.text.trim() === '') break;\n    from--;\n  }\n\n  // Walk down to find next blank line or end of doc\n  while (to < doc.lines) {\n    const next = doc.line(to + 1);\n    if (next.text.trim() === '') break;\n    to++;\n  }\n\n  return { from, to };\n}\n\n/**\n * Focus mode plugin - dims all paragraphs except the one(s) containing cursors.\n * Applies `cm-unfocused-line` decoration to non-active lines.\n * Only active when the editor has focus.\n */\nexport const focusModePlugin = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      this.decorations = this.buildDecorations(view);\n    }\n\n    update(update) {\n      if (\n        update.selectionSet ||\n        update.docChanged ||\n        update.focusChanged\n      ) {\n        this.decorations = this.buildDecorations(update.view);\n      }\n    }\n\n    buildDecorations(view) {\n      if (!view.hasFocus) {\n        return RangeSet.empty;\n      }\n\n      const doc = view.state.doc;\n      const activeLines = new Set();\n\n      // For each selection range, find its paragraph and mark all lines as active\n      for (const range of view.state.selection.ranges) {\n        const para = findParagraphRange(doc, range.head);\n        for (let i = para.from; i <= para.to; i++) {\n          activeLines.add(i);\n        }\n      }\n\n      const decorations = [];\n      for (let i = 1; i <= doc.lines; i++) {\n        if (!activeLines.has(i)) {\n          const line = doc.line(i);\n          decorations.push(unfocusedLine.range(line.from));\n        }\n      }\n\n      return RangeSet.of(decorations);\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n","/**\n * Word Count / Character Count / Reading Time Panel\n *\n * A bottom status bar showing live writing statistics:\n * - Word count\n * - Character count (with and without spaces)\n * - Estimated reading time\n * - Selection stats when text is selected\n */\n\nimport { showPanel } from '@codemirror/view';\n\n/**\n * Compute document and selection statistics\n */\nfunction computeStats(doc, selection) {\n  const text = doc.toString();\n  const words = text.split(/\\s+/).filter(w => w.length > 0).length;\n  const chars = text.length;\n  const charsNoSpaces = text.replace(/\\s/g, '').length;\n  const readingTime = Math.max(1, Math.ceil(words / 238));\n\n  let selWords = 0;\n  let selChars = 0;\n  const hasSelection = selection && !selection.main.empty;\n\n  if (hasSelection) {\n    const selText = doc.sliceString(selection.main.from, selection.main.to);\n    selWords = selText.split(/\\s+/).filter(w => w.length > 0).length;\n    selChars = selText.length;\n  }\n\n  return { words, chars, charsNoSpaces, readingTime, selWords, selChars, hasSelection };\n}\n\n/**\n * Format reading time as a human-readable string\n */\nfunction formatReadingTime(minutes) {\n  if (minutes < 1) return '< 1 min read';\n  if (minutes === 1) return '1 min read';\n  return `${minutes} min read`;\n}\n\n/**\n * Create a stat element (label + value)\n */\nfunction createStat(label, value) {\n  const stat = document.createElement('span');\n  stat.className = 'cm-word-count-stat';\n\n  const valueEl = document.createElement('span');\n  valueEl.className = 'cm-word-count-value';\n  valueEl.textContent = value;\n\n  const labelEl = document.createElement('span');\n  labelEl.className = 'cm-word-count-label';\n  labelEl.textContent = ` ${label}`;\n\n  stat.appendChild(valueEl);\n  stat.appendChild(labelEl);\n  return stat;\n}\n\n/**\n * Create a divider between stats\n */\nfunction createDivider() {\n  const div = document.createElement('span');\n  div.className = 'cm-word-count-divider';\n  return div;\n}\n\n/**\n * Create the word count panel extension\n */\nfunction wordCountPanelFactory(view) {\n  const dom = document.createElement('div');\n  dom.className = 'cm-word-count-panel';\n\n  function render(state) {\n    const stats = computeStats(state.doc, state.selection);\n    dom.textContent = '';\n\n    dom.appendChild(createStat('words', stats.words.toLocaleString()));\n    dom.appendChild(createDivider());\n    dom.appendChild(createStat('characters', stats.chars.toLocaleString()));\n    dom.appendChild(createDivider());\n    dom.appendChild(createStat('', formatReadingTime(stats.readingTime)));\n\n    if (stats.hasSelection) {\n      dom.appendChild(createDivider());\n\n      const selStat = document.createElement('span');\n      selStat.className = 'cm-word-count-stat cm-word-count-selection';\n\n      const selValue = document.createElement('span');\n      selValue.className = 'cm-word-count-value';\n      selValue.textContent = `${stats.selWords} words, ${stats.selChars} chars`;\n\n      const selLabel = document.createElement('span');\n      selLabel.className = 'cm-word-count-label';\n      selLabel.textContent = ' selected';\n\n      selStat.appendChild(selValue);\n      selStat.appendChild(selLabel);\n      dom.appendChild(selStat);\n    }\n  }\n\n  render(view.state);\n\n  return {\n    dom,\n    top: false,\n    update(update) {\n      if (update.docChanged || update.selectionSet) {\n        render(update.state);\n      }\n    },\n  };\n}\n\n/**\n * The word count panel extension.\n * Use with a Compartment for toggling.\n */\nexport const wordCountPanel = showPanel.of(wordCountPanelFactory);\n","import { EditorView, showPanel } from '@codemirror/view';\nimport { undoDepth, redoDepth } from '@codemirror/commands';\nimport { actions } from './actions.js';\n\nconst defaultButtons = [\n  { icon: '‚Ü∂', title: 'Undo', action: 'undo' },\n  { icon: '‚Ü∑', title: 'Redo', action: 'redo' },\n  { icon: 'B', title: 'Bold', action: 'bold' },\n  { icon: 'I', title: 'Italic', action: 'italic' },\n  { icon: 'S', title: 'Strikethrough', action: 'strikethrough' },\n  { icon: 'H\\u2081', title: 'Heading 1', action: 'h1' },\n  { icon: 'H\\u2082', title: 'Heading 2', action: 'h2' },\n  { icon: 'H\\u2083', title: 'Heading 3', action: 'h3' },\n  { icon: '\\u{1F517}', title: 'Link', action: 'link' },\n  { icon: '\\u{1F5BC}', title: 'Image', action: 'image' },\n  { icon: '\\u2022', title: 'Bullet List', action: 'bulletList' },\n  { icon: '1.', title: 'Numbered List', action: 'numberedList' },\n  { icon: '\\u2611', title: 'Task List', action: 'taskList' },\n  { icon: '< >', title: 'Inline Code', action: 'inlineCode' },\n  { icon: '{ }', title: 'Code Block', action: 'codeBlock' },\n  { icon: '\\u2014', title: 'Horizontal Rule', action: 'hr' },\n  { icon: '\\u201C', title: 'Blockquote', action: 'quote' },\n  { icon: '\\u229E', title: 'Table', action: 'table' },\n];\n\nconst toolbarBaseTheme = EditorView.baseTheme({\n  '.cm-bottom-toolbar': {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '2px',\n    padding: '6px 8px',\n    paddingBottom: 'max(6px, env(safe-area-inset-bottom))',\n    overflowX: 'auto',\n    WebkitOverflowScrolling: 'touch',\n    scrollbarWidth: 'none',\n    whiteSpace: 'nowrap',\n    borderTop: '1px solid #dee2e6',\n    fontFamily: 'system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    background: '#f8f9fa',\n    overscrollBehaviorX: 'contain',\n    touchAction: 'pan-x',\n  },\n  '.cm-bottom-toolbar::-webkit-scrollbar': {\n    display: 'none',\n  },\n  '.cm-bottom-toolbar-btn': {\n    minWidth: '36px',\n    height: '36px',\n    flexShrink: '0',\n    display: 'inline-flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    border: 'none',\n    background: 'transparent',\n    borderRadius: '6px',\n    cursor: 'pointer',\n    fontSize: '15px',\n    color: 'inherit',\n    transition: 'background 0.1s',\n    padding: '0 4px',\n    fontFamily: 'inherit',\n  },\n  '.cm-bottom-toolbar-btn:hover': {\n    background: 'rgba(0, 0, 0, 0.08)',\n  },\n  '.cm-bottom-toolbar-btn:active': {\n    background: 'rgba(0, 0, 0, 0.15)',\n  },\n  '.cm-bottom-toolbar-btn:disabled': {\n    opacity: '0.3',\n    cursor: 'not-allowed',\n  },\n  // Dark mode\n  '&dark .cm-bottom-toolbar': {\n    background: '#252526',\n    borderTopColor: '#3c3c3c',\n    color: '#d4d4d4',\n  },\n  '&dark .cm-bottom-toolbar-btn:hover': {\n    background: 'rgba(255, 255, 255, 0.1)',\n  },\n  '&dark .cm-bottom-toolbar-btn:active': {\n    background: 'rgba(255, 255, 255, 0.18)',\n  },\n});\n\n/**\n * Create a bottom toolbar extension for the markdown editor.\n *\n * @param {Object} [options]\n * @param {Array} [options.buttons] - Override the default button set\n * @param {Array} [options.extraButtons] - Additional buttons appended after defaults.\n *   Each entry: { icon: string, title: string, handler: (view) => void }\n * @returns {Extension[]}\n */\nexport function bottomToolbar(options = {}) {\n  const buttons = options.buttons || defaultButtons;\n  const extraButtons = options.extraButtons || [];\n\n  const panelExtension = showPanel.of((view) => {\n    const dom = document.createElement('div');\n    dom.className = 'cm-bottom-toolbar';\n\n    const buttonsByAction = new Map();\n\n    for (const btn of buttons) {\n      const el = document.createElement('button');\n      el.className = 'cm-bottom-toolbar-btn';\n      el.textContent = btn.icon;\n      el.title = btn.title;\n\n      if (btn.action) {\n        buttonsByAction.set(btn.action, el);\n        el.addEventListener('click', (e) => {\n          e.preventDefault();\n          if (actions[btn.action]) {\n            actions[btn.action](view);\n            view.focus();\n          }\n        });\n      }\n\n      dom.appendChild(el);\n    }\n\n    // Extra buttons (custom handlers)\n    for (const btn of extraButtons) {\n      const el = document.createElement('button');\n      el.className = 'cm-bottom-toolbar-btn';\n      el.textContent = btn.icon;\n      el.title = btn.title;\n      el.addEventListener('click', (e) => {\n        e.preventDefault();\n        if (btn.handler) {\n          btn.handler(view);\n        }\n        view.focus();\n      });\n      dom.appendChild(el);\n    }\n\n    // Fallback for older iOS WebKit: prevent scroll chaining at boundaries\n    let touchStartX = 0;\n    dom.addEventListener('touchstart', (e) => {\n      touchStartX = e.touches[0].clientX;\n    }, { passive: true });\n    dom.addEventListener('touchmove', (e) => {\n      const dx = e.touches[0].clientX - touchStartX;\n      const atLeft = dom.scrollLeft <= 0;\n      const atRight = dom.scrollLeft + dom.clientWidth >= dom.scrollWidth - 1;\n      if ((atLeft && dx > 0) || (atRight && dx < 0)) {\n        e.preventDefault();\n      }\n    }, { passive: false });\n\n    const updateHistoryButtons = (state) => {\n      const undoBtn = buttonsByAction.get('undo');\n      if (undoBtn) {\n        undoBtn.disabled = undoDepth(state) === 0;\n      }\n      const redoBtn = buttonsByAction.get('redo');\n      if (redoBtn) {\n        redoBtn.disabled = redoDepth(state) === 0;\n      }\n    };\n\n    updateHistoryButtons(view.state);\n\n    return {\n      dom,\n      top: false,\n      update(update) {\n        updateHistoryButtons(update.state);\n      },\n    };\n  });\n\n  return [panelExtension, toolbarBaseTheme];\n}\n","/**\n * Backlinks / Linked Mentions Panel\n *\n * A bottom panel showing incoming links to the current document.\n * The consumer provides an async resolver that returns backlink data.\n */\n\nimport { showPanel } from '@codemirror/view';\nimport { Facet } from '@codemirror/state';\n\n/**\n * Configuration facet for backlinks panel\n */\nexport const backlinksFacet = Facet.define({\n  combine(values) {\n    if (values.length === 0) {\n      return { docTitle: null, onBacklinksRequested: null, onBacklinkClick: null };\n    }\n    return values[values.length - 1];\n  },\n});\n\n/**\n * Extract the title from YAML frontmatter in the document\n */\nfunction extractFrontmatterTitle(doc) {\n  if (doc.lines < 2) return null;\n  const firstLine = doc.line(1).text.trim();\n  if (firstLine !== '---') return null;\n\n  for (let i = 2; i <= doc.lines; i++) {\n    const text = doc.line(i).text.trim();\n    if (text === '---' || text === '...') {\n      // Found end of frontmatter, now look for title in lines 2..(i-1)\n      for (let j = 2; j < i; j++) {\n        const line = doc.line(j).text;\n        const match = line.match(/^title:\\s*(.+)$/);\n        if (match) {\n          let title = match[1].trim();\n          // Strip quotes if present\n          if ((title.startsWith('\"') && title.endsWith('\"')) ||\n              (title.startsWith(\"'\") && title.endsWith(\"'\"))) {\n            title = title.slice(1, -1);\n          }\n          return title;\n        }\n      }\n      return null;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Render backlink chips into the panel DOM\n */\nfunction renderBacklinks(dom, backlinks, onBacklinkClick) {\n  dom.textContent = '';\n\n  const label = document.createElement('span');\n  label.className = 'cm-backlinks-label';\n  label.textContent = 'Backlinks';\n  dom.appendChild(label);\n\n  if (!backlinks || backlinks.length === 0) {\n    const empty = document.createElement('span');\n    empty.className = 'cm-backlinks-empty';\n    empty.textContent = 'None';\n    dom.appendChild(empty);\n    return;\n  }\n\n  const list = document.createElement('span');\n  list.className = 'cm-backlinks-list';\n\n  for (const backlink of backlinks) {\n    const chip = document.createElement('span');\n    chip.className = 'cm-backlinks-link';\n    chip.textContent = backlink.title;\n    if (backlink.excerpt) {\n      chip.title = backlink.excerpt;\n    }\n    chip.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      if (onBacklinkClick) {\n        onBacklinkClick(backlink);\n      }\n    });\n    list.appendChild(chip);\n  }\n\n  dom.appendChild(list);\n}\n\n/**\n * Create the backlinks panel\n */\nfunction backlinksPanelFactory(view) {\n  const dom = document.createElement('div');\n  dom.className = 'cm-backlinks-panel';\n\n  const config = view.state.facet(backlinksFacet);\n  let lastTitle = null;\n  let currentRequest = 0;\n\n  function resolveTitle(state) {\n    const config = state.facet(backlinksFacet);\n    if (config.docTitle) return config.docTitle;\n    return extractFrontmatterTitle(state.doc);\n  }\n\n  async function fetchBacklinks(state) {\n    const config = state.facet(backlinksFacet);\n    if (!config.onBacklinksRequested) {\n      dom.textContent = '';\n      return;\n    }\n\n    const title = resolveTitle(state);\n    if (title === lastTitle) return;\n    lastTitle = title;\n\n    if (!title) {\n      renderBacklinks(dom, [], config.onBacklinkClick);\n      return;\n    }\n\n    // Show loading state\n    dom.textContent = '';\n    const loadingLabel = document.createElement('span');\n    loadingLabel.className = 'cm-backlinks-label';\n    loadingLabel.textContent = 'Backlinks';\n    dom.appendChild(loadingLabel);\n    const loading = document.createElement('span');\n    loading.className = 'cm-backlinks-empty';\n    loading.textContent = 'Loading\\u2026';\n    dom.appendChild(loading);\n\n    const requestId = ++currentRequest;\n\n    try {\n      const backlinks = await config.onBacklinksRequested(title);\n      // Only render if this is still the latest request\n      if (requestId === currentRequest) {\n        renderBacklinks(dom, backlinks, config.onBacklinkClick);\n      }\n    } catch {\n      if (requestId === currentRequest) {\n        renderBacklinks(dom, [], config.onBacklinkClick);\n      }\n    }\n  }\n\n  // Initial fetch\n  fetchBacklinks(view.state);\n\n  return {\n    dom,\n    top: false,\n    update(update) {\n      if (update.docChanged) {\n        fetchBacklinks(update.state);\n      }\n    },\n  };\n}\n\n/**\n * The backlinks panel extension.\n * Use with a Compartment for toggling.\n *\n * Requires backlinksFacet to be configured with onBacklinksRequested callback.\n */\nexport const backlinksPanel = showPanel.of(backlinksPanelFactory);\n","/**\n * Frontmatter Sheet Overlay\n *\n * A slide-down overlay that displays the YAML frontmatter property table\n * on top of the editor content area. Managed by a ViewPlugin that appends\n * DOM to view.dom.\n */\n\nimport { ViewPlugin } from '@codemirror/view';\nimport { Facet } from '@codemirror/state';\nimport {\n  toggleSheetEffect,\n  frontmatterSheetField,\n  blockRangesField,\n  buildFrontmatterPropertyTable,\n} from './hybrid-preview.js';\nimport { allowReadOnlyEdit } from './read-only.js';\n\n/**\n * Facet for providing known frontmatter keys for autocomplete.\n * Consumers provide an array of strings.\n */\nexport const frontmatterKeysFacet = Facet.define({\n  combine(values) {\n    if (values.length === 0) return [];\n    return values[values.length - 1];\n  },\n});\n\nexport const frontmatterSheetPlugin = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      this.view = view;\n      this.backdrop = null;\n      this.sheet = null;\n      this.escHandler = null;\n      this.isOpen = view.state.field(frontmatterSheetField);\n      if (this.isOpen) this.open();\n    }\n\n    update(update) {\n      const wasOpen = this.isOpen;\n      this.isOpen = update.state.field(frontmatterSheetField);\n\n      if (!wasOpen && this.isOpen) {\n        this.open();\n      } else if (wasOpen && !this.isOpen) {\n        this.close();\n      } else if (this.isOpen && update.docChanged) {\n        this.rebuildContent();\n      }\n    }\n\n    open() {\n      const view = this.view;\n\n      // Create backdrop\n      this.backdrop = document.createElement('div');\n      this.backdrop.className = 'cm-frontmatter-sheet-backdrop';\n      this.backdrop.addEventListener('mousedown', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        view.dispatch({ effects: toggleSheetEffect.of(false) });\n      });\n\n      // Create sheet container\n      this.sheet = document.createElement('div');\n      this.sheet.className = 'cm-frontmatter-sheet';\n\n      // Header\n      const header = document.createElement('div');\n      header.className = 'cm-frontmatter-sheet-header';\n      const title = document.createElement('span');\n      title.className = 'cm-frontmatter-sheet-title';\n      title.textContent = 'Properties';\n      header.appendChild(title);\n\n      const closeBtn = document.createElement('button');\n      closeBtn.className = 'cm-frontmatter-sheet-close';\n      closeBtn.textContent = '\\u00d7';\n      closeBtn.title = 'Close';\n      closeBtn.addEventListener('mousedown', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n      });\n      closeBtn.addEventListener('click', (e) => {\n        e.stopPropagation();\n        view.dispatch({ effects: toggleSheetEffect.of(false) });\n      });\n      header.appendChild(closeBtn);\n\n      this.sheet.appendChild(header);\n\n      // Content area\n      this.contentEl = document.createElement('div');\n      this.contentEl.className = 'cm-frontmatter-sheet-content';\n      this.sheet.appendChild(this.contentEl);\n\n      this.buildContent();\n\n      // Append to view.dom (the .cm-editor element)\n      view.dom.appendChild(this.backdrop);\n      view.dom.appendChild(this.sheet);\n\n      // Lock scroll\n      view.scrollDOM.style.overflow = 'hidden';\n\n      // Escape key handler\n      this.escHandler = (e) => {\n        if (e.key === 'Escape') {\n          e.preventDefault();\n          e.stopPropagation();\n          view.dispatch({ effects: toggleSheetEffect.of(false) });\n        }\n      };\n      view.dom.addEventListener('keydown', this.escHandler, true);\n\n      // Trigger animation on next frame\n      requestAnimationFrame(() => {\n        if (this.backdrop) this.backdrop.classList.add('cm-frontmatter-sheet-backdrop-visible');\n        if (this.sheet) this.sheet.classList.add('cm-frontmatter-sheet-open');\n      });\n    }\n\n    close() {\n      const view = this.view;\n\n      // Unlock scroll\n      view.scrollDOM.style.overflow = '';\n\n      // Remove escape handler\n      if (this.escHandler) {\n        view.dom.removeEventListener('keydown', this.escHandler, true);\n        this.escHandler = null;\n      }\n\n      // Animate out\n      if (this.sheet) this.sheet.classList.remove('cm-frontmatter-sheet-open');\n      if (this.backdrop) this.backdrop.classList.remove('cm-frontmatter-sheet-backdrop-visible');\n\n      // Remove DOM after animation\n      const sheet = this.sheet;\n      const backdrop = this.backdrop;\n      setTimeout(() => {\n        sheet?.remove();\n        backdrop?.remove();\n      }, 200);\n\n      this.sheet = null;\n      this.backdrop = null;\n      this.contentEl = null;\n    }\n\n    buildContent() {\n      if (!this.contentEl) return;\n      this.contentEl.innerHTML = '';\n\n      const state = this.view.state;\n      const blockRanges = state.field(blockRangesField);\n      const { frontmatter } = blockRanges;\n\n      if (!frontmatter) {\n        // No frontmatter ‚Äî show empty state with add button\n        const empty = document.createElement('div');\n        empty.className = 'cm-frontmatter-sheet-empty';\n        empty.textContent = 'No frontmatter in this document.';\n        this.contentEl.appendChild(empty);\n\n        const addBtn = document.createElement('button');\n        addBtn.className = 'cm-frontmatter-sheet-add-btn';\n        addBtn.textContent = 'Add Frontmatter';\n        addBtn.addEventListener('click', (e) => {\n          e.stopPropagation();\n          this.view.dispatch({\n            changes: { from: 0, to: 0, insert: '---\\n---\\n' },\n            annotations: allowReadOnlyEdit.of(true),\n          });\n        });\n        this.contentEl.appendChild(addBtn);\n        return;\n      }\n\n      // Compute content range\n      const hasContent = frontmatter.end - frontmatter.start > 1;\n      const contentFrom = hasContent\n        ? state.doc.line(frontmatter.start + 1).from\n        : state.doc.line(frontmatter.start).to + 1;\n      const contentTo = hasContent\n        ? state.doc.line(frontmatter.end - 1).to\n        : contentFrom;\n\n      const yamlLines = [];\n      for (let j = frontmatter.start + 1; j < frontmatter.end; j++) {\n        yamlLines.push(state.doc.line(j).text);\n      }\n      const yamlContent = yamlLines.join('\\n');\n      const blockFrom = state.doc.line(frontmatter.start).from;\n\n      const knownKeys = this.view.state.facet(frontmatterKeysFacet);\n      const { dom } = buildFrontmatterPropertyTable(\n        yamlContent, contentFrom, contentTo, blockFrom, this.view,\n        { knownKeys }\n      );\n      this.contentEl.appendChild(dom);\n    }\n\n    rebuildContent() {\n      this.buildContent();\n    }\n\n    destroy() {\n      if (this.isOpen) {\n        if (this.escHandler) {\n          this.view.dom.removeEventListener('keydown', this.escHandler, true);\n        }\n        this.sheet?.remove();\n        this.backdrop?.remove();\n        this.view.scrollDOM.style.overflow = '';\n      }\n    }\n  }\n);\n","import { EditorView } from '@codemirror/view';\n\n// Inject @keyframes for smooth preview transitions (not supported by EditorView.baseTheme)\nif (typeof document !== 'undefined') {\n  const style = document.createElement('style');\n  style.textContent = '@keyframes cmFadeIn { from { opacity: 0 } to { opacity: 1 } }';\n  document.head.appendChild(style);\n}\n\n/**\n * Base theme with all required styles for the hybrid markdown preview\n * These styles are bundled with the extension\n */\nexport const baseTheme = EditorView.baseTheme({\n  // Editor base\n  '&': {\n    height: '100%',\n    fontSize: '17px',\n  },\n  '.cm-content': {\n    fontFamily: 'Charter, \"Bitstream Charter\", \"Sitka Text\", Cambria, serif',\n    padding: '20px 48px',\n    lineHeight: '1.75',\n  },\n  '.cm-line': {\n    padding: '4px 0',\n  },\n  '.cm-scroller': {\n    overflow: 'auto',\n    fontFamily: 'Charter, \"Bitstream Charter\", \"Sitka Text\", Cambria, serif',\n  },\n  '&.cm-focused': {\n    outline: 'none',\n  },\n\n  // Markdown preview container\n  '.cm-markdown-preview': {\n    display: 'inline',\n    animation: 'cmFadeIn 0.12s ease-out',\n  },\n\n  // Headers\n  '.cm-markdown-preview .md-header': {\n    display: 'inline',\n    fontWeight: '600',\n    lineHeight: '1.4',\n  },\n  '.cm-markdown-preview .md-h1': {\n    fontSize: '2em',\n  },\n  '.cm-markdown-preview .md-h2': {\n    fontSize: '1.5em',\n  },\n  '.cm-markdown-preview .md-h3': {\n    fontSize: '1.25em',\n  },\n  '.cm-markdown-preview .md-h4': {\n    fontSize: '1.1em',\n  },\n  '.cm-markdown-preview .md-h5': {\n    fontSize: '1em',\n  },\n  '.cm-markdown-preview .md-h6': {\n    fontSize: '0.9em',\n  },\n\n  // Bold and italic\n  '.cm-markdown-preview strong': {\n    fontWeight: '700',\n  },\n  '.cm-markdown-preview em': {\n    fontStyle: 'italic',\n  },\n  '.cm-markdown-preview del': {\n    textDecoration: 'line-through',\n  },\n  '.cm-markdown-preview .md-highlight, .cm-markdown-preview mark': {\n    backgroundColor: '#fde68a',\n    color: 'inherit',\n    padding: '0 2px',\n    borderRadius: '3px',\n  },\n  '.cm-markdown-preview .md-subscript, .cm-markdown-preview sub': {\n    fontSize: '0.85em',\n    verticalAlign: 'sub',\n  },\n  '.cm-markdown-preview .md-superscript, .cm-markdown-preview sup': {\n    fontSize: '0.85em',\n    verticalAlign: 'super',\n  },\n\n  // Inline code\n  '.cm-markdown-preview code': {\n    padding: '2px 6px',\n    borderRadius: '4px',\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n    fontSize: '0.9em',\n  },\n\n  // Links\n  '.cm-markdown-preview a': {\n    textDecoration: 'none',\n    cursor: 'pointer',\n  },\n  '.cm-markdown-preview a:hover': {\n    textDecoration: 'underline',\n  },\n\n  // Images\n  '.cm-markdown-preview img': {\n    maxWidth: '100%',\n    height: 'auto',\n    borderRadius: '4px',\n  },\n\n  // Blockquotes\n  '.cm-markdown-preview .md-blockquote': {\n    display: 'inline',\n    fontStyle: 'italic',\n    paddingLeft: '16px',\n    marginLeft: '0',\n  },\n\n  // List items\n  '.cm-markdown-preview .md-list-item': {\n    display: 'inline',\n  },\n  '.cm-markdown-preview .md-list-marker': {\n    marginRight: '4px',\n  },\n\n  // Horizontal rule\n  '.cm-markdown-preview .md-hr, .cm-markdown-preview hr': {\n    display: 'block',\n    border: 'none',\n    margin: '16px 0',\n    height: '1px',\n  },\n\n  // Checkboxes\n  '.cm-markdown-preview input[type=\"checkbox\"]': {\n    width: '19.2px',\n    height: '19.2px',\n    marginRight: '6px',\n    cursor: 'pointer',\n  },\n  '.cm-markdown-preview .md-task-icon': {\n    display: 'inline-flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    width: '1.2em',\n    marginRight: '6px',\n    cursor: 'pointer',\n    userSelect: 'none',\n  },\n  '.cm-markdown-preview .md-task-idea': {\n    color: '#0ea5e9',\n  },\n  '.cm-markdown-preview .md-task-urgent': {\n    color: '#ef4444',\n  },\n  '.cm-markdown-preview .md-task-question': {\n    color: '#a855f7',\n  },\n  '.cm-markdown-preview .md-task-important': {\n    color: '#ec4899',\n  },\n  '.cm-markdown-preview .md-task-forwarded': {\n    color: '#3b82f6',\n  },\n  '.cm-markdown-preview .md-task-scheduled': {\n    color: '#f59e0b',\n  },\n\n  // Code block lines\n  '.cm-code-block-line': {\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n    fontSize: '0.9em',\n  },\n\n  // Highlighted code\n  '.cm-highlighted-code': {\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n  },\n\n  // Table preview container\n  '.cm-table-preview': {\n    display: 'block',\n    margin: '0',\n    animation: 'cmFadeIn 0.15s ease-out',\n  },\n\n  // Definition list preview\n  '.cm-definition-list-preview': {\n    display: 'block',\n    margin: '0',\n    animation: 'cmFadeIn 0.15s ease-out',\n  },\n  '.md-definition-list': {\n    margin: '4px 0 8px 0',\n  },\n  '.md-definition-list dt': {\n    fontWeight: '600',\n  },\n  '.md-definition-list dd': {\n    margin: '2px 0 6px 16px',\n  },\n\n  // Footnote preview\n  '.cm-footnote-preview': {\n    display: 'block',\n    margin: '4px 0',\n    animation: 'cmFadeIn 0.15s ease-out',\n  },\n  '.md-footnote-block': {\n    display: 'block',\n  },\n  '.md-footnote-line': {\n    display: 'block',\n  },\n  '.md-footnote-backref': {\n    display: 'block',\n  },\n  '.md-footnote-backref-link': {\n    cursor: 'pointer',\n    fontSize: '0.85em',\n  },\n  '.md-wikilink': {\n    cursor: 'pointer',\n    textDecoration: 'underline',\n    textUnderlineOffset: '2px',\n  },\n  '.cm-wikilink': {\n    textDecoration: 'underline',\n    textUnderlineOffset: '2px',\n  },\n\n  // Table styling\n  '.md-table': {\n    borderCollapse: 'collapse',\n    borderRadius: '6px',\n    overflow: 'hidden',\n  },\n  '.md-table th, .md-table td': {\n    padding: '8px 12px',\n    textAlign: 'left',\n  },\n  '.md-table th': {\n    fontWeight: '600',\n  },\n\n  // Legacy single-line table styles\n  '.cm-markdown-preview .md-table-row': {\n    display: 'inline-flex',\n    borderRadius: '4px',\n  },\n  '.cm-markdown-preview .md-table-cell': {\n    display: 'inline-block',\n    padding: '6px 12px',\n    minWidth: '80px',\n  },\n  '.cm-markdown-preview .md-table-cell:last-child': {\n    borderRight: 'none',\n  },\n  '.cm-markdown-preview .md-table-separator': {\n    display: 'none',\n  },\n\n  // Math block preview\n  '.cm-math-preview': {\n    display: 'block',\n    padding: '8px 0',\n    animation: 'cmFadeIn 0.15s ease-out',\n  },\n  '.cm-math-preview .katex-display': {\n    textAlign: 'left !important',\n    margin: '0 !important',\n    justifyContent: 'flex-start !important',\n  },\n  '.cm-math-preview .katex-display > .katex': {\n    textAlign: 'left !important',\n  },\n\n  // Mermaid diagram preview\n  '.cm-mermaid-preview': {\n    display: 'block',\n    padding: '16px 0',\n    cursor: 'pointer',\n    animation: 'cmFadeIn 0.15s ease-out',\n  },\n  '.cm-mermaid-preview svg': {\n    maxWidth: '100%',\n    height: 'auto',\n  },\n  '.cm-mermaid-preview .mermaid-error': {\n    color: '#d73a49',\n    fontFamily: 'monospace',\n    fontSize: '0.9em',\n  },\n  '.cm-mermaid-block-line': {\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n    fontSize: '0.9em',\n  },\n\n  // Hidden lines (for multi-line blocks like tables, math, mermaid)\n  '.cm-hidden-line': {\n    height: '0 !important',\n    padding: '0 !important',\n    minHeight: '0 !important',\n  },\n\n  // Collapsed heading content (animated)\n  '.cm-collapsed-line': {\n    height: '0 !important',\n    minHeight: '0 !important',\n    padding: '0 !important',\n    margin: '0 !important',\n    overflow: 'hidden !important',\n    opacity: '0',\n    lineHeight: '0 !important',\n    transition: 'height 0.15s ease-out, opacity 0.1s ease-out, padding 0.15s ease-out',\n  },\n\n  // Heading preview with collapse toggle\n  '.cm-heading-preview': {\n    display: 'inline-flex',\n    alignItems: 'center',\n    animation: 'cmFadeIn 0.12s ease-out',\n  },\n\n  // Collapse toggle button\n  '.cm-collapse-toggle': {\n    display: 'inline-flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    cursor: 'pointer',\n    userSelect: 'none',\n    fontSize: '0.8em',\n    opacity: '0',\n    transition: 'opacity 0.15s ease, transform 0.15s ease',\n    marginLeft: '-20px',\n    width: '20px',\n    height: '1em',\n    flexShrink: '0',\n  },\n  // Collapsed: always visible\n  '.cm-collapse-toggle.collapsed': {\n    transform: 'rotate(0deg)',\n    opacity: '0.4',\n  },\n  '.cm-collapse-toggle.collapsed:hover': {\n    opacity: '1',\n  },\n  // Expanded: only visible on hover\n  '.cm-collapse-toggle.expanded': {\n    transform: 'rotate(90deg)',\n  },\n  '.cm-line:hover .cm-collapse-toggle.expanded': {\n    opacity: '0.4',\n  },\n  '.cm-line:hover .cm-collapse-toggle.expanded:hover': {\n    opacity: '1',\n  },\n\n  // Footnotes\n  '.footnote-ref .footnote-link': {\n    cursor: 'pointer',\n    fontSize: '0.85em',\n  },\n  '.footnote-def': {\n    display: 'inline',\n    fontSize: '0.9em',\n  },\n  '.footnote-def sup': {\n    marginRight: '4px',\n  },\n\n  // Syntax highlighting (base classes)\n  '.tok-keyword': {},\n  '.tok-operator': {},\n  '.tok-variableName': {},\n  '.tok-function, .tok-definition': {},\n  '.tok-string, .tok-string2': {},\n  '.tok-number': {},\n  '.tok-bool, .tok-null': {},\n  '.tok-comment': { fontStyle: 'italic' },\n  '.tok-punctuation': {},\n  '.tok-propertyName': {},\n  '.tok-typeName, .tok-className': {},\n  '.tok-tagName': {},\n  '.tok-attributeName': {},\n  '.tok-attributeValue': {},\n  '.tok-regexp': {},\n  '.tok-meta': {},\n\n  // Inline image preview\n  '.cm-image-preview': {\n    display: 'block',\n    padding: '8px 0',\n    cursor: 'pointer',\n    animation: 'cmFadeIn 0.15s ease-out',\n  },\n  '.cm-image-preview img': {\n    maxWidth: '100%',\n    maxHeight: '400px',\n    objectFit: 'contain',\n    borderRadius: '6px',\n    display: 'block',\n  },\n  '.cm-image-alt': {\n    display: 'block',\n    fontSize: '0.8em',\n    marginTop: '4px',\n    fontStyle: 'italic',\n  },\n  '.cm-image-error': {\n    display: 'block',\n    padding: '12px',\n    fontSize: '0.85em',\n    borderRadius: '6px',\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n  },\n\n  // Frontmatter property editor\n  '.cm-frontmatter-preview': {\n    display: 'block',\n    margin: '0',\n    padding: '8px 12px',\n    borderRadius: '6px',\n    animation: 'cmFadeIn 0.15s ease-out',\n  },\n  '.cm-frontmatter-table': {\n    width: '100%',\n    borderCollapse: 'collapse',\n    fontSize: '0.9em',\n  },\n  '.cm-frontmatter-table td': {\n    padding: '3px 8px',\n    verticalAlign: 'middle',\n  },\n  '.cm-frontmatter-key': {\n    fontWeight: '600',\n    whiteSpace: 'nowrap',\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n    fontSize: '0.9em',\n    width: '1%',\n    paddingRight: '16px',\n  },\n  '.cm-frontmatter-key-input': {\n    fontFamily: 'inherit',\n    fontWeight: 'inherit',\n    fontSize: 'inherit',\n    color: 'inherit',\n    background: 'transparent',\n    border: 'none',\n    outline: 'none',\n    padding: '2px 4px',\n    borderRadius: '3px',\n    boxSizing: 'border-box',\n    minWidth: '3ch',\n    appearance: 'none',\n    MozAppearance: 'none',\n    WebkitAppearance: 'none',\n  },\n  '.cm-frontmatter-key-input::-webkit-calendar-picker-indicator': {\n    display: 'none !important',\n  },\n  '.cm-frontmatter-value-cell': {\n    width: '100%',\n  },\n  '.cm-frontmatter-value': {\n    display: 'flex',\n    flexWrap: 'wrap',\n    gap: '4px',\n    alignItems: 'center',\n  },\n  '.cm-frontmatter-input': {\n    border: 'none',\n    background: 'transparent',\n    width: '100%',\n    font: 'inherit',\n    fontSize: '1em',\n    outline: 'none',\n    padding: '2px 4px',\n    borderRadius: '3px',\n  },\n  '.cm-frontmatter-input:focus': {\n    outline: 'none',\n  },\n  '.cm-frontmatter-checkbox': {\n    width: '16px',\n    height: '16px',\n    cursor: 'pointer',\n    margin: '0',\n  },\n  '.cm-frontmatter-tag': {\n    display: 'inline-block',\n    padding: '1px 8px',\n    borderRadius: '10px',\n    fontSize: '0.9em',\n    cursor: 'text',\n    outline: 'none',\n    lineHeight: '1.5',\n  },\n  '.cm-frontmatter-add-tag': {\n    display: 'inline-flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    width: '20px',\n    height: '20px',\n    borderRadius: '50%',\n    cursor: 'pointer',\n    fontSize: '0.85em',\n    opacity: '0.4',\n    userSelect: 'none',\n  },\n  '.cm-frontmatter-add-tag:hover': {\n    opacity: '1',\n  },\n  '.cm-frontmatter-action-cell': {\n    width: '1%',\n    whiteSpace: 'nowrap',\n  },\n  '.cm-frontmatter-delete': {\n    cursor: 'pointer',\n    opacity: '0',\n    fontSize: '1.1em',\n    padding: '0 4px',\n    userSelect: 'none',\n    transition: 'opacity 0.1s ease',\n  },\n  '.cm-frontmatter-table tr:hover .cm-frontmatter-delete': {\n    opacity: '0.3',\n  },\n  '.cm-frontmatter-table tr:hover .cm-frontmatter-delete:hover': {\n    opacity: '1',\n  },\n  '.cm-frontmatter-add': {\n    cursor: 'pointer',\n    opacity: '0.4',\n    fontSize: '0.85em',\n    padding: '4px 8px',\n    userSelect: 'none',\n  },\n  '.cm-frontmatter-add:hover': {\n    opacity: '0.8',\n  },\n  '.cm-frontmatter-error': {\n    fontStyle: 'italic',\n    fontSize: '0.9em',\n    padding: '4px 0',\n    cursor: 'pointer',\n  },\n  '.cm-frontmatter-line': {\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n    fontSize: '0.9em',\n    animation: 'cmFadeIn 0.1s ease-out',\n  },\n\n  // Frontmatter sheet overlay\n  '.cm-frontmatter-sheet-backdrop': {\n    position: 'absolute',\n    top: '0',\n    left: '0',\n    right: '0',\n    bottom: '0',\n    zIndex: '10',\n    opacity: '0',\n    transition: 'opacity 0.2s ease',\n  },\n  '.cm-frontmatter-sheet-backdrop-visible': {\n    opacity: '1',\n  },\n  '.cm-frontmatter-sheet': {\n    position: 'absolute',\n    top: '0',\n    left: '0',\n    right: '0',\n    zIndex: '11',\n    maxHeight: '70%',\n    overflowY: 'auto',\n    transform: 'translateY(-100%)',\n    transition: 'transform 0.2s ease',\n    borderBottomLeftRadius: '8px',\n    borderBottomRightRadius: '8px',\n  },\n  '.cm-frontmatter-sheet-open': {\n    transform: 'translateY(0)',\n  },\n  '.cm-frontmatter-sheet-header': {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    padding: '12px 20px 0',\n  },\n  '.cm-frontmatter-sheet-title': {\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    fontSize: '0.9em',\n    fontWeight: '600',\n  },\n  '.cm-frontmatter-sheet-close': {\n    background: 'none',\n    border: 'none',\n    fontSize: '18px',\n    cursor: 'pointer',\n    padding: '0 4px',\n    lineHeight: '1',\n    opacity: '0.5',\n  },\n  '.cm-frontmatter-sheet-close:hover': {\n    opacity: '1',\n  },\n  '.cm-frontmatter-sheet-content': {\n    padding: '8px 20px 16px',\n  },\n  '.cm-frontmatter-sheet-content .cm-frontmatter-preview': {\n    border: 'none',\n    padding: '0',\n    margin: '0',\n    borderRadius: '0',\n    animation: 'none',\n  },\n  '.cm-frontmatter-sheet-empty': {\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    fontSize: '0.9em',\n    padding: '8px 0',\n    opacity: '0.6',\n  },\n  '.cm-frontmatter-sheet-add-btn': {\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    fontSize: '0.85em',\n    padding: '6px 16px',\n    borderRadius: '6px',\n    cursor: 'pointer',\n    border: '1px solid',\n    marginTop: '8px',\n  },\n\n  // Word count panel\n  '.cm-word-count-panel': {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '0',\n    padding: '4px 16px',\n    fontSize: '12px',\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    userSelect: 'none',\n  },\n  '.cm-word-count-stat': {\n    display: 'inline-flex',\n    alignItems: 'center',\n    padding: '0 10px',\n  },\n  '.cm-word-count-value': {\n    fontWeight: '600',\n    fontVariantNumeric: 'tabular-nums',\n  },\n  '.cm-word-count-label': {\n    fontWeight: '400',\n  },\n  '.cm-word-count-divider': {\n    width: '1px',\n    height: '12px',\n    flexShrink: '0',\n  },\n\n  // Tag pills\n  '.md-tag': {\n    display: 'inline-block',\n    padding: '1px 8px',\n    borderRadius: '10px',\n    fontSize: '0.9em',\n    cursor: 'pointer',\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    lineHeight: '1.5',\n    verticalAlign: 'baseline',\n  },\n  '.cm-tag-mark': {\n    borderRadius: '3px',\n  },\n\n  // Smooth transitions: focused lines fade in when raw markdown appears\n  '.cm-selectedLine': {\n    animation: 'cmFadeIn 0.1s ease-out',\n  },\n  '.cm-table-line': {\n    animation: 'cmFadeIn 0.1s ease-out',\n  },\n  '.cm-math-block-line': {\n    animation: 'cmFadeIn 0.1s ease-out',\n  },\n  '.cm-mermaid-block-line': {\n    animation: 'cmFadeIn 0.1s ease-out',\n  },\n  // Backlinks panel\n  '.cm-backlinks-panel': {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '8px',\n    padding: '4px 16px',\n    fontSize: '12px',\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    userSelect: 'none',\n  },\n  '.cm-backlinks-label': {\n    fontWeight: '600',\n    flexShrink: '0',\n  },\n  '.cm-backlinks-list': {\n    display: 'flex',\n    flexWrap: 'wrap',\n    gap: '4px',\n    alignItems: 'center',\n  },\n  '.cm-backlinks-link': {\n    display: 'inline-block',\n    padding: '1px 8px',\n    borderRadius: '10px',\n    cursor: 'pointer',\n    fontSize: '11px',\n    lineHeight: '1.5',\n  },\n  '.cm-backlinks-link:hover': {\n    textDecoration: 'underline',\n  },\n  '.cm-backlinks-empty': {\n    fontStyle: 'italic',\n    opacity: '0.6',\n  },\n\n  // Focus mode: unfocused lines\n  '.cm-unfocused-line': {\n    opacity: '0.25',\n    transition: 'opacity 0.2s ease',\n  },\n});\n","import { EditorView } from '@codemirror/view';\n\n/**\n * Light theme for the hybrid markdown editor\n */\nexport const lightTheme = EditorView.theme({\n  // Editor background\n  '&': {\n    backgroundColor: '#fff',\n  },\n  '.cm-content': {\n    caretColor: '#333',\n  },\n  '.cm-cursor': {\n    borderLeftColor: '#333',\n    borderLeftWidth: '2px',\n  },\n  '.cm-selectionBackground': {\n    backgroundColor: '#b4d5fe',\n  },\n  '&.cm-focused .cm-selectionBackground': {\n    backgroundColor: '#b4d5fe',\n  },\n\n  // Header colors\n  '.cm-markdown-preview .md-h1': { color: '#1a1a2e' },\n  '.cm-markdown-preview .md-h2': { color: '#2d2d3f' },\n  '.cm-markdown-preview .md-h3': { color: '#3d3d4d' },\n  '.cm-markdown-preview .md-h4': { color: '#555566' },\n  '.cm-markdown-preview .md-h5': { color: '#666677' },\n  '.cm-markdown-preview .md-h6': { color: '#777788' },\n\n  // Text colors\n  '.cm-markdown-preview del': { color: '#868e96' },\n  '.cm-markdown-preview code': {\n    backgroundColor: '#f1f3f5',\n    color: '#e83e8c',\n  },\n  '.cm-markdown-preview a': { color: '#228be6' },\n  '.cm-markdown-preview .md-blockquote': {\n    color: '#555',\n    borderLeft: '3px solid #c0c8d0',\n  },\n  '.cm-markdown-preview .md-list-marker': { color: '#888' },\n  '.cm-markdown-preview .md-hr, .cm-markdown-preview hr': {\n    background: 'linear-gradient(to right, transparent, #c0c8d0, transparent)',\n  },\n\n  // Code block lines\n  '.cm-code-block-line': {\n    backgroundColor: '#f6f8fa !important',\n    borderLeft: '3px solid #e1e4e8',\n  },\n  '.cm-code-block-line.cm-code-block-focused': {\n    backgroundColor: '#e8f4fc !important',\n    borderLeft: '3px solid #228be6',\n  },\n\n  // Selected lines get dark styling (inverted)\n  '.cm-selectedLine, .cm-table-line, .cm-math-block-line, .cm-mermaid-block-line': {\n    backgroundColor: '#1e1e1e !important',\n    color: '#d4d4d4 !important',\n    caretColor: '#fff !important',\n    borderRadius: '4px',\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n    fontSize: '0.90em',\n  },\n  '.cm-selectedLine.cm-code-block-line': {\n    backgroundColor: '#1e1e1e !important',\n    borderLeft: '3px solid #569cd6',\n    color: '#d4d4d4 !important',\n    caretColor: '#fff !important',\n    borderRadius: '0',\n  },\n\n  // Syntax highlighting for selected code block lines (dark theme colors)\n  '.cm-selectedLine.cm-code-block-line .tok-keyword': { color: '#569cd6 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-operator': { color: '#d4d4d4 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-variableName': { color: '#9cdcfe !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-function, .cm-selectedLine.cm-code-block-line .tok-definition': { color: '#dcdcaa !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-string, .cm-selectedLine.cm-code-block-line .tok-string2': { color: '#ce9178 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-number': { color: '#b5cea8 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-bool, .cm-selectedLine.cm-code-block-line .tok-null': { color: '#569cd6 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-comment': { color: '#6a9955 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-punctuation': { color: '#d4d4d4 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-propertyName': { color: '#9cdcfe !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-typeName, .cm-selectedLine.cm-code-block-line .tok-className': { color: '#4ec9b0 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-tagName': { color: '#569cd6 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-attributeName': { color: '#9cdcfe !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-attributeValue': { color: '#ce9178 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-regexp': { color: '#d16969 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-meta': { color: '#6a9955 !important' },\n\n  // Inline image preview\n  '.cm-image-preview img': {\n    boxShadow: '0 1px 4px rgba(0, 0, 0, 0.1)',\n  },\n  '.cm-image-alt': {\n    color: '#888',\n  },\n  '.cm-image-error': {\n    backgroundColor: '#fff3f3',\n    color: '#d73a49',\n    border: '1px solid #fdd',\n  },\n\n  // Frontmatter property editor\n  '.cm-frontmatter-preview': {\n    backgroundColor: '#f8f9fa',\n    border: '1px solid #e1e4e8',\n  },\n  '.cm-frontmatter-table td': {\n    borderBottom: '1px solid #eee',\n  },\n  '.cm-frontmatter-table tr:last-child td': {\n    borderBottom: 'none',\n  },\n  '.cm-frontmatter-key': {\n    color: '#555',\n  },\n  '.cm-frontmatter-key-input:focus': {\n    backgroundColor: '#fff',\n    boxShadow: '0 0 0 1px #228be6',\n  },\n  '.cm-frontmatter-input:focus': {\n    backgroundColor: '#fff',\n    boxShadow: '0 0 0 1px #228be6',\n  },\n  '.cm-frontmatter-tag': {\n    backgroundColor: '#e8f0fe',\n    color: '#1a73e8',\n    border: '1px solid #d2e3fc',\n  },\n  '.cm-frontmatter-add-tag': {\n    backgroundColor: '#e8f0fe',\n    color: '#1a73e8',\n  },\n  '.cm-frontmatter-delete': {\n    color: '#d73a49',\n  },\n  '.cm-frontmatter-error': {\n    color: '#d73a49',\n  },\n  '.cm-frontmatter-line': {\n    backgroundColor: '#f6f8fa !important',\n    borderLeft: '3px solid #e1e4e8',\n  },\n\n  // Frontmatter sheet overlay\n  '.cm-frontmatter-sheet-backdrop': {\n    backgroundColor: 'rgba(0, 0, 0, 0.3)',\n  },\n  '.cm-frontmatter-sheet': {\n    backgroundColor: '#fff',\n    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.12)',\n  },\n  '.cm-frontmatter-sheet-title': {\n    color: '#333',\n  },\n  '.cm-frontmatter-sheet-close': {\n    color: '#666',\n  },\n  '.cm-frontmatter-sheet-add-btn': {\n    backgroundColor: '#f8f9fa',\n    borderColor: '#e1e4e8',\n    color: '#333',\n  },\n  '.cm-frontmatter-sheet-add-btn:hover': {\n    backgroundColor: '#e9ecef',\n  },\n\n  // Word count panel\n  '.cm-word-count-panel': {\n    backgroundColor: '#f8f9fa',\n    borderTop: '1px solid #e1e4e8',\n    color: '#555',\n  },\n  '.cm-word-count-value': {\n    color: '#333',\n  },\n  '.cm-word-count-label': {\n    color: '#888',\n  },\n  '.cm-word-count-divider': {\n    backgroundColor: '#dee2e6',\n  },\n  '.cm-word-count-selection': {\n    color: '#228be6',\n  },\n  '.cm-word-count-selection .cm-word-count-value': {\n    color: '#228be6',\n  },\n  '.cm-word-count-selection .cm-word-count-label': {\n    color: '#228be6',\n    opacity: '0.7',\n  },\n\n  // Gutters\n  '.cm-gutters': {\n    background: '#f8f9fa',\n    borderRight: '1px solid #dee2e6',\n  },\n\n  // Table styling\n  '.md-table': { border: '1px solid #d0d7de' },\n  '.md-table th, .md-table td': { border: '1px solid #d0d7de' },\n  '.md-table th': { background: '#f6f8fa' },\n  '.md-table tbody tr:hover': { background: '#f6f8fa' },\n  '.cm-markdown-preview .md-table-row': {\n    background: '#fff',\n    border: '1px solid #d0d7de',\n  },\n  '.cm-markdown-preview .md-table-cell': {\n    borderRight: '1px solid #d0d7de',\n  },\n\n  // Syntax highlighting (light theme colors)\n  '.tok-keyword': { color: '#d73a49' },\n  '.tok-operator': { color: '#d73a49' },\n  '.tok-variableName': { color: '#24292e' },\n  '.tok-function, .tok-definition': { color: '#6f42c1' },\n  '.tok-string, .tok-string2': { color: '#032f62' },\n  '.tok-number': { color: '#005cc5' },\n  '.tok-bool, .tok-null': { color: '#005cc5' },\n  '.tok-comment': { color: '#6a737d' },\n  '.tok-punctuation': { color: '#24292e' },\n  '.tok-propertyName': { color: '#005cc5' },\n  '.tok-typeName, .tok-className': { color: '#22863a' },\n  '.tok-tagName': { color: '#22863a' },\n  '.tok-attributeName': { color: '#6f42c1' },\n  '.tok-attributeValue': { color: '#032f62' },\n  '.tok-regexp': { color: '#032f62' },\n  '.tok-meta': { color: '#6a737d' },\n\n  // Backlinks panel\n  '.cm-backlinks-panel': {\n    backgroundColor: '#f8f9fa',\n    borderTop: '1px solid #e1e4e8',\n    color: '#555',\n  },\n  '.cm-backlinks-label': {\n    color: '#333',\n  },\n  '.cm-backlinks-link': {\n    backgroundColor: '#e8f0fe',\n    color: '#1a73e8',\n    border: '1px solid #d2e3fc',\n  },\n\n  // Tag pills\n  '.md-tag': {\n    backgroundColor: '#e8f5e9',\n    color: '#2e7d32',\n    border: '1px solid #c8e6c9',\n  },\n  '.cm-tag-mark': {\n    color: '#2e7d32',\n  },\n\n  // Footnotes\n  '.footnote-ref .footnote-link': { color: '#228be6' },\n  '.footnote-def': { color: '#666' },\n  '.footnote-def sup': { color: '#228be6' },\n  '.md-wikilink, .cm-wikilink': { color: '#228be6' },\n});\n","import { EditorView } from '@codemirror/view';\n\n/**\n * Dark theme for the hybrid markdown editor\n */\nexport const darkTheme = EditorView.theme({\n  // Editor background\n  '&': {\n    backgroundColor: '#1e1e1e',\n  },\n  '.cm-content': {\n    caretColor: '#fff',\n    color: '#d4d4d4',\n  },\n  '.cm-cursor': {\n    borderLeftColor: '#fff',\n    borderLeftWidth: '2px',\n  },\n  '.cm-selectionBackground': {\n    backgroundColor: '#264f78',\n  },\n  '&.cm-focused .cm-selectionBackground': {\n    backgroundColor: '#264f78',\n  },\n\n  // Header colors\n  '.cm-markdown-preview .md-h1': { color: '#e8e8ec' },\n  '.cm-markdown-preview .md-h2': { color: '#d5d5db' },\n  '.cm-markdown-preview .md-h3': { color: '#c2c2ca' },\n  '.cm-markdown-preview .md-h4': { color: '#acacb8' },\n  '.cm-markdown-preview .md-h5': { color: '#9696a4' },\n  '.cm-markdown-preview .md-h6': { color: '#808090' },\n\n  // Text colors\n  '.cm-markdown-preview del': { color: '#777' },\n  '.cm-markdown-preview code': {\n    backgroundColor: '#2d2d2d',\n    color: '#ce9178',\n  },\n  '.cm-markdown-preview a': { color: '#228be6' },\n  '.cm-markdown-preview .md-blockquote': {\n    color: '#aaa',\n    borderLeft: '3px solid #4a4a5a',\n  },\n  '.cm-markdown-preview .md-list-marker': { color: '#888' },\n  '.cm-markdown-preview .md-hr, .cm-markdown-preview hr': {\n    background: 'linear-gradient(to right, transparent, #4a4a5a, transparent)',\n  },\n\n  // Code block lines\n  '.cm-code-block-line': {\n    backgroundColor: '#2d2d2d !important',\n    borderLeft: '3px solid #444',\n  },\n  '.cm-code-block-line.cm-code-block-focused': {\n    backgroundColor: '#3a3d41 !important',\n    borderLeft: '3px solid #569cd6',\n  },\n\n  // Selected lines get light styling (inverted)\n  '.cm-selectedLine, .cm-table-line, .cm-math-block-line, .cm-mermaid-block-line': {\n    backgroundColor: '#fff !important',\n    color: '#1e1e1e !important',\n    caretColor: '#333 !important',\n    borderRadius: '4px',\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n    fontSize: '0.90em',\n  },\n  '.cm-selectedLine.cm-code-block-line': {\n    backgroundColor: '#fff !important',\n    borderLeft: '3px solid #228be6',\n    color: '#1e1e1e !important',\n    caretColor: '#333 !important',\n    borderRadius: '0',\n  },\n\n  // Syntax highlighting for selected code block lines (light theme colors)\n  '.cm-selectedLine.cm-code-block-line .tok-keyword': { color: '#d73a49 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-operator': { color: '#d73a49 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-variableName': { color: '#24292e !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-function, .cm-selectedLine.cm-code-block-line .tok-definition': { color: '#6f42c1 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-string, .cm-selectedLine.cm-code-block-line .tok-string2': { color: '#032f62 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-number': { color: '#005cc5 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-bool, .cm-selectedLine.cm-code-block-line .tok-null': { color: '#005cc5 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-comment': { color: '#6a737d !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-punctuation': { color: '#24292e !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-propertyName': { color: '#005cc5 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-typeName, .cm-selectedLine.cm-code-block-line .tok-className': { color: '#22863a !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-tagName': { color: '#22863a !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-attributeName': { color: '#6f42c1 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-attributeValue': { color: '#032f62 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-regexp': { color: '#032f62 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-meta': { color: '#6a737d !important' },\n\n  // Inline image preview\n  '.cm-image-preview img': {\n    boxShadow: '0 1px 4px rgba(0, 0, 0, 0.3)',\n  },\n  '.cm-image-alt': {\n    color: '#888',\n  },\n  '.cm-image-error': {\n    backgroundColor: '#3a2020',\n    color: '#f48771',\n    border: '1px solid #5a3030',\n  },\n\n  // Frontmatter property editor\n  '.cm-frontmatter-preview': {\n    backgroundColor: '#2d2d2d',\n    border: '1px solid #444',\n  },\n  '.cm-frontmatter-table td': {\n    borderBottom: '1px solid #3c3c3c',\n  },\n  '.cm-frontmatter-table tr:last-child td': {\n    borderBottom: 'none',\n  },\n  '.cm-frontmatter-key': {\n    color: '#9cdcfe',\n  },\n  '.cm-frontmatter-input': {\n    color: '#d4d4d4',\n  },\n  '.cm-frontmatter-key-input:focus': {\n    backgroundColor: '#3a3d41',\n    boxShadow: '0 0 0 1px #569cd6',\n  },\n  '.cm-frontmatter-input:focus': {\n    backgroundColor: '#3a3d41',\n    boxShadow: '0 0 0 1px #569cd6',\n  },\n  '.cm-frontmatter-tag': {\n    backgroundColor: '#264f78',\n    color: '#9cdcfe',\n    border: '1px solid #3a6ea5',\n  },\n  '.cm-frontmatter-add-tag': {\n    backgroundColor: '#264f78',\n    color: '#9cdcfe',\n  },\n  '.cm-frontmatter-delete': {\n    color: '#f48771',\n  },\n  '.cm-frontmatter-error': {\n    color: '#f48771',\n  },\n  '.cm-frontmatter-line': {\n    backgroundColor: '#2d2d2d !important',\n    borderLeft: '3px solid #444',\n  },\n\n  // Frontmatter sheet overlay\n  '.cm-frontmatter-sheet-backdrop': {\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\n  },\n  '.cm-frontmatter-sheet': {\n    backgroundColor: '#252526',\n    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.4)',\n  },\n  '.cm-frontmatter-sheet-title': {\n    color: '#d4d4d4',\n  },\n  '.cm-frontmatter-sheet-close': {\n    color: '#aaa',\n  },\n  '.cm-frontmatter-sheet-add-btn': {\n    backgroundColor: '#3c3c3c',\n    borderColor: '#555',\n    color: '#d4d4d4',\n  },\n  '.cm-frontmatter-sheet-add-btn:hover': {\n    backgroundColor: '#4a4a4a',\n  },\n\n  // Word count panel\n  '.cm-word-count-panel': {\n    backgroundColor: '#252526',\n    borderTop: '1px solid #3c3c3c',\n    color: '#aaa',\n  },\n  '.cm-word-count-value': {\n    color: '#d4d4d4',\n  },\n  '.cm-word-count-label': {\n    color: '#777',\n  },\n  '.cm-word-count-divider': {\n    backgroundColor: '#444',\n  },\n  '.cm-word-count-selection': {\n    color: '#569cd6',\n  },\n  '.cm-word-count-selection .cm-word-count-value': {\n    color: '#569cd6',\n  },\n  '.cm-word-count-selection .cm-word-count-label': {\n    color: '#569cd6',\n    opacity: '0.7',\n  },\n\n  // Gutters\n  '.cm-gutters': {\n    background: '#252526',\n    borderRight: '1px solid #3c3c3c',\n  },\n\n  // Table styling\n  '.md-table': { border: '1px solid #444' },\n  '.md-table th, .md-table td': { border: '1px solid #444' },\n  '.md-table th': { background: '#2d2d2d' },\n  '.md-table tbody tr:hover': { background: '#2d2d2d' },\n  '.cm-markdown-preview .md-table-row': {\n    background: '#1e1e1e',\n    border: '1px solid #444',\n  },\n  '.cm-markdown-preview .md-table-cell': {\n    borderRight: '1px solid #444',\n  },\n\n  // Syntax highlighting (dark theme colors)\n  '.tok-keyword': { color: '#569cd6' },\n  '.tok-operator': { color: '#d4d4d4' },\n  '.tok-variableName': { color: '#9cdcfe' },\n  '.tok-function, .tok-definition': { color: '#dcdcaa' },\n  '.tok-string, .tok-string2': { color: '#ce9178' },\n  '.tok-number': { color: '#b5cea8' },\n  '.tok-bool, .tok-null': { color: '#569cd6' },\n  '.tok-comment': { color: '#6a9955' },\n  '.tok-punctuation': { color: '#d4d4d4' },\n  '.tok-propertyName': { color: '#9cdcfe' },\n  '.tok-typeName, .tok-className': { color: '#4ec9b0' },\n  '.tok-tagName': { color: '#569cd6' },\n  '.tok-attributeName': { color: '#9cdcfe' },\n  '.tok-attributeValue': { color: '#ce9178' },\n  '.tok-regexp': { color: '#d16969' },\n  '.tok-meta': { color: '#6a9955' },\n\n  // Backlinks panel\n  '.cm-backlinks-panel': {\n    backgroundColor: '#252526',\n    borderTop: '1px solid #3c3c3c',\n    color: '#aaa',\n  },\n  '.cm-backlinks-label': {\n    color: '#d4d4d4',\n  },\n  '.cm-backlinks-link': {\n    backgroundColor: '#264f78',\n    color: '#9cdcfe',\n    border: '1px solid #3a6ea5',\n  },\n\n  // Tag pills\n  '.md-tag': {\n    backgroundColor: '#1b3a1b',\n    color: '#81c784',\n    border: '1px solid #2e5a2e',\n  },\n  '.cm-tag-mark': {\n    color: '#81c784',\n  },\n\n  // Footnotes\n  '.footnote-ref .footnote-link': { color: '#228be6' },\n  '.footnote-def': { color: '#aaa' },\n  '.footnote-def sup': { color: '#228be6' },\n  '.md-wikilink, .cm-wikilink': { color: '#228be6' },\n});\n","import { EditorView } from '@codemirror/view';\n\n/**\n * Raw mode theme - overrides selected line styling\n * In raw mode, lines are not inverted, just use monospace everywhere\n */\nexport const rawModeTheme = EditorView.theme({\n  // Use monospace font everywhere in raw mode\n  '.cm-scroller, .cm-content, .cm-line': {\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace !important',\n  },\n\n  // No inversion on selected lines - just subtle highlight\n  '.cm-selectedLine, .cm-selectedLine.cm-code-block-line': {\n    backgroundColor: 'rgba(0, 0, 0, 0.05) !important',\n    color: 'inherit !important',\n    caretColor: '#333 !important',\n    filter: 'none !important',\n    borderRadius: '0',\n    fontSize: 'inherit !important',\n  },\n});\n\n/**\n * Raw mode dark variant\n */\nexport const rawModeDarkTheme = EditorView.theme({\n  // Use monospace font everywhere in raw mode\n  '.cm-scroller, .cm-content, .cm-line': {\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace !important',\n  },\n\n  // Dark mode: subtle highlight\n  '.cm-selectedLine, .cm-selectedLine.cm-code-block-line': {\n    backgroundColor: 'rgba(255, 255, 255, 0.1) !important',\n    color: 'inherit !important',\n    caretColor: '#fff !important',\n    filter: 'none !important',\n    borderRadius: '0',\n    fontSize: 'inherit !important',\n  },\n});\n","/**\n * Create a tag completion source for the hybrid markdown editor.\n * Triggers after typing `#` and provides tag suggestions from a user-supplied list.\n *\n * Returns a completion source function ‚Äî combine with other sources\n * in a single `autocompletion({ override: [...] })` call.\n *\n * @param {Object} options\n * @param {string[]} options.tags - Array of tag names (without #), e.g. ['javascript', 'project/active', 'todo']\n * @returns {CompletionSource} A completion source function\n *\n * @example\n * import { autocompletion } from '@codemirror/autocomplete';\n * import { tagAutocomplete } from 'codemirror-for-writers';\n *\n * const extensions = [\n *   autocompletion({ override: [tagAutocomplete({ tags: ['javascript', 'todo'] })] }),\n * ];\n */\nexport function tagAutocomplete({ tags = [] } = {}) {\n  return (context) => {\n    const match = context.matchBefore(/#[\\w/-]*$/);\n    if (!match) return null;\n\n    // Don't trigger inside code blocks or at line start (headings)\n    const line = context.state.doc.lineAt(match.from);\n    const lineText = line.text;\n\n    // Skip if this looks like a heading (line starts with #)\n    if (/^#{1,6}\\s/.test(lineText)) return null;\n\n    const query = match.text.slice(1).toLowerCase();\n\n    const options = tags\n      .filter((tag) => tag.toLowerCase().includes(query))\n      .sort((a, b) => {\n        const aLower = a.toLowerCase();\n        const bLower = b.toLowerCase();\n        // Prioritize prefix matches\n        const aStarts = aLower.startsWith(query) ? 0 : 1;\n        const bStarts = bLower.startsWith(query) ? 0 : 1;\n        if (aStarts !== bStarts) return aStarts - bStarts;\n        return aLower.localeCompare(bLower);\n      })\n      .map((tag) => ({\n        label: `#${tag}`,\n        apply: `#${tag}`,\n        type: 'keyword',\n      }));\n\n    return {\n      from: match.from,\n      to: match.to,\n      options,\n      validFor: /^#[\\w/-]*$/,\n    };\n  };\n}\n","/**\n * Create a searchable note index for wiki-link autocomplete.\n *\n * @param {Array<{title: string, aliases?: string[]}>} notes - Array of note objects\n * @returns {{search: (query: string) => Array, resolve: (title: string) => Object|null}} Note index\n *\n * @example\n * const noteIndex = createNoteIndex([\n *   { title: 'Project Plan', aliases: ['Plan'] },\n *   { title: 'Meeting Notes' },\n * ]);\n */\nexport function createNoteIndex(notes = []) {\n  const entries = notes.map((note) => ({\n    title: note.title,\n    aliases: Array.isArray(note.aliases) ? note.aliases : [],\n    normalizedTitle: note.title.toLowerCase(),\n    normalizedAliases: Array.isArray(note.aliases)\n      ? note.aliases.map((alias) => alias.toLowerCase())\n      : [],\n  }));\n\n  return {\n    search(query) {\n      const needle = query.trim().toLowerCase();\n      if (!needle) {\n        return entries;\n      }\n\n      const scored = entries\n        .map((entry) => {\n          const titleIndex = entry.normalizedTitle.indexOf(needle);\n          const aliasIndex = entry.normalizedAliases.length\n            ? Math.min(\n                ...entry.normalizedAliases\n                  .map((alias) => alias.indexOf(needle))\n                  .filter((index) => index !== -1)\n              )\n            : -1;\n          const bestIndex = Math.min(\n            titleIndex === -1 ? Number.POSITIVE_INFINITY : titleIndex,\n            aliasIndex === -1 ? Number.POSITIVE_INFINITY : aliasIndex\n          );\n          return { entry, score: bestIndex };\n        })\n        .filter((result) => Number.isFinite(result.score))\n        .sort((a, b) => a.score - b.score);\n\n      return scored.map((result) => result.entry);\n    },\n\n    resolve(title) {\n      const needle = title.trim().toLowerCase();\n      return (\n        entries.find((entry) => entry.normalizedTitle === needle) ||\n        entries.find((entry) => entry.normalizedAliases.includes(needle)) ||\n        null\n      );\n    },\n  };\n}\n\nfunction defaultFormatLink(note) {\n  return `${note.title}]]`;\n}\n\n/**\n * Resolve a wiki link against a note index.\n *\n * @param {Object} noteIndex - Index created by createNoteIndex\n * @param {{title: string}} link - Wiki link object\n * @returns {Object|null} Matched note entry or null\n */\nexport function resolveWikiLink(noteIndex, link) {\n  if (!noteIndex || !link || !link.title) return null;\n  return noteIndex.resolve(link.title);\n}\n\n/**\n * Create a wiki-link completion source for use with @codemirror/autocomplete.\n * Triggers after typing `[[` and provides note title suggestions.\n *\n * Returns a completion source function ‚Äî combine with other sources\n * in a single `autocompletion({ override: [...] })` call.\n *\n * @param {Object} options\n * @param {Object} options.noteIndex - Index created by createNoteIndex\n * @param {(note: Object) => string} [options.formatLink] - Custom link formatter\n * @returns {CompletionSource} A completion source function\n *\n * @example\n * import { autocompletion } from '@codemirror/autocomplete';\n * import { createNoteIndex, wikiLinkAutocomplete } from 'codemirror-for-writers';\n *\n * const noteIndex = createNoteIndex([{ title: 'My Note' }]);\n * const extensions = [\n *   autocompletion({ override: [wikiLinkAutocomplete({ noteIndex })] }),\n * ];\n */\nexport function wikiLinkAutocomplete({ noteIndex, formatLink } = {}) {\n  const format = typeof formatLink === 'function' ? formatLink : defaultFormatLink;\n\n  return (context) => {\n    if (!noteIndex) return null;\n    const match = context.matchBefore(/\\[\\[[^\\[\\]\\n]*$/);\n    if (!match) return null;\n\n    const query = match.text.slice(2);\n    const results = noteIndex.search(query);\n    const options = results.map((note) => ({\n      label: note.title,\n      detail: note.aliases.length ? `aliases: ${note.aliases.join(', ')}` : undefined,\n      apply: format(note),\n      type: 'text',\n    }));\n\n    return {\n      from: match.from + 2,\n      to: match.to,\n      options,\n      validFor: /^[^\\[\\]\\n]*$/,\n    };\n  };\n}\n","import { EditorView, ViewPlugin } from '@codemirror/view';\n\nconst moreMenuTheme = EditorView.baseTheme({\n  '.cm-more-menu-container': {\n    position: 'absolute',\n    top: '8px',\n    right: '8px',\n    zIndex: '6',\n  },\n  '.cm-more-menu-trigger': {\n    width: '32px',\n    height: '32px',\n    borderRadius: '6px',\n    border: 'none',\n    background: 'rgba(0, 0, 0, 0.05)',\n    cursor: 'pointer',\n    fontSize: '18px',\n    lineHeight: '1',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    color: '#555',\n    fontFamily: 'system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n  },\n  '.cm-more-menu-trigger:hover': {\n    background: 'rgba(0, 0, 0, 0.1)',\n  },\n  '.cm-more-menu-dropdown': {\n    position: 'absolute',\n    top: '100%',\n    right: '0',\n    marginTop: '4px',\n    minWidth: '180px',\n    background: '#fff',\n    borderRadius: '8px',\n    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(0, 0, 0, 0.06)',\n    padding: '4px 0',\n    fontFamily: 'system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    fontSize: '14px',\n    overflow: 'hidden',\n  },\n  '.cm-more-menu-item': {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '8px',\n    width: '100%',\n    padding: '8px 12px',\n    border: 'none',\n    background: 'transparent',\n    cursor: 'pointer',\n    textAlign: 'left',\n    color: '#333',\n    fontSize: 'inherit',\n    fontFamily: 'inherit',\n    lineHeight: '1.3',\n  },\n  '.cm-more-menu-item:hover': {\n    background: 'rgba(0, 0, 0, 0.05)',\n  },\n  '.cm-more-menu-check': {\n    width: '16px',\n    textAlign: 'center',\n    flexShrink: '0',\n    fontSize: '13px',\n    color: '#555',\n  },\n  // Dark mode\n  '&dark .cm-more-menu-trigger': {\n    background: 'rgba(255, 255, 255, 0.08)',\n    color: '#aaa',\n  },\n  '&dark .cm-more-menu-trigger:hover': {\n    background: 'rgba(255, 255, 255, 0.14)',\n  },\n  '&dark .cm-more-menu-dropdown': {\n    background: '#2d2d2d',\n    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.08)',\n  },\n  '&dark .cm-more-menu-item': {\n    color: '#d4d4d4',\n  },\n  '&dark .cm-more-menu-item:hover': {\n    background: 'rgba(255, 255, 255, 0.08)',\n  },\n  '&dark .cm-more-menu-check': {\n    color: '#aaa',\n  },\n});\n\n/**\n * Create a \"more\" menu extension that adds a ‚ãØ button in the top-right\n * corner of the editor with a dropdown of toggle items.\n *\n * @param {Object} [options]\n * @param {Array<{label: string, handler: (view: EditorView) => boolean, getState?: (view: EditorView) => boolean}>} [options.items]\n *   Menu items. `handler` is called on click and should return the new toggle\n *   state (true = on). `getState` reads the current state for the checkmark.\n * @returns {Extension[]}\n */\nexport function moreMenu(options = {}) {\n  const items = options.items || [];\n\n  const plugin = ViewPlugin.fromClass(class {\n    constructor(view) {\n      this.view = view;\n      this.open = false;\n\n      // Container ‚Äî inline styles ensure visibility above .cm-scroller in all modes\n      this.container = document.createElement('div');\n      this.container.className = 'cm-more-menu-container';\n      Object.assign(this.container.style, {\n        position: 'absolute',\n        top: '8px',\n        right: '8px',\n        zIndex: '6',\n      });\n\n      // Trigger button\n      this.trigger = document.createElement('button');\n      this.trigger.className = 'cm-more-menu-trigger';\n      this.trigger.textContent = '\\u22EF';\n      this.trigger.title = 'More options';\n      this.trigger.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        this.toggle();\n      });\n      this.container.appendChild(this.trigger);\n\n      // Dropdown\n      this.dropdown = document.createElement('div');\n      this.dropdown.className = 'cm-more-menu-dropdown';\n      this.dropdown.style.display = 'none';\n      this.container.appendChild(this.dropdown);\n\n      // Menu items\n      this.checkEls = [];\n      for (const item of items) {\n        const btn = document.createElement('button');\n        btn.className = 'cm-more-menu-item';\n\n        const check = document.createElement('span');\n        check.className = 'cm-more-menu-check';\n        check.textContent = item.getState ? (item.getState(view) ? '‚úì' : '') : '';\n        this.checkEls.push({ check, item });\n\n        const label = document.createElement('span');\n        label.textContent = item.label;\n\n        btn.appendChild(check);\n        btn.appendChild(label);\n\n        btn.addEventListener('click', (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          item.handler(view);\n          this.refreshChecks();\n        });\n\n        this.dropdown.appendChild(btn);\n      }\n\n      // Close handlers\n      this._onDocClick = (e) => {\n        if (this.open && !this.container.contains(e.target)) {\n          this.close();\n        }\n      };\n      this._onKeyDown = (e) => {\n        if (this.open && e.key === 'Escape') {\n          this.close();\n        }\n      };\n      document.addEventListener('click', this._onDocClick, true);\n      document.addEventListener('keydown', this._onKeyDown);\n\n      // Insert into editor\n      view.dom.appendChild(this.container);\n    }\n\n    toggle() {\n      this.open ? this.close() : this.show();\n    }\n\n    show() {\n      this.open = true;\n      this.refreshChecks();\n      this.dropdown.style.display = '';\n    }\n\n    close() {\n      this.open = false;\n      this.dropdown.style.display = 'none';\n    }\n\n    refreshChecks() {\n      for (const { check, item } of this.checkEls) {\n        check.textContent = item.getState ? (item.getState(this.view) ? '‚úì' : '') : '';\n      }\n    }\n\n    update(update) {\n      if (this.open) {\n        this.refreshChecks();\n      }\n    }\n\n    destroy() {\n      document.removeEventListener('click', this._onDocClick, true);\n      document.removeEventListener('keydown', this._onKeyDown);\n      this.container.remove();\n    }\n  });\n\n  return [plugin, moreMenuTheme];\n}\n","import { EditorView, rectangularSelection, crosshairCursor } from '@codemirror/view';\nimport { EditorState, Compartment, Facet, StateField, StateEffect } from '@codemirror/state';\nimport { markdown } from '@codemirror/lang-markdown';\nimport { keymap } from '@codemirror/view';\nimport { defaultKeymap, history, historyKeymap } from '@codemirror/commands';\nimport { search, searchKeymap } from '@codemirror/search';\n\n// Internal extensions\nimport { hybridPreview } from './extensions/hybrid-preview.js';\nimport { markdownKeymap } from './extensions/keymaps.js';\nimport { highlightSelectedLines } from './extensions/selected-line.js';\nimport { actions } from './extensions/actions.js';\nimport { allowReadOnlyEdit } from './extensions/read-only.js';\nimport { typewriterPlugin } from './extensions/typewriter.js';\nimport { focusModePlugin } from './extensions/focus-mode.js';\nimport { wordCountPanel } from './extensions/word-count.js';\nimport { bottomToolbar as bottomToolbarExtension } from './extensions/bottom-toolbar.js';\nimport { backlinksPanel, backlinksFacet } from './extensions/backlinks.js';\nimport { frontmatterSheetPlugin, frontmatterKeysFacet } from './extensions/frontmatter-sheet.js';\nimport { toggleSheetEffect, frontmatterSheetField } from './extensions/hybrid-preview.js';\n\n// Themes\nimport { baseTheme } from './theme/base.js';\nimport { lightTheme } from './theme/light.js';\nimport { darkTheme } from './theme/dark.js';\nimport { rawModeTheme, rawModeDarkTheme } from './theme/raw-mode.js';\n\n/**\n * Configuration options for the hybrid markdown extension\n */\nexport const HybridMarkdownConfig = Facet.define({\n  combine(configs) {\n    return {\n      enablePreview: configs.reduce((a, c) => c.enablePreview ?? a, true),\n      enableKeymap: configs.reduce((a, c) => c.enableKeymap ?? a, true),\n      enableCollapse: configs.reduce((a, c) => c.enableCollapse ?? a, true),\n      enableCustomTasks: configs.reduce((a, c) => c.enableCustomTasks ?? a, false),\n      customTaskTypes: configs.reduce((a, c) => c.customTaskTypes ?? a, undefined),\n      enableWikiLinks: configs.reduce((a, c) => c.enableWikiLinks ?? a, false),\n      enableTags: configs.reduce((a, c) => c.enableTags ?? a, false),\n      onTagClick: configs.reduce((a, c) => c.onTagClick ?? a, undefined),\n      renderWikiLinks: configs.reduce((a, c) => c.renderWikiLinks ?? a, true),\n      onWikiLinkClick: configs.reduce((a, c) => c.onWikiLinkClick ?? a, undefined),\n      readOnly: configs.reduce((a, c) => c.readOnly ?? a, false),\n      typewriter: configs.reduce((a, c) => c.typewriter ?? a, false),\n      focusMode: configs.reduce((a, c) => c.focusMode ?? a, false),\n      toolbar: configs.reduce((a, c) => c.toolbar ?? a, true),\n      wordCount: configs.reduce((a, c) => c.wordCount ?? a, false),\n      backlinks: configs.reduce((a, c) => c.backlinks ?? a, false),\n      docTitle: configs.reduce((a, c) => c.docTitle ?? a, undefined),\n      onBacklinksRequested: configs.reduce((a, c) => c.onBacklinksRequested ?? a, undefined),\n      onBacklinkClick: configs.reduce((a, c) => c.onBacklinkClick ?? a, undefined),\n      frontmatterKeys: configs.reduce((a, c) => c.frontmatterKeys ?? a, undefined),\n      theme: configs.reduce((a, c) => c.theme ?? a, 'light'),\n    };\n  },\n});\n\n// ============================================================================\n// STATE MANAGEMENT\n// ============================================================================\n//\n// Editor state (theme, mode) is stored in a StateField rather than global\n// variables. This ensures:\n// - Multiple editor instances work correctly on the same page\n// - State is properly isolated per editor\n// - State can be serialized/restored if needed\n//\n// To modify state, dispatch a StateEffect which the StateField responds to.\n// ============================================================================\n\n/**\n * StateEffect for changing theme\n * @type {StateEffectType<'light'|'dark'>}\n */\nconst setThemeEffect = StateEffect.define();\n\n/**\n * StateEffect for changing mode\n * @type {StateEffectType<'hybrid'|'raw'>}\n */\nconst setModeEffect = StateEffect.define();\n\n/**\n * StateEffect for changing read-only mode\n * @type {StateEffectType<boolean>}\n */\nconst setReadOnlyEffect = StateEffect.define();\n\n/**\n * StateEffect for changing typewriter mode\n * @type {StateEffectType<boolean>}\n */\nconst setTypewriterEffect = StateEffect.define();\n\n/**\n * StateEffect for changing focus mode\n * @type {StateEffectType<boolean>}\n */\nconst setFocusModeEffect = StateEffect.define();\n\n/**\n * StateEffect for changing bottom toolbar visibility\n * @type {StateEffectType<boolean>}\n */\nconst setToolbarEffect = StateEffect.define();\n\n/**\n * StateEffect for changing word count panel visibility\n * @type {StateEffectType<boolean>}\n */\nconst setWordCountEffect = StateEffect.define();\n\n/**\n * StateEffect for changing backlinks panel visibility\n * @type {StateEffectType<boolean>}\n */\nconst setBacklinksEffect = StateEffect.define();\n\n/**\n * StateField that stores the current theme and mode for this editor instance.\n * This replaces global variables, allowing multiple editors on the same page.\n */\nconst editorStateField = StateField.define({\n  create(state) {\n    // Read initial values from the configuration facet\n    const config = state.facet(HybridMarkdownConfig);\n    return {\n      theme: config.theme || 'light',\n      mode: config.enablePreview !== false ? 'hybrid' : 'raw',\n      readOnly: config.readOnly === true,\n      typewriter: config.typewriter === true,\n      focusMode: config.focusMode === true,\n      toolbar: config.toolbar !== false,\n      wordCount: config.wordCount === true,\n      backlinks: config.backlinks === true,\n    };\n  },\n  update(value, tr) {\n    // Apply any theme/mode effects\n    for (const effect of tr.effects) {\n      if (effect.is(setThemeEffect)) {\n        value = { ...value, theme: effect.value };\n      } else if (effect.is(setModeEffect)) {\n        value = { ...value, mode: effect.value };\n      } else if (effect.is(setReadOnlyEffect)) {\n        value = { ...value, readOnly: effect.value };\n      } else if (effect.is(setTypewriterEffect)) {\n        value = { ...value, typewriter: effect.value };\n      } else if (effect.is(setFocusModeEffect)) {\n        value = { ...value, focusMode: effect.value };\n      } else if (effect.is(setToolbarEffect)) {\n        value = { ...value, toolbar: effect.value };\n      } else if (effect.is(setWordCountEffect)) {\n        value = { ...value, wordCount: effect.value };\n      } else if (effect.is(setBacklinksEffect)) {\n        value = { ...value, backlinks: effect.value };\n      }\n    }\n    return value;\n  },\n});\n\n// Compartments for dynamic reconfiguration\nconst themeCompartment = new Compartment();\nconst previewCompartment = new Compartment();\nconst rawModeCompartment = new Compartment();\nconst selectedLineCompartment = new Compartment();\nconst readOnlyCompartment = new Compartment();\nconst typewriterCompartment = new Compartment();\nconst focusModeCompartment = new Compartment();\nconst toolbarCompartment = new Compartment();\nconst wordCountCompartment = new Compartment();\nconst backlinksCompartment = new Compartment();\n\nconst readOnlyTransactionFilter = EditorState.transactionFilter.of((tr) => {\n  if (!tr.startState.readOnly || !tr.docChanged) {\n    return tr;\n  }\n\n  if (tr.annotation(allowReadOnlyEdit)) {\n    return tr;\n  }\n\n  return { changes: [] };\n});\n\n/**\n * Get the theme extension for the given theme name\n */\nfunction getThemeExtension(theme) {\n  return theme === 'dark' ? darkTheme : lightTheme;\n}\n\n/**\n * Get the raw mode extension for the given theme\n */\nfunction getRawModeExtension(theme, enabled) {\n  if (!enabled) return [];\n  return theme === 'dark' ? rawModeDarkTheme : rawModeTheme;\n}\n\n/**\n * Create the hybrid markdown extension\n *\n * @param {Object} options - Configuration options\n * @param {boolean} [options.enablePreview=true] - Enable hybrid preview mode\n * @param {boolean} [options.enableKeymap=true] - Enable markdown keyboard shortcuts\n * @param {'light'|'dark'} [options.theme='light'] - Initial theme\n * @param {boolean} [options.enableCustomTasks=false] - Enable custom task types in preview\n * @param {string[]} [options.customTaskTypes] - Custom task type order (e.g. ['i','!','?','*','>','<'])\n * @param {boolean} [options.enableWikiLinks=false] - Enable wiki-link parsing/highlighting in hybrid preview\n * @param {boolean} [options.renderWikiLinks=true] - Render wiki links in preview when enabled\n * @param {(link: {raw: string, title: string, section: string, alias: string, display: string}) => void} [options.onWikiLinkClick] - Optional handler for preview wiki-link clicks\n * @param {boolean} [options.readOnly=false] - Enable read-only mode (allows task toggles)\n * @param {boolean} [options.toolbar=true] - Show bottom formatting toolbar\n * @returns {Extension[]} Array of CodeMirror extensions\n *\n * @example\n * import { EditorState } from '@codemirror/state';\n * import { EditorView } from '@codemirror/view';\n * import { hybridMarkdown } from 'codemirror-for-writers';\n *\n * const state = EditorState.create({\n *   doc: '# Hello World',\n *   extensions: [\n *     hybridMarkdown({ theme: 'dark' }),\n *   ],\n * });\n *\n * const view = new EditorView({ state, parent: document.body });\n */\nexport function hybridMarkdown(options = {}) {\n  const {\n    enablePreview = true,\n    enableKeymap = true,\n    enableCollapse = true,\n    theme = 'light',\n    enableCustomTasks = false,\n    customTaskTypes,\n    enableWikiLinks = false,\n    renderWikiLinks = true,\n    onWikiLinkClick,\n    enableTags = false,\n    onTagClick,\n    readOnly = false,\n    typewriter = false,\n    focusMode = false,\n    toolbar = true,\n    wordCount = false,\n    backlinks = false,\n    docTitle,\n    onBacklinksRequested,\n    onBacklinkClick,\n    frontmatterKeys,\n  } = options;\n\n  const extensions = [\n    // Store configuration in facet (for StateField to read initial values)\n    HybridMarkdownConfig.of(options),\n\n    // StateField for tracking theme/mode per editor instance\n    editorStateField,\n\n    // Read-only enforcement\n    readOnlyTransactionFilter,\n    readOnlyCompartment.of(EditorState.readOnly.of(readOnly)),\n\n    // Core functionality\n    history(),\n    keymap.of([...defaultKeymap, ...historyKeymap, ...searchKeymap]),\n\n    // Search panel + keybindings\n    search(),\n\n    // Multiple selections (rectangular selection + crosshair cursor)\n    rectangularSelection(),\n    crosshairCursor(),\n\n    // Markdown language support\n    markdown(),\n\n    // Base theme (required styles)\n    baseTheme,\n\n    // Theme (in compartment for dynamic switching)\n    themeCompartment.of(getThemeExtension(theme)),\n\n    // Raw mode theme (in compartment for toggling)\n    rawModeCompartment.of(getRawModeExtension(theme, !enablePreview)),\n\n    // Highlight selected lines (disabled in raw mode)\n    selectedLineCompartment.of(enablePreview ? highlightSelectedLines : []),\n\n    // Typewriter mode (cursor stays vertically centered)\n    typewriterCompartment.of(typewriter ? typewriterPlugin : []),\n\n    // Focus mode (dims non-active paragraphs)\n    focusModeCompartment.of(focusMode ? focusModePlugin : []),\n\n    // Bottom formatting toolbar\n    toolbarCompartment.of(toolbar ? bottomToolbarExtension() : []),\n\n    // Word count panel (bottom status bar)\n    wordCountCompartment.of(wordCount ? wordCountPanel : []),\n\n    // Backlinks panel (bottom panel showing incoming links)\n    backlinksFacet.of({\n      docTitle: docTitle || null,\n      onBacklinksRequested: typeof onBacklinksRequested === 'function' ? onBacklinksRequested : null,\n      onBacklinkClick: typeof onBacklinkClick === 'function' ? onBacklinkClick : null,\n    }),\n    backlinksCompartment.of(backlinks ? backlinksPanel : []),\n\n    // Frontmatter sheet overlay (always loaded, just hidden when closed)\n    frontmatterKeysFacet.of(Array.isArray(frontmatterKeys) ? frontmatterKeys : []),\n    frontmatterSheetPlugin,\n\n    // Line wrapping\n    EditorView.lineWrapping,\n  ];\n\n  // Optional: Hybrid preview\n  if (enablePreview) {\n    extensions.push(previewCompartment.of(hybridPreview({\n      enableCollapse,\n      enableCustomTasks,\n      customTaskTypes,\n      enableWikiLinks,\n      renderWikiLinks,\n      onWikiLinkClick,\n      enableTags,\n      onTagClick,\n    })));\n  } else {\n    extensions.push(previewCompartment.of([]));\n  }\n\n  // Optional: Markdown keyboard shortcuts\n  if (enableKeymap) {\n    extensions.push(markdownKeymap);\n  }\n\n  return extensions;\n}\n\n/**\n * Toggle between light and dark themes\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now in dark mode, false if light\n */\nexport function toggleTheme(view) {\n  const currentState = view.state.field(editorStateField);\n  const newTheme = currentState.theme === 'light' ? 'dark' : 'light';\n\n  view.dispatch({\n    effects: [\n      setThemeEffect.of(newTheme),\n      themeCompartment.reconfigure(getThemeExtension(newTheme)),\n      rawModeCompartment.reconfigure(getRawModeExtension(newTheme, currentState.mode === 'raw')),\n    ],\n  });\n\n  return newTheme === 'dark';\n}\n\n/**\n * Toggle between hybrid preview mode and raw markdown mode\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if in hybrid mode, false if raw\n */\nexport function toggleHybridMode(view) {\n  const currentState = view.state.field(editorStateField);\n  const newMode = currentState.mode === 'hybrid' ? 'raw' : 'hybrid';\n  const isHybrid = newMode === 'hybrid';\n  const config = view.state.facet(HybridMarkdownConfig);\n\n  view.dispatch({\n    effects: [\n      setModeEffect.of(newMode),\n      previewCompartment.reconfigure(isHybrid ? hybridPreview({\n        enableCollapse: config.enableCollapse,\n        enableCustomTasks: config.enableCustomTasks,\n        customTaskTypes: config.customTaskTypes,\n      }) : []),\n      rawModeCompartment.reconfigure(getRawModeExtension(currentState.theme, !isHybrid)),\n      selectedLineCompartment.reconfigure(isHybrid ? highlightSelectedLines : []),\n    ],\n  });\n\n  return isHybrid;\n}\n\n/**\n * Toggle read-only mode\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now read-only, false if editable\n */\nexport function toggleReadOnly(view) {\n  const currentState = view.state.field(editorStateField);\n  const newReadOnly = !currentState.readOnly;\n\n  view.dispatch({\n    effects: [\n      setReadOnlyEffect.of(newReadOnly),\n      readOnlyCompartment.reconfigure(EditorState.readOnly.of(newReadOnly)),\n    ],\n  });\n\n  return newReadOnly;\n}\n\n/**\n * Set read-only mode explicitly\n * @param {EditorView} view - The editor view\n * @param {boolean} readOnly - Whether the editor should be read-only\n */\nexport function setReadOnly(view, readOnly) {\n  view.dispatch({\n    effects: [\n      setReadOnlyEffect.of(readOnly),\n      readOnlyCompartment.reconfigure(EditorState.readOnly.of(readOnly)),\n    ],\n  });\n}\n\n/**\n * Toggle typewriter mode\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now enabled\n */\nexport function toggleTypewriter(view) {\n  const currentState = view.state.field(editorStateField);\n  const enabled = !currentState.typewriter;\n\n  view.dispatch({\n    effects: [\n      setTypewriterEffect.of(enabled),\n      typewriterCompartment.reconfigure(enabled ? typewriterPlugin : []),\n    ],\n  });\n\n  return enabled;\n}\n\n/**\n * Set typewriter mode explicitly\n * @param {EditorView} view - The editor view\n * @param {boolean} enabled - Whether typewriter mode should be enabled\n */\nexport function setTypewriter(view, enabled) {\n  view.dispatch({\n    effects: [\n      setTypewriterEffect.of(enabled),\n      typewriterCompartment.reconfigure(enabled ? typewriterPlugin : []),\n    ],\n  });\n}\n\n/**\n * Get current typewriter mode state\n * @param {EditorView} view - The editor view\n * @returns {boolean}\n */\nexport function isTypewriter(view) {\n  return view.state.field(editorStateField).typewriter;\n}\n\n/**\n * Toggle focus mode\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now enabled\n */\nexport function toggleFocusMode(view) {\n  const currentState = view.state.field(editorStateField);\n  const enabled = !currentState.focusMode;\n\n  view.dispatch({\n    effects: [\n      setFocusModeEffect.of(enabled),\n      focusModeCompartment.reconfigure(enabled ? focusModePlugin : []),\n    ],\n  });\n\n  return enabled;\n}\n\n/**\n * Set focus mode explicitly\n * @param {EditorView} view - The editor view\n * @param {boolean} enabled - Whether focus mode should be enabled\n */\nexport function setFocusMode(view, enabled) {\n  view.dispatch({\n    effects: [\n      setFocusModeEffect.of(enabled),\n      focusModeCompartment.reconfigure(enabled ? focusModePlugin : []),\n    ],\n  });\n}\n\n/**\n * Get current focus mode state\n * @param {EditorView} view - The editor view\n * @returns {boolean}\n */\nexport function isFocusMode(view) {\n  return view.state.field(editorStateField).focusMode;\n}\n\n/**\n * Toggle bottom formatting toolbar\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now enabled\n */\nexport function toggleToolbar(view) {\n  const currentState = view.state.field(editorStateField);\n  const enabled = !currentState.toolbar;\n\n  view.dispatch({\n    effects: [\n      setToolbarEffect.of(enabled),\n      toolbarCompartment.reconfigure(enabled ? bottomToolbarExtension() : []),\n    ],\n  });\n\n  return enabled;\n}\n\n/**\n * Set bottom formatting toolbar visibility explicitly\n * @param {EditorView} view - The editor view\n * @param {boolean} enabled - Whether the toolbar should be shown\n */\nexport function setToolbar(view, enabled) {\n  view.dispatch({\n    effects: [\n      setToolbarEffect.of(enabled),\n      toolbarCompartment.reconfigure(enabled ? bottomToolbarExtension() : []),\n    ],\n  });\n}\n\n/**\n * Get current bottom toolbar visibility state\n * @param {EditorView} view - The editor view\n * @returns {boolean}\n */\nexport function isToolbar(view) {\n  return view.state.field(editorStateField).toolbar;\n}\n\n/**\n * Toggle word count panel\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now enabled\n */\nexport function toggleWordCount(view) {\n  const currentState = view.state.field(editorStateField);\n  const enabled = !currentState.wordCount;\n\n  view.dispatch({\n    effects: [\n      setWordCountEffect.of(enabled),\n      wordCountCompartment.reconfigure(enabled ? wordCountPanel : []),\n    ],\n  });\n\n  return enabled;\n}\n\n/**\n * Set word count panel explicitly\n * @param {EditorView} view - The editor view\n * @param {boolean} enabled - Whether the word count panel should be shown\n */\nexport function setWordCount(view, enabled) {\n  view.dispatch({\n    effects: [\n      setWordCountEffect.of(enabled),\n      wordCountCompartment.reconfigure(enabled ? wordCountPanel : []),\n    ],\n  });\n}\n\n/**\n * Get current word count panel state\n * @param {EditorView} view - The editor view\n * @returns {boolean}\n */\nexport function isWordCount(view) {\n  return view.state.field(editorStateField).wordCount;\n}\n\n/**\n * Toggle backlinks panel\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now enabled\n */\nexport function toggleBacklinks(view) {\n  const currentState = view.state.field(editorStateField);\n  const enabled = !currentState.backlinks;\n\n  view.dispatch({\n    effects: [\n      setBacklinksEffect.of(enabled),\n      backlinksCompartment.reconfigure(enabled ? backlinksPanel : []),\n    ],\n  });\n\n  return enabled;\n}\n\n/**\n * Set backlinks panel explicitly\n * @param {EditorView} view - The editor view\n * @param {boolean} enabled - Whether the backlinks panel should be shown\n */\nexport function setBacklinks(view, enabled) {\n  view.dispatch({\n    effects: [\n      setBacklinksEffect.of(enabled),\n      backlinksCompartment.reconfigure(enabled ? backlinksPanel : []),\n    ],\n  });\n}\n\n/**\n * Get current backlinks panel state\n * @param {EditorView} view - The editor view\n * @returns {boolean}\n */\nexport function isBacklinks(view) {\n  return view.state.field(editorStateField).backlinks;\n}\n\n/**\n * Toggle the frontmatter properties sheet overlay\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now open, false if closed\n */\nexport function toggleFrontmatterSheet(view) {\n  const isOpen = view.state.field(frontmatterSheetField);\n  view.dispatch({ effects: toggleSheetEffect.of(!isOpen) });\n  return !isOpen;\n}\n\n/**\n * Set the frontmatter sheet state explicitly\n * @param {EditorView} view - The editor view\n * @param {boolean} open - Whether the sheet should be open\n */\nexport function setFrontmatterSheet(view, open) {\n  view.dispatch({ effects: toggleSheetEffect.of(open) });\n}\n\n/**\n * Get current frontmatter sheet state\n * @param {EditorView} view - The editor view\n * @returns {boolean}\n */\nexport function isFrontmatterSheet(view) {\n  return view.state.field(frontmatterSheetField);\n}\n\n/**\n * Set the theme explicitly\n * @param {EditorView} view - The editor view\n * @param {'light'|'dark'} theme - The theme to set\n */\nexport function setTheme(view, theme) {\n  const currentState = view.state.field(editorStateField);\n\n  view.dispatch({\n    effects: [\n      setThemeEffect.of(theme),\n      themeCompartment.reconfigure(getThemeExtension(theme)),\n      rawModeCompartment.reconfigure(getRawModeExtension(theme, currentState.mode === 'raw')),\n    ],\n  });\n}\n\n/**\n * Set the mode explicitly\n * @param {EditorView} view - The editor view\n * @param {'hybrid'|'raw'} mode - The mode to set\n */\nexport function setMode(view, mode) {\n  const currentState = view.state.field(editorStateField);\n  const isHybrid = mode === 'hybrid';\n  const config = view.state.facet(HybridMarkdownConfig);\n\n  view.dispatch({\n    effects: [\n      setModeEffect.of(mode),\n      previewCompartment.reconfigure(isHybrid ? hybridPreview({\n        enableCollapse: config.enableCollapse,\n        enableCustomTasks: config.enableCustomTasks,\n        customTaskTypes: config.customTaskTypes,\n      }) : []),\n      rawModeCompartment.reconfigure(getRawModeExtension(currentState.theme, !isHybrid)),\n      selectedLineCompartment.reconfigure(isHybrid ? highlightSelectedLines : []),\n    ],\n  });\n}\n\n/**\n * Get current read-only state for an editor instance\n * @param {EditorView} view - The editor view\n * @returns {boolean}\n */\nexport function isReadOnly(view) {\n  return view.state.field(editorStateField).readOnly;\n}\n\n/**\n * Get current theme for an editor instance\n * @param {EditorView} view - The editor view\n * @returns {'light'|'dark'}\n */\nexport function getTheme(view) {\n  return view.state.field(editorStateField).theme;\n}\n\n/**\n * Get current mode for an editor instance\n * @param {EditorView} view - The editor view\n * @returns {'hybrid'|'raw'}\n */\nexport function getMode(view) {\n  return view.state.field(editorStateField).mode;\n}\n\n// Re-export actions for toolbar/external use\nexport { actions };\n\n// Re-export individual themes for advanced use cases\nexport { lightTheme, darkTheme, baseTheme };\n\n// Re-export extensions for advanced composition\nexport { hybridPreview } from './extensions/hybrid-preview.js';\nexport { markdownKeymap } from './extensions/keymaps.js';\nexport { highlightSelectedLines } from './extensions/selected-line.js';\nexport { typewriterPlugin } from './extensions/typewriter.js';\nexport { focusModePlugin } from './extensions/focus-mode.js';\nexport { wordCountPanel } from './extensions/word-count.js';\nexport { tagAutocomplete } from './extensions/tag-autocomplete.js';\nexport { createNoteIndex, resolveWikiLink, wikiLinkAutocomplete } from './extensions/wiki-link-autocomplete.js';\nexport { backlinksPanel } from './extensions/backlinks.js';\nexport { bottomToolbar } from './extensions/bottom-toolbar.js';\nexport { moreMenu } from './extensions/more-menu.js';\n"],"names":["allowReadOnlyEdit","Annotation","CUSTOM_TASK_TYPES","CUSTOM_TASK_META","WIKI_LINK_OPEN","WIKI_LINK_CLOSE","isTrimmed","value","parseWikiLinkContent","content","pipeIndex","target","alias","hashIndex","title","section","display","findClosingBackticks","text","start","tickCount","ticks","findWikiLinks","matches","i","end","meta","FIND_TAGS_REGEX","findTags","codeRanges","tickMatch","tickRegex","closePos","isInCode","pos","r","m","hashPos","md","MarkdownIt","markdownItEmoji","addWikiLinkRule","markdown","state","silent","token","tokens","idx","escape","attrs","label","TAG_REGEX","addTagRule","prev","match","tagName","addInlineMathRule","katex","addHighlightRule","addSubscriptRule","addSuperscriptRule","addFootnoteReferenceRule","id","renderBlockMath","renderFootnoteDef","options","rendered","renderInline","env","renderFootnoteBlock","lines","firstMatch","firstContent","parts","firstRendered","line","renderDefinitionList","term","definitions","current","defMatch","continuation","termHtml","defHtml","defLines","renderMarkdownLine","enableCustomTasks","customTaskTypes","customTaskSet","enableWikiLinks","renderOptions","footnoteDefMatch","headerMatch","level","headingId","idMatch","idAttr","listMatch","marker","taskMatch","checked","emoji","customTaskMatch","trimmed","cell","renderTable","rows","parseRow","row","isSeparator","headerRow","bodyRows","separatorFound","cells","html","languageMap","javascript","python","css","json","escapeHtml","highlightCode","code","language","langFn","tree","result","highlightTree","classHighlighter","from","to","classes","enableCollapseFacet","Facet","values","DEFAULT_CUSTOM_TASK_TYPES","TASK_TOKEN_REGEX","normalizeCustomTaskTypes","types","normalized","seen","raw","getTaskCycle","buildCustomTasksConfig","normalizedTypes","customTasksFacet","buildWikiLinksConfig","renderWikiLinks","onWikiLinkClick","enabled","wikiLinksFacet","buildTagsConfig","enableTags","onTagClick","tagsFacet","getListTaskToken","config","getNextTaskToken","currentToken","cycle","index","replaceTaskToken","nextToken","getWikiLinkData","element","toggleCollapseEffect","StateEffect","collapsedHeadingsField","StateField","collapsed","tr","newCollapsed","effect","adjustedSet","lineNum","oldDoc","oldLine","newPos","newLineNum","newLineText","mermaid","MarkdownPreviewWidget","WidgetType","lineFrom","lineTo","view","wrapper","customTasksConfig","wikiLinksConfig","tagsConfig","e","tagEl","footnoteLink","footnoteId","doc","footnoteBackref","wikiLink","link","taskConfig","newContent","rect","clickX","totalWidth","textLength","charPos","ratio","cursorPos","other","event","HeadingPreviewWidget","lineNumber","isCollapsed","hasContent","toggle","headingContent","getFocusedLines","focused","range","startLine","endLine","computeFrontmatterRange","computeCodeBlockRanges","ranges","inCodeBlock","blockStart","blockLanguage","computeMathBlockRanges","codeBlockLineSet","mathStart","computeTableRanges","tableStart","isIndentedContinuation","computeFootnoteDefinitionRanges","j","nextLine","computeDefinitionListRanges","footnoteLineSet","isDefinitionLine","isTermCandidate","nextLineNum","buildLineSet","lineSet","computeHeadingRanges","codeBlockLines","headings","buildHeadingMap","map","heading","blockRangesField","computeBlockRanges","frontmatter","frontmatterLines","codeBlocks","mathBlocks","mathBlockLines","tables","tableLines","footnoteBlocks","footnoteBlockLines","definitionLists","definitionListLines","mermaidBlocks","mermaidBlockLines","headingMap","MathBlockWidget","mathFrom","mathTo","MermaidBlockWidget","mermaidFrom","mermaidTo","svg","TableWidget","tableFrom","tableTo","FootnoteBlockWidget","DefinitionListWidget","isLineCollapsed","getHeadingInfo","buildDecorations","blockRanges","focusedLines","decorations","collapseEnabled","Decoration","parseImageLine","headingInfo","buildWikiLinkDecorations","hybridPreviewPlugin","ViewPlugin","update","hasCollapseEffect","v","wikiLinkDecorations","buildTagDecorations","tagDecorations","HighlightedCodeWidget","buildCodeBlockDecorations","hasFocus","blockFocused","isFence","lineClass","isFocused","codeBlockDecorations","buildTableDecorations","tableFocused","firstLine","tableDecorations","buildFootnoteBlockDecorations","footnoteBlockDecorations","buildDefinitionListDecorations","definitionListDecorations","buildMathBlockDecorations","mathFocused","mathLines","mathContent","mathBlockDecorations","buildMermaidBlockDecorations","mermaidFocused","mermaidLines","mermaidContent","mermaidBlockDecorations","IMAGE_LINE_REGEX","ImagePreviewWidget","alt","url","img","error","altText","buildImageDecorations","imageData","imageDecorations","toggleSheetEffect","frontmatterSheetField","open","serializeYaml","obj","yaml","createValueEditor","key","parsedYaml","fmContentFrom","fmContentTo","container","checkbox","updated","newYaml","tag","newArr","newVal","addTag","input","parsed","newValue","buildFrontmatterPropertyTable","yamlContent","contentFrom","contentTo","blockFrom","knownKeys","table","datalistId","datalist","currentKeys","k","opt","keys","keyCell","keyInput","newKey","valueCell","deleteCell","deleteBtn","addRow","counter","buildFrontmatterDecorations","frontmatterDecorations","hybridPreview","enableCollapse","focusReplaceField","panel","replaceField","wrapSelection","before","after","prefixLine","prefix","toggleHeading","headingMatch","targetPrefix","currentPrefix","toggleList","type","bulletMatch","numberedMatch","currentMatch","currentType","getSelection","actions","undo","redo","openSearchPanel","cmSelectNextOccurrence","cmSelectSelectionMatches","selection","exampleUrl","newText","markdownKeymap","keymap","selectedLineDecoration","highlightSelectedLines","selectedLines","typewriterPlugin","head","coords","viewportCenter","diff","unfocusedLine","findParagraphRange","focusModePlugin","RangeSet","activeLines","para","computeStats","words","w","chars","charsNoSpaces","readingTime","selWords","selChars","hasSelection","selText","formatReadingTime","minutes","createStat","stat","valueEl","labelEl","createDivider","div","wordCountPanelFactory","dom","render","stats","selStat","selValue","selLabel","wordCountPanel","showPanel","defaultButtons","toolbarBaseTheme","EditorView","bottomToolbar","buttons","extraButtons","buttonsByAction","btn","el","touchStartX","dx","atLeft","atRight","updateHistoryButtons","undoBtn","undoDepth","redoBtn","redoDepth","backlinksFacet","extractFrontmatterTitle","renderBacklinks","backlinks","onBacklinkClick","empty","list","backlink","chip","backlinksPanelFactory","lastTitle","currentRequest","resolveTitle","fetchBacklinks","loadingLabel","loading","requestId","backlinksPanel","frontmatterKeysFacet","frontmatterSheetPlugin","wasOpen","header","closeBtn","sheet","backdrop","addBtn","yamlLines","_a","_b","style","baseTheme","lightTheme","darkTheme","rawModeTheme","rawModeDarkTheme","tagAutocomplete","tags","context","lineText","query","a","b","aLower","bLower","aStarts","bStarts","createNoteIndex","notes","entries","note","needle","entry","titleIndex","aliasIndex","bestIndex","defaultFormatLink","resolveWikiLink","noteIndex","wikiLinkAutocomplete","formatLink","format","moreMenuTheme","moreMenu","items","item","check","HybridMarkdownConfig","configs","c","setThemeEffect","setModeEffect","setReadOnlyEffect","setTypewriterEffect","setFocusModeEffect","setToolbarEffect","setWordCountEffect","setBacklinksEffect","editorStateField","themeCompartment","Compartment","previewCompartment","rawModeCompartment","selectedLineCompartment","readOnlyCompartment","typewriterCompartment","focusModeCompartment","toolbarCompartment","wordCountCompartment","backlinksCompartment","readOnlyTransactionFilter","EditorState","getThemeExtension","theme","getRawModeExtension","hybridMarkdown","enablePreview","enableKeymap","readOnly","typewriter","focusMode","toolbar","wordCount","docTitle","onBacklinksRequested","frontmatterKeys","extensions","history","defaultKeymap","historyKeymap","searchKeymap","search","rectangularSelection","crosshairCursor","bottomToolbarExtension","toggleTheme","currentState","newTheme","toggleHybridMode","newMode","isHybrid","toggleReadOnly","newReadOnly","setReadOnly","toggleTypewriter","setTypewriter","isTypewriter","toggleFocusMode","setFocusMode","isFocusMode","toggleToolbar","setToolbar","isToolbar","toggleWordCount","setWordCount","isWordCount","toggleBacklinks","setBacklinks","isBacklinks","toggleFrontmatterSheet","isOpen","setFrontmatterSheet","isFrontmatterSheet","setTheme","setMode","mode","isReadOnly","getTheme","getMode"],"mappings":"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"}