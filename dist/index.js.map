{"version":3,"file":"index.js","sources":["../lib/extensions/read-only.js","../lib/utils/markdown.js","../lib/utils/syntax-highlight.js","../lib/extensions/hybrid-preview.js","../lib/extensions/actions.js","../lib/extensions/writing-mode-state.js","../lib/extensions/keymaps.js","../lib/extensions/selected-line.js","../lib/extensions/typewriter.js","../lib/extensions/focus-mode.js","../lib/extensions/word-count.js","../lib/extensions/bottom-toolbar.js","../lib/extensions/backlinks.js","../lib/extensions/frontmatter-sheet.js","../lib/extensions/writing-mode-sheet.js","../lib/theme/base.js","../lib/theme/light.js","../lib/theme/dark.js","../lib/theme/raw-mode.js","../lib/extensions/tag-autocomplete.js","../lib/extensions/wiki-link-autocomplete.js","../lib/extensions/more-menu.js","../lib/index.js"],"sourcesContent":["import { Annotation } from '@codemirror/state';\n\nexport const allowReadOnlyEdit = Annotation.define();\n","import MarkdownIt from 'markdown-it';\nimport { full as markdownItEmoji } from 'markdown-it-emoji';\nimport katex from 'katex';\n\nexport const CUSTOM_TASK_TYPES = ['i', '!', '?', '*', '>', '<'];\n\nconst CUSTOM_TASK_META = {\n  i: { emoji: 'üß†', label: 'Idea', className: 'idea' },\n  '!': { emoji: '‚ö†Ô∏è', label: 'Urgent', className: 'urgent' },\n  '?': { emoji: '‚ùì', label: 'Question', className: 'question' },\n  '*': { emoji: '‚≠ê', label: 'Important', className: 'important' },\n  '>': { emoji: '‚û°Ô∏è', label: 'Forwarded', className: 'forwarded' },\n  '<': { emoji: 'üìÖ', label: 'Scheduled', className: 'scheduled' },\n};\n\nconst WIKI_LINK_OPEN = '[[';\nconst WIKI_LINK_CLOSE = ']]';\n\nfunction isTrimmed(value) {\n  return value === value.trim();\n}\n\nfunction parseWikiLinkContent(content) {\n  if (!content || !isTrimmed(content)) return null;\n  if (content.includes('\\n')) return null;\n  if (content.includes('[') || content.includes(']')) return null;\n\n  const pipeIndex = content.indexOf('|');\n  const target = pipeIndex === -1 ? content : content.slice(0, pipeIndex);\n  const alias = pipeIndex === -1 ? null : content.slice(pipeIndex + 1);\n\n  if (!target || (alias !== null && (!alias || !isTrimmed(alias)))) return null;\n\n  const hashIndex = target.indexOf('#');\n  const title = hashIndex === -1 ? target : target.slice(0, hashIndex);\n  const section = hashIndex === -1 ? null : target.slice(hashIndex + 1);\n\n  if (!title || !isTrimmed(title)) return null;\n  if (section !== null && (!section || !isTrimmed(section))) return null;\n\n  const display = alias ?? (section ?? title);\n\n  return {\n    raw: `${WIKI_LINK_OPEN}${content}${WIKI_LINK_CLOSE}`,\n    title,\n    section,\n    alias,\n    display,\n  };\n}\n\nfunction findClosingBackticks(text, start, tickCount) {\n  const ticks = '`'.repeat(tickCount);\n  return text.indexOf(ticks, start + tickCount);\n}\n\nexport function findWikiLinks(text) {\n  const matches = [];\n  let i = 0;\n\n  while (i < text.length) {\n    if (text[i] === '`') {\n      let tickCount = 1;\n      while (text[i + tickCount] === '`') {\n        tickCount += 1;\n      }\n      const end = findClosingBackticks(text, i, tickCount);\n      if (end === -1) {\n        i += tickCount;\n        continue;\n      }\n      i = end + tickCount;\n      continue;\n    }\n\n    if (text.startsWith(WIKI_LINK_OPEN, i)) {\n      const end = text.indexOf(WIKI_LINK_CLOSE, i + 2);\n      if (end === -1) {\n        i += 2;\n        continue;\n      }\n\n      const content = text.slice(i + 2, end);\n      const meta = parseWikiLinkContent(content);\n      if (meta) {\n        matches.push({ from: i, to: end + 2, meta });\n        i = end + 2;\n        continue;\n      }\n\n      i += 2;\n      continue;\n    }\n\n    i += 1;\n  }\n\n  return matches;\n}\n\nconst FIND_TAGS_REGEX = /(?:^|(?<=\\s))#([a-zA-Z][\\w/-]*)/g;\n\n/**\n * Find all tags in a line of text, returning their positions\n * Skips tags inside backtick code spans\n */\nexport function findTags(text) {\n  const matches = [];\n  // First, find code span ranges to exclude\n  const codeRanges = [];\n  let tickMatch;\n  const tickRegex = /`+/g;\n  while ((tickMatch = tickRegex.exec(text)) !== null) {\n    const tickCount = tickMatch[0].length;\n    const closePos = findClosingBackticks(text, tickMatch.index, tickCount);\n    if (closePos !== -1) {\n      codeRanges.push({ from: tickMatch.index, to: closePos + tickCount });\n      tickRegex.lastIndex = closePos + tickCount;\n    }\n  }\n\n  const isInCode = (pos) => codeRanges.some(r => pos >= r.from && pos < r.to);\n\n  FIND_TAGS_REGEX.lastIndex = 0;\n  let m;\n  while ((m = FIND_TAGS_REGEX.exec(text)) !== null) {\n    const hashPos = m.index + (m[0].startsWith('#') ? 0 : m[0].indexOf('#'));\n    if (!isInCode(hashPos)) {\n      matches.push({ from: hashPos, to: hashPos + 1 + m[1].length, tag: m[1] });\n    }\n  }\n\n  return matches;\n}\n\nconst md = new MarkdownIt({\n  html: false,\n  linkify: true,\n  breaks: false,\n  typographer: false,\n});\n\nmd.use(markdownItEmoji);\n\nfunction addWikiLinkRule(markdown) {\n  markdown.inline.ruler.before('link', 'wikilink', (state, silent) => {\n    if (!state.env || state.env.enableWikiLinks !== true) return false;\n\n    const start = state.pos;\n    if (state.src.charCodeAt(start) !== 0x5b || state.src.charCodeAt(start + 1) !== 0x5b) {\n      return false;\n    }\n\n    const end = state.src.indexOf(WIKI_LINK_CLOSE, start + 2);\n    if (end === -1) return false;\n\n    const content = state.src.slice(start + 2, end);\n    const meta = parseWikiLinkContent(content);\n    if (!meta) return false;\n\n    if (!silent) {\n      const token = state.push('wikilink', '', 0);\n      token.meta = meta;\n    }\n\n    state.pos = end + 2;\n    return true;\n  });\n\n  markdown.renderer.rules.wikilink = (tokens, idx) => {\n    const meta = tokens[idx].meta || {};\n    const escape = markdown.utils.escapeHtml;\n    const attrs = [\n      'class=\"md-wikilink\"',\n      `data-wikilink=\"${escape(meta.raw || '')}\"`,\n      `data-wikilink-title=\"${escape(meta.title || '')}\"`,\n    ];\n\n    if (meta.section) {\n      attrs.push(`data-wikilink-section=\"${escape(meta.section)}\"`);\n    }\n    if (meta.alias) {\n      attrs.push(`data-wikilink-alias=\"${escape(meta.alias)}\"`);\n    }\n\n    const label = escape(meta.display || meta.title || '');\n    return `<span ${attrs.join(' ')}>${label}</span>`;\n  };\n}\n\n// Tag regex: #tag or #tag/subtag, must have at least one letter\nconst TAG_REGEX = /^#([a-zA-Z][\\w/-]*)/;\n\nfunction addTagRule(markdown) {\n  markdown.inline.ruler.before('link', 'tag', (state, silent) => {\n    if (!state.env || state.env.enableTags !== true) return false;\n\n    const start = state.pos;\n    if (state.src.charCodeAt(start) !== 0x23) return false; // #\n\n    // Must be at start of string or preceded by whitespace\n    if (start > 0) {\n      const prev = state.src.charCodeAt(start - 1);\n      // Space, tab, newline, or start of line\n      if (prev !== 0x20 && prev !== 0x09 && prev !== 0x0a && prev !== 0x0d) return false;\n    }\n\n    const remaining = state.src.slice(start);\n    const match = remaining.match(TAG_REGEX);\n    if (!match) return false;\n\n    const tagName = match[1];\n\n    if (!silent) {\n      const token = state.push('tag', '', 0);\n      token.meta = { tag: tagName };\n    }\n\n    state.pos = start + 1 + tagName.length;\n    return true;\n  });\n\n  markdown.renderer.rules.tag = (tokens, idx) => {\n    const meta = tokens[idx].meta || {};\n    const escape = markdown.utils.escapeHtml;\n    const tagName = escape(meta.tag || '');\n    return `<span class=\"md-tag\" data-tag=\"${tagName}\">#${tagName}</span>`;\n  };\n}\n\nfunction addInlineMathRule(markdown) {\n  markdown.inline.ruler.before('escape', 'katex_inline', (state, silent) => {\n    const start = state.pos;\n    if (state.src.charCodeAt(start) !== 0x24) return false; // $\n    if (state.src.charCodeAt(start + 1) === 0x24) return false; // $$\n\n    let end = start + 1;\n    while ((end = state.src.indexOf('$', end)) !== -1) {\n      if (state.src.charCodeAt(end - 1) !== 0x5c) break; // ignore escaped $\n      end += 1;\n    }\n\n    if (end === -1) return false;\n\n    const content = state.src.slice(start + 1, end);\n    if (!content || content.includes('\\n')) return false;\n\n    if (!silent) {\n      const token = state.push('math_inline', '', 0);\n      token.content = content;\n    }\n\n    state.pos = end + 1;\n    return true;\n  });\n\n  markdown.renderer.rules.math_inline = (tokens, idx) => {\n    try {\n      return katex.renderToString(tokens[idx].content, { displayMode: false, throwOnError: false });\n    } catch (e) {\n      return tokens[idx].content;\n    }\n  };\n}\n\nfunction addHighlightRule(markdown) {\n  markdown.inline.ruler.before('emphasis', 'highlight', (state, silent) => {\n    const start = state.pos;\n    if (state.src.charCodeAt(start) !== 0x3d || state.src.charCodeAt(start + 1) !== 0x3d) {\n      return false; // ==\n    }\n\n    let end = start + 2;\n    while ((end = state.src.indexOf('==', end)) !== -1) {\n      if (end > start + 2) break;\n      end += 2;\n    }\n\n    if (end === -1) return false;\n\n    const content = state.src.slice(start + 2, end);\n    if (!content || content.includes('\\n')) return false;\n\n    if (!silent) {\n      const token = state.push('mark_open', 'mark', 1);\n      token.attrSet('class', 'md-highlight');\n      markdown.inline.parse(content, markdown, state.env, state.tokens);\n      state.push('mark_close', 'mark', -1);\n    }\n\n    state.pos = end + 2;\n    return true;\n  });\n}\n\nfunction addSubscriptRule(markdown) {\n  markdown.inline.ruler.before('emphasis', 'subscript', (state, silent) => {\n    const start = state.pos;\n    if (state.src.charCodeAt(start) !== 0x7e) return false; // ~\n    if (state.src.charCodeAt(start + 1) === 0x7e) return false; // ~~\n\n    let end = start + 1;\n    while ((end = state.src.indexOf('~', end)) !== -1) {\n      if (state.src.charCodeAt(end - 1) === 0x5c) {\n        end += 1;\n        continue;\n      }\n      if (state.src.charCodeAt(end + 1) === 0x7e) {\n        end += 1;\n        continue;\n      }\n      break;\n    }\n\n    if (end === -1) return false;\n\n    const content = state.src.slice(start + 1, end);\n    if (!content || content.includes('\\n')) return false;\n\n    if (!silent) {\n      const token = state.push('sub_open', 'sub', 1);\n      token.attrSet('class', 'md-subscript');\n      markdown.inline.parse(content, markdown, state.env, state.tokens);\n      state.push('sub_close', 'sub', -1);\n    }\n\n    state.pos = end + 1;\n    return true;\n  });\n}\n\nfunction addSuperscriptRule(markdown) {\n  markdown.inline.ruler.before('emphasis', 'superscript', (state, silent) => {\n    const start = state.pos;\n    if (state.src.charCodeAt(start) !== 0x5e) return false; // ^\n    if (state.src.charCodeAt(start + 1) === 0x5e) return false; // ^^ (ignore)\n\n    let end = start + 1;\n    while ((end = state.src.indexOf('^', end)) !== -1) {\n      if (state.src.charCodeAt(end - 1) === 0x5c) {\n        end += 1;\n        continue;\n      }\n      break;\n    }\n\n    if (end === -1) return false;\n\n    const content = state.src.slice(start + 1, end);\n    if (!content || content.includes('\\n')) return false;\n\n    if (!silent) {\n      const token = state.push('sup_open', 'sup', 1);\n      token.attrSet('class', 'md-superscript');\n      markdown.inline.parse(content, markdown, state.env, state.tokens);\n      state.push('sup_close', 'sup', -1);\n    }\n\n    state.pos = end + 1;\n    return true;\n  });\n}\n\nfunction addFootnoteReferenceRule(markdown) {\n  markdown.inline.ruler.before('link', 'footnote_ref', (state, silent) => {\n    const start = state.pos;\n    if (state.src.charCodeAt(start) !== 0x5b) return false; // [\n    if (state.src.charCodeAt(start + 1) !== 0x5e) return false; // ^\n\n    const end = state.src.indexOf(']', start + 2);\n    if (end === -1) return false;\n\n    const id = state.src.slice(start + 2, end);\n    if (!id) return false;\n\n    if (!silent) {\n      const token = state.push('footnote_ref', '', 0);\n      token.meta = { id };\n    }\n\n    state.pos = end + 1;\n    return true;\n  });\n\n  markdown.renderer.rules.footnote_ref = (tokens, idx) => {\n    const id = tokens[idx].meta.id;\n    return `<sup class=\"footnote-ref\"><span class=\"footnote-link\" data-footnote=\"${id}\">[${id}]</span></sup>`;\n  };\n}\n\naddInlineMathRule(md);\naddHighlightRule(md);\naddSubscriptRule(md);\naddSuperscriptRule(md);\naddFootnoteReferenceRule(md);\naddWikiLinkRule(md);\naddTagRule(md);\n\n/**\n * Render block math $$...$$\n */\nexport function renderBlockMath(content) {\n  try {\n    return katex.renderToString(content, { displayMode: true, throwOnError: false });\n  } catch (e) {\n    return `<span class=\"math-error\">${content}</span>`;\n  }\n}\n\n/**\n * Render a footnote reference [^id]\n */\nexport function renderFootnoteRef(id) {\n  return `<sup class=\"footnote-ref\"><span class=\"footnote-link\" data-footnote=\"${id}\">[${id}]</span></sup>`;\n}\n\n/**\n * Render a footnote definition [^id]: content\n */\nexport function renderFootnoteDef(id, content, options = {}) {\n  const rendered = renderInline(content, options);\n  return `<span class=\"footnote-def\">[${id}]: ${rendered} <span class=\"md-footnote-backref-link\" data-footnote-ref=\"${id}\" title=\"Back to reference\">‚Ü©</span></span>`;\n}\n\n/**\n * Render inline content with extensions\n */\nfunction renderInline(text, options = {}) {\n  const env = {\n    enableWikiLinks: options.enableWikiLinks === true,\n    enableTags: options.enableTags === true,\n  };\n  return md.renderInline(text, env);\n}\n\n/**\n * Render a multi-line footnote definition block\n */\nexport function renderFootnoteBlock(id, lines, options = {}) {\n  if (!lines.length) return '';\n  const firstMatch = lines[0].match(/^\\[\\^([^\\]]+)\\]:\\s*(.*)$/);\n  const firstContent = firstMatch ? firstMatch[2] : lines[0];\n  const parts = [];\n\n  const firstRendered = renderInline(firstContent, options);\n  parts.push(`<div class=\"md-footnote-line md-footnote-first\">[${id}]: ${firstRendered}</div>`);\n\n  for (let i = 1; i < lines.length; i++) {\n    const line = lines[i].replace(/^\\s{2,}|\\t/, '');\n    const rendered = line.trim() ? renderInline(line, options) : '';\n    parts.push(`<div class=\"md-footnote-line md-footnote-continuation\">${rendered}</div>`);\n  }\n\n  parts.push(`<div class=\"md-footnote-backref\"><span class=\"md-footnote-backref-link\" data-footnote-ref=\"${id}\" title=\"Back to reference\">‚Ü©</span></div>`);\n\n  return `<div class=\"md-footnote-block\" data-footnote=\"${id}\">${parts.join('')}</div>`;\n}\n\n/**\n * Render a definition list block (single term with one or more definitions)\n */\nexport function renderDefinitionList(lines, options = {}) {\n  if (lines.length === 0) return '';\n  const term = lines[0].trim();\n  const definitions = [];\n  let current = null;\n\n  for (let i = 1; i < lines.length; i++) {\n    const line = lines[i];\n    const defMatch = line.match(/^\\s*:\\s*(.*)$/);\n    if (defMatch) {\n      if (current) {\n        definitions.push(current);\n      }\n      current = [defMatch[1]];\n      continue;\n    }\n\n    if (current) {\n      const continuation = line.replace(/^\\s{2,}|\\t/, '');\n      current.push(continuation);\n    }\n  }\n\n  if (current) {\n    definitions.push(current);\n  }\n\n  const termHtml = renderInline(term, options);\n  const defHtml = definitions.map((defLines) => {\n    const rendered = defLines.map((line) => renderInline(line, options)).join('<br>');\n    return `<dd>${rendered}</dd>`;\n  }).join('');\n\n  return `<dl class=\"md-definition-list\"><dt>${termHtml}</dt>${defHtml}</dl>`;\n}\n\n/**\n * Render a single line of markdown to HTML\n * Handles both block elements (headers) and inline elements\n */\nexport function renderMarkdownLine(content, options = {}) {\n  if (!content.trim()) {\n    return content;\n  }\n\n  const enableCustomTasks = options.enableCustomTasks === true;\n  const customTaskTypes = Array.isArray(options.customTaskTypes)\n    ? options.customTaskTypes\n    : CUSTOM_TASK_TYPES;\n  const customTaskSet = options.customTaskTypeSet ?? new Set(customTaskTypes);\n  const enableWikiLinks = options.enableWikiLinks === true;\n  const renderOptions = { ...options, enableWikiLinks };\n\n  // Check if it's a footnote definition [^id]: content\n  const footnoteDefMatch = content.match(/^\\[\\^([^\\]]+)\\]:\\s*(.*)$/);\n  if (footnoteDefMatch) {\n    return renderFootnoteDef(footnoteDefMatch[1], footnoteDefMatch[2], renderOptions);\n  }\n\n  // Check if it's a header line\n  const headerMatch = content.match(/^(#{1,6})\\s+(.*)$/);\n  if (headerMatch) {\n    const level = headerMatch[1].length;\n    let text = headerMatch[2];\n    let headingId = null;\n    const idMatch = text.match(/^(.*)\\s+(?:\\[#([A-Za-z0-9_-]+)\\]|\\{#([A-Za-z0-9_-]+)\\})\\s*$/);\n    if (idMatch) {\n      text = idMatch[1];\n      headingId = idMatch[2] || idMatch[3];\n    }\n    const idAttr = headingId ? ` id=\"${headingId}\" data-heading-id=\"${headingId}\"` : '';\n    return `<span class=\"md-header md-h${level}\"${idAttr}>${renderInline(text, renderOptions)}</span>`;\n  }\n\n  // Check if it's a blockquote\n  if (content.startsWith('>')) {\n    const text = content.replace(/^>\\s*/, '');\n    return `<span class=\"md-blockquote\">${renderInline(text, renderOptions)}</span>`;\n  }\n\n  // Check if it's a list item\n  const listMatch = content.match(/^(\\s*)([-*+]|\\d+\\.)\\s+(.*)$/);\n  if (listMatch) {\n    const marker = listMatch[2];\n    const text = listMatch[3];\n    // Check for task list\n    const taskMatch = text.match(/^\\[([ xX])\\]\\s*(.*)$/);\n    if (taskMatch) {\n      const checked = taskMatch[1].toLowerCase() === 'x';\n      const emoji = checked ? '‚úÖ' : '‚¨úÔ∏è';\n      const label = checked ? 'Completed' : 'Incomplete';\n      const stateClass = checked ? 'complete' : 'incomplete';\n      const token = checked ? 'x' : ' ';\n      return `<span class=\"md-list-item md-task-item\"><span class=\"md-list-marker\">${marker}</span> <span class=\"md-task-icon md-task-${stateClass}\" data-task=\"${token}\" role=\"button\" aria-label=\"${label}\" title=\"${label}\">${emoji}</span> ${renderInline(taskMatch[2], renderOptions)}</span>`;\n    }\n\n    if (enableCustomTasks) {\n      const customTaskMatch = text.match(/^\\[([!?>i*<])\\]\\s*(.*)$/);\n      if (customTaskMatch) {\n        const token = customTaskMatch[1];\n        const meta = CUSTOM_TASK_META[token];\n        if (meta && customTaskSet.has(token)) {\n          return `<span class=\"md-list-item md-task-item\"><span class=\"md-list-marker\">${marker}</span> <span class=\"md-task-icon md-task-${meta.className}\" data-task=\"${token}\" role=\"button\" aria-label=\"${meta.label}\" title=\"${meta.label}\">${meta.emoji}</span> ${renderInline(customTaskMatch[2], renderOptions)}</span>`;\n        }\n      }\n    }\n    return `<span class=\"md-list-item\"><span class=\"md-list-marker\">${marker}</span> ${renderInline(text, renderOptions)}</span>`;\n  }\n\n  // Check if it's a horizontal rule\n  if (/^(-{3,}|_{3,}|\\*{3,})$/.test(content.trim())) {\n    return '<hr class=\"md-hr\">';\n  }\n\n  // Check if it's a table row\n  if (content.trim().startsWith('|') && content.trim().endsWith('|')) {\n    const trimmed = content.trim();\n    // Check if it's a separator row (|---|---|) - only contains |, -, :, and spaces\n    if (/^\\|[-:\\s|]+\\|$/.test(trimmed) && trimmed.includes('-')) {\n      return `<span class=\"md-table-separator\"></span>`;\n    }\n    // Parse cells\n    const cells = trimmed.slice(1, -1).split('|').map(cell => cell.trim());\n    const renderedCells = cells.map(cell => {\n      return `<span class=\"md-table-cell\">${renderInline(cell, renderOptions)}</span>`;\n    }).join('');\n    return `<span class=\"md-table-row\">${renderedCells}</span>`;\n  }\n\n  // Default: render as inline markdown with extensions\n  return renderInline(content, renderOptions);\n}\n\n/**\n * Render a full markdown document\n */\nexport function renderDocument(content, options = {}) {\n  const env = {\n    enableWikiLinks: options.enableWikiLinks === true,\n  };\n  return md.render(content, env);\n}\n\n/**\n * Render a table from an array of row strings\n */\nexport function renderTable(rows, options = {}) {\n  if (rows.length === 0) return '';\n\n  const parseRow = (row) => {\n    const trimmed = row.trim();\n    if (!trimmed.startsWith('|') || !trimmed.endsWith('|')) return null;\n    return trimmed.slice(1, -1).split('|').map(cell => cell.trim());\n  };\n\n  const isSeparator = (row) => {\n    const trimmed = row.trim();\n    return /^\\|[-:\\s|]+\\|$/.test(trimmed) && trimmed.includes('-');\n  };\n\n  // Find header and body rows\n  let headerRow = null;\n  let bodyRows = [];\n  let separatorFound = false;\n\n  for (const row of rows) {\n    if (isSeparator(row)) {\n      separatorFound = true;\n      continue;\n    }\n\n    const cells = parseRow(row);\n    if (!cells) continue;\n\n    if (!separatorFound && !headerRow) {\n      headerRow = cells;\n    } else {\n      bodyRows.push(cells);\n    }\n  }\n\n  // Build HTML table\n  let html = '<table class=\"md-table\">';\n\n  if (headerRow) {\n    html += '<thead><tr>';\n    for (const cell of headerRow) {\n      html += `<th>${renderInline(cell, options)}</th>`;\n    }\n    html += '</tr></thead>';\n  }\n\n  if (bodyRows.length > 0) {\n    html += '<tbody>';\n    for (const row of bodyRows) {\n      html += '<tr>';\n      for (const cell of row) {\n        html += `<td>${renderInline(cell, options)}</td>`;\n      }\n      html += '</tr>';\n    }\n    html += '</tbody>';\n  }\n\n  html += '</table>';\n  return html;\n}\n","import { highlightTree, classHighlighter } from '@lezer/highlight';\nimport { javascript } from '@codemirror/lang-javascript';\nimport { python } from '@codemirror/lang-python';\nimport { css } from '@codemirror/lang-css';\nimport { html } from '@codemirror/lang-html';\nimport { json } from '@codemirror/lang-json';\n\nconst languageMap = {\n  javascript: javascript,\n  js: javascript,\n  typescript: () => javascript({ typescript: true }),\n  ts: () => javascript({ typescript: true }),\n  jsx: () => javascript({ jsx: true }),\n  tsx: () => javascript({ jsx: true, typescript: true }),\n  python: python,\n  py: python,\n  css: css,\n  html: html,\n  json: json,\n};\n\nfunction escapeHtml(text) {\n  return text\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;');\n}\n\nexport function highlightCode(code, language) {\n  const langFn = languageMap[language?.toLowerCase()];\n\n  if (!langFn) {\n    return escapeHtml(code);\n  }\n\n  const lang = typeof langFn === 'function' ? langFn() : langFn();\n  const tree = lang.language.parser.parse(code);\n\n  let result = '';\n  let pos = 0;\n\n  highlightTree(tree, classHighlighter, (from, to, classes) => {\n    if (from > pos) {\n      result += escapeHtml(code.slice(pos, from));\n    }\n    result += `<span class=\"${classes}\">${escapeHtml(code.slice(from, to))}</span>`;\n    pos = to;\n  });\n\n  if (pos < code.length) {\n    result += escapeHtml(code.slice(pos));\n  }\n\n  return result;\n}\n\nexport function getSupportedLanguages() {\n  return Object.keys(languageMap);\n}\n","/**\n * Hybrid Preview Extension for CodeMirror 6\n *\n * This extension provides \"hybrid\" markdown editing where:\n * - Lines WITHOUT cursor/selection show rendered preview (headings, bold, etc.)\n * - Lines WITH cursor/selection show raw markdown for editing\n *\n * ============================================================================\n * FOCUS/DECORATION INTERACTION\n * ============================================================================\n *\n * The key concept is \"focused lines\" - lines that contain any part of the\n * cursor or selection. These lines show raw markdown; all others show preview.\n *\n * Focus determination:\n * 1. Get all selection ranges from state.selection.ranges\n * 2. For each range, find start/end line numbers\n * 3. All lines in between are \"focused\" (added to Set)\n *\n * Decoration rules:\n * - Focused lines: No decoration (show raw markdown)\n * - Unfocused lines: Replace with MarkdownPreviewWidget (rendered HTML)\n * - Code blocks: Entire block focused if ANY line has cursor\n * - Tables: Entire table focused if ANY line has cursor\n * - Math blocks: Entire block focused if ANY line has cursor\n * - Mermaid diagrams: Entire block focused if ANY line has cursor\n *\n * When editor loses focus (hasFocus=false):\n * - ALL lines render as preview (no editing happening)\n *\n * Click handling:\n * - Clicking on preview calculates approximate character position\n * - Dispatches selection change to position cursor\n * - This triggers rebuild, showing raw markdown for that line\n *\n * ============================================================================\n */\n\nimport { EditorView, Decoration, WidgetType, ViewPlugin } from '@codemirror/view';\nimport { StateField, StateEffect, Facet } from '@codemirror/state';\nimport yaml from 'js-yaml';\nimport { allowReadOnlyEdit } from './read-only.js';\nimport {\n  renderMarkdownLine,\n  renderTable,\n  renderBlockMath,\n  renderFootnoteBlock,\n  renderDefinitionList,\n  CUSTOM_TASK_TYPES,\n  findWikiLinks,\n  findTags,\n} from '../utils/markdown.js';\n\n/**\n * Facet to configure whether collapse functionality is enabled\n */\nconst enableCollapseFacet = Facet.define({\n  combine(values) {\n    return values.length > 0 ? values[values.length - 1] : true;\n  },\n});\n\nconst DEFAULT_CUSTOM_TASK_TYPES = CUSTOM_TASK_TYPES;\nconst TASK_TOKEN_REGEX = /^(\\s*(?:[-*+]|\\d+\\.)\\s+)\\[([ xX!?>i*<])\\]/;\n\nfunction normalizeCustomTaskTypes(types) {\n  if (!Array.isArray(types)) {\n    return [...DEFAULT_CUSTOM_TASK_TYPES];\n  }\n\n  const normalized = [];\n  const seen = new Set();\n  for (const raw of types) {\n    if (typeof raw !== 'string' || raw.length === 0) continue;\n    const token = raw.toLowerCase();\n    if (!DEFAULT_CUSTOM_TASK_TYPES.includes(token)) continue;\n    if (seen.has(token)) continue;\n    seen.add(token);\n    normalized.push(token);\n  }\n\n  return normalized;\n}\n\nfunction getTaskCycle(customTaskTypes) {\n  return [' ', 'x', ...customTaskTypes];\n}\n\nfunction buildCustomTasksConfig(enableCustomTasks, customTaskTypes) {\n  const normalizedTypes = normalizeCustomTaskTypes(customTaskTypes);\n  return {\n    enableCustomTasks: enableCustomTasks === true,\n    customTaskTypes: normalizedTypes,\n    customTaskTypeSet: new Set(normalizedTypes),\n    taskCycle: getTaskCycle(normalizedTypes),\n  };\n}\n\nconst customTasksFacet = Facet.define({\n  combine(values) {\n    if (values.length === 0) {\n      return buildCustomTasksConfig(false, DEFAULT_CUSTOM_TASK_TYPES);\n    }\n    return values[values.length - 1];\n  },\n});\n\nfunction buildWikiLinksConfig(enableWikiLinks, renderWikiLinks, onWikiLinkClick) {\n  const enabled = enableWikiLinks === true;\n  const render = enabled && renderWikiLinks !== false;\n  const handler = typeof onWikiLinkClick === 'function' ? onWikiLinkClick : null;\n  return {\n    enableWikiLinks: enabled,\n    renderWikiLinks: render,\n    onWikiLinkClick: handler,\n  };\n}\n\nconst wikiLinksFacet = Facet.define({\n  combine(values) {\n    if (values.length === 0) {\n      return buildWikiLinksConfig(false, false, null);\n    }\n    return values[values.length - 1];\n  },\n});\n\nfunction buildTagsConfig(enableTags, onTagClick) {\n  const enabled = enableTags === true;\n  const handler = typeof onTagClick === 'function' ? onTagClick : null;\n  return { enableTags: enabled, onTagClick: handler };\n}\n\nconst tagsFacet = Facet.define({\n  combine(values) {\n    if (values.length === 0) {\n      return buildTagsConfig(false, null);\n    }\n    return values[values.length - 1];\n  },\n});\n\nfunction getListTaskToken(content, config) {\n  const match = content.match(TASK_TOKEN_REGEX);\n  if (!match) return null;\n\n  const token = match[2].toLowerCase();\n  if (token === ' ' || token === 'x') {\n    return token;\n  }\n\n  if (!config.enableCustomTasks) return null;\n\n  return config.customTaskTypeSet.has(token) ? token : null;\n}\n\nfunction getNextTaskToken(currentToken, cycle) {\n  if (!Array.isArray(cycle) || cycle.length === 0) return currentToken;\n  const index = cycle.indexOf(currentToken);\n  if (index === -1) return cycle[0];\n  return cycle[(index + 1) % cycle.length];\n}\n\nfunction replaceTaskToken(content, nextToken) {\n  return content.replace(TASK_TOKEN_REGEX, `$1[${nextToken}]`);\n}\n\nfunction getWikiLinkData(element) {\n  return {\n    raw: element.getAttribute('data-wikilink') || '',\n    title: element.getAttribute('data-wikilink-title') || '',\n    section: element.getAttribute('data-wikilink-section') || '',\n    alias: element.getAttribute('data-wikilink-alias') || '',\n    display: element.textContent || '',\n  };\n}\n\n// ============================================================================\n// HEADING COLLAPSE STATE\n// ============================================================================\n\n/**\n * StateEffect to toggle collapse state of a heading\n */\nexport const toggleCollapseEffect = StateEffect.define();\n\n/**\n * StateField that tracks which headings are collapsed.\n * Stores a Set of line numbers (1-based) that are collapsed.\n */\nexport const collapsedHeadingsField = StateField.define({\n  create() {\n    return new Set();\n  },\n  update(collapsed, tr) {\n    let newCollapsed = collapsed;\n\n    // Handle toggle effects\n    for (const effect of tr.effects) {\n      if (effect.is(toggleCollapseEffect)) {\n        newCollapsed = new Set(collapsed);\n        if (newCollapsed.has(effect.value)) {\n          newCollapsed.delete(effect.value);\n        } else {\n          newCollapsed.add(effect.value);\n        }\n      }\n    }\n\n    // Handle document changes - need to adjust line numbers\n    if (tr.docChanged && newCollapsed.size > 0) {\n      const adjustedSet = new Set();\n      for (const lineNum of newCollapsed) {\n        // Try to find the new line number after the change\n        // Map the old position to new position\n        const oldDoc = tr.startState.doc;\n        if (lineNum <= oldDoc.lines) {\n          const oldLine = oldDoc.line(lineNum);\n          const newPos = tr.changes.mapPos(oldLine.from);\n          const newLineNum = tr.newDoc.lineAt(newPos).number;\n          // Verify it's still a heading\n          const newLineText = tr.newDoc.line(newLineNum).text;\n          if (/^#{1,6}\\s/.test(newLineText)) {\n            adjustedSet.add(newLineNum);\n          }\n        }\n      }\n      newCollapsed = adjustedSet;\n    }\n\n    return newCollapsed;\n  },\n});\nimport { highlightCode } from '../utils/syntax-highlight.js';\nimport mermaid from 'mermaid';\n\n// Initialize mermaid\nmermaid.initialize({\n  startOnLoad: false,\n  theme: 'base',\n  securityLevel: 'loose',\n  themeVariables: {\n    primaryColor: '#f5f5f5',\n    secondaryColor: '#f5f5f5',\n    tertiaryColor: '#f5f5f5',\n    primaryBorderColor: '#ddd',\n    secondaryBorderColor: '#ddd',\n    tertiaryBorderColor: '#ddd',\n    lineColor: '#aaa',\n    edgeLabelBackground: '#fff',\n  },\n});\n\n/**\n * Widget that renders a markdown line as HTML\n * Handles click events to position cursor correctly\n */\nclass MarkdownPreviewWidget extends WidgetType {\n  constructor(content, lineFrom, lineTo) {\n    super();\n    this.content = content;\n    this.lineFrom = lineFrom;\n    this.lineTo = lineTo;\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('span');\n    wrapper.className = 'cm-markdown-preview';\n    const customTasksConfig = view.state.facet(customTasksFacet);\n    const wikiLinksConfig = view.state.facet(wikiLinksFacet);\n    const tagsConfig = view.state.facet(tagsFacet);\n    wrapper.innerHTML = renderMarkdownLine(this.content, {\n      ...customTasksConfig,\n      enableWikiLinks: wikiLinksConfig.renderWikiLinks,\n      enableTags: tagsConfig.enableTags,\n    });\n\n    // Store references for click handler\n    const lineFrom = this.lineFrom;\n    const lineTo = this.lineTo;\n    const content = this.content;\n\n    // Handle click to position cursor\n    wrapper.addEventListener('mousedown', (e) => {\n      // Check if clicked on a tag\n      const tagEl = e.target.closest('[data-tag]');\n      if (tagEl && tagsConfig.onTagClick) {\n        e.preventDefault();\n        e.stopPropagation();\n        tagsConfig.onTagClick(tagEl.getAttribute('data-tag'));\n        return;\n      }\n\n      // Check if clicked on a footnote link\n      const footnoteLink = e.target.closest('[data-footnote]');\n      if (footnoteLink) {\n        e.preventDefault();\n        e.stopPropagation();\n        const footnoteId = footnoteLink.getAttribute('data-footnote');\n        // Find the footnote definition line [^id]:\n        const doc = view.state.doc;\n        for (let i = 1; i <= doc.lines; i++) {\n          const line = doc.line(i);\n          if (line.text.match(new RegExp(`^\\\\[\\\\^${footnoteId}\\\\]:`))) {\n            view.dispatch({\n              selection: { anchor: line.from },\n              scrollIntoView: true,\n            });\n            view.focus();\n            return;\n          }\n        }\n        return;\n      }\n\n      // Check if clicked on a footnote back reference\n      const footnoteBackref = e.target.closest('[data-footnote-ref]');\n      if (footnoteBackref) {\n        e.preventDefault();\n        e.stopPropagation();\n        const footnoteId = footnoteBackref.getAttribute('data-footnote-ref');\n        const doc = view.state.doc;\n        for (let i = 1; i <= doc.lines; i++) {\n          const line = doc.line(i);\n          if (line.text.match(new RegExp(`\\\\[\\\\^${footnoteId}\\\\](?!:)`))) {\n            view.dispatch({\n              selection: { anchor: line.from },\n              scrollIntoView: true,\n            });\n            view.focus();\n            return;\n          }\n        }\n        return;\n      }\n\n      // Check if clicked on a wiki link (only if handler provided)\n      const wikiLink = e.target.closest('[data-wikilink]');\n      if (wikiLink && wikiLinksConfig.onWikiLinkClick) {\n        e.preventDefault();\n        e.stopPropagation();\n        wikiLinksConfig.onWikiLinkClick(getWikiLinkData(wikiLink));\n        return;\n      }\n\n      // Check if clicked on a link\n      const link = e.target.closest('a');\n      if (link && link.href) {\n        e.preventDefault();\n        e.stopPropagation();\n        window.open(link.href, '_blank', 'noopener,noreferrer');\n        return;\n      }\n\n      // Check if clicked on a task toggle (checkbox or custom task icon)\n      const taskToggle = e.target.closest('input[type=\"checkbox\"], .md-task-icon');\n      if (taskToggle) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const taskConfig = view.state.facet(customTasksFacet);\n        const currentToken = getListTaskToken(content, taskConfig);\n        if (!currentToken) {\n          return;\n        }\n\n        const nextToken = taskConfig.enableCustomTasks\n          ? getNextTaskToken(currentToken, taskConfig.taskCycle)\n          : (currentToken === 'x' ? ' ' : 'x');\n\n        const newContent = replaceTaskToken(content, nextToken);\n        if (newContent !== content) {\n          view.dispatch({\n            changes: { from: lineFrom, to: lineTo, insert: newContent },\n            annotations: allowReadOnlyEdit.of(true),\n          });\n        }\n        return;\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      // Get click position relative to the wrapper\n      const rect = wrapper.getBoundingClientRect();\n      const clickX = e.clientX - rect.left;\n      const totalWidth = rect.width;\n\n      // Estimate character position based on click location\n      const textLength = content.length;\n      let charPos;\n\n      if (totalWidth > 0 && textLength > 0) {\n        // Calculate position proportionally\n        const ratio = clickX / totalWidth;\n        charPos = Math.round(ratio * textLength);\n        charPos = Math.max(0, Math.min(charPos, textLength));\n      } else {\n        charPos = 0;\n      }\n\n      const cursorPos = lineFrom + charPos;\n\n      // Dispatch selection change\n      view.dispatch({\n        selection: { anchor: cursorPos },\n        scrollIntoView: true,\n      });\n\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    return other.content === this.content &&\n           other.lineFrom === this.lineFrom &&\n           other.lineTo === this.lineTo;\n  }\n\n  ignoreEvent(event) {\n    // We handle mousedown ourselves\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Widget that renders a heading with a collapse toggle button\n */\nclass HeadingPreviewWidget extends WidgetType {\n  constructor(content, lineFrom, lineTo, lineNumber, level, isCollapsed, hasContent) {\n    super();\n    this.content = content;\n    this.lineFrom = lineFrom;\n    this.lineTo = lineTo;\n    this.lineNumber = lineNumber;\n    this.level = level;\n    this.isCollapsed = isCollapsed;\n    this.hasContent = hasContent; // Whether this heading has content under it\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('span');\n    wrapper.className = 'cm-markdown-preview cm-heading-preview';\n\n    // Create collapse toggle button (only if heading has content)\n    if (this.hasContent) {\n      const toggle = document.createElement('span');\n      toggle.className = `cm-collapse-toggle ${this.isCollapsed ? 'collapsed' : 'expanded'}`;\n      toggle.textContent = '‚Ä∫';\n      toggle.title = this.isCollapsed ? 'Expand' : 'Collapse';\n\n      const lineNumber = this.lineNumber;\n\n      // Use click instead of mousedown to avoid focus issues\n      toggle.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        e.stopImmediatePropagation();\n\n        // Dispatch the toggle effect without changing selection\n        view.dispatch({\n          effects: toggleCollapseEffect.of(lineNumber),\n        });\n      });\n\n      // Also prevent mousedown from affecting focus\n      toggle.addEventListener('mousedown', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        e.stopImmediatePropagation();\n      });\n\n      wrapper.appendChild(toggle);\n    }\n\n    // Render the heading content\n    const headingContent = document.createElement('span');\n    const customTasksConfig = view.state.facet(customTasksFacet);\n    const wikiLinksConfig = view.state.facet(wikiLinksFacet);\n    const tagsConfig = view.state.facet(tagsFacet);\n    headingContent.innerHTML = renderMarkdownLine(this.content, {\n      ...customTasksConfig,\n      enableWikiLinks: wikiLinksConfig.renderWikiLinks,\n      enableTags: tagsConfig.enableTags,\n    });\n    wrapper.appendChild(headingContent);\n\n    // Store references for click handler\n    const lineFrom = this.lineFrom;\n    const lineTo = this.lineTo;\n    const content = this.content;\n\n    // Handle click to position cursor (on the heading text, not toggle)\n    headingContent.addEventListener('mousedown', (e) => {\n      // Check if clicked on a tag\n      const tagEl = e.target.closest('[data-tag]');\n      if (tagEl && tagsConfig.onTagClick) {\n        e.preventDefault();\n        e.stopPropagation();\n        tagsConfig.onTagClick(tagEl.getAttribute('data-tag'));\n        return;\n      }\n\n      // Check if clicked on a wiki link (only if handler provided)\n      const wikiLink = e.target.closest('[data-wikilink]');\n      if (wikiLink && wikiLinksConfig.onWikiLinkClick) {\n        e.preventDefault();\n        e.stopPropagation();\n        wikiLinksConfig.onWikiLinkClick(getWikiLinkData(wikiLink));\n        return;\n      }\n\n      // Check if clicked on a link\n      const link = e.target.closest('a');\n      if (link && link.href) {\n        e.preventDefault();\n        e.stopPropagation();\n        window.open(link.href, '_blank', 'noopener,noreferrer');\n        return;\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      // Get click position relative to the wrapper\n      const rect = headingContent.getBoundingClientRect();\n      const clickX = e.clientX - rect.left;\n      const totalWidth = rect.width;\n\n      // Estimate character position based on click location\n      const textLength = content.length;\n      let charPos;\n\n      if (totalWidth > 0 && textLength > 0) {\n        const ratio = clickX / totalWidth;\n        charPos = Math.round(ratio * textLength);\n        charPos = Math.max(0, Math.min(charPos, textLength));\n      } else {\n        charPos = 0;\n      }\n\n      const cursorPos = lineFrom + charPos;\n\n      view.dispatch({\n        selection: { anchor: cursorPos },\n        scrollIntoView: true,\n      });\n\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    return other.content === this.content &&\n           other.lineFrom === this.lineFrom &&\n           other.lineTo === this.lineTo &&\n           other.isCollapsed === this.isCollapsed &&\n           other.hasContent === this.hasContent;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Get the set of line numbers that contain the cursor or selection\n */\nfunction getFocusedLines(state) {\n  const focused = new Set();\n\n  for (const range of state.selection.ranges) {\n    const startLine = state.doc.lineAt(range.from).number;\n    const endLine = state.doc.lineAt(range.to).number;\n\n    for (let i = startLine; i <= endLine; i++) {\n      focused.add(i);\n    }\n  }\n\n  return focused;\n}\n\n// ============================================================================\n// SHARED STATE FOR BLOCK RANGES (Performance Optimization)\n// ============================================================================\n//\n// Block ranges (code blocks, tables, math, mermaid) are computed ONCE per\n// document change and shared across all ViewPlugins via a StateField.\n// This avoids redundant O(n) document scans on every keystroke.\n//\n// The StateField also provides O(1) Set-based lookups for line membership.\n// ============================================================================\n\n/**\n * Detect YAML frontmatter at the start of the document.\n * Frontmatter must start on line 1 with `---` and end with a closing `---`.\n * @returns {{ start: number, end: number } | null}\n */\nfunction computeFrontmatterRange(doc) {\n  if (doc.lines < 2) return null;\n  const firstLine = doc.line(1).text.trim();\n  if (firstLine !== '---') return null;\n\n  for (let i = 2; i <= doc.lines; i++) {\n    const text = doc.line(i).text.trim();\n    if (text === '---' || text === '...') {\n      return { start: 1, end: i };\n    }\n  }\n\n  return null;\n}\n\n/**\n * Detect code blocks in the document and return line ranges with language\n */\nfunction computeCodeBlockRanges(doc) {\n  const ranges = [];\n  let inCodeBlock = false;\n  let blockStart = 0;\n  let blockLanguage = '';\n\n  for (let i = 1; i <= doc.lines; i++) {\n    const line = doc.line(i);\n    const text = line.text;\n\n    if (text.startsWith('```')) {\n      if (!inCodeBlock) {\n        inCodeBlock = true;\n        blockStart = i;\n        blockLanguage = text.slice(3).trim();\n      } else {\n        ranges.push({ start: blockStart, end: i, language: blockLanguage });\n        inCodeBlock = false;\n        blockLanguage = '';\n      }\n    }\n  }\n\n  // Handle unclosed code block\n  if (inCodeBlock) {\n    ranges.push({ start: blockStart, end: doc.lines, language: blockLanguage });\n  }\n\n  return ranges;\n}\n\n/**\n * Detect math blocks ($$...$$) in the document\n */\nfunction computeMathBlockRanges(doc, codeBlockLineSet) {\n  const ranges = [];\n  let mathStart = null;\n\n  for (let i = 1; i <= doc.lines; i++) {\n    // Skip lines inside code blocks (O(1) lookup)\n    if (codeBlockLineSet.has(i)) {\n      if (mathStart !== null) {\n        mathStart = null; // Reset if we enter a code block\n      }\n      continue;\n    }\n\n    const line = doc.line(i);\n    const text = line.text.trim();\n\n    if (text === '$$') {\n      if (mathStart === null) {\n        mathStart = i;\n      } else {\n        ranges.push({ start: mathStart, end: i });\n        mathStart = null;\n      }\n    }\n  }\n\n  return ranges;\n}\n\n/**\n * Detect table blocks in the document\n */\nfunction computeTableRanges(doc, codeBlockLineSet) {\n  const ranges = [];\n  let tableStart = null;\n\n  for (let i = 1; i <= doc.lines; i++) {\n    // Skip lines inside code blocks (O(1) lookup)\n    if (codeBlockLineSet.has(i)) {\n      if (tableStart !== null) {\n        ranges.push({ start: tableStart, end: i - 1 });\n        tableStart = null;\n      }\n      continue;\n    }\n\n    const line = doc.line(i);\n    const text = line.text.trim();\n    const isTableLine = text.startsWith('|') && text.endsWith('|');\n\n    if (isTableLine) {\n      if (tableStart === null) {\n        tableStart = i;\n      }\n    } else {\n      if (tableStart !== null) {\n        ranges.push({ start: tableStart, end: i - 1 });\n        tableStart = null;\n      }\n    }\n  }\n\n  // Handle table at end of document\n  if (tableStart !== null) {\n    ranges.push({ start: tableStart, end: doc.lines });\n  }\n\n  return ranges;\n}\n\nfunction isIndentedContinuation(text) {\n  return /^(\\s{2,}|\\t)/.test(text);\n}\n\n/**\n * Detect footnote definition blocks in the document (multi-line)\n */\nfunction computeFootnoteDefinitionRanges(doc, codeBlockLineSet) {\n  const ranges = [];\n\n  for (let i = 1; i <= doc.lines; i++) {\n    if (codeBlockLineSet.has(i)) continue;\n\n    const line = doc.line(i);\n    const match = line.text.match(/^\\[\\^([^\\]]+)\\]:\\s*(.*)$/);\n    if (!match) continue;\n\n    const id = match[1];\n    let end = i;\n\n    for (let j = i + 1; j <= doc.lines; j++) {\n      if (codeBlockLineSet.has(j)) break;\n      const nextLine = doc.line(j).text;\n      if (!isIndentedContinuation(nextLine)) {\n        break;\n      }\n      end = j;\n    }\n\n    ranges.push({ start: i, end, id });\n    i = end;\n  }\n\n  return ranges;\n}\n\n/**\n * Detect definition list blocks in the document\n */\nfunction computeDefinitionListRanges(doc, codeBlockLineSet, footnoteLineSet) {\n  const ranges = [];\n\n  const isDefinitionLine = (text) => /^\\s*:\\s*/.test(text);\n  const isTermCandidate = (text) => {\n    if (!text.trim()) return false;\n    if (/^\\s/.test(text)) return false;\n    if (/^[-*+]\\s+/.test(text)) return false;\n    if (/^\\d+\\.\\s+/.test(text)) return false;\n    if (/^>/.test(text)) return false;\n    if (/^#{1,6}\\s+/.test(text)) return false;\n    const trimmed = text.trim();\n    if (trimmed.startsWith('|') && trimmed.endsWith('|')) return false;\n    if (/^\\[\\^([^\\]]+)\\]:/.test(text)) return false;\n    return true;\n  };\n\n  for (let i = 1; i <= doc.lines; i++) {\n    if (codeBlockLineSet.has(i) || footnoteLineSet.has(i)) continue;\n\n    const line = doc.line(i).text;\n    if (!isTermCandidate(line)) continue;\n\n    const nextLineNum = i + 1;\n    if (nextLineNum > doc.lines) continue;\n    if (codeBlockLineSet.has(nextLineNum) || footnoteLineSet.has(nextLineNum)) continue;\n\n    const nextLine = doc.line(nextLineNum).text;\n    if (!isDefinitionLine(nextLine)) continue;\n\n    let end = nextLineNum;\n    for (let j = nextLineNum + 1; j <= doc.lines; j++) {\n      if (codeBlockLineSet.has(j) || footnoteLineSet.has(j)) break;\n      const text = doc.line(j).text;\n      if (isDefinitionLine(text) || isIndentedContinuation(text)) {\n        end = j;\n        continue;\n      }\n      break;\n    }\n\n    ranges.push({ start: i, end });\n    i = end;\n  }\n\n  return ranges;\n}\n\n/**\n * Build a Set of line numbers from an array of ranges (for O(1) lookup)\n */\nfunction buildLineSet(ranges) {\n  const lineSet = new Set();\n  for (const range of ranges) {\n    for (let i = range.start; i <= range.end; i++) {\n      lineSet.add(i);\n    }\n  }\n  return lineSet;\n}\n\n/**\n * Compute heading ranges - for each heading, determine which lines belong to it\n * A heading's content extends until the next heading of equal or higher level\n * @returns {Array<{line: number, level: number, endLine: number}>}\n */\nfunction computeHeadingRanges(doc, codeBlockLines) {\n  const headings = [];\n\n  // First pass: find all headings\n  for (let i = 1; i <= doc.lines; i++) {\n    if (codeBlockLines.has(i)) continue;\n\n    const line = doc.line(i);\n    const match = line.text.match(/^(#{1,6})\\s+/);\n    if (match) {\n      headings.push({\n        line: i,\n        level: match[1].length,\n        endLine: doc.lines, // Will be adjusted in second pass\n      });\n    }\n  }\n\n  // Second pass: determine end lines for each heading\n  for (let i = 0; i < headings.length; i++) {\n    const current = headings[i];\n    // Find next heading of equal or higher level (lower number)\n    for (let j = i + 1; j < headings.length; j++) {\n      if (headings[j].level <= current.level) {\n        current.endLine = headings[j].line - 1;\n        break;\n      }\n    }\n  }\n\n  return headings;\n}\n\n/**\n * Build a map from line number to its parent heading (for collapse checking)\n * @returns {Map<number, number>} Map from line number to heading line number\n */\nfunction buildHeadingMap(headings) {\n  const map = new Map();\n  for (const heading of headings) {\n    // Map all lines in this heading's range to the heading line\n    for (let i = heading.line + 1; i <= heading.endLine; i++) {\n      // Only set if not already set (deeper headings take precedence)\n      if (!map.has(i)) {\n        map.set(i, heading.line);\n      }\n    }\n  }\n  return map;\n}\n\n/**\n * StateField that computes and caches all block ranges.\n * Recomputed only when the document changes.\n */\nexport const blockRangesField = StateField.define({\n  create(state) {\n    return computeBlockRanges(state.doc);\n  },\n  update(value, tr) {\n    // Only recompute if document changed\n    if (tr.docChanged) {\n      return computeBlockRanges(tr.newDoc);\n    }\n    return value;\n  },\n});\n\n/**\n * Compute all block ranges and line sets for the document\n */\nfunction computeBlockRanges(doc) {\n  const frontmatter = computeFrontmatterRange(doc);\n  const frontmatterLines = frontmatter ? buildLineSet([frontmatter]) : new Set();\n\n  const codeBlocks = computeCodeBlockRanges(doc);\n  const codeBlockLines = buildLineSet(codeBlocks);\n\n  const mathBlocks = computeMathBlockRanges(doc, codeBlockLines);\n  const mathBlockLines = buildLineSet(mathBlocks);\n\n  const tables = computeTableRanges(doc, codeBlockLines);\n  const tableLines = buildLineSet(tables);\n\n  const footnoteBlocks = computeFootnoteDefinitionRanges(doc, codeBlockLines);\n  const footnoteBlockLines = buildLineSet(footnoteBlocks);\n\n  const definitionLists = computeDefinitionListRanges(doc, codeBlockLines, footnoteBlockLines);\n  const definitionListLines = buildLineSet(definitionLists);\n\n  const mermaidBlocks = codeBlocks.filter(r => r.language === 'mermaid');\n  const mermaidBlockLines = buildLineSet(mermaidBlocks);\n\n  // Compute heading ranges for collapse functionality\n  const headings = computeHeadingRanges(doc, codeBlockLines);\n  const headingMap = buildHeadingMap(headings);\n\n  return {\n    frontmatter,\n    frontmatterLines,\n    codeBlocks,\n    codeBlockLines,\n    mathBlocks,\n    mathBlockLines,\n    tables,\n    tableLines,\n    footnoteBlocks,\n    footnoteBlockLines,\n    definitionLists,\n    definitionListLines,\n    mermaidBlocks,\n    mermaidBlockLines,\n    headings,\n    headingMap,\n  };\n}\n\n/**\n * Widget that renders a math block\n */\nclass MathBlockWidget extends WidgetType {\n  constructor(content, mathFrom, mathTo) {\n    super();\n    this.content = content;\n    this.mathFrom = mathFrom;\n    this.mathTo = mathTo;\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'cm-math-preview';\n    wrapper.innerHTML = renderBlockMath(this.content);\n\n    const mathFrom = this.mathFrom;\n\n    wrapper.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      view.dispatch({\n        selection: { anchor: mathFrom },\n        scrollIntoView: true,\n      });\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    return other.content === this.content;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Widget that renders a mermaid diagram\n */\nclass MermaidBlockWidget extends WidgetType {\n  constructor(content, mermaidFrom, mermaidTo) {\n    super();\n    this.content = content;\n    this.mermaidFrom = mermaidFrom;\n    this.mermaidTo = mermaidTo;\n    this.id = 'mermaid-' + Math.random().toString(36).substr(2, 9);\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'cm-mermaid-preview';\n\n    const mermaidFrom = this.mermaidFrom;\n    const content = this.content;\n    const id = this.id;\n\n    // Render mermaid diagram asynchronously\n    (async () => {\n      try {\n        const { svg } = await mermaid.render(id, content);\n        wrapper.innerHTML = svg;\n      } catch (e) {\n        wrapper.innerHTML = `<pre class=\"mermaid-error\">${e.message}</pre>`;\n      }\n    })();\n\n    wrapper.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      view.dispatch({\n        selection: { anchor: mermaidFrom },\n        scrollIntoView: true,\n      });\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    return other.content === this.content;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n\n/**\n * Widget that renders a complete table\n */\nclass TableWidget extends WidgetType {\n  constructor(rows, tableFrom, tableTo) {\n    super();\n    this.rows = rows;\n    this.tableFrom = tableFrom;\n    this.tableTo = tableTo;\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'cm-table-preview';\n    const wikiLinksConfig = view.state.facet(wikiLinksFacet);\n    wrapper.innerHTML = renderTable(this.rows, { enableWikiLinks: wikiLinksConfig.renderWikiLinks });\n\n    const tableFrom = this.tableFrom;\n\n    wrapper.addEventListener('mousedown', (e) => {\n      const wikiLink = e.target.closest('[data-wikilink]');\n      if (wikiLink && wikiLinksConfig.onWikiLinkClick) {\n        e.preventDefault();\n        e.stopPropagation();\n        wikiLinksConfig.onWikiLinkClick(getWikiLinkData(wikiLink));\n        return;\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      // Position cursor at start of table\n      view.dispatch({\n        selection: { anchor: tableFrom },\n        scrollIntoView: true,\n      });\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    // Fast array comparison without JSON.stringify\n    if (other.rows.length !== this.rows.length) return false;\n    for (let i = 0; i < this.rows.length; i++) {\n      if (other.rows[i] !== this.rows[i]) return false;\n    }\n    return true;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Widget that renders a footnote definition block\n */\nclass FootnoteBlockWidget extends WidgetType {\n  constructor(id, lines, from, to) {\n    super();\n    this.id = id;\n    this.lines = lines;\n    this.from = from;\n    this.to = to;\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'cm-footnote-preview';\n    const wikiLinksConfig = view.state.facet(wikiLinksFacet);\n    wrapper.innerHTML = renderFootnoteBlock(this.id, this.lines, { enableWikiLinks: wikiLinksConfig.renderWikiLinks });\n\n    const from = this.from;\n\n    wrapper.addEventListener('mousedown', (e) => {\n      const wikiLink = e.target.closest('[data-wikilink]');\n      if (wikiLink && wikiLinksConfig.onWikiLinkClick) {\n        e.preventDefault();\n        e.stopPropagation();\n        wikiLinksConfig.onWikiLinkClick(getWikiLinkData(wikiLink));\n        return;\n      }\n\n      const footnoteBackref = e.target.closest('[data-footnote-ref]');\n      if (footnoteBackref) {\n        e.preventDefault();\n        e.stopPropagation();\n        const footnoteId = footnoteBackref.getAttribute('data-footnote-ref');\n        const doc = view.state.doc;\n        for (let i = 1; i <= doc.lines; i++) {\n          const line = doc.line(i);\n          if (line.text.match(new RegExp(`\\\\[\\\\^${footnoteId}\\\\](?!:)`))) {\n            view.dispatch({\n              selection: { anchor: line.from },\n              scrollIntoView: true,\n            });\n            view.focus();\n            return;\n          }\n        }\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      view.dispatch({\n        selection: { anchor: from },\n        scrollIntoView: true,\n      });\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    if (other.id !== this.id) return false;\n    if (other.lines.length !== this.lines.length) return false;\n    for (let i = 0; i < this.lines.length; i++) {\n      if (other.lines[i] !== this.lines[i]) return false;\n    }\n    return true;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Widget that renders a definition list block\n */\nclass DefinitionListWidget extends WidgetType {\n  constructor(lines, from, to) {\n    super();\n    this.lines = lines;\n    this.from = from;\n    this.to = to;\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'cm-definition-list-preview';\n    const wikiLinksConfig = view.state.facet(wikiLinksFacet);\n    wrapper.innerHTML = renderDefinitionList(this.lines, { enableWikiLinks: wikiLinksConfig.renderWikiLinks });\n\n    const from = this.from;\n\n    wrapper.addEventListener('mousedown', (e) => {\n      const wikiLink = e.target.closest('[data-wikilink]');\n      if (wikiLink && wikiLinksConfig.onWikiLinkClick) {\n        e.preventDefault();\n        e.stopPropagation();\n        wikiLinksConfig.onWikiLinkClick(getWikiLinkData(wikiLink));\n        return;\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      view.dispatch({\n        selection: { anchor: from },\n        scrollIntoView: true,\n      });\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    if (other.lines.length !== this.lines.length) return false;\n    for (let i = 0; i < this.lines.length; i++) {\n      if (other.lines[i] !== this.lines[i]) return false;\n    }\n    return true;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Check if a line should be hidden due to a collapsed heading\n * @param {number} lineNum - Line number to check\n * @param {Array} headings - Array of heading objects\n * @param {Set} collapsed - Set of collapsed heading line numbers\n * @returns {boolean} True if line should be hidden\n */\nfunction isLineCollapsed(lineNum, headings, collapsed) {\n  for (const heading of headings) {\n    // Check if this heading is collapsed and contains the line\n    if (collapsed.has(heading.line) && lineNum > heading.line && lineNum <= heading.endLine) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Get heading info for a line if it's a heading\n */\nfunction getHeadingInfo(lineNum, headings) {\n  for (const heading of headings) {\n    if (heading.line === lineNum) {\n      return heading;\n    }\n  }\n  return null;\n}\n\n/**\n * Build decorations for all non-focused lines (viewport-aware)\n * @param {EditorView} view - The editor view\n * @param {Object} blockRanges - Precomputed block ranges from StateField\n */\nfunction buildDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  // If editor doesn't have focus, render preview for all lines\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n  const {\n    frontmatterLines,\n    codeBlockLines,\n    tableLines,\n    mathBlockLines,\n    footnoteBlockLines,\n    definitionListLines,\n    headings,\n  } = blockRanges;\n  const decorations = [];\n\n  // Check if collapse functionality is enabled\n  const collapseEnabled = state.facet(enableCollapseFacet);\n\n  // Get collapsed headings state (only if collapse is enabled)\n  const collapsed = collapseEnabled ? state.field(collapsedHeadingsField) : new Set();\n\n  // Only process lines in the visible viewport (+ small buffer)\n  for (const { from, to } of view.visibleRanges) {\n    const startLine = state.doc.lineAt(from).number;\n    const endLine = state.doc.lineAt(to).number;\n\n    for (let i = startLine; i <= endLine; i++) {\n      // Check if line is hidden due to collapsed heading (only if collapse enabled)\n      if (collapseEnabled && isLineCollapsed(i, headings, collapsed)) {\n        // Hide the line with a line decoration (CSS handles animation)\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-collapsed-line' }).range(line.from)\n        );\n        continue;\n      }\n\n      // Skip frontmatter lines (handled by frontmatterDecorations plugin)\n      if (frontmatterLines.has(i)) {\n        continue;\n      }\n\n      // Skip lines that contain the cursor/selection\n      if (focusedLines.has(i)) {\n        continue;\n      }\n\n      // Skip lines inside code blocks (show raw with styling) - O(1) lookup\n      if (codeBlockLines.has(i)) {\n        continue;\n      }\n\n      // Skip table lines (handled by separate tableDecorations plugin) - O(1) lookup\n      if (tableLines.has(i)) {\n        continue;\n      }\n\n      // Skip math block lines (handled by mathBlockDecorations plugin) - O(1) lookup\n      if (mathBlockLines.has(i)) {\n        continue;\n      }\n\n      // Skip footnote definition lines (handled by footnoteBlockDecorations plugin)\n      if (footnoteBlockLines.has(i)) {\n        continue;\n      }\n\n      // Skip definition list lines (handled by definitionListDecorations plugin)\n      if (definitionListLines.has(i)) {\n        continue;\n      }\n\n      const line = state.doc.line(i);\n      const content = line.text;\n\n      // Skip standalone image lines (handled by imageDecorations plugin)\n      if (parseImageLine(content)) {\n        continue;\n      }\n\n      // Skip empty lines\n      if (!content.trim()) {\n        continue;\n      }\n\n      // Check if this is a heading line (use special widget only if collapse is enabled)\n      if (collapseEnabled) {\n        const headingInfo = getHeadingInfo(i, headings);\n        if (headingInfo) {\n          // Check if heading has content (endLine > line)\n          const hasContent = headingInfo.endLine > headingInfo.line;\n          const isCollapsed = collapsed.has(i);\n\n          decorations.push(\n            Decoration.replace({\n              widget: new HeadingPreviewWidget(\n                content,\n                line.from,\n                line.to,\n                i,\n                headingInfo.level,\n                isCollapsed,\n                hasContent\n              ),\n              inclusive: false,\n              block: false,\n            }).range(line.from, line.to)\n          );\n          continue;\n        }\n      }\n\n      // Create replace decoration for the line content\n      decorations.push(\n        Decoration.replace({\n          widget: new MarkdownPreviewWidget(content, line.from, line.to),\n          inclusive: false,\n          block: false,\n        }).range(line.from, line.to)\n      );\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\n/**\n * Build decorations for wiki links in focused lines\n */\nfunction buildWikiLinkDecorations(view, blockRanges) {\n  const wikiLinksConfig = view.state.facet(wikiLinksFacet);\n  if (!wikiLinksConfig.enableWikiLinks) {\n    return Decoration.none;\n  }\n\n  if (!view.hasFocus) {\n    return Decoration.none;\n  }\n\n  const { state } = view;\n  const focusedLines = getFocusedLines(state);\n  const { codeBlockLines } = blockRanges;\n  const decorations = [];\n\n  for (const { from, to } of view.visibleRanges) {\n    const startLine = state.doc.lineAt(from).number;\n    const endLine = state.doc.lineAt(to).number;\n\n    for (let i = startLine; i <= endLine; i++) {\n      if (!focusedLines.has(i)) continue;\n      if (codeBlockLines.has(i)) continue;\n\n      const line = state.doc.line(i);\n      if (!line.text.includes('[[')) continue;\n\n      const matches = findWikiLinks(line.text);\n      for (const match of matches) {\n        decorations.push(\n          Decoration.mark({ class: 'cm-wikilink' }).range(\n            line.from + match.from,\n            line.from + match.to\n          )\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\n/**\n * ViewPlugin to manage preview decorations\n */\nconst hybridPreviewPlugin = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      // Check if any collapse effects were dispatched\n      const hasCollapseEffect = update.transactions.some(tr =>\n        tr.effects.some(e => e.is(toggleCollapseEffect))\n      );\n\n      // Rebuild on doc changes, selection changes, viewport changes, focus changes, or collapse changes\n      if (update.docChanged || update.selectionSet || update.viewportChanged || update.focusChanged || hasCollapseEffect) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\nconst wikiLinkDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildWikiLinkDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.viewportChanged || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildWikiLinkDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * Build decorations for tags in focused lines\n */\nfunction buildTagDecorations(view, blockRanges) {\n  const tagsConfig = view.state.facet(tagsFacet);\n  if (!tagsConfig.enableTags) {\n    return Decoration.none;\n  }\n\n  if (!view.hasFocus) {\n    return Decoration.none;\n  }\n\n  const { state } = view;\n  const focusedLines = getFocusedLines(state);\n  const { codeBlockLines } = blockRanges;\n  const decorations = [];\n\n  for (const { from, to } of view.visibleRanges) {\n    const startLine = state.doc.lineAt(from).number;\n    const endLine = state.doc.lineAt(to).number;\n\n    for (let i = startLine; i <= endLine; i++) {\n      if (!focusedLines.has(i)) continue;\n      if (codeBlockLines.has(i)) continue;\n\n      const line = state.doc.line(i);\n      if (!line.text.includes('#')) continue;\n\n      const matches = findTags(line.text);\n      for (const match of matches) {\n        decorations.push(\n          Decoration.mark({ class: 'cm-tag-mark' }).range(\n            line.from + match.from,\n            line.from + match.to\n          )\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst tagDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildTagDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.viewportChanged || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildTagDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * Widget that renders a syntax-highlighted code line\n */\nclass HighlightedCodeWidget extends WidgetType {\n  constructor(content, language, lineFrom, lineTo) {\n    super();\n    this.content = content;\n    this.language = language;\n    this.lineFrom = lineFrom;\n    this.lineTo = lineTo;\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('span');\n    wrapper.className = 'cm-highlighted-code';\n    wrapper.innerHTML = highlightCode(this.content, this.language);\n\n    const lineFrom = this.lineFrom;\n    const lineTo = this.lineTo;\n    const content = this.content;\n\n    wrapper.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      // Estimate character position based on click location\n      const rect = wrapper.getBoundingClientRect();\n      const clickX = e.clientX - rect.left;\n      const totalWidth = rect.width;\n      const textLength = content.length;\n\n      let charPos = 0;\n      if (totalWidth > 0 && textLength > 0) {\n        const ratio = clickX / totalWidth;\n        charPos = Math.round(ratio * textLength);\n        charPos = Math.max(0, Math.min(charPos, textLength));\n      }\n\n      const cursorPos = lineFrom + charPos;\n\n      view.dispatch({\n        selection: { anchor: cursorPos },\n        scrollIntoView: true,\n      });\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    return other.content === this.content && other.language === this.language;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Build line decorations for code blocks (adds background styling and syntax highlighting)\n * @param {EditorView} view - The editor view\n * @param {Object} blockRanges - Precomputed block ranges from StateField\n */\nfunction buildCodeBlockDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  const decorations = [];\n  const { codeBlocks } = blockRanges;\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n\n  for (const range of codeBlocks) {\n    // Skip mermaid blocks - they're handled separately\n    if (range.language === 'mermaid') {\n      continue;\n    }\n    // Check if any line in this code block is focused\n    let blockFocused = false;\n    for (let j = range.start; j <= range.end; j++) {\n      if (focusedLines.has(j)) {\n        blockFocused = true;\n        break;\n      }\n    }\n\n    // Check if block has content lines (not just fences)\n    const hasContent = range.end - range.start > 1;\n\n    for (let i = range.start; i <= range.end; i++) {\n      const line = state.doc.line(i);\n      const isFence = i === range.start || i === range.end;\n\n      // Hide fence lines when not focused and block has content\n      if (isFence && !blockFocused && hasContent) {\n        decorations.push(\n          Decoration.replace({}).range(line.from, line.to)\n        );\n        continue;\n      }\n\n      // Add background styling - use focused style if block is being edited\n      const lineClass = blockFocused ? 'cm-code-block-line cm-code-block-focused' : 'cm-code-block-line';\n      decorations.push(\n        Decoration.line({ class: lineClass }).range(line.from)\n      );\n\n      // Add syntax highlighting for content lines (not fences, not focused)\n      const isFocused = focusedLines.has(i);\n\n      if (!isFence && !isFocused && line.text.length > 0) {\n        decorations.push(\n          Decoration.replace({\n            widget: new HighlightedCodeWidget(line.text, range.language, line.from, line.to),\n          }).range(line.from, line.to)\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst codeBlockDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildCodeBlockDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildCodeBlockDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * Build decorations for tables\n * @param {EditorView} view - The editor view\n * @param {Object} blockRanges - Precomputed block ranges from StateField\n */\nfunction buildTableDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  const decorations = [];\n  const { tables } = blockRanges;\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n\n  for (const range of tables) {\n    // Check if any line in this table is focused\n    let tableFocused = false;\n    for (let j = range.start; j <= range.end; j++) {\n      if (focusedLines.has(j)) {\n        tableFocused = true;\n        break;\n      }\n    }\n\n    if (tableFocused) {\n      // Show raw table lines with background styling\n      for (let i = range.start; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-table-line' }).range(line.from)\n        );\n      }\n    } else {\n      // Render table as widget on first line, hide other lines\n      const rows = [];\n      for (let j = range.start; j <= range.end; j++) {\n        rows.push(state.doc.line(j).text);\n      }\n      const firstLine = state.doc.line(range.start);\n\n      // Replace first line with widget\n      decorations.push(\n        Decoration.replace({\n          widget: new TableWidget(rows, firstLine.from, firstLine.to),\n        }).range(firstLine.from, firstLine.to)\n      );\n\n      // Hide remaining table lines\n      for (let i = range.start + 1; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-hidden-line' }).range(line.from),\n          Decoration.replace({}).range(line.from, line.to)\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst tableDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildTableDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildTableDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * Build decorations for footnote definition blocks\n * @param {EditorView} view - The editor view\n * @param {Object} blockRanges - Precomputed block ranges from StateField\n */\nfunction buildFootnoteBlockDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  const decorations = [];\n  const { footnoteBlocks } = blockRanges;\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n\n  for (const range of footnoteBlocks) {\n    let blockFocused = false;\n    for (let j = range.start; j <= range.end; j++) {\n      if (focusedLines.has(j)) {\n        blockFocused = true;\n        break;\n      }\n    }\n\n    if (blockFocused) {\n      for (let i = range.start; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-footnote-line' }).range(line.from)\n        );\n      }\n    } else {\n      const lines = [];\n      for (let j = range.start; j <= range.end; j++) {\n        lines.push(state.doc.line(j).text);\n      }\n      const firstLine = state.doc.line(range.start);\n\n      decorations.push(\n        Decoration.replace({\n          widget: new FootnoteBlockWidget(range.id, lines, firstLine.from, firstLine.to),\n        }).range(firstLine.from, firstLine.to)\n      );\n\n      for (let i = range.start + 1; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-hidden-line' }).range(line.from),\n          Decoration.replace({}).range(line.from, line.to)\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst footnoteBlockDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildFootnoteBlockDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildFootnoteBlockDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * Build decorations for definition list blocks\n * @param {EditorView} view - The editor view\n * @param {Object} blockRanges - Precomputed block ranges from StateField\n */\nfunction buildDefinitionListDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  const decorations = [];\n  const { definitionLists } = blockRanges;\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n\n  for (const range of definitionLists) {\n    let blockFocused = false;\n    for (let j = range.start; j <= range.end; j++) {\n      if (focusedLines.has(j)) {\n        blockFocused = true;\n        break;\n      }\n    }\n\n    if (blockFocused) {\n      for (let i = range.start; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-definition-list-line' }).range(line.from)\n        );\n      }\n    } else {\n      const lines = [];\n      for (let j = range.start; j <= range.end; j++) {\n        lines.push(state.doc.line(j).text);\n      }\n      const firstLine = state.doc.line(range.start);\n\n      decorations.push(\n        Decoration.replace({\n          widget: new DefinitionListWidget(lines, firstLine.from, firstLine.to),\n        }).range(firstLine.from, firstLine.to)\n      );\n\n      for (let i = range.start + 1; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-hidden-line' }).range(line.from),\n          Decoration.replace({}).range(line.from, line.to)\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst definitionListDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildDefinitionListDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildDefinitionListDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * Build decorations for math blocks\n * @param {EditorView} view - The editor view\n * @param {Object} blockRanges - Precomputed block ranges from StateField\n */\nfunction buildMathBlockDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  const decorations = [];\n  const { mathBlocks } = blockRanges;\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n\n  for (const range of mathBlocks) {\n    // Check if any line in this math block is focused\n    let mathFocused = false;\n    for (let j = range.start; j <= range.end; j++) {\n      if (focusedLines.has(j)) {\n        mathFocused = true;\n        break;\n      }\n    }\n\n    if (mathFocused) {\n      // Show raw math lines with background styling\n      for (let i = range.start; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-math-block-line' }).range(line.from)\n        );\n      }\n    } else {\n      // Collect math content (excluding $$ delimiters)\n      const mathLines = [];\n      for (let j = range.start + 1; j < range.end; j++) {\n        mathLines.push(state.doc.line(j).text);\n      }\n      const mathContent = mathLines.join('\\n');\n      const firstLine = state.doc.line(range.start);\n\n      // Replace first line with widget, hide other lines with empty replacements\n      decorations.push(\n        Decoration.replace({\n          widget: new MathBlockWidget(mathContent, firstLine.from, firstLine.to),\n        }).range(firstLine.from, firstLine.to)\n      );\n\n      // Hide remaining lines (content and closing $$)\n      for (let i = range.start + 1; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-hidden-line' }).range(line.from),\n          Decoration.replace({}).range(line.from, line.to)\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst mathBlockDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildMathBlockDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildMathBlockDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * Build decorations for mermaid blocks\n * @param {EditorView} view - The editor view\n * @param {Object} blockRanges - Precomputed block ranges from StateField\n */\nfunction buildMermaidBlockDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  const decorations = [];\n  const { mermaidBlocks } = blockRanges;\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n\n  for (const range of mermaidBlocks) {\n    // Check if any line in this mermaid block is focused\n    let mermaidFocused = false;\n    for (let j = range.start; j <= range.end; j++) {\n      if (focusedLines.has(j)) {\n        mermaidFocused = true;\n        break;\n      }\n    }\n\n    if (mermaidFocused) {\n      // Show raw mermaid lines with background styling\n      for (let i = range.start; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-mermaid-block-line' }).range(line.from)\n        );\n      }\n    } else {\n      // Collect mermaid content (excluding ``` fences)\n      const mermaidLines = [];\n      for (let j = range.start + 1; j < range.end; j++) {\n        mermaidLines.push(state.doc.line(j).text);\n      }\n      const mermaidContent = mermaidLines.join('\\n');\n      const firstLine = state.doc.line(range.start);\n\n      // Replace first line with widget\n      decorations.push(\n        Decoration.replace({\n          widget: new MermaidBlockWidget(mermaidContent, firstLine.from, firstLine.to),\n        }).range(firstLine.from, firstLine.to)\n      );\n\n      // Hide remaining lines\n      for (let i = range.start + 1; i <= range.end; i++) {\n        const line = state.doc.line(i);\n        decorations.push(\n          Decoration.line({ class: 'cm-hidden-line' }).range(line.from),\n          Decoration.replace({}).range(line.from, line.to)\n        );\n      }\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst mermaidBlockDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildMermaidBlockDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildMermaidBlockDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n// ============================================================================\n// INLINE IMAGE PREVIEW\n// ============================================================================\n\nconst IMAGE_LINE_REGEX = /^!\\[([^\\]]*)\\]\\(([^)]+)\\)$/;\n\n/**\n * Check if a line contains only an image markdown syntax\n * @returns {{ alt: string, url: string } | null}\n */\nfunction parseImageLine(text) {\n  const match = text.trim().match(IMAGE_LINE_REGEX);\n  if (!match) return null;\n  return { alt: match[1], url: match[2].trim() };\n}\n\n/**\n * Widget that renders an image preview\n */\nclass ImagePreviewWidget extends WidgetType {\n  constructor(alt, url, lineFrom, lineTo) {\n    super();\n    this.alt = alt;\n    this.url = url;\n    this.lineFrom = lineFrom;\n    this.lineTo = lineTo;\n  }\n\n  toDOM(view) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'cm-image-preview';\n\n    const img = document.createElement('img');\n    img.src = this.url;\n    img.alt = this.alt;\n    img.loading = 'lazy';\n\n    img.addEventListener('error', () => {\n      wrapper.textContent = '';\n      const error = document.createElement('div');\n      error.className = 'cm-image-error';\n      error.textContent = `Image not found: ${this.url}`;\n      wrapper.appendChild(error);\n    });\n\n    wrapper.appendChild(img);\n\n    if (this.alt) {\n      const altText = document.createElement('span');\n      altText.className = 'cm-image-alt';\n      altText.textContent = this.alt;\n      wrapper.appendChild(altText);\n    }\n\n    const lineFrom = this.lineFrom;\n    wrapper.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      view.dispatch({\n        selection: { anchor: lineFrom },\n        scrollIntoView: true,\n      });\n      view.focus();\n    });\n\n    return wrapper;\n  }\n\n  eq(other) {\n    return other.url === this.url && other.alt === this.alt;\n  }\n\n  ignoreEvent(event) {\n    return event.type !== 'mousedown';\n  }\n}\n\n/**\n * Build decorations for standalone image lines\n */\nfunction buildImageDecorations(view, blockRanges) {\n  const { state } = view;\n  const hasFocus = view.hasFocus;\n  const decorations = [];\n  const focusedLines = hasFocus ? getFocusedLines(state) : new Set();\n  const {\n    frontmatterLines,\n    codeBlockLines,\n    tableLines,\n    mathBlockLines,\n    footnoteBlockLines,\n    definitionListLines,\n    mermaidBlockLines,\n  } = blockRanges;\n\n  for (const { from, to } of view.visibleRanges) {\n    const startLine = state.doc.lineAt(from).number;\n    const endLine = state.doc.lineAt(to).number;\n\n    for (let i = startLine; i <= endLine; i++) {\n      if (focusedLines.has(i)) continue;\n      if (frontmatterLines.has(i)) continue;\n      if (codeBlockLines.has(i)) continue;\n      if (tableLines.has(i)) continue;\n      if (mathBlockLines.has(i)) continue;\n      if (footnoteBlockLines.has(i)) continue;\n      if (definitionListLines.has(i)) continue;\n      if (mermaidBlockLines.has(i)) continue;\n\n      const line = state.doc.line(i);\n      const imageData = parseImageLine(line.text);\n      if (!imageData) continue;\n\n      decorations.push(\n        Decoration.replace({\n          widget: new ImagePreviewWidget(imageData.alt, imageData.url, line.from, line.to),\n        }).range(line.from, line.to)\n      );\n    }\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst imageDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildImageDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.viewportChanged || update.focusChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildImageDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n// ============================================================================\n// FRONTMATTER SHEET STATE\n// ============================================================================\n// Defined here (not in frontmatter-sheet.js) to avoid circular imports.\n// The sheet plugin imports these from here; buildFrontmatterDecorations reads\n// the field to decide between full table vs collapsed indicator.\n\n/**\n * StateEffect for toggling the frontmatter sheet open/closed\n * @type {StateEffectType<boolean>}\n */\nexport const toggleSheetEffect = StateEffect.define();\n\n/**\n * StateField tracking whether the frontmatter sheet overlay is open\n */\nexport const frontmatterSheetField = StateField.define({\n  create() {\n    return false;\n  },\n  update(open, tr) {\n    for (const effect of tr.effects) {\n      if (effect.is(toggleSheetEffect)) {\n        return effect.value;\n      }\n    }\n    return open;\n  },\n});\n\n// ============================================================================\n// YAML FRONTMATTER PROPERTIES EDITOR\n// ============================================================================\n\n/**\n * Serialize a parsed YAML object back to frontmatter YAML string.\n * Produces clean output without trailing newline.\n */\nfunction serializeYaml(obj) {\n  if (!obj || typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    return '';\n  }\n  // js-yaml.dump always adds a trailing newline, trim it since the document\n  // structure already has newlines between content and the closing ---\n  return yaml.dump(obj, {\n    indent: 2,\n    lineWidth: -1,\n    noRefs: true,\n    quotingType: '\"',\n    forceQuotes: false,\n  }).trimEnd();\n}\n\n/**\n * Create a DOM element for displaying/editing a YAML value based on its type\n */\nfunction createValueEditor(key, value, parsedYaml, fmContentFrom, fmContentTo, view) {\n  const container = document.createElement('span');\n  container.className = 'cm-frontmatter-value';\n\n  if (typeof value === 'boolean') {\n    const checkbox = document.createElement('input');\n    checkbox.type = 'checkbox';\n    checkbox.checked = value;\n    checkbox.className = 'cm-frontmatter-checkbox';\n    checkbox.addEventListener('change', (e) => {\n      e.stopPropagation();\n      const updated = { ...parsedYaml, [key]: checkbox.checked };\n      const newYaml = serializeYaml(updated);\n      view.dispatch({\n        changes: { from: fmContentFrom, to: fmContentTo, insert: newYaml },\n        annotations: allowReadOnlyEdit.of(true),\n      });\n    });\n    container.appendChild(checkbox);\n    return container;\n  }\n\n  if (Array.isArray(value)) {\n    for (let i = 0; i < value.length; i++) {\n      const tag = document.createElement('span');\n      tag.className = 'cm-frontmatter-tag';\n      tag.textContent = String(value[i]);\n      tag.contentEditable = 'true';\n      tag.spellcheck = false;\n\n      const idx = i;\n      tag.addEventListener('blur', (e) => {\n        e.stopPropagation();\n        const newArr = [...value];\n        const newVal = tag.textContent.trim();\n        if (newVal === '') {\n          newArr.splice(idx, 1);\n        } else {\n          newArr[idx] = newVal;\n        }\n        const updated = { ...parsedYaml, [key]: newArr };\n        const newYaml = serializeYaml(updated);\n        view.dispatch({\n          changes: { from: fmContentFrom, to: fmContentTo, insert: newYaml },\n          annotations: allowReadOnlyEdit.of(true),\n        });\n      });\n      tag.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter') {\n          e.preventDefault();\n          tag.blur();\n        }\n        e.stopPropagation();\n      });\n      tag.addEventListener('mousedown', (e) => e.stopPropagation());\n      container.appendChild(tag);\n    }\n\n    // Add tag button\n    const addTag = document.createElement('span');\n    addTag.className = 'cm-frontmatter-add-tag';\n    addTag.textContent = '+';\n    addTag.title = 'Add item';\n    addTag.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n    });\n    addTag.addEventListener('click', (e) => {\n      e.stopPropagation();\n      const newArr = [...value, 'new'];\n      const updated = { ...parsedYaml, [key]: newArr };\n      const newYaml = serializeYaml(updated);\n      view.dispatch({\n        changes: { from: fmContentFrom, to: fmContentTo, insert: newYaml },\n        annotations: allowReadOnlyEdit.of(true),\n      });\n    });\n    container.appendChild(addTag);\n    return container;\n  }\n\n  if (value !== null && typeof value === 'object') {\n    // Nested object: render as JSON-like text, editable\n    const input = document.createElement('input');\n    input.type = 'text';\n    input.className = 'cm-frontmatter-input';\n    input.value = JSON.stringify(value);\n    input.addEventListener('blur', (e) => {\n      e.stopPropagation();\n      try {\n        const parsed = JSON.parse(input.value);\n        const updated = { ...parsedYaml, [key]: parsed };\n        const newYaml = serializeYaml(updated);\n        view.dispatch({\n          changes: { from: fmContentFrom, to: fmContentTo, insert: newYaml },\n          annotations: allowReadOnlyEdit.of(true),\n        });\n      } catch {\n        // Invalid JSON, revert\n        input.value = JSON.stringify(value);\n      }\n    });\n    input.addEventListener('keydown', (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        input.blur();\n      }\n      e.stopPropagation();\n    });\n    input.addEventListener('mousedown', (e) => e.stopPropagation());\n    container.appendChild(input);\n    return container;\n  }\n\n  // String, number, date, null ‚Äî text input\n  const input = document.createElement('input');\n  input.type = 'text';\n  input.className = 'cm-frontmatter-input';\n  input.value = value === null ? '' : String(value);\n  input.placeholder = value === null ? 'empty' : '';\n  input.addEventListener('blur', (e) => {\n    e.stopPropagation();\n    const raw = input.value;\n    // Try to preserve types: numbers, booleans, null\n    let newValue;\n    if (raw === '' || raw === 'null') {\n      newValue = null;\n    } else if (raw === 'true') {\n      newValue = true;\n    } else if (raw === 'false') {\n      newValue = false;\n    } else if (!isNaN(raw) && raw.trim() !== '') {\n      newValue = Number(raw);\n    } else {\n      newValue = raw;\n    }\n    const updated = { ...parsedYaml, [key]: newValue };\n    const newYaml = serializeYaml(updated);\n    view.dispatch({\n      changes: { from: fmContentFrom, to: fmContentTo, insert: newYaml },\n      annotations: allowReadOnlyEdit.of(true),\n    });\n  });\n  input.addEventListener('keydown', (e) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      input.blur();\n    }\n    e.stopPropagation();\n  });\n  input.addEventListener('mousedown', (e) => e.stopPropagation());\n  container.appendChild(input);\n  return container;\n}\n\n/**\n * Build the frontmatter property table DOM.\n * Used by the frontmatter sheet overlay.\n *\n * @param {string} yamlContent - raw YAML between fences\n * @param {number} contentFrom - doc position of first content line\n * @param {number} contentTo - doc position of last content line\n * @param {number} blockFrom - doc position of opening ---\n * @param {EditorView} view\n * @param {Object} [options]\n * @param {string[]} [options.knownKeys] - Known property names for autocomplete suggestions\n * @returns {{ dom: HTMLElement, error: boolean }}\n */\nexport function buildFrontmatterPropertyTable(yamlContent, contentFrom, contentTo, blockFrom, view, options = {}) {\n  const { knownKeys = [] } = options;\n  const wrapper = document.createElement('div');\n  wrapper.className = 'cm-frontmatter-preview';\n\n  let parsedYaml;\n  try {\n    parsedYaml = yaml.load(yamlContent);\n  } catch {\n    const error = document.createElement('div');\n    error.className = 'cm-frontmatter-error';\n    error.textContent = 'Invalid YAML frontmatter \\u2014 click to edit';\n    wrapper.appendChild(error);\n    return { dom: wrapper, error: true };\n  }\n\n  if (!parsedYaml || typeof parsedYaml !== 'object') {\n    parsedYaml = {};\n  }\n\n  const table = document.createElement('table');\n  table.className = 'cm-frontmatter-table';\n\n  // Create datalist for key autocomplete suggestions\n  const datalistId = 'cm-fm-keys-' + Math.random().toString(36).slice(2, 8);\n  const datalist = document.createElement('datalist');\n  datalist.id = datalistId;\n  const currentKeys = new Set(Object.keys(parsedYaml));\n  for (const k of knownKeys) {\n    if (!currentKeys.has(k)) {\n      const opt = document.createElement('option');\n      opt.value = k;\n      datalist.appendChild(opt);\n    }\n  }\n  wrapper.appendChild(datalist);\n\n  const keys = Object.keys(parsedYaml);\n\n  for (const key of keys) {\n    const row = document.createElement('tr');\n\n    const keyCell = document.createElement('td');\n    keyCell.className = 'cm-frontmatter-key';\n    const keyInput = document.createElement('input');\n    keyInput.type = 'text';\n    keyInput.className = 'cm-frontmatter-key-input';\n    keyInput.value = key;\n    keyInput.size = Math.max(key.length, 1);\n    keyInput.spellcheck = false;\n    keyInput.setAttribute('list', datalistId);\n    keyInput.addEventListener('blur', (e) => {\n      e.stopPropagation();\n      const newKey = keyInput.value.trim();\n      if (newKey === '' || newKey === key) {\n        keyInput.value = key;\n        return;\n      }\n      // Rename: build new object preserving order\n      const updated = {};\n      for (const k of Object.keys(parsedYaml)) {\n        if (k === key) {\n          updated[newKey] = parsedYaml[k];\n        } else {\n          updated[k] = parsedYaml[k];\n        }\n      }\n      const newYaml = serializeYaml(updated);\n      view.dispatch({\n        changes: { from: contentFrom, to: contentTo, insert: newYaml },\n        annotations: allowReadOnlyEdit.of(true),\n      });\n    });\n    keyInput.addEventListener('keydown', (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        keyInput.blur();\n      }\n      e.stopPropagation();\n    });\n    keyInput.addEventListener('mousedown', (e) => e.stopPropagation());\n    keyCell.appendChild(keyInput);\n    row.appendChild(keyCell);\n\n    const valueCell = document.createElement('td');\n    valueCell.className = 'cm-frontmatter-value-cell';\n    valueCell.appendChild(\n      createValueEditor(key, parsedYaml[key], parsedYaml, contentFrom, contentTo, view)\n    );\n    row.appendChild(valueCell);\n\n    const deleteCell = document.createElement('td');\n    deleteCell.className = 'cm-frontmatter-action-cell';\n    const deleteBtn = document.createElement('span');\n    deleteBtn.className = 'cm-frontmatter-delete';\n    deleteBtn.textContent = '\\u00d7';\n    deleteBtn.title = 'Remove property';\n    deleteBtn.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n    });\n    deleteBtn.addEventListener('click', (e) => {\n      e.stopPropagation();\n      const updated = { ...parsedYaml };\n      delete updated[key];\n      const newYaml = serializeYaml(updated);\n      view.dispatch({\n        changes: { from: contentFrom, to: contentTo, insert: newYaml },\n        annotations: allowReadOnlyEdit.of(true),\n      });\n    });\n    deleteCell.appendChild(deleteBtn);\n    row.appendChild(deleteCell);\n\n    table.appendChild(row);\n  }\n\n  wrapper.appendChild(table);\n\n  const addRow = document.createElement('div');\n  addRow.className = 'cm-frontmatter-add';\n  addRow.textContent = '+ Add property';\n  addRow.addEventListener('mousedown', (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n  });\n  addRow.addEventListener('click', (e) => {\n    e.stopPropagation();\n    let newKey = 'property';\n    let counter = 1;\n    while (parsedYaml[newKey] !== undefined) {\n      newKey = `property${counter}`;\n      counter++;\n    }\n    const updated = { ...parsedYaml, [newKey]: '' };\n    const newYaml = serializeYaml(updated);\n    view.dispatch({\n      changes: { from: contentFrom, to: contentTo, insert: newYaml },\n      annotations: allowReadOnlyEdit.of(true),\n    });\n  });\n  wrapper.appendChild(addRow);\n\n  return { dom: wrapper, error: false };\n}\n\n/**\n * Build decorations for YAML frontmatter\n */\nfunction buildFrontmatterDecorations(view, blockRanges) {\n  const { state } = view;\n  const { frontmatter } = blockRanges;\n\n  if (!frontmatter) {\n    return Decoration.none;\n  }\n\n  // Frontmatter is always hidden in the editor ‚Äî editing happens in the sheet overlay\n  const decorations = [];\n  const firstLine = state.doc.line(frontmatter.start);\n\n  // Replace the opening --- with an empty widget so it takes no space\n  decorations.push(\n    Decoration.replace({}).range(firstLine.from, firstLine.to)\n  );\n  decorations.push(\n    Decoration.line({ class: 'cm-hidden-line' }).range(firstLine.from)\n  );\n\n  // Hide remaining lines\n  for (let i = frontmatter.start + 1; i <= frontmatter.end; i++) {\n    const line = state.doc.line(i);\n    decorations.push(\n      Decoration.line({ class: 'cm-hidden-line' }).range(line.from),\n      Decoration.replace({}).range(line.from, line.to)\n    );\n  }\n\n  return Decoration.set(decorations, true);\n}\n\nconst frontmatterDecorations = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      const blockRanges = view.state.field(blockRangesField);\n      this.decorations = buildFrontmatterDecorations(view, blockRanges);\n    }\n\n    update(update) {\n      if (update.docChanged) {\n        const blockRanges = update.state.field(blockRangesField);\n        this.decorations = buildFrontmatterDecorations(update.view, blockRanges);\n      }\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n\n/**\n * The hybrid preview extension\n * @param {Object} options - Configuration options\n * @param {boolean} [options.enableCollapse=true] - Enable heading collapse functionality\n */\nexport function hybridPreview(options = {}) {\n  const {\n    enableCollapse = true,\n    enableCustomTasks = false,\n    customTaskTypes,\n    enableWikiLinks = false,\n    renderWikiLinks = true,\n    onWikiLinkClick,\n    enableTags = false,\n    onTagClick,\n  } = options;\n\n  const customTasksConfig = buildCustomTasksConfig(enableCustomTasks, customTaskTypes);\n  const wikiLinksConfig = buildWikiLinksConfig(enableWikiLinks, renderWikiLinks, onWikiLinkClick);\n  const tagsConfig = buildTagsConfig(enableTags, onTagClick);\n\n  return [\n    // Configuration facet for collapse functionality\n    enableCollapseFacet.of(enableCollapse),\n    // Configuration facet for custom task types\n    customTasksFacet.of(customTasksConfig),\n    // Configuration facet for wiki links\n    wikiLinksFacet.of(wikiLinksConfig),\n    // Configuration facet for tags\n    tagsFacet.of(tagsConfig),\n    // State for tracking collapsed headings (always included, but only used if collapse enabled)\n    collapsedHeadingsField,\n    // Frontmatter sheet open/closed state\n    frontmatterSheetField,\n    // Shared state for block ranges (computed once per doc change)\n    blockRangesField,\n    // ViewPlugins that read from the shared state\n    frontmatterDecorations,\n    imageDecorations,\n    hybridPreviewPlugin,\n    wikiLinkDecorations,\n    tagDecorations,\n    codeBlockDecorations,\n    tableDecorations,\n    footnoteBlockDecorations,\n    definitionListDecorations,\n    mathBlockDecorations,\n    mermaidBlockDecorations,\n  ];\n}\n","import { undo, redo } from '@codemirror/commands';\nimport { openSearchPanel, selectNextOccurrence as cmSelectNextOccurrence, selectSelectionMatches as cmSelectSelectionMatches } from '@codemirror/search';\n\nfunction focusReplaceField(view) {\n  requestAnimationFrame(() => {\n    const panel = view.dom.querySelector('.cm-search');\n    const replaceField = panel?.querySelector('input[name=\"replace\"]');\n    if (replaceField instanceof HTMLInputElement) {\n      replaceField.focus();\n      replaceField.select();\n    }\n  });\n}\n\n/**\n * Wrap selected text with prefix and suffix\n */\nfunction wrapSelection(view, before, after) {\n  const { from, to } = view.state.selection.main;\n  const text = view.state.sliceDoc(from, to);\n\n  view.dispatch({\n    changes: { from, to, insert: before + text + after },\n    selection: { anchor: from + before.length, head: to + before.length },\n  });\n}\n\n/**\n * Add prefix to the beginning of the current line\n */\nfunction prefixLine(view, prefix) {\n  const { from } = view.state.selection.main;\n  const line = view.state.doc.lineAt(from);\n\n  view.dispatch({\n    changes: { from: line.from, to: line.from, insert: prefix },\n  });\n}\n\n/**\n * Toggle heading prefix on the current line\n * If line has this heading, remove it\n * If line has different heading or no heading, set to this level\n */\nfunction toggleHeading(view, level) {\n  const { from } = view.state.selection.main;\n  const line = view.state.doc.lineAt(from);\n  const text = line.text;\n\n  // Match any heading prefix (# to ######)\n  const headingMatch = text.match(/^(#{1,6})\\s/);\n  const targetPrefix = '#'.repeat(level) + ' ';\n\n  if (headingMatch) {\n    const currentPrefix = headingMatch[0];\n    if (currentPrefix === targetPrefix) {\n      // Same heading level - remove it\n      view.dispatch({\n        changes: { from: line.from, to: line.from + currentPrefix.length, insert: '' },\n      });\n    } else {\n      // Different heading level - replace it\n      view.dispatch({\n        changes: { from: line.from, to: line.from + currentPrefix.length, insert: targetPrefix },\n      });\n    }\n  } else {\n    // No heading - add it\n    view.dispatch({\n      changes: { from: line.from, to: line.from, insert: targetPrefix },\n    });\n  }\n}\n\n/**\n * Toggle list prefix on the current line\n * Handles bullet (-), numbered (1.), and task (- [ ]) lists\n */\nfunction toggleList(view, type) {\n  const { from } = view.state.selection.main;\n  const line = view.state.doc.lineAt(from);\n  const text = line.text;\n\n  // Match list prefixes: bullet (- ), numbered (1. ), or task (- [ ] or - [x] )\n  const bulletMatch = text.match(/^(-|\\*|\\+)\\s(?!\\[[ xX]\\])/);\n  const numberedMatch = text.match(/^(\\d+)\\.\\s/);\n  const taskMatch = text.match(/^(-|\\*|\\+)\\s\\[[ xX]\\]\\s/);\n\n  const prefixes = {\n    bullet: '- ',\n    numbered: '1. ',\n    task: '- [ ] ',\n  };\n\n  const targetPrefix = prefixes[type];\n  let currentMatch = null;\n  let currentType = null;\n\n  if (taskMatch) {\n    currentMatch = taskMatch[0];\n    currentType = 'task';\n  } else if (numberedMatch) {\n    currentMatch = numberedMatch[0];\n    currentType = 'numbered';\n  } else if (bulletMatch) {\n    currentMatch = bulletMatch[0];\n    currentType = 'bullet';\n  }\n\n  if (currentMatch) {\n    if (currentType === type) {\n      // Same list type - remove it\n      view.dispatch({\n        changes: { from: line.from, to: line.from + currentMatch.length, insert: '' },\n      });\n    } else {\n      // Different list type - replace it\n      view.dispatch({\n        changes: { from: line.from, to: line.from + currentMatch.length, insert: targetPrefix },\n      });\n    }\n  } else {\n    // No list prefix - add it\n    view.dispatch({\n      changes: { from: line.from, to: line.from, insert: targetPrefix },\n    });\n  }\n}\n\n/**\n * Insert text at cursor position\n */\nfunction insertAt(view, text) {\n  const { from, to } = view.state.selection.main;\n  view.dispatch({\n    changes: { from, to, insert: text },\n  });\n}\n\n/**\n * Get currently selected text\n */\nfunction getSelection(view) {\n  const { from, to } = view.state.selection.main;\n  return from !== to ? view.state.sliceDoc(from, to) : null;\n}\n\n/**\n * Toolbar formatting actions\n */\nexport const actions = {\n  undo(view) {\n    undo(view);\n  },\n\n  redo(view) {\n    redo(view);\n  },\n\n  search(view) {\n    openSearchPanel(view);\n  },\n\n  replace(view) {\n    openSearchPanel(view);\n    focusReplaceField(view);\n  },\n\n  selectNextOccurrence(view) {\n    cmSelectNextOccurrence(view);\n  },\n\n  selectAllOccurrences(view) {\n    if (view.state.selection.main.empty) {\n      cmSelectNextOccurrence(view);\n    }\n    cmSelectSelectionMatches(view);\n  },\n\n  bold(view) {\n    wrapSelection(view, '**', '**');\n  },\n\n  italic(view) {\n    wrapSelection(view, '_', '_');\n  },\n\n  strikethrough(view) {\n    wrapSelection(view, '~~', '~~');\n  },\n\n  h1(view) {\n    toggleHeading(view, 1);\n  },\n\n  h2(view) {\n    toggleHeading(view, 2);\n  },\n\n  h3(view) {\n    toggleHeading(view, 3);\n  },\n\n  link(view) {\n    const selection = getSelection(view);\n    const exampleUrl = 'https://example.com';\n    if (selection) {\n      const { from, to } = view.state.selection.main;\n      view.dispatch({\n        changes: { from, to, insert: `[${selection}](${exampleUrl})` },\n        selection: { anchor: from + selection.length + 3, head: from + selection.length + 3 + exampleUrl.length },\n      });\n    } else {\n      const { from } = view.state.selection.main;\n      view.dispatch({\n        changes: { from, insert: `[link text](${exampleUrl})` },\n        selection: { anchor: from + 1, head: from + 10 },\n      });\n    }\n  },\n\n  image(view) {\n    const { from } = view.state.selection.main;\n    const exampleUrl = 'https://placehold.co/400x200';\n    view.dispatch({\n      changes: { from, insert: `![alt text](${exampleUrl})` },\n      selection: { anchor: from + 2, head: from + 10 },\n    });\n  },\n\n  bulletList(view) {\n    toggleList(view, 'bullet');\n  },\n\n  numberedList(view) {\n    toggleList(view, 'numbered');\n  },\n\n  taskList(view) {\n    toggleList(view, 'task');\n  },\n\n  inlineCode(view) {\n    wrapSelection(view, '`', '`');\n  },\n\n  codeBlock(view) {\n    const { from, to } = view.state.selection.main;\n    const text = view.state.sliceDoc(from, to);\n    const sampleCode = `javascript\nfunction hello() {\n  alert(\"hello world\");\n}\nhello();`;\n    const newText = text ? '```\\n' + text + '\\n```' : '```' + sampleCode + '\\n```';\n\n    view.dispatch({\n      changes: { from, to, insert: newText },\n      selection: { anchor: from + 4 },\n    });\n  },\n\n  hr(view) {\n    const { from } = view.state.selection.main;\n    const line = view.state.doc.lineAt(from);\n\n    view.dispatch({\n      changes: { from: line.to, insert: '\\n\\n---\\n' },\n    });\n  },\n\n  quote(view) {\n    prefixLine(view, '> ');\n  },\n\n  table(view) {\n    const { from } = view.state.selection.main;\n    const line = view.state.doc.lineAt(from);\n    const sampleTable = `| Column 1 | Column 2 | Column 3 |\n|----------|----------|----------|\n| Cell 1   | Cell 2   | Cell 3   |\n| Cell 4   | Cell 5   | Cell 6   |`;\n\n    view.dispatch({\n      changes: { from: line.to, insert: '\\n\\n' + sampleTable + '\\n' },\n      selection: { anchor: line.to + 4 },\n    });\n  },\n\n  diagram(view) {\n    const { from } = view.state.selection.main;\n    const line = view.state.doc.lineAt(from);\n    const sampleDiagram = `\\`\\`\\`mermaid\nflowchart LR\n    A[Start] --> B[Process]\n    B --> C{Decision}\n    C -->|Yes| D[Result 1]\n    C -->|No| E[Result 2]\n\\`\\`\\``;\n\n    view.dispatch({\n      changes: { from: line.to, insert: '\\n\\n' + sampleDiagram + '\\n' },\n      selection: { anchor: line.to + 4 },\n    });\n  },\n\n  emoji(view) {\n    const { from } = view.state.selection.main;\n    view.dispatch({\n      changes: { from, insert: ':smile:' },\n      selection: { anchor: from + 1, head: from + 6 },\n    });\n  },\n};\n","/**\n * Shared state for writing mode features.\n * Both index.js and writing-mode-sheet.js import from here to avoid circular dependencies.\n */\n\nimport { Facet, StateEffect, StateField } from '@codemirror/state';\n\n/**\n * Facet for providing initial writing mode config.\n * index.js populates this so writingModeField can read initial values.\n */\nexport const writingModeConfigFacet = Facet.define({\n  combine(values) {\n    if (values.length === 0) return {};\n    return values[values.length - 1];\n  },\n});\n\n/** Effect: toggle writing mode sheet open/close */\nexport const setWritingModeSheetEffect = StateEffect.define();\n\n/** Effect: set typewriter mode */\nexport const setTypewriterEffect = StateEffect.define();\n\n/** Effect: set focus mode */\nexport const setFocusModeEffect = StateEffect.define();\n\n/** Effect: set focus level ('line'|'sentence'|'paragraph') */\nexport const setFocusLevelEffect = StateEffect.define();\n\n/** Effect: set dim intensity (0-100) */\nexport const setDimIntensityEffect = StateEffect.define();\n\n/**\n * StateField tracking all writing-mode-related state.\n * Responds to the effects above.\n */\nexport const writingModeField = StateField.define({\n  create(state) {\n    const config = state.facet(writingModeConfigFacet);\n    return {\n      writingModeSheet: false,\n      typewriter: config.typewriter === true,\n      focusMode: config.focusMode === true,\n      focusLevel: config.focusLevel || 'paragraph',\n      dimIntensity: config.dimIntensity != null ? config.dimIntensity : 30,\n    };\n  },\n  update(value, tr) {\n    for (const effect of tr.effects) {\n      if (effect.is(setWritingModeSheetEffect)) {\n        value = { ...value, writingModeSheet: effect.value };\n      } else if (effect.is(setTypewriterEffect)) {\n        value = { ...value, typewriter: effect.value };\n      } else if (effect.is(setFocusModeEffect)) {\n        value = { ...value, focusMode: effect.value };\n      } else if (effect.is(setFocusLevelEffect)) {\n        value = { ...value, focusLevel: effect.value };\n      } else if (effect.is(setDimIntensityEffect)) {\n        value = { ...value, dimIntensity: effect.value };\n      }\n    }\n    return value;\n  },\n});\n","import { keymap } from '@codemirror/view';\nimport { actions } from './actions.js';\nimport {\n  setTypewriterEffect,\n  setFocusModeEffect,\n  writingModeField,\n} from './writing-mode-state.js';\n\nexport const markdownKeymap = keymap.of([\n  {\n    key: 'Mod-Shift-t',\n    run: (view) => {\n      const current = view.state.field(writingModeField).typewriter;\n      view.dispatch({ effects: setTypewriterEffect.of(!current) });\n      return true;\n    },\n  },\n  {\n    key: 'Mod-Shift-f',\n    run: (view) => {\n      const current = view.state.field(writingModeField).focusMode;\n      view.dispatch({ effects: setFocusModeEffect.of(!current) });\n      return true;\n    },\n  },\n  {\n    key: 'Mod-b',\n    run: (view) => {\n      actions.bold(view);\n      return true;\n    },\n  },\n  {\n    key: 'Mod-i',\n    run: (view) => {\n      actions.italic(view);\n      return true;\n    },\n  },\n  {\n    key: 'Mod-k',\n    run: (view) => {\n      actions.link(view);\n      return true;\n    },\n  },\n  {\n    key: 'Mod-`',\n    run: (view) => {\n      actions.inlineCode(view);\n      return true;\n    },\n  },\n  {\n    key: 'Mod-Shift-`',\n    run: (view) => {\n      actions.codeBlock(view);\n      return true;\n    },\n  },\n]);\n","import { Decoration, ViewPlugin } from '@codemirror/view';\n\n/**\n * Custom extension to highlight all selected lines (only when editor is focused)\n */\nconst selectedLineDecoration = Decoration.line({ class: 'cm-selectedLine' });\n\nexport const highlightSelectedLines = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      this.decorations = this.buildDecorations(view);\n    }\n\n    update(update) {\n      if (update.docChanged || update.selectionSet || update.focusChanged) {\n        this.decorations = this.buildDecorations(update.view);\n      }\n    }\n\n    buildDecorations(view) {\n      // Only highlight when editor is focused\n      if (!view.hasFocus) {\n        return Decoration.none;\n      }\n\n      const decorations = [];\n      const selectedLines = new Set();\n      const state = view.state;\n\n      for (const range of state.selection.ranges) {\n        const startLine = state.doc.lineAt(range.from).number;\n        const endLine = state.doc.lineAt(range.to).number;\n        for (let i = startLine; i <= endLine; i++) {\n          selectedLines.add(i);\n        }\n      }\n\n      for (const lineNum of selectedLines) {\n        const line = state.doc.line(lineNum);\n        decorations.push(selectedLineDecoration.range(line.from));\n      }\n\n      return Decoration.set(decorations, true);\n    }\n  },\n  {\n    decorations: (v) => v.decorations,\n  }\n);\n","import { ViewPlugin } from '@codemirror/view';\n\n/**\n * Typewriter mode plugin - keeps the cursor line vertically centered\n * in the viewport while typing or navigating.\n *\n * Uses requestMeasure to avoid layout thrashing and infinite update loops.\n */\nexport const typewriterPlugin = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      this.view = view;\n    }\n\n    update(update) {\n      if (!update.selectionSet && !update.docChanged && !update.geometryChanged) {\n        return;\n      }\n\n      this.view.requestMeasure({\n        key: 'typewriter-scroll',\n        read: (view) => {\n          const head = view.state.selection.main.head;\n          const coords = view.coordsAtPos(head);\n          if (!coords) return null;\n\n          const rect = view.scrollDOM.getBoundingClientRect();\n          const viewportCenter = rect.top + rect.height / 2;\n          const diff = coords.top - viewportCenter;\n\n          if (Math.abs(diff) < 2) return null;\n          return diff;\n        },\n        write: (diff, view) => {\n          if (diff == null) return;\n          view.scrollDOM.scrollBy({ top: diff, behavior: 'auto' });\n        },\n      });\n    }\n  }\n);\n","import { ViewPlugin, Decoration } from '@codemirror/view';\nimport { RangeSet } from '@codemirror/state';\n\nconst unfocusedLine = Decoration.line({ class: 'cm-unfocused-line' });\n\n/**\n * Find the paragraph boundaries (blank-line delimited) around a position.\n * Returns { from: lineNumber, to: lineNumber } (1-based line numbers).\n */\nfunction findParagraphRange(doc, pos) {\n  const line = doc.lineAt(pos);\n  let from = line.number;\n  let to = line.number;\n\n  // Walk up to find first blank line or start of doc\n  while (from > 1) {\n    const prev = doc.line(from - 1);\n    if (prev.text.trim() === '') break;\n    from--;\n  }\n\n  // Walk down to find next blank line or end of doc\n  while (to < doc.lines) {\n    const next = doc.line(to + 1);\n    if (next.text.trim() === '') break;\n    to++;\n  }\n\n  return { from, to };\n}\n\n/**\n * Find the sentence boundaries around a position.\n * Returns { from: lineNumber, to: lineNumber } (1-based line numbers).\n * A sentence ends at `. `, `! `, `? ` or at a blank line boundary.\n */\nfunction findSentenceRange(doc, pos) {\n  const fullText = doc.toString();\n\n  // Find sentence start: walk backwards from pos to find sentence boundary\n  let sentenceStart = 0;\n  for (let i = pos - 1; i >= 0; i--) {\n    const ch = fullText[i];\n    // Check for sentence-ending punctuation followed by space (we're at the space or after)\n    if ((ch === '.' || ch === '!' || ch === '?') && i + 1 < fullText.length && /\\s/.test(fullText[i + 1])) {\n      sentenceStart = i + 1;\n      // Skip whitespace after punctuation\n      while (sentenceStart < pos && /\\s/.test(fullText[sentenceStart])) sentenceStart++;\n      break;\n    }\n    // Blank line = paragraph boundary = sentence boundary\n    if (ch === '\\n' && i > 0 && fullText[i - 1] === '\\n') {\n      sentenceStart = i + 1;\n      break;\n    }\n  }\n\n  // Find sentence end: walk forward from pos\n  let sentenceEnd = fullText.length;\n  for (let i = pos; i < fullText.length; i++) {\n    const ch = fullText[i];\n    if ((ch === '.' || ch === '!' || ch === '?') && (i + 1 >= fullText.length || /\\s/.test(fullText[i + 1]))) {\n      sentenceEnd = i + 1;\n      break;\n    }\n    // Blank line boundary\n    if (ch === '\\n' && i + 1 < fullText.length && fullText[i + 1] === '\\n') {\n      sentenceEnd = i;\n      break;\n    }\n  }\n\n  // Convert character offsets to line numbers\n  const fromLine = doc.lineAt(Math.max(0, sentenceStart)).number;\n  const toLine = doc.lineAt(Math.min(fullText.length, Math.max(sentenceStart, sentenceEnd - 1))).number;\n\n  return { from: fromLine, to: toLine };\n}\n\n/**\n * Create a focus mode plugin configured for a specific level and intensity.\n * @param {'line'|'sentence'|'paragraph'} level - Focus granularity\n * @param {number} intensity - Dim intensity 0-100 (higher = more dim)\n * @returns {ViewPlugin}\n */\nexport function createFocusModePlugin(level = 'paragraph', intensity = 30) {\n  return ViewPlugin.fromClass(\n    class {\n      constructor(view) {\n        this.setIntensity(view, intensity);\n        this.decorations = this.buildDecorations(view);\n      }\n\n      update(update) {\n        if (\n          update.selectionSet ||\n          update.docChanged ||\n          update.focusChanged\n        ) {\n          this.decorations = this.buildDecorations(update.view);\n        }\n      }\n\n      setIntensity(view, value) {\n        // Convert intensity (0-100, higher=more dim) to opacity (0-1, lower=more dim)\n        const opacity = Math.max(0, Math.min(1, 1 - value / 100));\n        view.dom.style.setProperty('--cm-unfocused-opacity', String(opacity));\n      }\n\n      buildDecorations(view) {\n        if (!view.hasFocus) {\n          return RangeSet.empty;\n        }\n\n        const doc = view.state.doc;\n        const activeLines = new Set();\n\n        for (const range of view.state.selection.ranges) {\n          let result;\n          if (level === 'line') {\n            const line = doc.lineAt(range.head);\n            result = { from: line.number, to: line.number };\n          } else if (level === 'sentence') {\n            result = findSentenceRange(doc, range.head);\n          } else {\n            result = findParagraphRange(doc, range.head);\n          }\n          for (let i = result.from; i <= result.to; i++) {\n            activeLines.add(i);\n          }\n        }\n\n        const decorations = [];\n        for (let i = 1; i <= doc.lines; i++) {\n          if (!activeLines.has(i)) {\n            const line = doc.line(i);\n            decorations.push(unfocusedLine.range(line.from));\n          }\n        }\n\n        return RangeSet.of(decorations);\n      }\n\n      destroy() {\n        // Clean up CSS variable\n      }\n    },\n    {\n      decorations: (v) => v.decorations,\n    }\n  );\n}\n\n/**\n * Focus mode plugin - dims all paragraphs except the one(s) containing cursors.\n * Applies `cm-unfocused-line` decoration to non-active lines.\n * Only active when the editor has focus.\n * @deprecated Use createFocusModePlugin() for configurable focus levels\n */\nexport const focusModePlugin = createFocusModePlugin('paragraph', 30);\n","/**\n * Word Count / Character Count / Reading Time Panel\n *\n * A bottom status bar showing live writing statistics:\n * - Word count\n * - Character count (with and without spaces)\n * - Estimated reading time\n * - Selection stats when text is selected\n */\n\nimport { showPanel } from '@codemirror/view';\n\n/**\n * Compute document and selection statistics\n */\nfunction computeStats(doc, selection) {\n  const text = doc.toString();\n  const words = text.split(/\\s+/).filter(w => w.length > 0).length;\n  const chars = text.length;\n  const charsNoSpaces = text.replace(/\\s/g, '').length;\n  const readingTime = Math.max(1, Math.ceil(words / 238));\n\n  let selWords = 0;\n  let selChars = 0;\n  const hasSelection = selection && !selection.main.empty;\n\n  if (hasSelection) {\n    const selText = doc.sliceString(selection.main.from, selection.main.to);\n    selWords = selText.split(/\\s+/).filter(w => w.length > 0).length;\n    selChars = selText.length;\n  }\n\n  return { words, chars, charsNoSpaces, readingTime, selWords, selChars, hasSelection };\n}\n\n/**\n * Format reading time as a human-readable string\n */\nfunction formatReadingTime(minutes) {\n  if (minutes < 1) return '< 1 min read';\n  if (minutes === 1) return '1 min read';\n  return `${minutes} min read`;\n}\n\n/**\n * Create a stat element (label + value)\n */\nfunction createStat(label, value) {\n  const stat = document.createElement('span');\n  stat.className = 'cm-word-count-stat';\n\n  const valueEl = document.createElement('span');\n  valueEl.className = 'cm-word-count-value';\n  valueEl.textContent = value;\n\n  const labelEl = document.createElement('span');\n  labelEl.className = 'cm-word-count-label';\n  labelEl.textContent = ` ${label}`;\n\n  stat.appendChild(valueEl);\n  stat.appendChild(labelEl);\n  return stat;\n}\n\n/**\n * Create a divider between stats\n */\nfunction createDivider() {\n  const div = document.createElement('span');\n  div.className = 'cm-word-count-divider';\n  return div;\n}\n\n/**\n * Create the word count panel extension\n */\nfunction wordCountPanelFactory(view) {\n  const dom = document.createElement('div');\n  dom.className = 'cm-word-count-panel';\n\n  function render(state) {\n    const stats = computeStats(state.doc, state.selection);\n    dom.textContent = '';\n\n    dom.appendChild(createStat('words', stats.words.toLocaleString()));\n    dom.appendChild(createDivider());\n    dom.appendChild(createStat('characters', stats.chars.toLocaleString()));\n    dom.appendChild(createDivider());\n    dom.appendChild(createStat('', formatReadingTime(stats.readingTime)));\n\n    if (stats.hasSelection) {\n      dom.appendChild(createDivider());\n\n      const selStat = document.createElement('span');\n      selStat.className = 'cm-word-count-stat cm-word-count-selection';\n\n      const selValue = document.createElement('span');\n      selValue.className = 'cm-word-count-value';\n      selValue.textContent = `${stats.selWords} words, ${stats.selChars} chars`;\n\n      const selLabel = document.createElement('span');\n      selLabel.className = 'cm-word-count-label';\n      selLabel.textContent = ' selected';\n\n      selStat.appendChild(selValue);\n      selStat.appendChild(selLabel);\n      dom.appendChild(selStat);\n    }\n  }\n\n  render(view.state);\n\n  return {\n    dom,\n    top: false,\n    update(update) {\n      if (update.docChanged || update.selectionSet) {\n        render(update.state);\n      }\n    },\n  };\n}\n\n/**\n * The word count panel extension.\n * Use with a Compartment for toggling.\n */\nexport const wordCountPanel = showPanel.of(wordCountPanelFactory);\n","import { EditorView, showPanel } from '@codemirror/view';\nimport { undoDepth, redoDepth } from '@codemirror/commands';\nimport { actions } from './actions.js';\n\nconst defaultButtons = [\n  { icon: '‚Ü∂', title: 'Undo', action: 'undo' },\n  { icon: '‚Ü∑', title: 'Redo', action: 'redo' },\n  { icon: 'B', title: 'Bold', action: 'bold' },\n  { icon: 'I', title: 'Italic', action: 'italic' },\n  { icon: 'S', title: 'Strikethrough', action: 'strikethrough' },\n  { icon: 'H\\u2081', title: 'Heading 1', action: 'h1' },\n  { icon: 'H\\u2082', title: 'Heading 2', action: 'h2' },\n  { icon: 'H\\u2083', title: 'Heading 3', action: 'h3' },\n  { icon: '\\u{1F517}', title: 'Link', action: 'link' },\n  { icon: '\\u{1F5BC}', title: 'Image', action: 'image' },\n  { icon: '\\u2022', title: 'Bullet List', action: 'bulletList' },\n  { icon: '1.', title: 'Numbered List', action: 'numberedList' },\n  { icon: '\\u2611', title: 'Task List', action: 'taskList' },\n  { icon: '< >', title: 'Inline Code', action: 'inlineCode' },\n  { icon: '{ }', title: 'Code Block', action: 'codeBlock' },\n  { icon: '\\u2014', title: 'Horizontal Rule', action: 'hr' },\n  { icon: '\\u201C', title: 'Blockquote', action: 'quote' },\n  { icon: '\\u229E', title: 'Table', action: 'table' },\n];\n\nconst toolbarBaseTheme = EditorView.baseTheme({\n  '.cm-bottom-toolbar': {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '2px',\n    padding: '6px 8px',\n    paddingBottom: 'max(6px, env(safe-area-inset-bottom))',\n    overflowX: 'auto',\n    WebkitOverflowScrolling: 'touch',\n    scrollbarWidth: 'none',\n    whiteSpace: 'nowrap',\n    borderTop: '1px solid #dee2e6',\n    fontFamily: 'system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    background: '#f8f9fa',\n    overscrollBehaviorX: 'contain',\n    touchAction: 'pan-x',\n  },\n  '.cm-bottom-toolbar::-webkit-scrollbar': {\n    display: 'none',\n  },\n  '.cm-bottom-toolbar-btn': {\n    minWidth: '36px',\n    height: '36px',\n    flexShrink: '0',\n    display: 'inline-flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    border: 'none',\n    background: 'transparent',\n    borderRadius: '6px',\n    cursor: 'pointer',\n    fontSize: '15px',\n    color: 'inherit',\n    transition: 'background 0.1s',\n    padding: '0 4px',\n    fontFamily: 'inherit',\n  },\n  '.cm-bottom-toolbar-btn:hover': {\n    background: 'rgba(0, 0, 0, 0.08)',\n  },\n  '.cm-bottom-toolbar-btn:active': {\n    background: 'rgba(0, 0, 0, 0.15)',\n  },\n  '.cm-bottom-toolbar-btn:disabled': {\n    opacity: '0.3',\n    cursor: 'not-allowed',\n  },\n  // Dark mode\n  '&dark .cm-bottom-toolbar': {\n    background: '#252526',\n    borderTopColor: '#3c3c3c',\n    color: '#d4d4d4',\n  },\n  '&dark .cm-bottom-toolbar-btn:hover': {\n    background: 'rgba(255, 255, 255, 0.1)',\n  },\n  '&dark .cm-bottom-toolbar-btn:active': {\n    background: 'rgba(255, 255, 255, 0.18)',\n  },\n});\n\n/**\n * Create a bottom toolbar extension for the markdown editor.\n *\n * @param {Object} [options]\n * @param {Array} [options.buttons] - Override the default button set\n * @param {Array} [options.extraButtons] - Additional buttons appended after defaults.\n *   Each entry: { icon: string, title: string, handler: (view) => void }\n * @returns {Extension[]}\n */\nexport function bottomToolbar(options = {}) {\n  const buttons = options.buttons || defaultButtons;\n  const extraButtons = options.extraButtons || [];\n\n  const panelExtension = showPanel.of((view) => {\n    const dom = document.createElement('div');\n    dom.className = 'cm-bottom-toolbar';\n\n    const buttonsByAction = new Map();\n\n    for (const btn of buttons) {\n      const el = document.createElement('button');\n      el.className = 'cm-bottom-toolbar-btn';\n      el.textContent = btn.icon;\n      el.title = btn.title;\n\n      if (btn.action) {\n        buttonsByAction.set(btn.action, el);\n        el.addEventListener('click', (e) => {\n          e.preventDefault();\n          if (actions[btn.action]) {\n            actions[btn.action](view);\n            view.focus();\n          }\n        });\n      }\n\n      dom.appendChild(el);\n    }\n\n    // Extra buttons (custom handlers)\n    for (const btn of extraButtons) {\n      const el = document.createElement('button');\n      el.className = 'cm-bottom-toolbar-btn';\n      el.textContent = btn.icon;\n      el.title = btn.title;\n      el.addEventListener('click', (e) => {\n        e.preventDefault();\n        if (btn.handler) {\n          btn.handler(view);\n        }\n        view.focus();\n      });\n      dom.appendChild(el);\n    }\n\n    // Fallback for older iOS WebKit: prevent scroll chaining at boundaries\n    let touchStartX = 0;\n    dom.addEventListener('touchstart', (e) => {\n      touchStartX = e.touches[0].clientX;\n    }, { passive: true });\n    dom.addEventListener('touchmove', (e) => {\n      const dx = e.touches[0].clientX - touchStartX;\n      const atLeft = dom.scrollLeft <= 0;\n      const atRight = dom.scrollLeft + dom.clientWidth >= dom.scrollWidth - 1;\n      if ((atLeft && dx > 0) || (atRight && dx < 0)) {\n        e.preventDefault();\n      }\n    }, { passive: false });\n\n    const updateHistoryButtons = (state) => {\n      const undoBtn = buttonsByAction.get('undo');\n      if (undoBtn) {\n        undoBtn.disabled = undoDepth(state) === 0;\n      }\n      const redoBtn = buttonsByAction.get('redo');\n      if (redoBtn) {\n        redoBtn.disabled = redoDepth(state) === 0;\n      }\n    };\n\n    updateHistoryButtons(view.state);\n\n    return {\n      dom,\n      top: false,\n      update(update) {\n        updateHistoryButtons(update.state);\n      },\n    };\n  });\n\n  return [panelExtension, toolbarBaseTheme];\n}\n","/**\n * Backlinks / Linked Mentions Panel\n *\n * A bottom panel showing incoming links to the current document.\n * The consumer provides an async resolver that returns backlink data.\n */\n\nimport { showPanel } from '@codemirror/view';\nimport { Facet } from '@codemirror/state';\n\n/**\n * Configuration facet for backlinks panel\n */\nexport const backlinksFacet = Facet.define({\n  combine(values) {\n    if (values.length === 0) {\n      return { docTitle: null, onBacklinksRequested: null, onBacklinkClick: null };\n    }\n    return values[values.length - 1];\n  },\n});\n\n/**\n * Extract the title from YAML frontmatter in the document\n */\nfunction extractFrontmatterTitle(doc) {\n  if (doc.lines < 2) return null;\n  const firstLine = doc.line(1).text.trim();\n  if (firstLine !== '---') return null;\n\n  for (let i = 2; i <= doc.lines; i++) {\n    const text = doc.line(i).text.trim();\n    if (text === '---' || text === '...') {\n      // Found end of frontmatter, now look for title in lines 2..(i-1)\n      for (let j = 2; j < i; j++) {\n        const line = doc.line(j).text;\n        const match = line.match(/^title:\\s*(.+)$/);\n        if (match) {\n          let title = match[1].trim();\n          // Strip quotes if present\n          if ((title.startsWith('\"') && title.endsWith('\"')) ||\n              (title.startsWith(\"'\") && title.endsWith(\"'\"))) {\n            title = title.slice(1, -1);\n          }\n          return title;\n        }\n      }\n      return null;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Render backlink chips into the panel DOM\n */\nfunction renderBacklinks(dom, backlinks, onBacklinkClick) {\n  dom.textContent = '';\n\n  const label = document.createElement('span');\n  label.className = 'cm-backlinks-label';\n  label.textContent = 'Backlinks';\n  dom.appendChild(label);\n\n  if (!backlinks || backlinks.length === 0) {\n    const empty = document.createElement('span');\n    empty.className = 'cm-backlinks-empty';\n    empty.textContent = 'None';\n    dom.appendChild(empty);\n    return;\n  }\n\n  const list = document.createElement('span');\n  list.className = 'cm-backlinks-list';\n\n  for (const backlink of backlinks) {\n    const chip = document.createElement('span');\n    chip.className = 'cm-backlinks-link';\n    chip.textContent = backlink.title;\n    if (backlink.excerpt) {\n      chip.title = backlink.excerpt;\n    }\n    chip.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      if (onBacklinkClick) {\n        onBacklinkClick(backlink);\n      }\n    });\n    list.appendChild(chip);\n  }\n\n  dom.appendChild(list);\n}\n\n/**\n * Create the backlinks panel\n */\nfunction backlinksPanelFactory(view) {\n  const dom = document.createElement('div');\n  dom.className = 'cm-backlinks-panel';\n\n  const config = view.state.facet(backlinksFacet);\n  let lastTitle = null;\n  let currentRequest = 0;\n\n  function resolveTitle(state) {\n    const config = state.facet(backlinksFacet);\n    if (config.docTitle) return config.docTitle;\n    return extractFrontmatterTitle(state.doc);\n  }\n\n  async function fetchBacklinks(state) {\n    const config = state.facet(backlinksFacet);\n    if (!config.onBacklinksRequested) {\n      dom.textContent = '';\n      return;\n    }\n\n    const title = resolveTitle(state);\n    if (title === lastTitle) return;\n    lastTitle = title;\n\n    if (!title) {\n      renderBacklinks(dom, [], config.onBacklinkClick);\n      return;\n    }\n\n    // Show loading state\n    dom.textContent = '';\n    const loadingLabel = document.createElement('span');\n    loadingLabel.className = 'cm-backlinks-label';\n    loadingLabel.textContent = 'Backlinks';\n    dom.appendChild(loadingLabel);\n    const loading = document.createElement('span');\n    loading.className = 'cm-backlinks-empty';\n    loading.textContent = 'Loading\\u2026';\n    dom.appendChild(loading);\n\n    const requestId = ++currentRequest;\n\n    try {\n      const backlinks = await config.onBacklinksRequested(title);\n      // Only render if this is still the latest request\n      if (requestId === currentRequest) {\n        renderBacklinks(dom, backlinks, config.onBacklinkClick);\n      }\n    } catch {\n      if (requestId === currentRequest) {\n        renderBacklinks(dom, [], config.onBacklinkClick);\n      }\n    }\n  }\n\n  // Initial fetch\n  fetchBacklinks(view.state);\n\n  return {\n    dom,\n    top: false,\n    update(update) {\n      if (update.docChanged) {\n        fetchBacklinks(update.state);\n      }\n    },\n  };\n}\n\n/**\n * The backlinks panel extension.\n * Use with a Compartment for toggling.\n *\n * Requires backlinksFacet to be configured with onBacklinksRequested callback.\n */\nexport const backlinksPanel = showPanel.of(backlinksPanelFactory);\n","/**\n * Frontmatter Sheet Overlay\n *\n * A slide-down overlay that displays the YAML frontmatter property table\n * on top of the editor content area. Managed by a ViewPlugin that appends\n * DOM to view.dom.\n */\n\nimport { ViewPlugin } from '@codemirror/view';\nimport { Facet } from '@codemirror/state';\nimport {\n  toggleSheetEffect,\n  frontmatterSheetField,\n  blockRangesField,\n  buildFrontmatterPropertyTable,\n} from './hybrid-preview.js';\nimport { allowReadOnlyEdit } from './read-only.js';\n\n/**\n * Facet for providing known frontmatter keys for autocomplete.\n * Consumers provide an array of strings.\n */\nexport const frontmatterKeysFacet = Facet.define({\n  combine(values) {\n    if (values.length === 0) return [];\n    return values[values.length - 1];\n  },\n});\n\nexport const frontmatterSheetPlugin = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      this.view = view;\n      this.backdrop = null;\n      this.sheet = null;\n      this.escHandler = null;\n      this.isOpen = view.state.field(frontmatterSheetField);\n      if (this.isOpen) this.open();\n    }\n\n    update(update) {\n      const wasOpen = this.isOpen;\n      this.isOpen = update.state.field(frontmatterSheetField);\n\n      if (!wasOpen && this.isOpen) {\n        this.open();\n      } else if (wasOpen && !this.isOpen) {\n        this.close();\n      } else if (this.isOpen && update.docChanged) {\n        this.rebuildContent();\n      }\n    }\n\n    open() {\n      const view = this.view;\n\n      // Create backdrop\n      this.backdrop = document.createElement('div');\n      this.backdrop.className = 'cm-frontmatter-sheet-backdrop';\n      this.backdrop.addEventListener('mousedown', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        view.dispatch({ effects: toggleSheetEffect.of(false) });\n      });\n\n      // Create sheet container\n      this.sheet = document.createElement('div');\n      this.sheet.className = 'cm-frontmatter-sheet';\n\n      // Header\n      const header = document.createElement('div');\n      header.className = 'cm-frontmatter-sheet-header';\n      const title = document.createElement('span');\n      title.className = 'cm-frontmatter-sheet-title';\n      title.textContent = 'Properties';\n      header.appendChild(title);\n\n      const closeBtn = document.createElement('button');\n      closeBtn.className = 'cm-frontmatter-sheet-close';\n      closeBtn.textContent = '\\u00d7';\n      closeBtn.title = 'Close';\n      closeBtn.addEventListener('mousedown', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n      });\n      closeBtn.addEventListener('click', (e) => {\n        e.stopPropagation();\n        view.dispatch({ effects: toggleSheetEffect.of(false) });\n      });\n      header.appendChild(closeBtn);\n\n      this.sheet.appendChild(header);\n\n      // Content area\n      this.contentEl = document.createElement('div');\n      this.contentEl.className = 'cm-frontmatter-sheet-content';\n      this.sheet.appendChild(this.contentEl);\n\n      this.buildContent();\n\n      // Append to view.dom (the .cm-editor element)\n      view.dom.appendChild(this.backdrop);\n      view.dom.appendChild(this.sheet);\n\n      // Lock scroll\n      view.scrollDOM.style.overflow = 'hidden';\n\n      // Escape key handler\n      this.escHandler = (e) => {\n        if (e.key === 'Escape') {\n          e.preventDefault();\n          e.stopPropagation();\n          view.dispatch({ effects: toggleSheetEffect.of(false) });\n        }\n      };\n      view.dom.addEventListener('keydown', this.escHandler, true);\n\n      // Trigger animation on next frame\n      requestAnimationFrame(() => {\n        if (this.backdrop) this.backdrop.classList.add('cm-frontmatter-sheet-backdrop-visible');\n        if (this.sheet) this.sheet.classList.add('cm-frontmatter-sheet-open');\n      });\n    }\n\n    close() {\n      const view = this.view;\n\n      // Unlock scroll\n      view.scrollDOM.style.overflow = '';\n\n      // Remove escape handler\n      if (this.escHandler) {\n        view.dom.removeEventListener('keydown', this.escHandler, true);\n        this.escHandler = null;\n      }\n\n      // Animate out\n      if (this.sheet) this.sheet.classList.remove('cm-frontmatter-sheet-open');\n      if (this.backdrop) this.backdrop.classList.remove('cm-frontmatter-sheet-backdrop-visible');\n\n      // Remove DOM after animation\n      const sheet = this.sheet;\n      const backdrop = this.backdrop;\n      setTimeout(() => {\n        sheet?.remove();\n        backdrop?.remove();\n      }, 200);\n\n      this.sheet = null;\n      this.backdrop = null;\n      this.contentEl = null;\n    }\n\n    buildContent() {\n      if (!this.contentEl) return;\n      this.contentEl.innerHTML = '';\n\n      const state = this.view.state;\n      const blockRanges = state.field(blockRangesField);\n      const { frontmatter } = blockRanges;\n\n      if (!frontmatter) {\n        // No frontmatter ‚Äî show empty state with add button\n        const empty = document.createElement('div');\n        empty.className = 'cm-frontmatter-sheet-empty';\n        empty.textContent = 'No frontmatter in this document.';\n        this.contentEl.appendChild(empty);\n\n        const addBtn = document.createElement('button');\n        addBtn.className = 'cm-frontmatter-sheet-add-btn';\n        addBtn.textContent = 'Add Frontmatter';\n        addBtn.addEventListener('click', (e) => {\n          e.stopPropagation();\n          this.view.dispatch({\n            changes: { from: 0, to: 0, insert: '---\\n---\\n' },\n            annotations: allowReadOnlyEdit.of(true),\n          });\n        });\n        this.contentEl.appendChild(addBtn);\n        return;\n      }\n\n      // Compute content range\n      const hasContent = frontmatter.end - frontmatter.start > 1;\n      const contentFrom = hasContent\n        ? state.doc.line(frontmatter.start + 1).from\n        : state.doc.line(frontmatter.start).to + 1;\n      const contentTo = hasContent\n        ? state.doc.line(frontmatter.end - 1).to\n        : contentFrom;\n\n      const yamlLines = [];\n      for (let j = frontmatter.start + 1; j < frontmatter.end; j++) {\n        yamlLines.push(state.doc.line(j).text);\n      }\n      const yamlContent = yamlLines.join('\\n');\n      const blockFrom = state.doc.line(frontmatter.start).from;\n\n      const knownKeys = this.view.state.facet(frontmatterKeysFacet);\n      const { dom } = buildFrontmatterPropertyTable(\n        yamlContent, contentFrom, contentTo, blockFrom, this.view,\n        { knownKeys }\n      );\n      this.contentEl.appendChild(dom);\n    }\n\n    rebuildContent() {\n      this.buildContent();\n    }\n\n    destroy() {\n      if (this.isOpen) {\n        if (this.escHandler) {\n          this.view.dom.removeEventListener('keydown', this.escHandler, true);\n        }\n        this.sheet?.remove();\n        this.backdrop?.remove();\n        this.view.scrollDOM.style.overflow = '';\n      }\n    }\n  }\n);\n","/**\n * Writing Mode Sheet Overlay\n *\n * A slide-up bottom sheet that provides unified controls for writing modes:\n * mode selection (Normal/Typewriter/Focus/Both), focus level (Line/Sentence/Paragraph),\n * and dim intensity slider. Modeled on frontmatter-sheet.js.\n */\n\nimport { ViewPlugin } from '@codemirror/view';\nimport {\n  writingModeField,\n  setWritingModeSheetEffect,\n  setTypewriterEffect,\n  setFocusModeEffect,\n  setFocusLevelEffect,\n  setDimIntensityEffect,\n} from './writing-mode-state.js';\n\nconst isMac = typeof navigator !== 'undefined' && /Mac/.test(navigator.platform);\nconst modKey = isMac ? '\\u2318' : 'Ctrl+';\n\nexport const writingModeSheetPlugin = ViewPlugin.fromClass(\n  class {\n    constructor(view) {\n      this.view = view;\n      this.backdrop = null;\n      this.sheet = null;\n      this.escHandler = null;\n      this.isOpen = view.state.field(writingModeField).writingModeSheet;\n      if (this.isOpen) this.open();\n    }\n\n    update(update) {\n      const wasOpen = this.isOpen;\n      const state = update.state.field(writingModeField);\n      this.isOpen = state.writingModeSheet;\n\n      if (!wasOpen && this.isOpen) {\n        this.open();\n      } else if (wasOpen && !this.isOpen) {\n        this.close();\n      } else if (this.isOpen) {\n        // Rebuild content if state changed (mode toggled, level changed, etc.)\n        this.rebuildContent();\n      }\n    }\n\n    open() {\n      const view = this.view;\n\n      // Create backdrop\n      this.backdrop = document.createElement('div');\n      this.backdrop.className = 'cm-writing-mode-sheet-backdrop';\n      this.backdrop.addEventListener('mousedown', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        view.dispatch({ effects: setWritingModeSheetEffect.of(false) });\n      });\n\n      // Create sheet container\n      this.sheet = document.createElement('div');\n      this.sheet.className = 'cm-writing-mode-sheet';\n\n      // Header\n      const header = document.createElement('div');\n      header.className = 'cm-writing-mode-sheet-header';\n\n      const title = document.createElement('span');\n      title.className = 'cm-writing-mode-sheet-title';\n      title.textContent = 'Writing Mode';\n      header.appendChild(title);\n\n      const closeBtn = document.createElement('button');\n      closeBtn.className = 'cm-writing-mode-sheet-close';\n      closeBtn.textContent = '\\u00d7';\n      closeBtn.title = 'Close';\n      closeBtn.addEventListener('mousedown', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n      });\n      closeBtn.addEventListener('click', (e) => {\n        e.stopPropagation();\n        view.dispatch({ effects: setWritingModeSheetEffect.of(false) });\n      });\n      header.appendChild(closeBtn);\n\n      this.sheet.appendChild(header);\n\n      // Content area\n      this.contentEl = document.createElement('div');\n      this.contentEl.className = 'cm-writing-mode-sheet-content';\n      this.sheet.appendChild(this.contentEl);\n\n      this.buildContent();\n\n      // Append to view.dom\n      view.dom.appendChild(this.backdrop);\n      view.dom.appendChild(this.sheet);\n\n      // Lock scroll\n      view.scrollDOM.style.overflow = 'hidden';\n\n      // Escape key handler\n      this.escHandler = (e) => {\n        if (e.key === 'Escape') {\n          e.preventDefault();\n          e.stopPropagation();\n          view.dispatch({ effects: setWritingModeSheetEffect.of(false) });\n        }\n      };\n      view.dom.addEventListener('keydown', this.escHandler, true);\n\n      // Trigger slide-up animation\n      requestAnimationFrame(() => {\n        if (this.backdrop) this.backdrop.classList.add('cm-writing-mode-sheet-backdrop-visible');\n        if (this.sheet) this.sheet.classList.add('cm-writing-mode-sheet-open');\n      });\n    }\n\n    close() {\n      const view = this.view;\n\n      view.scrollDOM.style.overflow = '';\n\n      if (this.escHandler) {\n        view.dom.removeEventListener('keydown', this.escHandler, true);\n        this.escHandler = null;\n      }\n\n      if (this.sheet) this.sheet.classList.remove('cm-writing-mode-sheet-open');\n      if (this.backdrop) this.backdrop.classList.remove('cm-writing-mode-sheet-backdrop-visible');\n\n      const sheet = this.sheet;\n      const backdrop = this.backdrop;\n      setTimeout(() => {\n        sheet?.remove();\n        backdrop?.remove();\n      }, 200);\n\n      this.sheet = null;\n      this.backdrop = null;\n      this.contentEl = null;\n    }\n\n    buildContent() {\n      if (!this.contentEl) return;\n      this.contentEl.innerHTML = '';\n\n      const view = this.view;\n      const state = view.state.field(writingModeField);\n      const { typewriter, focusMode, focusLevel, dimIntensity } = state;\n\n      // Determine current mode\n      let currentMode = 'normal';\n      if (typewriter && focusMode) currentMode = 'both';\n      else if (typewriter) currentMode = 'typewriter';\n      else if (focusMode) currentMode = 'focus';\n\n      // === MODE SECTION ===\n      const modeSection = this.createSection('MODE');\n      const modeOptions = document.createElement('div');\n      modeOptions.className = 'cm-writing-mode-options';\n\n      const modes = [\n        { id: 'normal', label: 'Normal', icon: '\\u2014' },\n        { id: 'typewriter', label: 'Typewriter', icon: '\\u2338' },\n        { id: 'focus', label: 'Focus', icon: '\\u25CE' },\n        { id: 'both', label: 'Both', icon: '\\u29BF' },\n      ];\n\n      for (const mode of modes) {\n        const btn = document.createElement('button');\n        btn.className = 'cm-writing-mode-option';\n        if (mode.id === currentMode) btn.classList.add('cm-writing-mode-option-active');\n        btn.title = mode.label;\n\n        const icon = document.createElement('span');\n        icon.className = 'cm-writing-mode-option-icon';\n        icon.textContent = mode.icon;\n        btn.appendChild(icon);\n\n        const label = document.createElement('span');\n        label.className = 'cm-writing-mode-option-label';\n        label.textContent = mode.label;\n        btn.appendChild(label);\n\n        btn.addEventListener('mousedown', (e) => e.preventDefault());\n        btn.addEventListener('click', (e) => {\n          e.stopPropagation();\n          const tw = mode.id === 'typewriter' || mode.id === 'both';\n          const fm = mode.id === 'focus' || mode.id === 'both';\n          view.dispatch({\n            effects: [\n              setTypewriterEffect.of(tw),\n              setFocusModeEffect.of(fm),\n            ],\n          });\n        });\n\n        modeOptions.appendChild(btn);\n      }\n\n      modeSection.appendChild(modeOptions);\n      this.contentEl.appendChild(modeSection);\n\n      // === FOCUS LEVEL SECTION (only when focus mode is active) ===\n      if (focusMode) {\n        const levelSection = this.createSection('FOCUS LEVEL');\n        const pills = document.createElement('div');\n        pills.className = 'cm-writing-mode-pills';\n\n        const levels = [\n          { id: 'line', label: 'Line' },\n          { id: 'sentence', label: 'Sentence' },\n          { id: 'paragraph', label: 'Paragraph' },\n        ];\n\n        for (const lvl of levels) {\n          const pill = document.createElement('button');\n          pill.className = 'cm-writing-mode-pill';\n          if (lvl.id === focusLevel) pill.classList.add('cm-writing-mode-pill-active');\n          pill.textContent = lvl.label;\n\n          pill.addEventListener('mousedown', (e) => e.preventDefault());\n          pill.addEventListener('click', (e) => {\n            e.stopPropagation();\n            view.dispatch({ effects: setFocusLevelEffect.of(lvl.id) });\n          });\n\n          pills.appendChild(pill);\n        }\n\n        levelSection.appendChild(pills);\n        this.contentEl.appendChild(levelSection);\n\n        // === DIM INTENSITY SECTION ===\n        const dimSection = this.createSection(`DIM INTENSITY: ${dimIntensity}%`);\n        this.dimLabel = dimSection.querySelector('.cm-writing-mode-section-label');\n\n        const sliderWrap = document.createElement('div');\n        sliderWrap.className = 'cm-writing-mode-slider-wrap';\n\n        const slider = document.createElement('input');\n        slider.type = 'range';\n        slider.className = 'cm-writing-mode-slider';\n        slider.min = '0';\n        slider.max = '100';\n        slider.value = String(dimIntensity);\n\n        slider.addEventListener('mousedown', (e) => e.stopPropagation());\n        slider.addEventListener('input', (e) => {\n          e.stopPropagation();\n          const val = Number(e.target.value);\n          if (this.dimLabel) {\n            this.dimLabel.textContent = `DIM INTENSITY: ${val}%`;\n          }\n          view.dispatch({ effects: setDimIntensityEffect.of(val) });\n        });\n\n        const labels = document.createElement('div');\n        labels.className = 'cm-writing-mode-slider-labels';\n        const lessLabel = document.createElement('span');\n        lessLabel.textContent = 'Less dim';\n        const moreLabel = document.createElement('span');\n        moreLabel.textContent = 'More dim';\n        labels.appendChild(lessLabel);\n        labels.appendChild(moreLabel);\n\n        sliderWrap.appendChild(slider);\n        sliderWrap.appendChild(labels);\n        dimSection.appendChild(sliderWrap);\n        this.contentEl.appendChild(dimSection);\n      }\n\n      // === SHORTCUTS SECTION ===\n      const shortcuts = document.createElement('div');\n      shortcuts.className = 'cm-writing-mode-shortcuts';\n\n      const shortcutLabel = document.createElement('span');\n      shortcutLabel.className = 'cm-writing-mode-shortcuts-label';\n      shortcutLabel.textContent = 'Shortcuts:';\n      shortcuts.appendChild(shortcutLabel);\n\n      const twKbd = document.createElement('kbd');\n      twKbd.className = 'cm-writing-mode-kbd';\n      twKbd.textContent = `${modKey}Shift+T`;\n      shortcuts.appendChild(twKbd);\n\n      const twDesc = document.createElement('span');\n      twDesc.className = 'cm-writing-mode-kbd-desc';\n      twDesc.textContent = 'Typewriter';\n      shortcuts.appendChild(twDesc);\n\n      const fmKbd = document.createElement('kbd');\n      fmKbd.className = 'cm-writing-mode-kbd';\n      fmKbd.textContent = `${modKey}Shift+F`;\n      shortcuts.appendChild(fmKbd);\n\n      const fmDesc = document.createElement('span');\n      fmDesc.className = 'cm-writing-mode-kbd-desc';\n      fmDesc.textContent = 'Focus';\n      shortcuts.appendChild(fmDesc);\n\n      this.contentEl.appendChild(shortcuts);\n    }\n\n    createSection(labelText) {\n      const section = document.createElement('div');\n      section.className = 'cm-writing-mode-section';\n\n      const label = document.createElement('label');\n      label.className = 'cm-writing-mode-section-label';\n      label.textContent = labelText;\n      section.appendChild(label);\n\n      return section;\n    }\n\n    rebuildContent() {\n      this.buildContent();\n    }\n\n    destroy() {\n      if (this.isOpen) {\n        if (this.escHandler) {\n          this.view.dom.removeEventListener('keydown', this.escHandler, true);\n        }\n        this.sheet?.remove();\n        this.backdrop?.remove();\n        this.view.scrollDOM.style.overflow = '';\n      }\n    }\n  }\n);\n","import { EditorView } from '@codemirror/view';\n\n// Inject @keyframes for smooth preview transitions (not supported by EditorView.baseTheme)\nif (typeof document !== 'undefined') {\n  const style = document.createElement('style');\n  style.textContent = '@keyframes cmFadeIn { from { opacity: 0 } to { opacity: 1 } }';\n  document.head.appendChild(style);\n}\n\n/**\n * Base theme with all required styles for the hybrid markdown preview\n * These styles are bundled with the extension\n */\nexport const baseTheme = EditorView.baseTheme({\n  // Editor base\n  '&': {\n    height: '100%',\n    fontSize: '17px',\n  },\n  '.cm-content': {\n    fontFamily: 'Charter, \"Bitstream Charter\", \"Sitka Text\", Cambria, serif',\n    padding: '20px 48px',\n    lineHeight: '1.75',\n  },\n  '.cm-line': {\n    padding: '4px 0',\n  },\n  '.cm-scroller': {\n    overflow: 'auto',\n    fontFamily: 'Charter, \"Bitstream Charter\", \"Sitka Text\", Cambria, serif',\n  },\n  '&.cm-focused': {\n    outline: 'none',\n  },\n\n  // Markdown preview container\n  '.cm-markdown-preview': {\n    display: 'inline',\n    animation: 'cmFadeIn 0.12s ease-out',\n  },\n\n  // Headers\n  '.cm-markdown-preview .md-header': {\n    display: 'inline',\n    fontWeight: '600',\n    lineHeight: '1.4',\n  },\n  '.cm-markdown-preview .md-h1': {\n    fontSize: '2em',\n  },\n  '.cm-markdown-preview .md-h2': {\n    fontSize: '1.5em',\n  },\n  '.cm-markdown-preview .md-h3': {\n    fontSize: '1.25em',\n  },\n  '.cm-markdown-preview .md-h4': {\n    fontSize: '1.1em',\n  },\n  '.cm-markdown-preview .md-h5': {\n    fontSize: '1em',\n  },\n  '.cm-markdown-preview .md-h6': {\n    fontSize: '0.9em',\n  },\n\n  // Bold and italic\n  '.cm-markdown-preview strong': {\n    fontWeight: '700',\n  },\n  '.cm-markdown-preview em': {\n    fontStyle: 'italic',\n  },\n  '.cm-markdown-preview del': {\n    textDecoration: 'line-through',\n  },\n  '.cm-markdown-preview .md-highlight, .cm-markdown-preview mark': {\n    backgroundColor: '#fde68a',\n    color: 'inherit',\n    padding: '0 2px',\n    borderRadius: '3px',\n  },\n  '.cm-markdown-preview .md-subscript, .cm-markdown-preview sub': {\n    fontSize: '0.85em',\n    verticalAlign: 'sub',\n  },\n  '.cm-markdown-preview .md-superscript, .cm-markdown-preview sup': {\n    fontSize: '0.85em',\n    verticalAlign: 'super',\n  },\n\n  // Inline code\n  '.cm-markdown-preview code': {\n    padding: '2px 6px',\n    borderRadius: '4px',\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n    fontSize: '0.9em',\n  },\n\n  // Links\n  '.cm-markdown-preview a': {\n    textDecoration: 'none',\n    cursor: 'pointer',\n  },\n  '.cm-markdown-preview a:hover': {\n    textDecoration: 'underline',\n  },\n\n  // Images\n  '.cm-markdown-preview img': {\n    maxWidth: '100%',\n    height: 'auto',\n    borderRadius: '4px',\n  },\n\n  // Blockquotes\n  '.cm-markdown-preview .md-blockquote': {\n    display: 'inline',\n    fontStyle: 'italic',\n    paddingLeft: '16px',\n    marginLeft: '0',\n  },\n\n  // List items\n  '.cm-markdown-preview .md-list-item': {\n    display: 'inline',\n  },\n  '.cm-markdown-preview .md-list-marker': {\n    marginRight: '4px',\n  },\n\n  // Horizontal rule\n  '.cm-markdown-preview .md-hr, .cm-markdown-preview hr': {\n    display: 'block',\n    border: 'none',\n    margin: '16px 0',\n    height: '1px',\n  },\n\n  // Checkboxes\n  '.cm-markdown-preview input[type=\"checkbox\"]': {\n    width: '19.2px',\n    height: '19.2px',\n    marginRight: '6px',\n    cursor: 'pointer',\n  },\n  '.cm-markdown-preview .md-task-icon': {\n    display: 'inline-flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    width: '1.2em',\n    marginRight: '6px',\n    cursor: 'pointer',\n    userSelect: 'none',\n  },\n  '.cm-markdown-preview .md-task-idea': {\n    color: '#0ea5e9',\n  },\n  '.cm-markdown-preview .md-task-urgent': {\n    color: '#ef4444',\n  },\n  '.cm-markdown-preview .md-task-question': {\n    color: '#a855f7',\n  },\n  '.cm-markdown-preview .md-task-important': {\n    color: '#ec4899',\n  },\n  '.cm-markdown-preview .md-task-forwarded': {\n    color: '#3b82f6',\n  },\n  '.cm-markdown-preview .md-task-scheduled': {\n    color: '#f59e0b',\n  },\n\n  // Code block lines\n  '.cm-code-block-line': {\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n    fontSize: '0.9em',\n  },\n\n  // Highlighted code\n  '.cm-highlighted-code': {\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n  },\n\n  // Table preview container\n  '.cm-table-preview': {\n    display: 'block',\n    margin: '0',\n    animation: 'cmFadeIn 0.15s ease-out',\n  },\n\n  // Definition list preview\n  '.cm-definition-list-preview': {\n    display: 'block',\n    margin: '0',\n    animation: 'cmFadeIn 0.15s ease-out',\n  },\n  '.md-definition-list': {\n    margin: '4px 0 8px 0',\n  },\n  '.md-definition-list dt': {\n    fontWeight: '600',\n  },\n  '.md-definition-list dd': {\n    margin: '2px 0 6px 16px',\n  },\n\n  // Footnote preview\n  '.cm-footnote-preview': {\n    display: 'block',\n    margin: '4px 0',\n    animation: 'cmFadeIn 0.15s ease-out',\n  },\n  '.md-footnote-block': {\n    display: 'block',\n  },\n  '.md-footnote-line': {\n    display: 'block',\n  },\n  '.md-footnote-backref': {\n    display: 'block',\n  },\n  '.md-footnote-backref-link': {\n    cursor: 'pointer',\n    fontSize: '0.85em',\n  },\n  '.md-wikilink': {\n    cursor: 'pointer',\n    textDecoration: 'underline',\n    textUnderlineOffset: '2px',\n  },\n  '.cm-wikilink': {\n    textDecoration: 'underline',\n    textUnderlineOffset: '2px',\n  },\n\n  // Table styling\n  '.md-table': {\n    borderCollapse: 'collapse',\n    borderRadius: '6px',\n    overflow: 'hidden',\n  },\n  '.md-table th, .md-table td': {\n    padding: '8px 12px',\n    textAlign: 'left',\n  },\n  '.md-table th': {\n    fontWeight: '600',\n  },\n\n  // Legacy single-line table styles\n  '.cm-markdown-preview .md-table-row': {\n    display: 'inline-flex',\n    borderRadius: '4px',\n  },\n  '.cm-markdown-preview .md-table-cell': {\n    display: 'inline-block',\n    padding: '6px 12px',\n    minWidth: '80px',\n  },\n  '.cm-markdown-preview .md-table-cell:last-child': {\n    borderRight: 'none',\n  },\n  '.cm-markdown-preview .md-table-separator': {\n    display: 'none',\n  },\n\n  // Math block preview\n  '.cm-math-preview': {\n    display: 'block',\n    padding: '8px 0',\n    animation: 'cmFadeIn 0.15s ease-out',\n  },\n  '.cm-math-preview .katex-display': {\n    textAlign: 'left !important',\n    margin: '0 !important',\n    justifyContent: 'flex-start !important',\n  },\n  '.cm-math-preview .katex-display > .katex': {\n    textAlign: 'left !important',\n  },\n\n  // Mermaid diagram preview\n  '.cm-mermaid-preview': {\n    display: 'block',\n    padding: '16px 0',\n    cursor: 'pointer',\n    animation: 'cmFadeIn 0.15s ease-out',\n  },\n  '.cm-mermaid-preview svg': {\n    maxWidth: '100%',\n    height: 'auto',\n  },\n  '.cm-mermaid-preview .mermaid-error': {\n    color: '#d73a49',\n    fontFamily: 'monospace',\n    fontSize: '0.9em',\n  },\n  '.cm-mermaid-block-line': {\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n    fontSize: '0.9em',\n  },\n\n  // Hidden lines (for multi-line blocks like tables, math, mermaid)\n  '.cm-hidden-line': {\n    height: '0 !important',\n    padding: '0 !important',\n    minHeight: '0 !important',\n  },\n\n  // Collapsed heading content (animated)\n  '.cm-collapsed-line': {\n    height: '0 !important',\n    minHeight: '0 !important',\n    padding: '0 !important',\n    margin: '0 !important',\n    overflow: 'hidden !important',\n    opacity: '0',\n    lineHeight: '0 !important',\n    transition: 'height 0.15s ease-out, opacity 0.1s ease-out, padding 0.15s ease-out',\n  },\n\n  // Heading preview with collapse toggle\n  '.cm-heading-preview': {\n    display: 'inline-flex',\n    alignItems: 'center',\n    animation: 'cmFadeIn 0.12s ease-out',\n  },\n\n  // Collapse toggle button\n  '.cm-collapse-toggle': {\n    display: 'inline-flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    cursor: 'pointer',\n    userSelect: 'none',\n    fontSize: '0.8em',\n    opacity: '0',\n    transition: 'opacity 0.15s ease, transform 0.15s ease',\n    marginLeft: '-20px',\n    width: '20px',\n    height: '1em',\n    flexShrink: '0',\n  },\n  // Collapsed: always visible\n  '.cm-collapse-toggle.collapsed': {\n    transform: 'rotate(0deg)',\n    opacity: '0.4',\n  },\n  '.cm-collapse-toggle.collapsed:hover': {\n    opacity: '1',\n  },\n  // Expanded: only visible on hover\n  '.cm-collapse-toggle.expanded': {\n    transform: 'rotate(90deg)',\n  },\n  '.cm-line:hover .cm-collapse-toggle.expanded': {\n    opacity: '0.4',\n  },\n  '.cm-line:hover .cm-collapse-toggle.expanded:hover': {\n    opacity: '1',\n  },\n\n  // Footnotes\n  '.footnote-ref .footnote-link': {\n    cursor: 'pointer',\n    fontSize: '0.85em',\n  },\n  '.footnote-def': {\n    display: 'inline',\n    fontSize: '0.9em',\n  },\n  '.footnote-def sup': {\n    marginRight: '4px',\n  },\n\n  // Syntax highlighting (base classes)\n  '.tok-keyword': {},\n  '.tok-operator': {},\n  '.tok-variableName': {},\n  '.tok-function, .tok-definition': {},\n  '.tok-string, .tok-string2': {},\n  '.tok-number': {},\n  '.tok-bool, .tok-null': {},\n  '.tok-comment': { fontStyle: 'italic' },\n  '.tok-punctuation': {},\n  '.tok-propertyName': {},\n  '.tok-typeName, .tok-className': {},\n  '.tok-tagName': {},\n  '.tok-attributeName': {},\n  '.tok-attributeValue': {},\n  '.tok-regexp': {},\n  '.tok-meta': {},\n\n  // Inline image preview\n  '.cm-image-preview': {\n    display: 'block',\n    padding: '8px 0',\n    cursor: 'pointer',\n    animation: 'cmFadeIn 0.15s ease-out',\n  },\n  '.cm-image-preview img': {\n    maxWidth: '100%',\n    maxHeight: '400px',\n    objectFit: 'contain',\n    borderRadius: '6px',\n    display: 'block',\n  },\n  '.cm-image-alt': {\n    display: 'block',\n    fontSize: '0.8em',\n    marginTop: '4px',\n    fontStyle: 'italic',\n  },\n  '.cm-image-error': {\n    display: 'block',\n    padding: '12px',\n    fontSize: '0.85em',\n    borderRadius: '6px',\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n  },\n\n  // Frontmatter property editor\n  '.cm-frontmatter-preview': {\n    display: 'block',\n    margin: '0',\n    padding: '8px 12px',\n    borderRadius: '6px',\n    animation: 'cmFadeIn 0.15s ease-out',\n  },\n  '.cm-frontmatter-table': {\n    width: '100%',\n    borderCollapse: 'collapse',\n    fontSize: '0.9em',\n  },\n  '.cm-frontmatter-table td': {\n    padding: '3px 8px',\n    verticalAlign: 'middle',\n  },\n  '.cm-frontmatter-key': {\n    fontWeight: '600',\n    whiteSpace: 'nowrap',\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n    fontSize: '0.9em',\n    width: '1%',\n    paddingRight: '16px',\n  },\n  '.cm-frontmatter-key-input': {\n    fontFamily: 'inherit',\n    fontWeight: 'inherit',\n    fontSize: 'inherit',\n    color: 'inherit',\n    background: 'transparent',\n    border: 'none',\n    outline: 'none',\n    padding: '2px 4px',\n    borderRadius: '3px',\n    boxSizing: 'border-box',\n    minWidth: '3ch',\n    appearance: 'none',\n    MozAppearance: 'none',\n    WebkitAppearance: 'none',\n  },\n  '.cm-frontmatter-key-input::-webkit-calendar-picker-indicator': {\n    display: 'none !important',\n  },\n  '.cm-frontmatter-value-cell': {\n    width: '100%',\n  },\n  '.cm-frontmatter-value': {\n    display: 'flex',\n    flexWrap: 'wrap',\n    gap: '4px',\n    alignItems: 'center',\n  },\n  '.cm-frontmatter-input': {\n    border: 'none',\n    background: 'transparent',\n    width: '100%',\n    font: 'inherit',\n    fontSize: '1em',\n    outline: 'none',\n    padding: '2px 4px',\n    borderRadius: '3px',\n  },\n  '.cm-frontmatter-input:focus': {\n    outline: 'none',\n  },\n  '.cm-frontmatter-checkbox': {\n    width: '16px',\n    height: '16px',\n    cursor: 'pointer',\n    margin: '0',\n  },\n  '.cm-frontmatter-tag': {\n    display: 'inline-block',\n    padding: '1px 8px',\n    borderRadius: '10px',\n    fontSize: '0.9em',\n    cursor: 'text',\n    outline: 'none',\n    lineHeight: '1.5',\n  },\n  '.cm-frontmatter-add-tag': {\n    display: 'inline-flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    width: '20px',\n    height: '20px',\n    borderRadius: '50%',\n    cursor: 'pointer',\n    fontSize: '0.85em',\n    opacity: '0.4',\n    userSelect: 'none',\n  },\n  '.cm-frontmatter-add-tag:hover': {\n    opacity: '1',\n  },\n  '.cm-frontmatter-action-cell': {\n    width: '1%',\n    whiteSpace: 'nowrap',\n  },\n  '.cm-frontmatter-delete': {\n    cursor: 'pointer',\n    opacity: '0',\n    fontSize: '1.1em',\n    padding: '0 4px',\n    userSelect: 'none',\n    transition: 'opacity 0.1s ease',\n  },\n  '.cm-frontmatter-table tr:hover .cm-frontmatter-delete': {\n    opacity: '0.3',\n  },\n  '.cm-frontmatter-table tr:hover .cm-frontmatter-delete:hover': {\n    opacity: '1',\n  },\n  '.cm-frontmatter-add': {\n    cursor: 'pointer',\n    opacity: '0.4',\n    fontSize: '0.85em',\n    padding: '4px 8px',\n    userSelect: 'none',\n  },\n  '.cm-frontmatter-add:hover': {\n    opacity: '0.8',\n  },\n  '.cm-frontmatter-error': {\n    fontStyle: 'italic',\n    fontSize: '0.9em',\n    padding: '4px 0',\n    cursor: 'pointer',\n  },\n  '.cm-frontmatter-line': {\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n    fontSize: '0.9em',\n    animation: 'cmFadeIn 0.1s ease-out',\n  },\n\n  // Frontmatter sheet overlay\n  '.cm-frontmatter-sheet-backdrop': {\n    position: 'absolute',\n    top: '0',\n    left: '0',\n    right: '0',\n    bottom: '0',\n    zIndex: '10',\n    opacity: '0',\n    transition: 'opacity 0.2s ease',\n  },\n  '.cm-frontmatter-sheet-backdrop-visible': {\n    opacity: '1',\n  },\n  '.cm-frontmatter-sheet': {\n    position: 'absolute',\n    top: '0',\n    left: '0',\n    right: '0',\n    zIndex: '11',\n    maxHeight: '70%',\n    overflowY: 'auto',\n    transform: 'translateY(-100%)',\n    transition: 'transform 0.2s ease',\n    borderBottomLeftRadius: '8px',\n    borderBottomRightRadius: '8px',\n  },\n  '.cm-frontmatter-sheet-open': {\n    transform: 'translateY(0)',\n  },\n  '.cm-frontmatter-sheet-header': {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    padding: '12px 20px 0',\n  },\n  '.cm-frontmatter-sheet-title': {\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    fontSize: '0.9em',\n    fontWeight: '600',\n  },\n  '.cm-frontmatter-sheet-close': {\n    background: 'none',\n    border: 'none',\n    fontSize: '18px',\n    cursor: 'pointer',\n    padding: '0 4px',\n    lineHeight: '1',\n    opacity: '0.5',\n  },\n  '.cm-frontmatter-sheet-close:hover': {\n    opacity: '1',\n  },\n  '.cm-frontmatter-sheet-content': {\n    padding: '8px 20px 16px',\n  },\n  '.cm-frontmatter-sheet-content .cm-frontmatter-preview': {\n    border: 'none',\n    padding: '0',\n    margin: '0',\n    borderRadius: '0',\n    animation: 'none',\n  },\n  '.cm-frontmatter-sheet-empty': {\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    fontSize: '0.9em',\n    padding: '8px 0',\n    opacity: '0.6',\n  },\n  '.cm-frontmatter-sheet-add-btn': {\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    fontSize: '0.85em',\n    padding: '6px 16px',\n    borderRadius: '6px',\n    cursor: 'pointer',\n    border: '1px solid',\n    marginTop: '8px',\n  },\n\n  // Word count panel\n  '.cm-word-count-panel': {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '0',\n    padding: '4px 16px',\n    fontSize: '12px',\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    userSelect: 'none',\n  },\n  '.cm-word-count-stat': {\n    display: 'inline-flex',\n    alignItems: 'center',\n    padding: '0 10px',\n  },\n  '.cm-word-count-value': {\n    fontWeight: '600',\n    fontVariantNumeric: 'tabular-nums',\n  },\n  '.cm-word-count-label': {\n    fontWeight: '400',\n  },\n  '.cm-word-count-divider': {\n    width: '1px',\n    height: '12px',\n    flexShrink: '0',\n  },\n\n  // Tag pills\n  '.md-tag': {\n    display: 'inline-block',\n    padding: '1px 8px',\n    borderRadius: '10px',\n    fontSize: '0.9em',\n    cursor: 'pointer',\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    lineHeight: '1.5',\n    verticalAlign: 'baseline',\n  },\n  '.cm-tag-mark': {\n    borderRadius: '3px',\n  },\n\n  // Smooth transitions: focused lines fade in when raw markdown appears\n  '.cm-selectedLine': {\n    animation: 'cmFadeIn 0.1s ease-out',\n  },\n  '.cm-table-line': {\n    animation: 'cmFadeIn 0.1s ease-out',\n  },\n  '.cm-math-block-line': {\n    animation: 'cmFadeIn 0.1s ease-out',\n  },\n  '.cm-mermaid-block-line': {\n    animation: 'cmFadeIn 0.1s ease-out',\n  },\n  // Backlinks panel\n  '.cm-backlinks-panel': {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '8px',\n    padding: '4px 16px',\n    fontSize: '12px',\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    userSelect: 'none',\n  },\n  '.cm-backlinks-label': {\n    fontWeight: '600',\n    flexShrink: '0',\n  },\n  '.cm-backlinks-list': {\n    display: 'flex',\n    flexWrap: 'wrap',\n    gap: '4px',\n    alignItems: 'center',\n  },\n  '.cm-backlinks-link': {\n    display: 'inline-block',\n    padding: '1px 8px',\n    borderRadius: '10px',\n    cursor: 'pointer',\n    fontSize: '11px',\n    lineHeight: '1.5',\n  },\n  '.cm-backlinks-link:hover': {\n    textDecoration: 'underline',\n  },\n  '.cm-backlinks-empty': {\n    fontStyle: 'italic',\n    opacity: '0.6',\n  },\n\n  // Focus mode: unfocused lines\n  '.cm-unfocused-line': {\n    opacity: 'var(--cm-unfocused-opacity, 0.25)',\n    transition: 'opacity 0.2s ease',\n  },\n\n  // Writing mode sheet overlay\n  '.cm-writing-mode-sheet-backdrop': {\n    position: 'absolute',\n    top: '0',\n    left: '0',\n    right: '0',\n    bottom: '0',\n    zIndex: '10',\n    opacity: '0',\n    transition: 'opacity 0.2s ease',\n  },\n  '.cm-writing-mode-sheet-backdrop-visible': {\n    opacity: '1',\n  },\n  '.cm-writing-mode-sheet': {\n    position: 'absolute',\n    bottom: '0',\n    left: '0',\n    right: '0',\n    zIndex: '11',\n    maxHeight: '70%',\n    overflowY: 'auto',\n    transform: 'translateY(100%)',\n    transition: 'transform 0.2s ease',\n    borderTopLeftRadius: '12px',\n    borderTopRightRadius: '12px',\n  },\n  '.cm-writing-mode-sheet-open': {\n    transform: 'translateY(0)',\n  },\n  '.cm-writing-mode-sheet-header': {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    padding: '16px 20px 0',\n  },\n  '.cm-writing-mode-sheet-title': {\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    fontSize: '0.95em',\n    fontWeight: '600',\n  },\n  '.cm-writing-mode-sheet-close': {\n    background: 'none',\n    border: 'none',\n    fontSize: '18px',\n    cursor: 'pointer',\n    padding: '0 4px',\n    lineHeight: '1',\n    opacity: '0.5',\n  },\n  '.cm-writing-mode-sheet-close:hover': {\n    opacity: '1',\n  },\n  '.cm-writing-mode-sheet-content': {\n    padding: '12px 20px 20px',\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n  },\n  '.cm-writing-mode-section': {\n    marginBottom: '16px',\n  },\n  '.cm-writing-mode-section-label': {\n    display: 'block',\n    fontSize: '0.7em',\n    fontWeight: '600',\n    textTransform: 'uppercase',\n    letterSpacing: '0.05em',\n    marginBottom: '8px',\n  },\n  '.cm-writing-mode-options': {\n    display: 'flex',\n    gap: '8px',\n  },\n  '.cm-writing-mode-option': {\n    flex: '1',\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    gap: '4px',\n    padding: '10px 8px',\n    borderRadius: '8px',\n    border: '1px solid transparent',\n    cursor: 'pointer',\n    fontSize: '0.85em',\n    background: 'none',\n    transition: 'background 0.15s ease, border-color 0.15s ease',\n  },\n  '.cm-writing-mode-option-icon': {\n    fontSize: '1.4em',\n    lineHeight: '1',\n  },\n  '.cm-writing-mode-option-label': {\n    fontSize: '0.8em',\n  },\n  '.cm-writing-mode-pills': {\n    display: 'flex',\n    gap: '6px',\n  },\n  '.cm-writing-mode-pill': {\n    padding: '5px 14px',\n    borderRadius: '16px',\n    border: '1px solid transparent',\n    cursor: 'pointer',\n    fontSize: '0.82em',\n    fontWeight: '500',\n    background: 'none',\n    transition: 'background 0.15s ease, border-color 0.15s ease',\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n  },\n  '.cm-writing-mode-slider-wrap': {\n    display: 'flex',\n    flexDirection: 'column',\n    gap: '4px',\n  },\n  '.cm-writing-mode-slider': {\n    width: '100%',\n    height: '4px',\n    appearance: 'none',\n    WebkitAppearance: 'none',\n    borderRadius: '2px',\n    outline: 'none',\n    cursor: 'pointer',\n  },\n  '.cm-writing-mode-slider-labels': {\n    display: 'flex',\n    justifyContent: 'space-between',\n    fontSize: '0.7em',\n  },\n  '.cm-writing-mode-shortcuts': {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '6px',\n    fontSize: '0.75em',\n    flexWrap: 'wrap',\n    marginTop: '4px',\n    paddingTop: '12px',\n  },\n  '.cm-writing-mode-shortcuts-label': {\n    fontWeight: '500',\n  },\n  '.cm-writing-mode-kbd': {\n    display: 'inline-block',\n    padding: '2px 6px',\n    borderRadius: '4px',\n    fontSize: '0.9em',\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n    lineHeight: '1.4',\n  },\n  '.cm-writing-mode-kbd-desc': {\n    marginRight: '8px',\n  },\n});\n","import { EditorView } from '@codemirror/view';\n\n/**\n * Light theme for the hybrid markdown editor\n */\nexport const lightTheme = EditorView.theme({\n  // Editor background\n  '&': {\n    backgroundColor: '#fff',\n  },\n  '.cm-content': {\n    caretColor: '#333',\n  },\n  '.cm-cursor': {\n    borderLeftColor: '#333',\n    borderLeftWidth: '2px',\n  },\n  '.cm-selectionBackground': {\n    backgroundColor: '#b4d5fe',\n  },\n  '&.cm-focused .cm-selectionBackground': {\n    backgroundColor: '#b4d5fe',\n  },\n\n  // Header colors\n  '.cm-markdown-preview .md-h1': { color: '#1a1a2e' },\n  '.cm-markdown-preview .md-h2': { color: '#2d2d3f' },\n  '.cm-markdown-preview .md-h3': { color: '#3d3d4d' },\n  '.cm-markdown-preview .md-h4': { color: '#555566' },\n  '.cm-markdown-preview .md-h5': { color: '#666677' },\n  '.cm-markdown-preview .md-h6': { color: '#777788' },\n\n  // Text colors\n  '.cm-markdown-preview del': { color: '#868e96' },\n  '.cm-markdown-preview code': {\n    backgroundColor: '#f1f3f5',\n    color: '#e83e8c',\n  },\n  '.cm-markdown-preview a': { color: '#228be6' },\n  '.cm-markdown-preview .md-blockquote': {\n    color: '#555',\n    borderLeft: '3px solid #c0c8d0',\n  },\n  '.cm-markdown-preview .md-list-marker': { color: '#888' },\n  '.cm-markdown-preview .md-hr, .cm-markdown-preview hr': {\n    background: 'linear-gradient(to right, transparent, #c0c8d0, transparent)',\n  },\n\n  // Code block lines\n  '.cm-code-block-line': {\n    backgroundColor: '#f6f8fa !important',\n    borderLeft: '3px solid #e1e4e8',\n  },\n  '.cm-code-block-line.cm-code-block-focused': {\n    backgroundColor: '#e8f4fc !important',\n    borderLeft: '3px solid #228be6',\n  },\n\n  // Selected lines get dark styling (inverted)\n  '.cm-selectedLine, .cm-table-line, .cm-math-block-line, .cm-mermaid-block-line': {\n    backgroundColor: '#1e1e1e !important',\n    color: '#d4d4d4 !important',\n    caretColor: '#fff !important',\n    borderRadius: '4px',\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n    fontSize: '0.90em',\n  },\n  '.cm-selectedLine.cm-code-block-line': {\n    backgroundColor: '#1e1e1e !important',\n    borderLeft: '3px solid #569cd6',\n    color: '#d4d4d4 !important',\n    caretColor: '#fff !important',\n    borderRadius: '0',\n  },\n\n  // Syntax highlighting for selected code block lines (dark theme colors)\n  '.cm-selectedLine.cm-code-block-line .tok-keyword': { color: '#569cd6 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-operator': { color: '#d4d4d4 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-variableName': { color: '#9cdcfe !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-function, .cm-selectedLine.cm-code-block-line .tok-definition': { color: '#dcdcaa !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-string, .cm-selectedLine.cm-code-block-line .tok-string2': { color: '#ce9178 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-number': { color: '#b5cea8 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-bool, .cm-selectedLine.cm-code-block-line .tok-null': { color: '#569cd6 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-comment': { color: '#6a9955 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-punctuation': { color: '#d4d4d4 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-propertyName': { color: '#9cdcfe !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-typeName, .cm-selectedLine.cm-code-block-line .tok-className': { color: '#4ec9b0 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-tagName': { color: '#569cd6 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-attributeName': { color: '#9cdcfe !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-attributeValue': { color: '#ce9178 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-regexp': { color: '#d16969 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-meta': { color: '#6a9955 !important' },\n\n  // Inline image preview\n  '.cm-image-preview img': {\n    boxShadow: '0 1px 4px rgba(0, 0, 0, 0.1)',\n  },\n  '.cm-image-alt': {\n    color: '#888',\n  },\n  '.cm-image-error': {\n    backgroundColor: '#fff3f3',\n    color: '#d73a49',\n    border: '1px solid #fdd',\n  },\n\n  // Frontmatter property editor\n  '.cm-frontmatter-preview': {\n    backgroundColor: '#f8f9fa',\n    border: '1px solid #e1e4e8',\n  },\n  '.cm-frontmatter-table td': {\n    borderBottom: '1px solid #eee',\n  },\n  '.cm-frontmatter-table tr:last-child td': {\n    borderBottom: 'none',\n  },\n  '.cm-frontmatter-key': {\n    color: '#555',\n  },\n  '.cm-frontmatter-key-input:focus': {\n    backgroundColor: '#fff',\n    boxShadow: '0 0 0 1px #228be6',\n  },\n  '.cm-frontmatter-input:focus': {\n    backgroundColor: '#fff',\n    boxShadow: '0 0 0 1px #228be6',\n  },\n  '.cm-frontmatter-tag': {\n    backgroundColor: '#e8f0fe',\n    color: '#1a73e8',\n    border: '1px solid #d2e3fc',\n  },\n  '.cm-frontmatter-add-tag': {\n    backgroundColor: '#e8f0fe',\n    color: '#1a73e8',\n  },\n  '.cm-frontmatter-delete': {\n    color: '#d73a49',\n  },\n  '.cm-frontmatter-error': {\n    color: '#d73a49',\n  },\n  '.cm-frontmatter-line': {\n    backgroundColor: '#f6f8fa !important',\n    borderLeft: '3px solid #e1e4e8',\n  },\n\n  // Frontmatter sheet overlay\n  '.cm-frontmatter-sheet-backdrop': {\n    backgroundColor: 'rgba(0, 0, 0, 0.3)',\n  },\n  '.cm-frontmatter-sheet': {\n    backgroundColor: '#fff',\n    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.12)',\n  },\n  '.cm-frontmatter-sheet-title': {\n    color: '#333',\n  },\n  '.cm-frontmatter-sheet-close': {\n    color: '#666',\n  },\n  '.cm-frontmatter-sheet-add-btn': {\n    backgroundColor: '#f8f9fa',\n    borderColor: '#e1e4e8',\n    color: '#333',\n  },\n  '.cm-frontmatter-sheet-add-btn:hover': {\n    backgroundColor: '#e9ecef',\n  },\n\n  // Word count panel\n  '.cm-word-count-panel': {\n    backgroundColor: '#f8f9fa',\n    borderTop: '1px solid #e1e4e8',\n    color: '#555',\n  },\n  '.cm-word-count-value': {\n    color: '#333',\n  },\n  '.cm-word-count-label': {\n    color: '#888',\n  },\n  '.cm-word-count-divider': {\n    backgroundColor: '#dee2e6',\n  },\n  '.cm-word-count-selection': {\n    color: '#228be6',\n  },\n  '.cm-word-count-selection .cm-word-count-value': {\n    color: '#228be6',\n  },\n  '.cm-word-count-selection .cm-word-count-label': {\n    color: '#228be6',\n    opacity: '0.7',\n  },\n\n  // Gutters\n  '.cm-gutters': {\n    background: '#f8f9fa',\n    borderRight: '1px solid #dee2e6',\n  },\n\n  // Table styling\n  '.md-table': { border: '1px solid #d0d7de' },\n  '.md-table th, .md-table td': { border: '1px solid #d0d7de' },\n  '.md-table th': { background: '#f6f8fa' },\n  '.md-table tbody tr:hover': { background: '#f6f8fa' },\n  '.cm-markdown-preview .md-table-row': {\n    background: '#fff',\n    border: '1px solid #d0d7de',\n  },\n  '.cm-markdown-preview .md-table-cell': {\n    borderRight: '1px solid #d0d7de',\n  },\n\n  // Syntax highlighting (light theme colors)\n  '.tok-keyword': { color: '#d73a49' },\n  '.tok-operator': { color: '#d73a49' },\n  '.tok-variableName': { color: '#24292e' },\n  '.tok-function, .tok-definition': { color: '#6f42c1' },\n  '.tok-string, .tok-string2': { color: '#032f62' },\n  '.tok-number': { color: '#005cc5' },\n  '.tok-bool, .tok-null': { color: '#005cc5' },\n  '.tok-comment': { color: '#6a737d' },\n  '.tok-punctuation': { color: '#24292e' },\n  '.tok-propertyName': { color: '#005cc5' },\n  '.tok-typeName, .tok-className': { color: '#22863a' },\n  '.tok-tagName': { color: '#22863a' },\n  '.tok-attributeName': { color: '#6f42c1' },\n  '.tok-attributeValue': { color: '#032f62' },\n  '.tok-regexp': { color: '#032f62' },\n  '.tok-meta': { color: '#6a737d' },\n\n  // Backlinks panel\n  '.cm-backlinks-panel': {\n    backgroundColor: '#f8f9fa',\n    borderTop: '1px solid #e1e4e8',\n    color: '#555',\n  },\n  '.cm-backlinks-label': {\n    color: '#333',\n  },\n  '.cm-backlinks-link': {\n    backgroundColor: '#e8f0fe',\n    color: '#1a73e8',\n    border: '1px solid #d2e3fc',\n  },\n\n  // Tag pills\n  '.md-tag': {\n    backgroundColor: '#e8f5e9',\n    color: '#2e7d32',\n    border: '1px solid #c8e6c9',\n  },\n  '.cm-tag-mark': {\n    color: '#2e7d32',\n  },\n\n  // Writing mode sheet\n  '.cm-writing-mode-sheet-backdrop': {\n    backgroundColor: 'rgba(0, 0, 0, 0.3)',\n  },\n  '.cm-writing-mode-sheet': {\n    backgroundColor: '#fff',\n    boxShadow: '0 -4px 16px rgba(0, 0, 0, 0.12)',\n  },\n  '.cm-writing-mode-sheet-title': {\n    color: '#333',\n  },\n  '.cm-writing-mode-sheet-close': {\n    color: '#666',\n  },\n  '.cm-writing-mode-section-label': {\n    color: '#888',\n  },\n  '.cm-writing-mode-option': {\n    color: '#555',\n    backgroundColor: '#f5f5f5',\n  },\n  '.cm-writing-mode-option:hover': {\n    backgroundColor: '#eee',\n  },\n  '.cm-writing-mode-option-active': {\n    backgroundColor: '#e8f0fe !important',\n    borderColor: '#1a73e8 !important',\n    color: '#1a73e8 !important',\n  },\n  '.cm-writing-mode-pill': {\n    color: '#555',\n    backgroundColor: '#f5f5f5',\n  },\n  '.cm-writing-mode-pill:hover': {\n    backgroundColor: '#eee',\n  },\n  '.cm-writing-mode-pill-active': {\n    backgroundColor: '#e8f0fe !important',\n    borderColor: '#1a73e8 !important',\n    color: '#1a73e8 !important',\n  },\n  '.cm-writing-mode-slider': {\n    background: '#ddd',\n  },\n  '.cm-writing-mode-slider-labels': {\n    color: '#999',\n  },\n  '.cm-writing-mode-shortcuts': {\n    color: '#888',\n    borderTop: '1px solid #eee',\n  },\n  '.cm-writing-mode-kbd': {\n    backgroundColor: '#f0f0f0',\n    border: '1px solid #ddd',\n    color: '#555',\n  },\n\n  // Footnotes\n  '.footnote-ref .footnote-link': { color: '#228be6' },\n  '.footnote-def': { color: '#666' },\n  '.footnote-def sup': { color: '#228be6' },\n  '.md-wikilink, .cm-wikilink': { color: '#228be6' },\n});\n","import { EditorView } from '@codemirror/view';\n\n/**\n * Dark theme for the hybrid markdown editor\n */\nexport const darkTheme = EditorView.theme({\n  // Editor background\n  '&': {\n    backgroundColor: '#1e1e1e',\n  },\n  '.cm-content': {\n    caretColor: '#fff',\n    color: '#d4d4d4',\n  },\n  '.cm-cursor': {\n    borderLeftColor: '#fff',\n    borderLeftWidth: '2px',\n  },\n  '.cm-selectionBackground': {\n    backgroundColor: '#264f78',\n  },\n  '&.cm-focused .cm-selectionBackground': {\n    backgroundColor: '#264f78',\n  },\n\n  // Header colors\n  '.cm-markdown-preview .md-h1': { color: '#e8e8ec' },\n  '.cm-markdown-preview .md-h2': { color: '#d5d5db' },\n  '.cm-markdown-preview .md-h3': { color: '#c2c2ca' },\n  '.cm-markdown-preview .md-h4': { color: '#acacb8' },\n  '.cm-markdown-preview .md-h5': { color: '#9696a4' },\n  '.cm-markdown-preview .md-h6': { color: '#808090' },\n\n  // Text colors\n  '.cm-markdown-preview del': { color: '#777' },\n  '.cm-markdown-preview code': {\n    backgroundColor: '#2d2d2d',\n    color: '#ce9178',\n  },\n  '.cm-markdown-preview a': { color: '#228be6' },\n  '.cm-markdown-preview .md-blockquote': {\n    color: '#aaa',\n    borderLeft: '3px solid #4a4a5a',\n  },\n  '.cm-markdown-preview .md-list-marker': { color: '#888' },\n  '.cm-markdown-preview .md-hr, .cm-markdown-preview hr': {\n    background: 'linear-gradient(to right, transparent, #4a4a5a, transparent)',\n  },\n\n  // Code block lines\n  '.cm-code-block-line': {\n    backgroundColor: '#2d2d2d !important',\n    borderLeft: '3px solid #444',\n  },\n  '.cm-code-block-line.cm-code-block-focused': {\n    backgroundColor: '#3a3d41 !important',\n    borderLeft: '3px solid #569cd6',\n  },\n\n  // Selected lines get light styling (inverted)\n  '.cm-selectedLine, .cm-table-line, .cm-math-block-line, .cm-mermaid-block-line': {\n    backgroundColor: '#fff !important',\n    color: '#1e1e1e !important',\n    caretColor: '#333 !important',\n    borderRadius: '4px',\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace',\n    fontSize: '0.90em',\n  },\n  '.cm-selectedLine.cm-code-block-line': {\n    backgroundColor: '#fff !important',\n    borderLeft: '3px solid #228be6',\n    color: '#1e1e1e !important',\n    caretColor: '#333 !important',\n    borderRadius: '0',\n  },\n\n  // Syntax highlighting for selected code block lines (light theme colors)\n  '.cm-selectedLine.cm-code-block-line .tok-keyword': { color: '#d73a49 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-operator': { color: '#d73a49 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-variableName': { color: '#24292e !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-function, .cm-selectedLine.cm-code-block-line .tok-definition': { color: '#6f42c1 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-string, .cm-selectedLine.cm-code-block-line .tok-string2': { color: '#032f62 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-number': { color: '#005cc5 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-bool, .cm-selectedLine.cm-code-block-line .tok-null': { color: '#005cc5 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-comment': { color: '#6a737d !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-punctuation': { color: '#24292e !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-propertyName': { color: '#005cc5 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-typeName, .cm-selectedLine.cm-code-block-line .tok-className': { color: '#22863a !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-tagName': { color: '#22863a !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-attributeName': { color: '#6f42c1 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-attributeValue': { color: '#032f62 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-regexp': { color: '#032f62 !important' },\n  '.cm-selectedLine.cm-code-block-line .tok-meta': { color: '#6a737d !important' },\n\n  // Inline image preview\n  '.cm-image-preview img': {\n    boxShadow: '0 1px 4px rgba(0, 0, 0, 0.3)',\n  },\n  '.cm-image-alt': {\n    color: '#888',\n  },\n  '.cm-image-error': {\n    backgroundColor: '#3a2020',\n    color: '#f48771',\n    border: '1px solid #5a3030',\n  },\n\n  // Frontmatter property editor\n  '.cm-frontmatter-preview': {\n    backgroundColor: '#2d2d2d',\n    border: '1px solid #444',\n  },\n  '.cm-frontmatter-table td': {\n    borderBottom: '1px solid #3c3c3c',\n  },\n  '.cm-frontmatter-table tr:last-child td': {\n    borderBottom: 'none',\n  },\n  '.cm-frontmatter-key': {\n    color: '#9cdcfe',\n  },\n  '.cm-frontmatter-input': {\n    color: '#d4d4d4',\n  },\n  '.cm-frontmatter-key-input:focus': {\n    backgroundColor: '#3a3d41',\n    boxShadow: '0 0 0 1px #569cd6',\n  },\n  '.cm-frontmatter-input:focus': {\n    backgroundColor: '#3a3d41',\n    boxShadow: '0 0 0 1px #569cd6',\n  },\n  '.cm-frontmatter-tag': {\n    backgroundColor: '#264f78',\n    color: '#9cdcfe',\n    border: '1px solid #3a6ea5',\n  },\n  '.cm-frontmatter-add-tag': {\n    backgroundColor: '#264f78',\n    color: '#9cdcfe',\n  },\n  '.cm-frontmatter-delete': {\n    color: '#f48771',\n  },\n  '.cm-frontmatter-error': {\n    color: '#f48771',\n  },\n  '.cm-frontmatter-line': {\n    backgroundColor: '#2d2d2d !important',\n    borderLeft: '3px solid #444',\n  },\n\n  // Frontmatter sheet overlay\n  '.cm-frontmatter-sheet-backdrop': {\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\n  },\n  '.cm-frontmatter-sheet': {\n    backgroundColor: '#252526',\n    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.4)',\n  },\n  '.cm-frontmatter-sheet-title': {\n    color: '#d4d4d4',\n  },\n  '.cm-frontmatter-sheet-close': {\n    color: '#aaa',\n  },\n  '.cm-frontmatter-sheet-add-btn': {\n    backgroundColor: '#3c3c3c',\n    borderColor: '#555',\n    color: '#d4d4d4',\n  },\n  '.cm-frontmatter-sheet-add-btn:hover': {\n    backgroundColor: '#4a4a4a',\n  },\n\n  // Word count panel\n  '.cm-word-count-panel': {\n    backgroundColor: '#252526',\n    borderTop: '1px solid #3c3c3c',\n    color: '#aaa',\n  },\n  '.cm-word-count-value': {\n    color: '#d4d4d4',\n  },\n  '.cm-word-count-label': {\n    color: '#777',\n  },\n  '.cm-word-count-divider': {\n    backgroundColor: '#444',\n  },\n  '.cm-word-count-selection': {\n    color: '#569cd6',\n  },\n  '.cm-word-count-selection .cm-word-count-value': {\n    color: '#569cd6',\n  },\n  '.cm-word-count-selection .cm-word-count-label': {\n    color: '#569cd6',\n    opacity: '0.7',\n  },\n\n  // Gutters\n  '.cm-gutters': {\n    background: '#252526',\n    borderRight: '1px solid #3c3c3c',\n  },\n\n  // Table styling\n  '.md-table': { border: '1px solid #444' },\n  '.md-table th, .md-table td': { border: '1px solid #444' },\n  '.md-table th': { background: '#2d2d2d' },\n  '.md-table tbody tr:hover': { background: '#2d2d2d' },\n  '.cm-markdown-preview .md-table-row': {\n    background: '#1e1e1e',\n    border: '1px solid #444',\n  },\n  '.cm-markdown-preview .md-table-cell': {\n    borderRight: '1px solid #444',\n  },\n\n  // Syntax highlighting (dark theme colors)\n  '.tok-keyword': { color: '#569cd6' },\n  '.tok-operator': { color: '#d4d4d4' },\n  '.tok-variableName': { color: '#9cdcfe' },\n  '.tok-function, .tok-definition': { color: '#dcdcaa' },\n  '.tok-string, .tok-string2': { color: '#ce9178' },\n  '.tok-number': { color: '#b5cea8' },\n  '.tok-bool, .tok-null': { color: '#569cd6' },\n  '.tok-comment': { color: '#6a9955' },\n  '.tok-punctuation': { color: '#d4d4d4' },\n  '.tok-propertyName': { color: '#9cdcfe' },\n  '.tok-typeName, .tok-className': { color: '#4ec9b0' },\n  '.tok-tagName': { color: '#569cd6' },\n  '.tok-attributeName': { color: '#9cdcfe' },\n  '.tok-attributeValue': { color: '#ce9178' },\n  '.tok-regexp': { color: '#d16969' },\n  '.tok-meta': { color: '#6a9955' },\n\n  // Backlinks panel\n  '.cm-backlinks-panel': {\n    backgroundColor: '#252526',\n    borderTop: '1px solid #3c3c3c',\n    color: '#aaa',\n  },\n  '.cm-backlinks-label': {\n    color: '#d4d4d4',\n  },\n  '.cm-backlinks-link': {\n    backgroundColor: '#264f78',\n    color: '#9cdcfe',\n    border: '1px solid #3a6ea5',\n  },\n\n  // Tag pills\n  '.md-tag': {\n    backgroundColor: '#1b3a1b',\n    color: '#81c784',\n    border: '1px solid #2e5a2e',\n  },\n  '.cm-tag-mark': {\n    color: '#81c784',\n  },\n\n  // Writing mode sheet\n  '.cm-writing-mode-sheet-backdrop': {\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\n  },\n  '.cm-writing-mode-sheet': {\n    backgroundColor: '#252526',\n    boxShadow: '0 -4px 16px rgba(0, 0, 0, 0.4)',\n  },\n  '.cm-writing-mode-sheet-title': {\n    color: '#d4d4d4',\n  },\n  '.cm-writing-mode-sheet-close': {\n    color: '#aaa',\n  },\n  '.cm-writing-mode-section-label': {\n    color: '#777',\n  },\n  '.cm-writing-mode-option': {\n    color: '#aaa',\n    backgroundColor: '#2d2d2d',\n  },\n  '.cm-writing-mode-option:hover': {\n    backgroundColor: '#3a3a3a',\n  },\n  '.cm-writing-mode-option-active': {\n    backgroundColor: '#264f78 !important',\n    borderColor: '#569cd6 !important',\n    color: '#9cdcfe !important',\n  },\n  '.cm-writing-mode-pill': {\n    color: '#aaa',\n    backgroundColor: '#2d2d2d',\n  },\n  '.cm-writing-mode-pill:hover': {\n    backgroundColor: '#3a3a3a',\n  },\n  '.cm-writing-mode-pill-active': {\n    backgroundColor: '#264f78 !important',\n    borderColor: '#569cd6 !important',\n    color: '#9cdcfe !important',\n  },\n  '.cm-writing-mode-slider': {\n    background: '#444',\n  },\n  '.cm-writing-mode-slider-labels': {\n    color: '#666',\n  },\n  '.cm-writing-mode-shortcuts': {\n    color: '#666',\n    borderTop: '1px solid #3c3c3c',\n  },\n  '.cm-writing-mode-kbd': {\n    backgroundColor: '#3c3c3c',\n    border: '1px solid #555',\n    color: '#aaa',\n  },\n\n  // Footnotes\n  '.footnote-ref .footnote-link': { color: '#228be6' },\n  '.footnote-def': { color: '#aaa' },\n  '.footnote-def sup': { color: '#228be6' },\n  '.md-wikilink, .cm-wikilink': { color: '#228be6' },\n});\n","import { EditorView } from '@codemirror/view';\n\n/**\n * Raw mode theme - overrides selected line styling\n * In raw mode, lines are not inverted, just use monospace everywhere\n */\nexport const rawModeTheme = EditorView.theme({\n  // Use monospace font everywhere in raw mode\n  '.cm-scroller, .cm-content, .cm-line': {\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace !important',\n  },\n\n  // No inversion on selected lines - just subtle highlight\n  '.cm-selectedLine, .cm-selectedLine.cm-code-block-line': {\n    backgroundColor: 'rgba(0, 0, 0, 0.05) !important',\n    color: 'inherit !important',\n    caretColor: '#333 !important',\n    filter: 'none !important',\n    borderRadius: '0',\n    fontSize: 'inherit !important',\n  },\n});\n\n/**\n * Raw mode dark variant\n */\nexport const rawModeDarkTheme = EditorView.theme({\n  // Use monospace font everywhere in raw mode\n  '.cm-scroller, .cm-content, .cm-line': {\n    fontFamily: '\"SF Mono\", Monaco, \"Cascadia Code\", Consolas, monospace !important',\n  },\n\n  // Dark mode: subtle highlight\n  '.cm-selectedLine, .cm-selectedLine.cm-code-block-line': {\n    backgroundColor: 'rgba(255, 255, 255, 0.1) !important',\n    color: 'inherit !important',\n    caretColor: '#fff !important',\n    filter: 'none !important',\n    borderRadius: '0',\n    fontSize: 'inherit !important',\n  },\n});\n","/**\n * Create a tag completion source for the hybrid markdown editor.\n * Triggers after typing `#` and provides tag suggestions from a user-supplied list.\n *\n * Returns a completion source function ‚Äî combine with other sources\n * in a single `autocompletion({ override: [...] })` call.\n *\n * @param {Object} options\n * @param {string[]} options.tags - Array of tag names (without #), e.g. ['javascript', 'project/active', 'todo']\n * @returns {CompletionSource} A completion source function\n *\n * @example\n * import { autocompletion } from '@codemirror/autocomplete';\n * import { tagAutocomplete } from 'codemirror-for-writers';\n *\n * const extensions = [\n *   autocompletion({ override: [tagAutocomplete({ tags: ['javascript', 'todo'] })] }),\n * ];\n */\nexport function tagAutocomplete({ tags = [] } = {}) {\n  return (context) => {\n    const match = context.matchBefore(/#[\\w/-]*$/);\n    if (!match) return null;\n\n    // Don't trigger inside code blocks or at line start (headings)\n    const line = context.state.doc.lineAt(match.from);\n    const lineText = line.text;\n\n    // Skip if this looks like a heading (line starts with #)\n    if (/^#{1,6}\\s/.test(lineText)) return null;\n\n    const query = match.text.slice(1).toLowerCase();\n\n    const options = tags\n      .filter((tag) => tag.toLowerCase().includes(query))\n      .sort((a, b) => {\n        const aLower = a.toLowerCase();\n        const bLower = b.toLowerCase();\n        // Prioritize prefix matches\n        const aStarts = aLower.startsWith(query) ? 0 : 1;\n        const bStarts = bLower.startsWith(query) ? 0 : 1;\n        if (aStarts !== bStarts) return aStarts - bStarts;\n        return aLower.localeCompare(bLower);\n      })\n      .map((tag) => ({\n        label: `#${tag}`,\n        apply: `#${tag}`,\n        type: 'keyword',\n      }));\n\n    return {\n      from: match.from,\n      to: match.to,\n      options,\n      validFor: /^#[\\w/-]*$/,\n    };\n  };\n}\n","/**\n * Create a searchable note index for wiki-link autocomplete.\n *\n * @param {Array<{title: string, aliases?: string[]}>} notes - Array of note objects\n * @returns {{search: (query: string) => Array, resolve: (title: string) => Object|null}} Note index\n *\n * @example\n * const noteIndex = createNoteIndex([\n *   { title: 'Project Plan', aliases: ['Plan'] },\n *   { title: 'Meeting Notes' },\n * ]);\n */\nexport function createNoteIndex(notes = []) {\n  const entries = notes.map((note) => ({\n    title: note.title,\n    aliases: Array.isArray(note.aliases) ? note.aliases : [],\n    normalizedTitle: note.title.toLowerCase(),\n    normalizedAliases: Array.isArray(note.aliases)\n      ? note.aliases.map((alias) => alias.toLowerCase())\n      : [],\n  }));\n\n  return {\n    search(query) {\n      const needle = query.trim().toLowerCase();\n      if (!needle) {\n        return entries;\n      }\n\n      const scored = entries\n        .map((entry) => {\n          const titleIndex = entry.normalizedTitle.indexOf(needle);\n          const aliasIndex = entry.normalizedAliases.length\n            ? Math.min(\n                ...entry.normalizedAliases\n                  .map((alias) => alias.indexOf(needle))\n                  .filter((index) => index !== -1)\n              )\n            : -1;\n          const bestIndex = Math.min(\n            titleIndex === -1 ? Number.POSITIVE_INFINITY : titleIndex,\n            aliasIndex === -1 ? Number.POSITIVE_INFINITY : aliasIndex\n          );\n          return { entry, score: bestIndex };\n        })\n        .filter((result) => Number.isFinite(result.score))\n        .sort((a, b) => a.score - b.score);\n\n      return scored.map((result) => result.entry);\n    },\n\n    resolve(title) {\n      const needle = title.trim().toLowerCase();\n      return (\n        entries.find((entry) => entry.normalizedTitle === needle) ||\n        entries.find((entry) => entry.normalizedAliases.includes(needle)) ||\n        null\n      );\n    },\n  };\n}\n\nfunction defaultFormatLink(note) {\n  return `${note.title}]]`;\n}\n\n/**\n * Resolve a wiki link against a note index.\n *\n * @param {Object} noteIndex - Index created by createNoteIndex\n * @param {{title: string}} link - Wiki link object\n * @returns {Object|null} Matched note entry or null\n */\nexport function resolveWikiLink(noteIndex, link) {\n  if (!noteIndex || !link || !link.title) return null;\n  return noteIndex.resolve(link.title);\n}\n\n/**\n * Create a wiki-link completion source for use with @codemirror/autocomplete.\n * Triggers after typing `[[` and provides note title suggestions.\n *\n * Returns a completion source function ‚Äî combine with other sources\n * in a single `autocompletion({ override: [...] })` call.\n *\n * @param {Object} options\n * @param {Object} options.noteIndex - Index created by createNoteIndex\n * @param {(note: Object) => string} [options.formatLink] - Custom link formatter\n * @returns {CompletionSource} A completion source function\n *\n * @example\n * import { autocompletion } from '@codemirror/autocomplete';\n * import { createNoteIndex, wikiLinkAutocomplete } from 'codemirror-for-writers';\n *\n * const noteIndex = createNoteIndex([{ title: 'My Note' }]);\n * const extensions = [\n *   autocompletion({ override: [wikiLinkAutocomplete({ noteIndex })] }),\n * ];\n */\nexport function wikiLinkAutocomplete({ noteIndex, formatLink } = {}) {\n  const format = typeof formatLink === 'function' ? formatLink : defaultFormatLink;\n\n  return (context) => {\n    if (!noteIndex) return null;\n    const match = context.matchBefore(/\\[\\[[^\\[\\]\\n]*$/);\n    if (!match) return null;\n\n    const query = match.text.slice(2);\n    const results = noteIndex.search(query);\n    const options = results.map((note) => ({\n      label: note.title,\n      detail: note.aliases.length ? `aliases: ${note.aliases.join(', ')}` : undefined,\n      apply: format(note),\n      type: 'text',\n    }));\n\n    return {\n      from: match.from + 2,\n      to: match.to,\n      options,\n      validFor: /^[^\\[\\]\\n]*$/,\n    };\n  };\n}\n","import { EditorView, ViewPlugin } from '@codemirror/view';\n\nconst moreMenuTheme = EditorView.baseTheme({\n  '.cm-more-menu-container': {\n    position: 'absolute',\n    top: '8px',\n    right: '8px',\n    zIndex: '6',\n  },\n  '.cm-more-menu-trigger': {\n    width: '32px',\n    height: '32px',\n    borderRadius: '6px',\n    border: 'none',\n    background: 'rgba(0, 0, 0, 0.05)',\n    cursor: 'pointer',\n    fontSize: '18px',\n    lineHeight: '1',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    color: '#555',\n    fontFamily: 'system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n  },\n  '.cm-more-menu-trigger:hover': {\n    background: 'rgba(0, 0, 0, 0.1)',\n  },\n  '.cm-more-menu-dropdown': {\n    position: 'absolute',\n    top: '100%',\n    right: '0',\n    marginTop: '4px',\n    minWidth: '180px',\n    background: '#fff',\n    borderRadius: '8px',\n    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(0, 0, 0, 0.06)',\n    padding: '4px 0',\n    fontFamily: 'system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    fontSize: '14px',\n    overflow: 'hidden',\n  },\n  '.cm-more-menu-item': {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '8px',\n    width: '100%',\n    padding: '8px 12px',\n    border: 'none',\n    background: 'transparent',\n    cursor: 'pointer',\n    textAlign: 'left',\n    color: '#333',\n    fontSize: 'inherit',\n    fontFamily: 'inherit',\n    lineHeight: '1.3',\n  },\n  '.cm-more-menu-item:hover': {\n    background: 'rgba(0, 0, 0, 0.05)',\n  },\n  '.cm-more-menu-check': {\n    width: '16px',\n    textAlign: 'center',\n    flexShrink: '0',\n    fontSize: '13px',\n    color: '#555',\n  },\n  // Dark mode\n  '&dark .cm-more-menu-trigger': {\n    background: 'rgba(255, 255, 255, 0.08)',\n    color: '#aaa',\n  },\n  '&dark .cm-more-menu-trigger:hover': {\n    background: 'rgba(255, 255, 255, 0.14)',\n  },\n  '&dark .cm-more-menu-dropdown': {\n    background: '#2d2d2d',\n    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.08)',\n  },\n  '&dark .cm-more-menu-item': {\n    color: '#d4d4d4',\n  },\n  '&dark .cm-more-menu-item:hover': {\n    background: 'rgba(255, 255, 255, 0.08)',\n  },\n  '&dark .cm-more-menu-check': {\n    color: '#aaa',\n  },\n});\n\n/**\n * Create a \"more\" menu extension that adds a ‚ãØ button in the top-right\n * corner of the editor with a dropdown of toggle items.\n *\n * @param {Object} [options]\n * @param {Array<{label: string, handler: (view: EditorView) => boolean, getState?: (view: EditorView) => boolean}>} [options.items]\n *   Menu items. `handler` is called on click and should return the new toggle\n *   state (true = on). `getState` reads the current state for the checkmark.\n * @returns {Extension[]}\n */\nexport function moreMenu(options = {}) {\n  const items = options.items || [];\n\n  const plugin = ViewPlugin.fromClass(class {\n    constructor(view) {\n      this.view = view;\n      this.open = false;\n\n      // Container ‚Äî inline styles ensure visibility above .cm-scroller in all modes\n      this.container = document.createElement('div');\n      this.container.className = 'cm-more-menu-container';\n      Object.assign(this.container.style, {\n        position: 'absolute',\n        top: '8px',\n        right: '8px',\n        zIndex: '6',\n      });\n\n      // Trigger button\n      this.trigger = document.createElement('button');\n      this.trigger.className = 'cm-more-menu-trigger';\n      this.trigger.textContent = '\\u22EF';\n      this.trigger.title = 'More options';\n      this.trigger.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        this.toggle();\n      });\n      this.container.appendChild(this.trigger);\n\n      // Dropdown\n      this.dropdown = document.createElement('div');\n      this.dropdown.className = 'cm-more-menu-dropdown';\n      this.dropdown.style.display = 'none';\n      this.container.appendChild(this.dropdown);\n\n      // Menu items\n      this.checkEls = [];\n      for (const item of items) {\n        const btn = document.createElement('button');\n        btn.className = 'cm-more-menu-item';\n\n        const check = document.createElement('span');\n        check.className = 'cm-more-menu-check';\n        check.textContent = item.getState ? (item.getState(view) ? '‚úì' : '') : '';\n        this.checkEls.push({ check, item });\n\n        const label = document.createElement('span');\n        label.textContent = item.label;\n\n        btn.appendChild(check);\n        btn.appendChild(label);\n\n        btn.addEventListener('click', (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          item.handler(view);\n          this.refreshChecks();\n        });\n\n        this.dropdown.appendChild(btn);\n      }\n\n      // Close handlers\n      this._onDocClick = (e) => {\n        if (this.open && !this.container.contains(e.target)) {\n          this.close();\n        }\n      };\n      this._onKeyDown = (e) => {\n        if (this.open && e.key === 'Escape') {\n          this.close();\n        }\n      };\n      document.addEventListener('click', this._onDocClick, true);\n      document.addEventListener('keydown', this._onKeyDown);\n\n      // Insert into editor\n      view.dom.appendChild(this.container);\n    }\n\n    toggle() {\n      this.open ? this.close() : this.show();\n    }\n\n    show() {\n      this.open = true;\n      this.refreshChecks();\n      this.dropdown.style.display = '';\n    }\n\n    close() {\n      this.open = false;\n      this.dropdown.style.display = 'none';\n    }\n\n    refreshChecks() {\n      for (const { check, item } of this.checkEls) {\n        check.textContent = item.getState ? (item.getState(this.view) ? '‚úì' : '') : '';\n      }\n    }\n\n    update(update) {\n      if (this.open) {\n        this.refreshChecks();\n      }\n    }\n\n    destroy() {\n      document.removeEventListener('click', this._onDocClick, true);\n      document.removeEventListener('keydown', this._onKeyDown);\n      this.container.remove();\n    }\n  });\n\n  return [plugin, moreMenuTheme];\n}\n","import { EditorView, rectangularSelection, crosshairCursor } from '@codemirror/view';\nimport { EditorState, Compartment, Facet, StateField, StateEffect } from '@codemirror/state';\nimport { markdown } from '@codemirror/lang-markdown';\nimport { keymap } from '@codemirror/view';\nimport { defaultKeymap, history, historyKeymap } from '@codemirror/commands';\nimport { search, searchKeymap } from '@codemirror/search';\n\n// Internal extensions\nimport { hybridPreview } from './extensions/hybrid-preview.js';\nimport { markdownKeymap } from './extensions/keymaps.js';\nimport { highlightSelectedLines } from './extensions/selected-line.js';\nimport { actions } from './extensions/actions.js';\nimport { allowReadOnlyEdit } from './extensions/read-only.js';\nimport { typewriterPlugin } from './extensions/typewriter.js';\nimport { focusModePlugin, createFocusModePlugin } from './extensions/focus-mode.js';\nimport { wordCountPanel } from './extensions/word-count.js';\nimport { bottomToolbar as bottomToolbarExtension } from './extensions/bottom-toolbar.js';\nimport { backlinksPanel, backlinksFacet } from './extensions/backlinks.js';\nimport { frontmatterSheetPlugin, frontmatterKeysFacet } from './extensions/frontmatter-sheet.js';\nimport { toggleSheetEffect, frontmatterSheetField } from './extensions/hybrid-preview.js';\nimport { writingModeSheetPlugin } from './extensions/writing-mode-sheet.js';\nimport {\n  writingModeConfigFacet,\n  setWritingModeSheetEffect,\n  setTypewriterEffect,\n  setFocusModeEffect,\n  setFocusLevelEffect,\n  setDimIntensityEffect,\n  writingModeField,\n} from './extensions/writing-mode-state.js';\n\n// Themes\nimport { baseTheme } from './theme/base.js';\nimport { lightTheme } from './theme/light.js';\nimport { darkTheme } from './theme/dark.js';\nimport { rawModeTheme, rawModeDarkTheme } from './theme/raw-mode.js';\n\n/**\n * Configuration options for the hybrid markdown extension\n */\nexport const HybridMarkdownConfig = Facet.define({\n  combine(configs) {\n    return {\n      enablePreview: configs.reduce((a, c) => c.enablePreview ?? a, true),\n      enableKeymap: configs.reduce((a, c) => c.enableKeymap ?? a, true),\n      enableCollapse: configs.reduce((a, c) => c.enableCollapse ?? a, true),\n      enableCustomTasks: configs.reduce((a, c) => c.enableCustomTasks ?? a, false),\n      customTaskTypes: configs.reduce((a, c) => c.customTaskTypes ?? a, undefined),\n      enableWikiLinks: configs.reduce((a, c) => c.enableWikiLinks ?? a, false),\n      enableTags: configs.reduce((a, c) => c.enableTags ?? a, false),\n      onTagClick: configs.reduce((a, c) => c.onTagClick ?? a, undefined),\n      renderWikiLinks: configs.reduce((a, c) => c.renderWikiLinks ?? a, true),\n      onWikiLinkClick: configs.reduce((a, c) => c.onWikiLinkClick ?? a, undefined),\n      readOnly: configs.reduce((a, c) => c.readOnly ?? a, false),\n      typewriter: configs.reduce((a, c) => c.typewriter ?? a, false),\n      focusMode: configs.reduce((a, c) => c.focusMode ?? a, false),\n      focusLevel: configs.reduce((a, c) => c.focusLevel ?? a, 'paragraph'),\n      dimIntensity: configs.reduce((a, c) => c.dimIntensity ?? a, 30),\n      toolbar: configs.reduce((a, c) => c.toolbar ?? a, true),\n      wordCount: configs.reduce((a, c) => c.wordCount ?? a, false),\n      backlinks: configs.reduce((a, c) => c.backlinks ?? a, false),\n      docTitle: configs.reduce((a, c) => c.docTitle ?? a, undefined),\n      onBacklinksRequested: configs.reduce((a, c) => c.onBacklinksRequested ?? a, undefined),\n      onBacklinkClick: configs.reduce((a, c) => c.onBacklinkClick ?? a, undefined),\n      frontmatterKeys: configs.reduce((a, c) => c.frontmatterKeys ?? a, undefined),\n      theme: configs.reduce((a, c) => c.theme ?? a, 'light'),\n    };\n  },\n});\n\n// ============================================================================\n// STATE MANAGEMENT\n// ============================================================================\n//\n// Editor state (theme, mode) is stored in a StateField rather than global\n// variables. This ensures:\n// - Multiple editor instances work correctly on the same page\n// - State is properly isolated per editor\n// - State can be serialized/restored if needed\n//\n// To modify state, dispatch a StateEffect which the StateField responds to.\n// ============================================================================\n\n/**\n * StateEffect for changing theme\n * @type {StateEffectType<'light'|'dark'>}\n */\nconst setThemeEffect = StateEffect.define();\n\n/**\n * StateEffect for changing mode\n * @type {StateEffectType<'hybrid'|'raw'>}\n */\nconst setModeEffect = StateEffect.define();\n\n/**\n * StateEffect for changing read-only mode\n * @type {StateEffectType<boolean>}\n */\nconst setReadOnlyEffect = StateEffect.define();\n\n/**\n * StateEffect for changing bottom toolbar visibility\n * @type {StateEffectType<boolean>}\n */\nconst setToolbarEffect = StateEffect.define();\n\n/**\n * StateEffect for changing word count panel visibility\n * @type {StateEffectType<boolean>}\n */\nconst setWordCountEffect = StateEffect.define();\n\n/**\n * StateEffect for changing backlinks panel visibility\n * @type {StateEffectType<boolean>}\n */\nconst setBacklinksEffect = StateEffect.define();\n\n/**\n * StateField that stores the current theme and mode for this editor instance.\n * This replaces global variables, allowing multiple editors on the same page.\n */\nconst editorStateField = StateField.define({\n  create(state) {\n    // Read initial values from the configuration facet\n    const config = state.facet(HybridMarkdownConfig);\n    return {\n      theme: config.theme || 'light',\n      mode: config.enablePreview !== false ? 'hybrid' : 'raw',\n      readOnly: config.readOnly === true,\n      typewriter: config.typewriter === true,\n      focusMode: config.focusMode === true,\n      focusLevel: config.focusLevel || 'paragraph',\n      dimIntensity: config.dimIntensity != null ? config.dimIntensity : 30,\n      writingModeSheet: false,\n      toolbar: config.toolbar !== false,\n      wordCount: config.wordCount === true,\n      backlinks: config.backlinks === true,\n    };\n  },\n  update(value, tr) {\n    // Apply any theme/mode effects\n    for (const effect of tr.effects) {\n      if (effect.is(setThemeEffect)) {\n        value = { ...value, theme: effect.value };\n      } else if (effect.is(setModeEffect)) {\n        value = { ...value, mode: effect.value };\n      } else if (effect.is(setReadOnlyEffect)) {\n        value = { ...value, readOnly: effect.value };\n      } else if (effect.is(setTypewriterEffect)) {\n        value = { ...value, typewriter: effect.value };\n      } else if (effect.is(setFocusModeEffect)) {\n        value = { ...value, focusMode: effect.value };\n      } else if (effect.is(setFocusLevelEffect)) {\n        value = { ...value, focusLevel: effect.value };\n      } else if (effect.is(setDimIntensityEffect)) {\n        value = { ...value, dimIntensity: effect.value };\n      } else if (effect.is(setWritingModeSheetEffect)) {\n        value = { ...value, writingModeSheet: effect.value };\n      } else if (effect.is(setToolbarEffect)) {\n        value = { ...value, toolbar: effect.value };\n      } else if (effect.is(setWordCountEffect)) {\n        value = { ...value, wordCount: effect.value };\n      } else if (effect.is(setBacklinksEffect)) {\n        value = { ...value, backlinks: effect.value };\n      }\n    }\n    return value;\n  },\n});\n\n// Compartments for dynamic reconfiguration\nconst themeCompartment = new Compartment();\nconst previewCompartment = new Compartment();\nconst rawModeCompartment = new Compartment();\nconst selectedLineCompartment = new Compartment();\nconst readOnlyCompartment = new Compartment();\nconst typewriterCompartment = new Compartment();\nconst focusModeCompartment = new Compartment();\nconst toolbarCompartment = new Compartment();\nconst wordCountCompartment = new Compartment();\nconst backlinksCompartment = new Compartment();\n\nconst readOnlyTransactionFilter = EditorState.transactionFilter.of((tr) => {\n  if (!tr.startState.readOnly || !tr.docChanged) {\n    return tr;\n  }\n\n  if (tr.annotation(allowReadOnlyEdit)) {\n    return tr;\n  }\n\n  return { changes: [] };\n});\n\n/**\n * Transaction extender: when writing-mode effects are dispatched (e.g. from the sheet),\n * automatically append the corresponding compartment reconfigurations.\n */\nconst writingModeTransactionExtender = EditorState.transactionExtender.of((tr) => {\n  const effects = [];\n  let needsTypewriter = null;\n  let needsFocusMode = null;\n  let needsFocusLevel = null;\n  let needsDimIntensity = null;\n\n  for (const effect of tr.effects) {\n    if (effect.is(setTypewriterEffect)) needsTypewriter = effect.value;\n    if (effect.is(setFocusModeEffect)) needsFocusMode = effect.value;\n    if (effect.is(setFocusLevelEffect)) needsFocusLevel = effect.value;\n    if (effect.is(setDimIntensityEffect)) needsDimIntensity = effect.value;\n  }\n\n  // Read current state to fill in unchanged values\n  const current = tr.startState.field(editorStateField);\n\n  if (needsTypewriter !== null) {\n    effects.push(typewriterCompartment.reconfigure(needsTypewriter ? typewriterPlugin : []));\n  }\n\n  if (needsFocusMode !== null || needsFocusLevel !== null || needsDimIntensity !== null) {\n    const fm = needsFocusMode !== null ? needsFocusMode : current.focusMode;\n    const level = needsFocusLevel !== null ? needsFocusLevel : current.focusLevel;\n    const intensity = needsDimIntensity !== null ? needsDimIntensity : current.dimIntensity;\n    effects.push(focusModeCompartment.reconfigure(fm ? createFocusModePlugin(level, intensity) : []));\n  }\n\n  return effects.length > 0 ? { effects } : null;\n});\n\n/**\n * Get the theme extension for the given theme name\n */\nfunction getThemeExtension(theme) {\n  return theme === 'dark' ? darkTheme : lightTheme;\n}\n\n/**\n * Get the raw mode extension for the given theme\n */\nfunction getRawModeExtension(theme, enabled) {\n  if (!enabled) return [];\n  return theme === 'dark' ? rawModeDarkTheme : rawModeTheme;\n}\n\n/**\n * Create the hybrid markdown extension\n *\n * @param {Object} options - Configuration options\n * @param {boolean} [options.enablePreview=true] - Enable hybrid preview mode\n * @param {boolean} [options.enableKeymap=true] - Enable markdown keyboard shortcuts\n * @param {'light'|'dark'} [options.theme='light'] - Initial theme\n * @param {boolean} [options.enableCustomTasks=false] - Enable custom task types in preview\n * @param {string[]} [options.customTaskTypes] - Custom task type order (e.g. ['i','!','?','*','>','<'])\n * @param {boolean} [options.enableWikiLinks=false] - Enable wiki-link parsing/highlighting in hybrid preview\n * @param {boolean} [options.renderWikiLinks=true] - Render wiki links in preview when enabled\n * @param {(link: {raw: string, title: string, section: string, alias: string, display: string}) => void} [options.onWikiLinkClick] - Optional handler for preview wiki-link clicks\n * @param {boolean} [options.readOnly=false] - Enable read-only mode (allows task toggles)\n * @param {boolean} [options.toolbar=true] - Show bottom formatting toolbar\n * @returns {Extension[]} Array of CodeMirror extensions\n *\n * @example\n * import { EditorState } from '@codemirror/state';\n * import { EditorView } from '@codemirror/view';\n * import { hybridMarkdown } from 'codemirror-for-writers';\n *\n * const state = EditorState.create({\n *   doc: '# Hello World',\n *   extensions: [\n *     hybridMarkdown({ theme: 'dark' }),\n *   ],\n * });\n *\n * const view = new EditorView({ state, parent: document.body });\n */\nexport function hybridMarkdown(options = {}) {\n  const {\n    enablePreview = true,\n    enableKeymap = true,\n    enableCollapse = true,\n    theme = 'light',\n    enableCustomTasks = false,\n    customTaskTypes,\n    enableWikiLinks = false,\n    renderWikiLinks = true,\n    onWikiLinkClick,\n    enableTags = false,\n    onTagClick,\n    readOnly = false,\n    typewriter = false,\n    focusMode = false,\n    focusLevel = 'paragraph',\n    dimIntensity = 30,\n    toolbar = true,\n    wordCount = false,\n    backlinks = false,\n    docTitle,\n    onBacklinksRequested,\n    onBacklinkClick,\n    frontmatterKeys,\n  } = options;\n\n  const extensions = [\n    // Store configuration in facet (for StateField to read initial values)\n    HybridMarkdownConfig.of(options),\n\n    // StateField for tracking theme/mode per editor instance\n    editorStateField,\n\n    // Read-only enforcement\n    readOnlyTransactionFilter,\n\n    // Auto-reconfigure compartments when writing mode effects are dispatched\n    writingModeTransactionExtender,\n    readOnlyCompartment.of(EditorState.readOnly.of(readOnly)),\n\n    // Core functionality\n    history(),\n    keymap.of([...defaultKeymap, ...historyKeymap, ...searchKeymap]),\n\n    // Search panel + keybindings\n    search(),\n\n    // Multiple selections (rectangular selection + crosshair cursor)\n    rectangularSelection(),\n    crosshairCursor(),\n\n    // Markdown language support\n    markdown(),\n\n    // Base theme (required styles)\n    baseTheme,\n\n    // Theme (in compartment for dynamic switching)\n    themeCompartment.of(getThemeExtension(theme)),\n\n    // Raw mode theme (in compartment for toggling)\n    rawModeCompartment.of(getRawModeExtension(theme, !enablePreview)),\n\n    // Highlight selected lines (disabled in raw mode)\n    selectedLineCompartment.of(enablePreview ? highlightSelectedLines : []),\n\n    // Typewriter mode (cursor stays vertically centered)\n    typewriterCompartment.of(typewriter ? typewriterPlugin : []),\n\n    // Focus mode (dims non-active paragraphs)\n    focusModeCompartment.of(focusMode ? createFocusModePlugin(focusLevel, dimIntensity) : []),\n\n    // Bottom formatting toolbar\n    toolbarCompartment.of(toolbar ? bottomToolbarExtension() : []),\n\n    // Word count panel (bottom status bar)\n    wordCountCompartment.of(wordCount ? wordCountPanel : []),\n\n    // Backlinks panel (bottom panel showing incoming links)\n    backlinksFacet.of({\n      docTitle: docTitle || null,\n      onBacklinksRequested: typeof onBacklinksRequested === 'function' ? onBacklinksRequested : null,\n      onBacklinkClick: typeof onBacklinkClick === 'function' ? onBacklinkClick : null,\n    }),\n    backlinksCompartment.of(backlinks ? backlinksPanel : []),\n\n    // Frontmatter sheet overlay (always loaded, just hidden when closed)\n    frontmatterKeysFacet.of(Array.isArray(frontmatterKeys) ? frontmatterKeys : []),\n    frontmatterSheetPlugin,\n\n    // Writing mode shared state (used by writing-mode-sheet plugin)\n    writingModeConfigFacet.of({ typewriter, focusMode, focusLevel, dimIntensity }),\n    writingModeField,\n\n    // Writing mode sheet overlay (always loaded, just hidden when closed)\n    writingModeSheetPlugin,\n\n    // Line wrapping\n    EditorView.lineWrapping,\n  ];\n\n  // Optional: Hybrid preview\n  if (enablePreview) {\n    extensions.push(previewCompartment.of(hybridPreview({\n      enableCollapse,\n      enableCustomTasks,\n      customTaskTypes,\n      enableWikiLinks,\n      renderWikiLinks,\n      onWikiLinkClick,\n      enableTags,\n      onTagClick,\n    })));\n  } else {\n    extensions.push(previewCompartment.of([]));\n  }\n\n  // Optional: Markdown keyboard shortcuts\n  if (enableKeymap) {\n    extensions.push(markdownKeymap);\n  }\n\n  return extensions;\n}\n\n/**\n * Toggle between light and dark themes\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now in dark mode, false if light\n */\nexport function toggleTheme(view) {\n  const currentState = view.state.field(editorStateField);\n  const newTheme = currentState.theme === 'light' ? 'dark' : 'light';\n\n  view.dispatch({\n    effects: [\n      setThemeEffect.of(newTheme),\n      themeCompartment.reconfigure(getThemeExtension(newTheme)),\n      rawModeCompartment.reconfigure(getRawModeExtension(newTheme, currentState.mode === 'raw')),\n    ],\n  });\n\n  return newTheme === 'dark';\n}\n\n/**\n * Toggle between hybrid preview mode and raw markdown mode\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if in hybrid mode, false if raw\n */\nexport function toggleHybridMode(view) {\n  const currentState = view.state.field(editorStateField);\n  const newMode = currentState.mode === 'hybrid' ? 'raw' : 'hybrid';\n  const isHybrid = newMode === 'hybrid';\n  const config = view.state.facet(HybridMarkdownConfig);\n\n  view.dispatch({\n    effects: [\n      setModeEffect.of(newMode),\n      previewCompartment.reconfigure(isHybrid ? hybridPreview({\n        enableCollapse: config.enableCollapse,\n        enableCustomTasks: config.enableCustomTasks,\n        customTaskTypes: config.customTaskTypes,\n      }) : []),\n      rawModeCompartment.reconfigure(getRawModeExtension(currentState.theme, !isHybrid)),\n      selectedLineCompartment.reconfigure(isHybrid ? highlightSelectedLines : []),\n    ],\n  });\n\n  return isHybrid;\n}\n\n/**\n * Toggle read-only mode\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now read-only, false if editable\n */\nexport function toggleReadOnly(view) {\n  const currentState = view.state.field(editorStateField);\n  const newReadOnly = !currentState.readOnly;\n\n  view.dispatch({\n    effects: [\n      setReadOnlyEffect.of(newReadOnly),\n      readOnlyCompartment.reconfigure(EditorState.readOnly.of(newReadOnly)),\n    ],\n  });\n\n  return newReadOnly;\n}\n\n/**\n * Set read-only mode explicitly\n * @param {EditorView} view - The editor view\n * @param {boolean} readOnly - Whether the editor should be read-only\n */\nexport function setReadOnly(view, readOnly) {\n  view.dispatch({\n    effects: [\n      setReadOnlyEffect.of(readOnly),\n      readOnlyCompartment.reconfigure(EditorState.readOnly.of(readOnly)),\n    ],\n  });\n}\n\n/**\n * Toggle typewriter mode\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now enabled\n */\nexport function toggleTypewriter(view) {\n  const currentState = view.state.field(editorStateField);\n  const enabled = !currentState.typewriter;\n  view.dispatch({ effects: setTypewriterEffect.of(enabled) });\n  return enabled;\n}\n\n/**\n * Set typewriter mode explicitly\n * @param {EditorView} view - The editor view\n * @param {boolean} enabled - Whether typewriter mode should be enabled\n */\nexport function setTypewriter(view, enabled) {\n  view.dispatch({ effects: setTypewriterEffect.of(enabled) });\n}\n\n/**\n * Get current typewriter mode state\n * @param {EditorView} view - The editor view\n * @returns {boolean}\n */\nexport function isTypewriter(view) {\n  return view.state.field(editorStateField).typewriter;\n}\n\n/**\n * Toggle focus mode\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now enabled\n */\nexport function toggleFocusMode(view) {\n  const currentState = view.state.field(editorStateField);\n  const enabled = !currentState.focusMode;\n  view.dispatch({ effects: setFocusModeEffect.of(enabled) });\n  return enabled;\n}\n\n/**\n * Set focus mode explicitly\n * @param {EditorView} view - The editor view\n * @param {boolean} enabled - Whether focus mode should be enabled\n */\nexport function setFocusMode(view, enabled) {\n  view.dispatch({ effects: setFocusModeEffect.of(enabled) });\n}\n\n/**\n * Get current focus mode state\n * @param {EditorView} view - The editor view\n * @returns {boolean}\n */\nexport function isFocusMode(view) {\n  return view.state.field(editorStateField).focusMode;\n}\n\n/**\n * Set focus level\n * @param {EditorView} view - The editor view\n * @param {'line'|'sentence'|'paragraph'} level\n */\nexport function setFocusLevel(view, level) {\n  view.dispatch({ effects: setFocusLevelEffect.of(level) });\n}\n\n/**\n * Get current focus level\n * @param {EditorView} view - The editor view\n * @returns {'line'|'sentence'|'paragraph'}\n */\nexport function getFocusLevel(view) {\n  return view.state.field(editorStateField).focusLevel;\n}\n\n/**\n * Set dim intensity\n * @param {EditorView} view - The editor view\n * @param {number} intensity - 0-100\n */\nexport function setDimIntensity(view, intensity) {\n  view.dispatch({ effects: setDimIntensityEffect.of(intensity) });\n}\n\n/**\n * Get current dim intensity\n * @param {EditorView} view - The editor view\n * @returns {number}\n */\nexport function getDimIntensity(view) {\n  return view.state.field(editorStateField).dimIntensity;\n}\n\n/**\n * Get the current writing mode\n * @param {EditorView} view - The editor view\n * @returns {'normal'|'typewriter'|'focus'|'both'}\n */\nexport function getWritingMode(view) {\n  const s = view.state.field(editorStateField);\n  if (s.typewriter && s.focusMode) return 'both';\n  if (s.typewriter) return 'typewriter';\n  if (s.focusMode) return 'focus';\n  return 'normal';\n}\n\n/**\n * Set writing mode\n * @param {EditorView} view - The editor view\n * @param {'normal'|'typewriter'|'focus'|'both'} mode\n */\nexport function setWritingMode(view, mode) {\n  const tw = mode === 'typewriter' || mode === 'both';\n  const fm = mode === 'focus' || mode === 'both';\n  view.dispatch({\n    effects: [\n      setTypewriterEffect.of(tw),\n      setFocusModeEffect.of(fm),\n    ],\n  });\n}\n\n/**\n * Toggle the writing mode sheet overlay\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now open\n */\nexport function toggleWritingModeSheet(view) {\n  const isOpen = view.state.field(editorStateField).writingModeSheet;\n  view.dispatch({ effects: setWritingModeSheetEffect.of(!isOpen) });\n  return !isOpen;\n}\n\n/**\n * Set the writing mode sheet state explicitly\n * @param {EditorView} view - The editor view\n * @param {boolean} open\n */\nexport function setWritingModeSheet(view, open) {\n  view.dispatch({ effects: setWritingModeSheetEffect.of(open) });\n}\n\n/**\n * Get current writing mode sheet state\n * @param {EditorView} view - The editor view\n * @returns {boolean}\n */\nexport function isWritingModeSheet(view) {\n  return view.state.field(editorStateField).writingModeSheet;\n}\n\n/**\n * Toggle bottom formatting toolbar\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now enabled\n */\nexport function toggleToolbar(view) {\n  const currentState = view.state.field(editorStateField);\n  const enabled = !currentState.toolbar;\n\n  view.dispatch({\n    effects: [\n      setToolbarEffect.of(enabled),\n      toolbarCompartment.reconfigure(enabled ? bottomToolbarExtension() : []),\n    ],\n  });\n\n  return enabled;\n}\n\n/**\n * Set bottom formatting toolbar visibility explicitly\n * @param {EditorView} view - The editor view\n * @param {boolean} enabled - Whether the toolbar should be shown\n */\nexport function setToolbar(view, enabled) {\n  view.dispatch({\n    effects: [\n      setToolbarEffect.of(enabled),\n      toolbarCompartment.reconfigure(enabled ? bottomToolbarExtension() : []),\n    ],\n  });\n}\n\n/**\n * Get current bottom toolbar visibility state\n * @param {EditorView} view - The editor view\n * @returns {boolean}\n */\nexport function isToolbar(view) {\n  return view.state.field(editorStateField).toolbar;\n}\n\n/**\n * Toggle word count panel\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now enabled\n */\nexport function toggleWordCount(view) {\n  const currentState = view.state.field(editorStateField);\n  const enabled = !currentState.wordCount;\n\n  view.dispatch({\n    effects: [\n      setWordCountEffect.of(enabled),\n      wordCountCompartment.reconfigure(enabled ? wordCountPanel : []),\n    ],\n  });\n\n  return enabled;\n}\n\n/**\n * Set word count panel explicitly\n * @param {EditorView} view - The editor view\n * @param {boolean} enabled - Whether the word count panel should be shown\n */\nexport function setWordCount(view, enabled) {\n  view.dispatch({\n    effects: [\n      setWordCountEffect.of(enabled),\n      wordCountCompartment.reconfigure(enabled ? wordCountPanel : []),\n    ],\n  });\n}\n\n/**\n * Get current word count panel state\n * @param {EditorView} view - The editor view\n * @returns {boolean}\n */\nexport function isWordCount(view) {\n  return view.state.field(editorStateField).wordCount;\n}\n\n/**\n * Toggle backlinks panel\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now enabled\n */\nexport function toggleBacklinks(view) {\n  const currentState = view.state.field(editorStateField);\n  const enabled = !currentState.backlinks;\n\n  view.dispatch({\n    effects: [\n      setBacklinksEffect.of(enabled),\n      backlinksCompartment.reconfigure(enabled ? backlinksPanel : []),\n    ],\n  });\n\n  return enabled;\n}\n\n/**\n * Set backlinks panel explicitly\n * @param {EditorView} view - The editor view\n * @param {boolean} enabled - Whether the backlinks panel should be shown\n */\nexport function setBacklinks(view, enabled) {\n  view.dispatch({\n    effects: [\n      setBacklinksEffect.of(enabled),\n      backlinksCompartment.reconfigure(enabled ? backlinksPanel : []),\n    ],\n  });\n}\n\n/**\n * Get current backlinks panel state\n * @param {EditorView} view - The editor view\n * @returns {boolean}\n */\nexport function isBacklinks(view) {\n  return view.state.field(editorStateField).backlinks;\n}\n\n/**\n * Toggle the frontmatter properties sheet overlay\n * @param {EditorView} view - The editor view\n * @returns {boolean} True if now open, false if closed\n */\nexport function toggleFrontmatterSheet(view) {\n  const isOpen = view.state.field(frontmatterSheetField);\n  view.dispatch({ effects: toggleSheetEffect.of(!isOpen) });\n  return !isOpen;\n}\n\n/**\n * Set the frontmatter sheet state explicitly\n * @param {EditorView} view - The editor view\n * @param {boolean} open - Whether the sheet should be open\n */\nexport function setFrontmatterSheet(view, open) {\n  view.dispatch({ effects: toggleSheetEffect.of(open) });\n}\n\n/**\n * Get current frontmatter sheet state\n * @param {EditorView} view - The editor view\n * @returns {boolean}\n */\nexport function isFrontmatterSheet(view) {\n  return view.state.field(frontmatterSheetField);\n}\n\n/**\n * Set the theme explicitly\n * @param {EditorView} view - The editor view\n * @param {'light'|'dark'} theme - The theme to set\n */\nexport function setTheme(view, theme) {\n  const currentState = view.state.field(editorStateField);\n\n  view.dispatch({\n    effects: [\n      setThemeEffect.of(theme),\n      themeCompartment.reconfigure(getThemeExtension(theme)),\n      rawModeCompartment.reconfigure(getRawModeExtension(theme, currentState.mode === 'raw')),\n    ],\n  });\n}\n\n/**\n * Set the mode explicitly\n * @param {EditorView} view - The editor view\n * @param {'hybrid'|'raw'} mode - The mode to set\n */\nexport function setMode(view, mode) {\n  const currentState = view.state.field(editorStateField);\n  const isHybrid = mode === 'hybrid';\n  const config = view.state.facet(HybridMarkdownConfig);\n\n  view.dispatch({\n    effects: [\n      setModeEffect.of(mode),\n      previewCompartment.reconfigure(isHybrid ? hybridPreview({\n        enableCollapse: config.enableCollapse,\n        enableCustomTasks: config.enableCustomTasks,\n        customTaskTypes: config.customTaskTypes,\n      }) : []),\n      rawModeCompartment.reconfigure(getRawModeExtension(currentState.theme, !isHybrid)),\n      selectedLineCompartment.reconfigure(isHybrid ? highlightSelectedLines : []),\n    ],\n  });\n}\n\n/**\n * Get current read-only state for an editor instance\n * @param {EditorView} view - The editor view\n * @returns {boolean}\n */\nexport function isReadOnly(view) {\n  return view.state.field(editorStateField).readOnly;\n}\n\n/**\n * Get current theme for an editor instance\n * @param {EditorView} view - The editor view\n * @returns {'light'|'dark'}\n */\nexport function getTheme(view) {\n  return view.state.field(editorStateField).theme;\n}\n\n/**\n * Get current mode for an editor instance\n * @param {EditorView} view - The editor view\n * @returns {'hybrid'|'raw'}\n */\nexport function getMode(view) {\n  return view.state.field(editorStateField).mode;\n}\n\n// Re-export actions for toolbar/external use\nexport { actions };\n\n// Re-export individual themes for advanced use cases\nexport { lightTheme, darkTheme, baseTheme };\n\n// Re-export extensions for advanced composition\nexport { hybridPreview } from './extensions/hybrid-preview.js';\nexport { markdownKeymap } from './extensions/keymaps.js';\nexport { highlightSelectedLines } from './extensions/selected-line.js';\nexport { typewriterPlugin } from './extensions/typewriter.js';\nexport { focusModePlugin, createFocusModePlugin } from './extensions/focus-mode.js';\nexport { writingModeSheetPlugin } from './extensions/writing-mode-sheet.js';\nexport { wordCountPanel } from './extensions/word-count.js';\nexport { tagAutocomplete } from './extensions/tag-autocomplete.js';\nexport { createNoteIndex, resolveWikiLink, wikiLinkAutocomplete } from './extensions/wiki-link-autocomplete.js';\nexport { backlinksPanel } from './extensions/backlinks.js';\nexport { bottomToolbar } from './extensions/bottom-toolbar.js';\nexport { moreMenu } from './extensions/more-menu.js';\n"],"names":["allowReadOnlyEdit","Annotation","CUSTOM_TASK_TYPES","CUSTOM_TASK_META","WIKI_LINK_OPEN","WIKI_LINK_CLOSE","isTrimmed","value","parseWikiLinkContent","content","pipeIndex","target","alias","hashIndex","title","section","display","findClosingBackticks","text","start","tickCount","ticks","findWikiLinks","matches","i","end","meta","FIND_TAGS_REGEX","findTags","codeRanges","tickMatch","tickRegex","closePos","isInCode","pos","r","m","hashPos","md","MarkdownIt","markdownItEmoji","addWikiLinkRule","markdown","state","silent","token","tokens","idx","escape","attrs","label","TAG_REGEX","addTagRule","prev","match","tagName","addInlineMathRule","katex","addHighlightRule","addSubscriptRule","addSuperscriptRule","addFootnoteReferenceRule","id","renderBlockMath","renderFootnoteDef","options","rendered","renderInline","env","renderFootnoteBlock","lines","firstMatch","firstContent","parts","firstRendered","line","renderDefinitionList","term","definitions","current","defMatch","continuation","termHtml","defHtml","defLines","renderMarkdownLine","enableCustomTasks","customTaskTypes","customTaskSet","enableWikiLinks","renderOptions","footnoteDefMatch","headerMatch","level","headingId","idMatch","idAttr","listMatch","marker","taskMatch","checked","emoji","customTaskMatch","trimmed","cell","renderTable","rows","parseRow","row","isSeparator","headerRow","bodyRows","separatorFound","cells","html","languageMap","javascript","python","css","json","escapeHtml","highlightCode","code","language","langFn","tree","result","highlightTree","classHighlighter","from","to","classes","enableCollapseFacet","Facet","values","DEFAULT_CUSTOM_TASK_TYPES","TASK_TOKEN_REGEX","normalizeCustomTaskTypes","types","normalized","seen","raw","getTaskCycle","buildCustomTasksConfig","normalizedTypes","customTasksFacet","buildWikiLinksConfig","renderWikiLinks","onWikiLinkClick","enabled","wikiLinksFacet","buildTagsConfig","enableTags","onTagClick","tagsFacet","getListTaskToken","config","getNextTaskToken","currentToken","cycle","index","replaceTaskToken","nextToken","getWikiLinkData","element","toggleCollapseEffect","StateEffect","collapsedHeadingsField","StateField","collapsed","tr","newCollapsed","effect","adjustedSet","lineNum","oldDoc","oldLine","newPos","newLineNum","newLineText","mermaid","MarkdownPreviewWidget","WidgetType","lineFrom","lineTo","view","wrapper","customTasksConfig","wikiLinksConfig","tagsConfig","e","tagEl","footnoteLink","footnoteId","doc","footnoteBackref","wikiLink","link","taskConfig","newContent","rect","clickX","totalWidth","textLength","charPos","ratio","cursorPos","other","event","HeadingPreviewWidget","lineNumber","isCollapsed","hasContent","toggle","headingContent","getFocusedLines","focused","range","startLine","endLine","computeFrontmatterRange","computeCodeBlockRanges","ranges","inCodeBlock","blockStart","blockLanguage","computeMathBlockRanges","codeBlockLineSet","mathStart","computeTableRanges","tableStart","isIndentedContinuation","computeFootnoteDefinitionRanges","j","nextLine","computeDefinitionListRanges","footnoteLineSet","isDefinitionLine","isTermCandidate","nextLineNum","buildLineSet","lineSet","computeHeadingRanges","codeBlockLines","headings","buildHeadingMap","map","heading","blockRangesField","computeBlockRanges","frontmatter","frontmatterLines","codeBlocks","mathBlocks","mathBlockLines","tables","tableLines","footnoteBlocks","footnoteBlockLines","definitionLists","definitionListLines","mermaidBlocks","mermaidBlockLines","headingMap","MathBlockWidget","mathFrom","mathTo","MermaidBlockWidget","mermaidFrom","mermaidTo","svg","TableWidget","tableFrom","tableTo","FootnoteBlockWidget","DefinitionListWidget","isLineCollapsed","getHeadingInfo","buildDecorations","blockRanges","focusedLines","decorations","collapseEnabled","Decoration","parseImageLine","headingInfo","buildWikiLinkDecorations","hybridPreviewPlugin","ViewPlugin","update","hasCollapseEffect","v","wikiLinkDecorations","buildTagDecorations","tagDecorations","HighlightedCodeWidget","buildCodeBlockDecorations","hasFocus","blockFocused","isFence","lineClass","isFocused","codeBlockDecorations","buildTableDecorations","tableFocused","firstLine","tableDecorations","buildFootnoteBlockDecorations","footnoteBlockDecorations","buildDefinitionListDecorations","definitionListDecorations","buildMathBlockDecorations","mathFocused","mathLines","mathContent","mathBlockDecorations","buildMermaidBlockDecorations","mermaidFocused","mermaidLines","mermaidContent","mermaidBlockDecorations","IMAGE_LINE_REGEX","ImagePreviewWidget","alt","url","img","error","altText","buildImageDecorations","imageData","imageDecorations","toggleSheetEffect","frontmatterSheetField","open","serializeYaml","obj","yaml","createValueEditor","key","parsedYaml","fmContentFrom","fmContentTo","container","checkbox","updated","newYaml","tag","newArr","newVal","addTag","input","parsed","newValue","buildFrontmatterPropertyTable","yamlContent","contentFrom","contentTo","blockFrom","knownKeys","table","datalistId","datalist","currentKeys","k","opt","keys","keyCell","keyInput","newKey","valueCell","deleteCell","deleteBtn","addRow","counter","buildFrontmatterDecorations","frontmatterDecorations","hybridPreview","enableCollapse","focusReplaceField","panel","replaceField","wrapSelection","before","after","prefixLine","prefix","toggleHeading","headingMatch","targetPrefix","currentPrefix","toggleList","type","bulletMatch","numberedMatch","currentMatch","currentType","getSelection","actions","undo","redo","openSearchPanel","cmSelectNextOccurrence","cmSelectSelectionMatches","selection","exampleUrl","newText","writingModeConfigFacet","setWritingModeSheetEffect","setTypewriterEffect","setFocusModeEffect","setFocusLevelEffect","setDimIntensityEffect","writingModeField","markdownKeymap","keymap","selectedLineDecoration","highlightSelectedLines","selectedLines","typewriterPlugin","head","coords","viewportCenter","diff","unfocusedLine","findParagraphRange","findSentenceRange","fullText","sentenceStart","ch","sentenceEnd","fromLine","toLine","createFocusModePlugin","intensity","opacity","RangeSet","activeLines","focusModePlugin","computeStats","words","w","chars","charsNoSpaces","readingTime","selWords","selChars","hasSelection","selText","formatReadingTime","minutes","createStat","stat","valueEl","labelEl","createDivider","div","wordCountPanelFactory","dom","render","stats","selStat","selValue","selLabel","wordCountPanel","showPanel","defaultButtons","toolbarBaseTheme","EditorView","bottomToolbar","buttons","extraButtons","buttonsByAction","btn","el","touchStartX","dx","atLeft","atRight","updateHistoryButtons","undoBtn","undoDepth","redoBtn","redoDepth","backlinksFacet","extractFrontmatterTitle","renderBacklinks","backlinks","onBacklinkClick","empty","list","backlink","chip","backlinksPanelFactory","lastTitle","currentRequest","resolveTitle","fetchBacklinks","loadingLabel","loading","requestId","backlinksPanel","frontmatterKeysFacet","frontmatterSheetPlugin","wasOpen","header","closeBtn","sheet","backdrop","addBtn","yamlLines","_a","_b","isMac","modKey","writingModeSheetPlugin","typewriter","focusMode","focusLevel","dimIntensity","currentMode","modeSection","modeOptions","modes","mode","icon","tw","fm","levelSection","pills","levels","lvl","pill","dimSection","sliderWrap","slider","val","labels","lessLabel","moreLabel","shortcuts","shortcutLabel","twKbd","twDesc","fmKbd","fmDesc","labelText","style","baseTheme","lightTheme","darkTheme","rawModeTheme","rawModeDarkTheme","tagAutocomplete","tags","context","lineText","query","a","b","aLower","bLower","aStarts","bStarts","createNoteIndex","notes","entries","note","needle","entry","titleIndex","aliasIndex","bestIndex","defaultFormatLink","resolveWikiLink","noteIndex","wikiLinkAutocomplete","formatLink","format","moreMenuTheme","moreMenu","items","item","check","HybridMarkdownConfig","configs","c","setThemeEffect","setModeEffect","setReadOnlyEffect","setToolbarEffect","setWordCountEffect","setBacklinksEffect","editorStateField","themeCompartment","Compartment","previewCompartment","rawModeCompartment","selectedLineCompartment","readOnlyCompartment","typewriterCompartment","focusModeCompartment","toolbarCompartment","wordCountCompartment","backlinksCompartment","readOnlyTransactionFilter","EditorState","writingModeTransactionExtender","effects","needsTypewriter","needsFocusMode","needsFocusLevel","needsDimIntensity","getThemeExtension","theme","getRawModeExtension","hybridMarkdown","enablePreview","enableKeymap","readOnly","toolbar","wordCount","docTitle","onBacklinksRequested","frontmatterKeys","extensions","history","defaultKeymap","historyKeymap","searchKeymap","search","rectangularSelection","crosshairCursor","bottomToolbarExtension","toggleTheme","currentState","newTheme","toggleHybridMode","newMode","isHybrid","toggleReadOnly","newReadOnly","setReadOnly","toggleTypewriter","setTypewriter","isTypewriter","toggleFocusMode","setFocusMode","isFocusMode","setFocusLevel","getFocusLevel","setDimIntensity","getDimIntensity","getWritingMode","s","setWritingMode","toggleWritingModeSheet","isOpen","setWritingModeSheet","isWritingModeSheet","toggleToolbar","setToolbar","isToolbar","toggleWordCount","setWordCount","isWordCount","toggleBacklinks","setBacklinks","isBacklinks","toggleFrontmatterSheet","setFrontmatterSheet","isFrontmatterSheet","setTheme","setMode","isReadOnly","getTheme","getMode"],"mappings":";;;;;;;;;;;;;;;;AAEO,MAAMA,IAAoBC,GAAW,OAAM,GCErCC,KAAoB,CAAC,KAAK,KAAK,KAAK,KAAK,KAAK,GAAG,GAExDC,KAAmB;AAAA,EACvB,GAAG,EAAE,OAAO,MAAM,OAAO,QAAQ,WAAW,OAAM;AAAA,EAClD,KAAK,EAAE,OAAO,MAAM,OAAO,UAAU,WAAW,SAAQ;AAAA,EACxD,KAAK,EAAE,OAAO,KAAK,OAAO,YAAY,WAAW,WAAU;AAAA,EAC3D,KAAK,EAAE,OAAO,KAAK,OAAO,aAAa,WAAW,YAAW;AAAA,EAC7D,KAAK,EAAE,OAAO,MAAM,OAAO,aAAa,WAAW,YAAW;AAAA,EAC9D,KAAK,EAAE,OAAO,MAAM,OAAO,aAAa,WAAW,YAAW;AAChE,GAEMC,KAAiB,MACjBC,KAAkB;AAExB,SAASC,GAAUC,GAAO;AACxB,SAAOA,MAAUA,EAAM,KAAI;AAC7B;AAEA,SAASC,GAAqBC,GAAS;AAGrC,MAFI,CAACA,KAAW,CAACH,GAAUG,CAAO,KAC9BA,EAAQ,SAAS;AAAA,CAAI,KACrBA,EAAQ,SAAS,GAAG,KAAKA,EAAQ,SAAS,GAAG,EAAG,QAAO;AAE3D,QAAMC,IAAYD,EAAQ,QAAQ,GAAG,GAC/BE,IAASD,MAAc,KAAKD,IAAUA,EAAQ,MAAM,GAAGC,CAAS,GAChEE,IAAQF,MAAc,KAAK,OAAOD,EAAQ,MAAMC,IAAY,CAAC;AAEnE,MAAI,CAACC,KAAWC,MAAU,SAAS,CAACA,KAAS,CAACN,GAAUM,CAAK,GAAK,QAAO;AAEzE,QAAMC,IAAYF,EAAO,QAAQ,GAAG,GAC9BG,IAAQD,MAAc,KAAKF,IAASA,EAAO,MAAM,GAAGE,CAAS,GAC7DE,IAAUF,MAAc,KAAK,OAAOF,EAAO,MAAME,IAAY,CAAC;AAGpE,MADI,CAACC,KAAS,CAACR,GAAUQ,CAAK,KAC1BC,MAAY,SAAS,CAACA,KAAW,CAACT,GAAUS,CAAO,GAAI,QAAO;AAElE,QAAMC,IAAUJ,KAAUG,KAAWD;AAErC,SAAO;AAAA,IACL,KAAK,GAAGV,EAAc,GAAGK,CAAO,GAAGJ,EAAe;AAAA,IAClD,OAAAS;AAAA,IACA,SAAAC;AAAA,IACA,OAAAH;AAAA,IACA,SAAAI;AAAA,EACJ;AACA;AAEA,SAASC,GAAqBC,GAAMC,GAAOC,GAAW;AACpD,QAAMC,IAAQ,IAAI,OAAOD,CAAS;AAClC,SAAOF,EAAK,QAAQG,GAAOF,IAAQC,CAAS;AAC9C;AAEO,SAASE,GAAcJ,GAAM;AAClC,QAAMK,IAAU,CAAA;AAChB,MAAIC,IAAI;AAER,SAAOA,IAAIN,EAAK,UAAQ;AACtB,QAAIA,EAAKM,CAAC,MAAM,KAAK;AACnB,UAAIJ,IAAY;AAChB,aAAOF,EAAKM,IAAIJ,CAAS,MAAM;AAC7B,QAAAA,KAAa;AAEf,YAAMK,IAAMR,GAAqBC,GAAMM,GAAGJ,CAAS;AACnD,UAAIK,MAAQ,IAAI;AACd,QAAAD,KAAKJ;AACL;AAAA,MACF;AACA,MAAAI,IAAIC,IAAML;AACV;AAAA,IACF;AAEA,QAAIF,EAAK,WAAWd,IAAgBoB,CAAC,GAAG;AACtC,YAAMC,IAAMP,EAAK,QAAQb,IAAiBmB,IAAI,CAAC;AAC/C,UAAIC,MAAQ,IAAI;AACd,QAAAD,KAAK;AACL;AAAA,MACF;AAEA,YAAMf,IAAUS,EAAK,MAAMM,IAAI,GAAGC,CAAG,GAC/BC,IAAOlB,GAAqBC,CAAO;AACzC,UAAIiB,GAAM;AACR,QAAAH,EAAQ,KAAK,EAAE,MAAMC,GAAG,IAAIC,IAAM,GAAG,MAAAC,GAAM,GAC3CF,IAAIC,IAAM;AACV;AAAA,MACF;AAEA,MAAAD,KAAK;AACL;AAAA,IACF;AAEA,IAAAA,KAAK;AAAA,EACP;AAEA,SAAOD;AACT;AAEA,MAAMI,KAAkB,WAAA,qCAAA,GAAkC;AAMnD,SAASC,GAASV,GAAM;AAC7B,QAAMK,IAAU,CAAA,GAEVM,IAAa,CAAA;AACnB,MAAIC;AACJ,QAAMC,IAAY;AAClB,UAAQD,IAAYC,EAAU,KAAKb,CAAI,OAAO,QAAM;AAClD,UAAME,IAAYU,EAAU,CAAC,EAAE,QACzBE,IAAWf,GAAqBC,GAAMY,EAAU,OAAOV,CAAS;AACtE,IAAIY,MAAa,OACfH,EAAW,KAAK,EAAE,MAAMC,EAAU,OAAO,IAAIE,IAAWZ,GAAW,GACnEW,EAAU,YAAYC,IAAWZ;AAAA,EAErC;AAEA,QAAMa,IAAW,CAACC,MAAQL,EAAW,KAAK,CAAAM,MAAKD,KAAOC,EAAE,QAAQD,IAAMC,EAAE,EAAE;AAE1E,EAAAR,GAAgB,YAAY;AAC5B,MAAIS;AACJ,UAAQA,IAAIT,GAAgB,KAAKT,CAAI,OAAO,QAAM;AAChD,UAAMmB,IAAUD,EAAE,SAASA,EAAE,CAAC,EAAE,WAAW,GAAG,IAAI,IAAIA,EAAE,CAAC,EAAE,QAAQ,GAAG;AACtE,IAAKH,EAASI,CAAO,KACnBd,EAAQ,KAAK,EAAE,MAAMc,GAAS,IAAIA,IAAU,IAAID,EAAE,CAAC,EAAE,QAAQ,KAAKA,EAAE,CAAC,GAAG;AAAA,EAE5E;AAEA,SAAOb;AACT;AAEA,MAAMe,IAAK,IAAIC,GAAW;AAAA,EACxB,MAAM;AAAA,EACN,SAAS;AAAA,EACT,QAAQ;AAAA,EACR,aAAa;AACf,CAAC;AAEDD,EAAG,IAAIE,EAAe;AAEtB,SAASC,GAAgBC,GAAU;AACjC,EAAAA,EAAS,OAAO,MAAM,OAAO,QAAQ,YAAY,CAACC,GAAOC,MAAW;AAClE,QAAI,CAACD,EAAM,OAAOA,EAAM,IAAI,oBAAoB,GAAM,QAAO;AAE7D,UAAMxB,IAAQwB,EAAM;AACpB,QAAIA,EAAM,IAAI,WAAWxB,CAAK,MAAM,MAAQwB,EAAM,IAAI,WAAWxB,IAAQ,CAAC,MAAM;AAC9E,aAAO;AAGT,UAAMM,IAAMkB,EAAM,IAAI,QAAQtC,IAAiBc,IAAQ,CAAC;AACxD,QAAIM,MAAQ,GAAI,QAAO;AAEvB,UAAMhB,IAAUkC,EAAM,IAAI,MAAMxB,IAAQ,GAAGM,CAAG,GACxCC,IAAOlB,GAAqBC,CAAO;AACzC,QAAI,CAACiB,EAAM,QAAO;AAElB,QAAI,CAACkB,GAAQ;AACX,YAAMC,IAAQF,EAAM,KAAK,YAAY,IAAI,CAAC;AAC1C,MAAAE,EAAM,OAAOnB;AAAA,IACf;AAEA,WAAAiB,EAAM,MAAMlB,IAAM,GACX;AAAA,EACT,CAAC,GAEDiB,EAAS,SAAS,MAAM,WAAW,CAACI,GAAQC,MAAQ;AAClD,UAAMrB,IAAOoB,EAAOC,CAAG,EAAE,QAAQ,CAAA,GAC3BC,IAASN,EAAS,MAAM,YACxBO,IAAQ;AAAA,MACZ;AAAA,MACA,kBAAkBD,EAAOtB,EAAK,OAAO,EAAE,CAAC;AAAA,MACxC,wBAAwBsB,EAAOtB,EAAK,SAAS,EAAE,CAAC;AAAA,IACtD;AAEI,IAAIA,EAAK,WACPuB,EAAM,KAAK,0BAA0BD,EAAOtB,EAAK,OAAO,CAAC,GAAG,GAE1DA,EAAK,SACPuB,EAAM,KAAK,wBAAwBD,EAAOtB,EAAK,KAAK,CAAC,GAAG;AAG1D,UAAMwB,IAAQF,EAAOtB,EAAK,WAAWA,EAAK,SAAS,EAAE;AACrD,WAAO,SAASuB,EAAM,KAAK,GAAG,CAAC,IAAIC,CAAK;AAAA,EAC1C;AACF;AAGA,MAAMC,KAAY;AAElB,SAASC,GAAWV,GAAU;AAC5B,EAAAA,EAAS,OAAO,MAAM,OAAO,QAAQ,OAAO,CAACC,GAAOC,MAAW;AAC7D,QAAI,CAACD,EAAM,OAAOA,EAAM,IAAI,eAAe,GAAM,QAAO;AAExD,UAAMxB,IAAQwB,EAAM;AACpB,QAAIA,EAAM,IAAI,WAAWxB,CAAK,MAAM,GAAM,QAAO;AAGjD,QAAIA,IAAQ,GAAG;AACb,YAAMkC,IAAOV,EAAM,IAAI,WAAWxB,IAAQ,CAAC;AAE3C,UAAIkC,MAAS,MAAQA,MAAS,KAAQA,MAAS,MAAQA,MAAS,GAAM,QAAO;AAAA,IAC/E;AAGA,UAAMC,IADYX,EAAM,IAAI,MAAMxB,CAAK,EACf,MAAMgC,EAAS;AACvC,QAAI,CAACG,EAAO,QAAO;AAEnB,UAAMC,IAAUD,EAAM,CAAC;AAEvB,QAAI,CAACV,GAAQ;AACX,YAAMC,IAAQF,EAAM,KAAK,OAAO,IAAI,CAAC;AACrC,MAAAE,EAAM,OAAO,EAAE,KAAKU,EAAO;AAAA,IAC7B;AAEA,WAAAZ,EAAM,MAAMxB,IAAQ,IAAIoC,EAAQ,QACzB;AAAA,EACT,CAAC,GAEDb,EAAS,SAAS,MAAM,MAAM,CAACI,GAAQC,MAAQ;AAC7C,UAAMrB,IAAOoB,EAAOC,CAAG,EAAE,QAAQ,CAAA,GAC3BC,IAASN,EAAS,MAAM,YACxBa,IAAUP,EAAOtB,EAAK,OAAO,EAAE;AACrC,WAAO,kCAAkC6B,CAAO,MAAMA,CAAO;AAAA,EAC/D;AACF;AAEA,SAASC,GAAkBd,GAAU;AACnC,EAAAA,EAAS,OAAO,MAAM,OAAO,UAAU,gBAAgB,CAACC,GAAOC,MAAW;AACxE,UAAMzB,IAAQwB,EAAM;AAEpB,QADIA,EAAM,IAAI,WAAWxB,CAAK,MAAM,MAChCwB,EAAM,IAAI,WAAWxB,IAAQ,CAAC,MAAM,GAAM,QAAO;AAErD,QAAIM,IAAMN,IAAQ;AAClB,YAAQM,IAAMkB,EAAM,IAAI,QAAQ,KAAKlB,CAAG,OAAO,MACzCkB,EAAM,IAAI,WAAWlB,IAAM,CAAC,MAAM;AACtC,MAAAA,KAAO;AAGT,QAAIA,MAAQ,GAAI,QAAO;AAEvB,UAAMhB,IAAUkC,EAAM,IAAI,MAAMxB,IAAQ,GAAGM,CAAG;AAC9C,QAAI,CAAChB,KAAWA,EAAQ,SAAS;AAAA,CAAI,EAAG,QAAO;AAE/C,QAAI,CAACmC,GAAQ;AACX,YAAMC,IAAQF,EAAM,KAAK,eAAe,IAAI,CAAC;AAC7C,MAAAE,EAAM,UAAUpC;AAAA,IAClB;AAEA,WAAAkC,EAAM,MAAMlB,IAAM,GACX;AAAA,EACT,CAAC,GAEDiB,EAAS,SAAS,MAAM,cAAc,CAACI,GAAQC,MAAQ;AACrD,QAAI;AACF,aAAOU,GAAM,eAAeX,EAAOC,CAAG,EAAE,SAAS,EAAE,aAAa,IAAO,cAAc,GAAK,CAAE;AAAA,IAC9F,QAAY;AACV,aAAOD,EAAOC,CAAG,EAAE;AAAA,IACrB;AAAA,EACF;AACF;AAEA,SAASW,GAAiBhB,GAAU;AAClC,EAAAA,EAAS,OAAO,MAAM,OAAO,YAAY,aAAa,CAACC,GAAOC,MAAW;AACvE,UAAMzB,IAAQwB,EAAM;AACpB,QAAIA,EAAM,IAAI,WAAWxB,CAAK,MAAM,MAAQwB,EAAM,IAAI,WAAWxB,IAAQ,CAAC,MAAM;AAC9E,aAAO;AAGT,QAAIM,IAAMN,IAAQ;AAClB,YAAQM,IAAMkB,EAAM,IAAI,QAAQ,MAAMlB,CAAG,OAAO,MAC1C,EAAAA,IAAMN,IAAQ;AAClB,MAAAM,KAAO;AAGT,QAAIA,MAAQ,GAAI,QAAO;AAEvB,UAAMhB,IAAUkC,EAAM,IAAI,MAAMxB,IAAQ,GAAGM,CAAG;AAC9C,WAAI,CAAChB,KAAWA,EAAQ,SAAS;AAAA,CAAI,IAAU,MAE1CmC,MACWD,EAAM,KAAK,aAAa,QAAQ,CAAC,EACzC,QAAQ,SAAS,cAAc,GACrCD,EAAS,OAAO,MAAMjC,GAASiC,GAAUC,EAAM,KAAKA,EAAM,MAAM,GAChEA,EAAM,KAAK,cAAc,QAAQ,EAAE,IAGrCA,EAAM,MAAMlB,IAAM,GACX;AAAA,EACT,CAAC;AACH;AAEA,SAASkC,GAAiBjB,GAAU;AAClC,EAAAA,EAAS,OAAO,MAAM,OAAO,YAAY,aAAa,CAACC,GAAOC,MAAW;AACvE,UAAMzB,IAAQwB,EAAM;AAEpB,QADIA,EAAM,IAAI,WAAWxB,CAAK,MAAM,OAChCwB,EAAM,IAAI,WAAWxB,IAAQ,CAAC,MAAM,IAAM,QAAO;AAErD,QAAIM,IAAMN,IAAQ;AAClB,YAAQM,IAAMkB,EAAM,IAAI,QAAQ,KAAKlB,CAAG,OAAO,MAAI;AACjD,UAAIkB,EAAM,IAAI,WAAWlB,IAAM,CAAC,MAAM,IAAM;AAC1C,QAAAA,KAAO;AACP;AAAA,MACF;AACA,UAAIkB,EAAM,IAAI,WAAWlB,IAAM,CAAC,MAAM,KAAM;AAC1C,QAAAA,KAAO;AACP;AAAA,MACF;AACA;AAAA,IACF;AAEA,QAAIA,MAAQ,GAAI,QAAO;AAEvB,UAAMhB,IAAUkC,EAAM,IAAI,MAAMxB,IAAQ,GAAGM,CAAG;AAC9C,WAAI,CAAChB,KAAWA,EAAQ,SAAS;AAAA,CAAI,IAAU,MAE1CmC,MACWD,EAAM,KAAK,YAAY,OAAO,CAAC,EACvC,QAAQ,SAAS,cAAc,GACrCD,EAAS,OAAO,MAAMjC,GAASiC,GAAUC,EAAM,KAAKA,EAAM,MAAM,GAChEA,EAAM,KAAK,aAAa,OAAO,EAAE,IAGnCA,EAAM,MAAMlB,IAAM,GACX;AAAA,EACT,CAAC;AACH;AAEA,SAASmC,GAAmBlB,GAAU;AACpC,EAAAA,EAAS,OAAO,MAAM,OAAO,YAAY,eAAe,CAACC,GAAOC,MAAW;AACzE,UAAMzB,IAAQwB,EAAM;AAEpB,QADIA,EAAM,IAAI,WAAWxB,CAAK,MAAM,MAChCwB,EAAM,IAAI,WAAWxB,IAAQ,CAAC,MAAM,GAAM,QAAO;AAErD,QAAIM,IAAMN,IAAQ;AAClB,YAAQM,IAAMkB,EAAM,IAAI,QAAQ,KAAKlB,CAAG,OAAO,MAAI;AACjD,UAAIkB,EAAM,IAAI,WAAWlB,IAAM,CAAC,MAAM,IAAM;AAC1C,QAAAA,KAAO;AACP;AAAA,MACF;AACA;AAAA,IACF;AAEA,QAAIA,MAAQ,GAAI,QAAO;AAEvB,UAAMhB,IAAUkC,EAAM,IAAI,MAAMxB,IAAQ,GAAGM,CAAG;AAC9C,WAAI,CAAChB,KAAWA,EAAQ,SAAS;AAAA,CAAI,IAAU,MAE1CmC,MACWD,EAAM,KAAK,YAAY,OAAO,CAAC,EACvC,QAAQ,SAAS,gBAAgB,GACvCD,EAAS,OAAO,MAAMjC,GAASiC,GAAUC,EAAM,KAAKA,EAAM,MAAM,GAChEA,EAAM,KAAK,aAAa,OAAO,EAAE,IAGnCA,EAAM,MAAMlB,IAAM,GACX;AAAA,EACT,CAAC;AACH;AAEA,SAASoC,GAAyBnB,GAAU;AAC1C,EAAAA,EAAS,OAAO,MAAM,OAAO,QAAQ,gBAAgB,CAACC,GAAOC,MAAW;AACtE,UAAMzB,IAAQwB,EAAM;AAEpB,QADIA,EAAM,IAAI,WAAWxB,CAAK,MAAM,MAChCwB,EAAM,IAAI,WAAWxB,IAAQ,CAAC,MAAM,GAAM,QAAO;AAErD,UAAMM,IAAMkB,EAAM,IAAI,QAAQ,KAAKxB,IAAQ,CAAC;AAC5C,QAAIM,MAAQ,GAAI,QAAO;AAEvB,UAAMqC,IAAKnB,EAAM,IAAI,MAAMxB,IAAQ,GAAGM,CAAG;AACzC,QAAI,CAACqC,EAAI,QAAO;AAEhB,QAAI,CAAClB,GAAQ;AACX,YAAMC,IAAQF,EAAM,KAAK,gBAAgB,IAAI,CAAC;AAC9C,MAAAE,EAAM,OAAO,EAAE,IAAAiB,EAAE;AAAA,IACnB;AAEA,WAAAnB,EAAM,MAAMlB,IAAM,GACX;AAAA,EACT,CAAC,GAEDiB,EAAS,SAAS,MAAM,eAAe,CAACI,GAAQC,MAAQ;AACtD,UAAMe,IAAKhB,EAAOC,CAAG,EAAE,KAAK;AAC5B,WAAO,wEAAwEe,CAAE,MAAMA,CAAE;AAAA,EAC3F;AACF;AAEAN,GAAkBlB,CAAE;AACpBoB,GAAiBpB,CAAE;AACnBqB,GAAiBrB,CAAE;AACnBsB,GAAmBtB,CAAE;AACrBuB,GAAyBvB,CAAE;AAC3BG,GAAgBH,CAAE;AAClBc,GAAWd,CAAE;AAKN,SAASyB,GAAgBtD,GAAS;AACvC,MAAI;AACF,WAAOgD,GAAM,eAAehD,GAAS,EAAE,aAAa,IAAM,cAAc,IAAO;AAAA,EACjF,QAAY;AACV,WAAO,4BAA4BA,CAAO;AAAA,EAC5C;AACF;AAYO,SAASuD,GAAkBF,GAAIrD,GAASwD,IAAU,CAAA,GAAI;AAC3D,QAAMC,IAAWC,EAAa1D,GAASwD,CAAO;AAC9C,SAAO,+BAA+BH,CAAE,MAAMI,CAAQ,8DAA8DJ,CAAE;AACxH;AAKA,SAASK,EAAajD,GAAM+C,IAAU,IAAI;AACxC,QAAMG,IAAM;AAAA,IACV,iBAAiBH,EAAQ,oBAAoB;AAAA,IAC7C,YAAYA,EAAQ,eAAe;AAAA,EACvC;AACE,SAAO3B,EAAG,aAAapB,GAAMkD,CAAG;AAClC;AAKO,SAASC,GAAoBP,GAAIQ,GAAOL,IAAU,CAAA,GAAI;AAC3D,MAAI,CAACK,EAAM,OAAQ,QAAO;AAC1B,QAAMC,IAAaD,EAAM,CAAC,EAAE,MAAM,0BAA0B,GACtDE,IAAeD,IAAaA,EAAW,CAAC,IAAID,EAAM,CAAC,GACnDG,IAAQ,CAAA,GAERC,IAAgBP,EAAaK,GAAcP,CAAO;AACxD,EAAAQ,EAAM,KAAK,oDAAoDX,CAAE,MAAMY,CAAa,QAAQ;AAE5F,WAASlD,IAAI,GAAGA,IAAI8C,EAAM,QAAQ9C,KAAK;AACrC,UAAMmD,IAAOL,EAAM9C,CAAC,EAAE,QAAQ,cAAc,EAAE,GACxC0C,IAAWS,EAAK,KAAI,IAAKR,EAAaQ,GAAMV,CAAO,IAAI;AAC7D,IAAAQ,EAAM,KAAK,0DAA0DP,CAAQ,QAAQ;AAAA,EACvF;AAEA,SAAAO,EAAM,KAAK,8FAA8FX,CAAE,4CAA4C,GAEhJ,iDAAiDA,CAAE,KAAKW,EAAM,KAAK,EAAE,CAAC;AAC/E;AAKO,SAASG,GAAqBN,GAAOL,IAAU,IAAI;AACxD,MAAIK,EAAM,WAAW,EAAG,QAAO;AAC/B,QAAMO,IAAOP,EAAM,CAAC,EAAE,KAAI,GACpBQ,IAAc,CAAA;AACpB,MAAIC,IAAU;AAEd,WAASvD,IAAI,GAAGA,IAAI8C,EAAM,QAAQ9C,KAAK;AACrC,UAAMmD,IAAOL,EAAM9C,CAAC,GACdwD,IAAWL,EAAK,MAAM,eAAe;AAC3C,QAAIK,GAAU;AACZ,MAAID,KACFD,EAAY,KAAKC,CAAO,GAE1BA,IAAU,CAACC,EAAS,CAAC,CAAC;AACtB;AAAA,IACF;AAEA,QAAID,GAAS;AACX,YAAME,IAAeN,EAAK,QAAQ,cAAc,EAAE;AAClD,MAAAI,EAAQ,KAAKE,CAAY;AAAA,IAC3B;AAAA,EACF;AAEA,EAAIF,KACFD,EAAY,KAAKC,CAAO;AAG1B,QAAMG,IAAWf,EAAaU,GAAMZ,CAAO,GACrCkB,IAAUL,EAAY,IAAI,CAACM,MAExB,OADUA,EAAS,IAAI,CAACT,MAASR,EAAaQ,GAAMV,CAAO,CAAC,EAAE,KAAK,MAAM,CAC1D,OACvB,EAAE,KAAK,EAAE;AAEV,SAAO,sCAAsCiB,CAAQ,QAAQC,CAAO;AACtE;AAMO,SAASE,GAAmB5E,GAASwD,IAAU,IAAI;AACxD,MAAI,CAACxD,EAAQ;AACX,WAAOA;AAGT,QAAM6E,IAAoBrB,EAAQ,sBAAsB,IAClDsB,IAAkB,MAAM,QAAQtB,EAAQ,eAAe,IACzDA,EAAQ,kBACR/D,IACEsF,IAAgBvB,EAAQ,qBAAqB,IAAI,IAAIsB,CAAe,GACpEE,IAAkBxB,EAAQ,oBAAoB,IAC9CyB,IAAgB,EAAE,GAAGzB,GAAS,iBAAAwB,EAAe,GAG7CE,IAAmBlF,EAAQ,MAAM,0BAA0B;AACjE,MAAIkF;AACF,WAAO3B,GAAkB2B,EAAiB,CAAC,GAAGA,EAAiB,CAAC,GAAGD,CAAa;AAIlF,QAAME,IAAcnF,EAAQ,MAAM,mBAAmB;AACrD,MAAImF,GAAa;AACf,UAAMC,IAAQD,EAAY,CAAC,EAAE;AAC7B,QAAI1E,IAAO0E,EAAY,CAAC,GACpBE,IAAY;AAChB,UAAMC,IAAU7E,EAAK,MAAM,6DAA6D;AACxF,IAAI6E,MACF7E,IAAO6E,EAAQ,CAAC,GAChBD,IAAYC,EAAQ,CAAC,KAAKA,EAAQ,CAAC;AAErC,UAAMC,IAASF,IAAY,QAAQA,CAAS,sBAAsBA,CAAS,MAAM;AACjF,WAAO,8BAA8BD,CAAK,IAAIG,CAAM,IAAI7B,EAAajD,GAAMwE,CAAa,CAAC;AAAA,EAC3F;AAGA,MAAIjF,EAAQ,WAAW,GAAG,GAAG;AAC3B,UAAMS,IAAOT,EAAQ,QAAQ,SAAS,EAAE;AACxC,WAAO,+BAA+B0D,EAAajD,GAAMwE,CAAa,CAAC;AAAA,EACzE;AAGA,QAAMO,IAAYxF,EAAQ,MAAM,6BAA6B;AAC7D,MAAIwF,GAAW;AACb,UAAMC,IAASD,EAAU,CAAC,GACpB/E,IAAO+E,EAAU,CAAC,GAElBE,IAAYjF,EAAK,MAAM,sBAAsB;AACnD,QAAIiF,GAAW;AACb,YAAMC,IAAUD,EAAU,CAAC,EAAE,YAAW,MAAO,KACzCE,IAAQD,IAAU,MAAM,MACxBlD,IAAQkD,IAAU,cAAc;AAGtC,aAAO,wEAAwEF,CAAM,6CAFlEE,IAAU,aAAa,YAEkG,gBAD9HA,IAAU,MAAM,GACmI,+BAA+BlD,CAAK,YAAYA,CAAK,KAAKmD,CAAK,WAAWlC,EAAagC,EAAU,CAAC,GAAGT,CAAa,CAAC;AAAA,IACtR;AAEA,QAAIJ,GAAmB;AACrB,YAAMgB,IAAkBpF,EAAK,MAAM,yBAAyB;AAC5D,UAAIoF,GAAiB;AACnB,cAAMzD,IAAQyD,EAAgB,CAAC,GACzB5E,IAAOvB,GAAiB0C,CAAK;AACnC,YAAInB,KAAQ8D,EAAc,IAAI3C,CAAK;AACjC,iBAAO,wEAAwEqD,CAAM,6CAA6CxE,EAAK,SAAS,gBAAgBmB,CAAK,+BAA+BnB,EAAK,KAAK,YAAYA,EAAK,KAAK,KAAKA,EAAK,KAAK,WAAWyC,EAAamC,EAAgB,CAAC,GAAGZ,CAAa,CAAC;AAAA,MAEjT;AAAA,IACF;AACA,WAAO,2DAA2DQ,CAAM,WAAW/B,EAAajD,GAAMwE,CAAa,CAAC;AAAA,EACtH;AAGA,MAAI,yBAAyB,KAAKjF,EAAQ,KAAI,CAAE;AAC9C,WAAO;AAIT,MAAIA,EAAQ,OAAO,WAAW,GAAG,KAAKA,EAAQ,KAAI,EAAG,SAAS,GAAG,GAAG;AAClE,UAAM8F,IAAU9F,EAAQ,KAAI;AAE5B,WAAI,iBAAiB,KAAK8F,CAAO,KAAKA,EAAQ,SAAS,GAAG,IACjD,6CAOF,8BAJOA,EAAQ,MAAM,GAAG,EAAE,EAAE,MAAM,GAAG,EAAE,IAAI,CAAAC,MAAQA,EAAK,KAAI,CAAE,EACzC,IAAI,CAAAA,MACvB,+BAA+BrC,EAAaqC,GAAMd,CAAa,CAAC,SACxE,EAAE,KAAK,EAAE,CACwC;AAAA,EACpD;AAGA,SAAOvB,EAAa1D,GAASiF,CAAa;AAC5C;AAeO,SAASe,GAAYC,GAAMzC,IAAU,IAAI;AAC9C,MAAIyC,EAAK,WAAW,EAAG,QAAO;AAE9B,QAAMC,IAAW,CAACC,MAAQ;AACxB,UAAML,IAAUK,EAAI,KAAI;AACxB,WAAI,CAACL,EAAQ,WAAW,GAAG,KAAK,CAACA,EAAQ,SAAS,GAAG,IAAU,OACxDA,EAAQ,MAAM,GAAG,EAAE,EAAE,MAAM,GAAG,EAAE,IAAI,CAAAC,MAAQA,EAAK,KAAI,CAAE;AAAA,EAChE,GAEMK,IAAc,CAACD,MAAQ;AAC3B,UAAML,IAAUK,EAAI,KAAI;AACxB,WAAO,iBAAiB,KAAKL,CAAO,KAAKA,EAAQ,SAAS,GAAG;AAAA,EAC/D;AAGA,MAAIO,IAAY,MACZC,IAAW,CAAA,GACXC,IAAiB;AAErB,aAAWJ,KAAOF,GAAM;AACtB,QAAIG,EAAYD,CAAG,GAAG;AACpB,MAAAI,IAAiB;AACjB;AAAA,IACF;AAEA,UAAMC,IAAQN,EAASC,CAAG;AAC1B,IAAKK,MAED,CAACD,KAAkB,CAACF,IACtBA,IAAYG,IAEZF,EAAS,KAAKE,CAAK;AAAA,EAEvB;AAGA,MAAIC,IAAO;AAEX,MAAIJ,GAAW;AACb,IAAAI,KAAQ;AACR,eAAWV,KAAQM;AACjB,MAAAI,KAAQ,OAAO/C,EAAaqC,GAAMvC,CAAO,CAAC;AAE5C,IAAAiD,KAAQ;AAAA,EACV;AAEA,MAAIH,EAAS,SAAS,GAAG;AACvB,IAAAG,KAAQ;AACR,eAAWN,KAAOG,GAAU;AAC1B,MAAAG,KAAQ;AACR,iBAAWV,KAAQI;AACjB,QAAAM,KAAQ,OAAO/C,EAAaqC,GAAMvC,CAAO,CAAC;AAE5C,MAAAiD,KAAQ;AAAA,IACV;AACA,IAAAA,KAAQ;AAAA,EACV;AAEA,SAAAA,KAAQ,YACDA;AACT;ACppBA,MAAMC,KAAc;AAAA,EAClB,YAAYC;AAAA,EACZ,IAAIA;AAAA,EACJ,YAAY,MAAMA,EAAW,EAAE,YAAY,GAAI,CAAE;AAAA,EACjD,IAAI,MAAMA,EAAW,EAAE,YAAY,GAAI,CAAE;AAAA,EACzC,KAAK,MAAMA,EAAW,EAAE,KAAK,GAAI,CAAE;AAAA,EACnC,KAAK,MAAMA,EAAW,EAAE,KAAK,IAAM,YAAY,IAAM;AAAA,EACrD,QAAQC;AAAA,EACR,IAAIA;AAAA,EACJ,KAAKC;AAAA,EACL,MAAMJ;AAAA,EACN,MAAMK;AACR;AAEA,SAASC,GAAWtG,GAAM;AACxB,SAAOA,EACJ,QAAQ,MAAM,OAAO,EACrB,QAAQ,MAAM,MAAM,EACpB,QAAQ,MAAM,MAAM;AACzB;AAEO,SAASuG,GAAcC,GAAMC,GAAU;AAC5C,QAAMC,IAAST,GAAYQ,KAAA,gBAAAA,EAAU,aAAa;AAElD,MAAI,CAACC;AACH,WAAOJ,GAAWE,CAAI;AAIxB,QAAMG,IADsCD,EAAM,EAChC,SAAS,OAAO,MAAMF,CAAI;AAE5C,MAAII,IAAS,IACT5F,IAAM;AAEV,SAAA6F,GAAcF,GAAMG,IAAkB,CAACC,GAAMC,GAAIC,MAAY;AAC3D,IAAIF,IAAO/F,MACT4F,KAAUN,GAAWE,EAAK,MAAMxF,GAAK+F,CAAI,CAAC,IAE5CH,KAAU,gBAAgBK,CAAO,KAAKX,GAAWE,EAAK,MAAMO,GAAMC,CAAE,CAAC,CAAC,WACtEhG,IAAMgG;AAAA,EACR,CAAC,GAEGhG,IAAMwF,EAAK,WACbI,KAAUN,GAAWE,EAAK,MAAMxF,CAAG,CAAC,IAG/B4F;AACT;ACEA,MAAMM,KAAsBC,EAAM,OAAO;AAAA,EACvC,QAAQC,GAAQ;AACd,WAAOA,EAAO,SAAS,IAAIA,EAAOA,EAAO,SAAS,CAAC,IAAI;AAAA,EACzD;AACF,CAAC,GAEKC,KAA4BrI,IAC5BsI,KAAmB;AAEzB,SAASC,GAAyBC,GAAO;AACvC,MAAI,CAAC,MAAM,QAAQA,CAAK;AACtB,WAAO,CAAC,GAAGH,EAAyB;AAGtC,QAAMI,IAAa,CAAA,GACbC,IAAO,oBAAI,IAAG;AACpB,aAAWC,KAAOH,GAAO;AACvB,QAAI,OAAOG,KAAQ,YAAYA,EAAI,WAAW,EAAG;AACjD,UAAMhG,IAAQgG,EAAI,YAAW;AAC7B,IAAKN,GAA0B,SAAS1F,CAAK,MACzC+F,EAAK,IAAI/F,CAAK,MAClB+F,EAAK,IAAI/F,CAAK,GACd8F,EAAW,KAAK9F,CAAK;AAAA,EACvB;AAEA,SAAO8F;AACT;AAEA,SAASG,GAAavD,GAAiB;AACrC,SAAO,CAAC,KAAK,KAAK,GAAGA,CAAe;AACtC;AAEA,SAASwD,GAAuBzD,GAAmBC,GAAiB;AAClE,QAAMyD,IAAkBP,GAAyBlD,CAAe;AAChE,SAAO;AAAA,IACL,mBAAmBD,MAAsB;AAAA,IACzC,iBAAiB0D;AAAA,IACjB,mBAAmB,IAAI,IAAIA,CAAe;AAAA,IAC1C,WAAWF,GAAaE,CAAe;AAAA,EAC3C;AACA;AAEA,MAAMC,KAAmBZ,EAAM,OAAO;AAAA,EACpC,QAAQC,GAAQ;AACd,WAAIA,EAAO,WAAW,IACbS,GAAuB,IAAOR,EAAyB,IAEzDD,EAAOA,EAAO,SAAS,CAAC;AAAA,EACjC;AACF,CAAC;AAED,SAASY,GAAqBzD,GAAiB0D,GAAiBC,GAAiB;AAC/E,QAAMC,IAAU5D,MAAoB;AAGpC,SAAO;AAAA,IACL,iBAAiB4D;AAAA,IACjB,iBAJaA,KAAWF,MAAoB;AAAA,IAK5C,iBAJc,OAAOC,KAAoB,aAAaA,IAAkB;AAAA,EAK5E;AACA;AAEA,MAAME,IAAiBjB,EAAM,OAAO;AAAA,EAClC,QAAQC,GAAQ;AACd,WAAIA,EAAO,WAAW,IACbY,GAAqB,IAAO,IAAO,IAAI,IAEzCZ,EAAOA,EAAO,SAAS,CAAC;AAAA,EACjC;AACF,CAAC;AAED,SAASiB,GAAgBC,GAAYC,GAAY;AAG/C,SAAO,EAAE,YAFOD,MAAe,IAED,YADd,OAAOC,KAAe,aAAaA,IAAa,KACf;AACnD;AAEA,MAAMC,KAAYrB,EAAM,OAAO;AAAA,EAC7B,QAAQC,GAAQ;AACd,WAAIA,EAAO,WAAW,IACbiB,GAAgB,IAAO,IAAI,IAE7BjB,EAAOA,EAAO,SAAS,CAAC;AAAA,EACjC;AACF,CAAC;AAED,SAASqB,GAAiBlJ,GAASmJ,GAAQ;AACzC,QAAMtG,IAAQ7C,EAAQ,MAAM+H,EAAgB;AAC5C,MAAI,CAAClF,EAAO,QAAO;AAEnB,QAAMT,IAAQS,EAAM,CAAC,EAAE,YAAW;AAClC,SAAIT,MAAU,OAAOA,MAAU,OAI1B+G,EAAO,qBAELA,EAAO,kBAAkB,IAAI/G,CAAK,IALhCA,IAG6B;AAGxC;AAEA,SAASgH,GAAiBC,GAAcC,GAAO;AAC7C,MAAI,CAAC,MAAM,QAAQA,CAAK,KAAKA,EAAM,WAAW,EAAG,QAAOD;AACxD,QAAME,IAAQD,EAAM,QAAQD,CAAY;AACxC,SAAIE,MAAU,KAAWD,EAAM,CAAC,IACzBA,GAAOC,IAAQ,KAAKD,EAAM,MAAM;AACzC;AAEA,SAASE,GAAiBxJ,GAASyJ,GAAW;AAC5C,SAAOzJ,EAAQ,QAAQ+H,IAAkB,MAAM0B,CAAS,GAAG;AAC7D;AAEA,SAASC,EAAgBC,GAAS;AAChC,SAAO;AAAA,IACL,KAAKA,EAAQ,aAAa,eAAe,KAAK;AAAA,IAC9C,OAAOA,EAAQ,aAAa,qBAAqB,KAAK;AAAA,IACtD,SAASA,EAAQ,aAAa,uBAAuB,KAAK;AAAA,IAC1D,OAAOA,EAAQ,aAAa,qBAAqB,KAAK;AAAA,IACtD,SAASA,EAAQ,eAAe;AAAA,EACpC;AACA;AASO,MAAMC,KAAuBC,EAAY,OAAM,GAMzCC,KAAyBC,EAAW,OAAO;AAAA,EACtD,SAAS;AACP,WAAO,oBAAI,IAAG;AAAA,EAChB;AAAA,EACA,OAAOC,GAAWC,GAAI;AACpB,QAAIC,IAAeF;AAGnB,eAAWG,KAAUF,EAAG;AACtB,MAAIE,EAAO,GAAGP,EAAoB,MAChCM,IAAe,IAAI,IAAIF,CAAS,GAC5BE,EAAa,IAAIC,EAAO,KAAK,IAC/BD,EAAa,OAAOC,EAAO,KAAK,IAEhCD,EAAa,IAAIC,EAAO,KAAK;AAMnC,QAAIF,EAAG,cAAcC,EAAa,OAAO,GAAG;AAC1C,YAAME,IAAc,oBAAI,IAAG;AAC3B,iBAAWC,KAAWH,GAAc;AAGlC,cAAMI,IAASL,EAAG,WAAW;AAC7B,YAAII,KAAWC,EAAO,OAAO;AAC3B,gBAAMC,IAAUD,EAAO,KAAKD,CAAO,GAC7BG,IAASP,EAAG,QAAQ,OAAOM,EAAQ,IAAI,GACvCE,IAAaR,EAAG,OAAO,OAAOO,CAAM,EAAE,QAEtCE,IAAcT,EAAG,OAAO,KAAKQ,CAAU,EAAE;AAC/C,UAAI,YAAY,KAAKC,CAAW,KAC9BN,EAAY,IAAIK,CAAU;AAAA,QAE9B;AAAA,MACF;AACA,MAAAP,IAAeE;AAAA,IACjB;AAEA,WAAOF;AAAA,EACT;AACF,CAAC;AAKDS,GAAQ,WAAW;AAAA,EACjB,aAAa;AAAA,EACb,OAAO;AAAA,EACP,eAAe;AAAA,EACf,gBAAgB;AAAA,IACd,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,eAAe;AAAA,IACf,oBAAoB;AAAA,IACpB,sBAAsB;AAAA,IACtB,qBAAqB;AAAA,IACrB,WAAW;AAAA,IACX,qBAAqB;AAAA,EACzB;AACA,CAAC;AAMD,MAAMC,WAA8BC,EAAW;AAAA,EAC7C,YAAY7K,GAAS8K,GAAUC,GAAQ;AACrC,UAAK,GACL,KAAK,UAAU/K,GACf,KAAK,WAAW8K,GAChB,KAAK,SAASC;AAAA,EAChB;AAAA,EAEA,MAAMC,GAAM;AACV,UAAMC,IAAU,SAAS,cAAc,MAAM;AAC7C,IAAAA,EAAQ,YAAY;AACpB,UAAMC,IAAoBF,EAAK,MAAM,MAAMxC,EAAgB,GACrD2C,IAAkBH,EAAK,MAAM,MAAMnC,CAAc,GACjDuC,IAAaJ,EAAK,MAAM,MAAM/B,EAAS;AAC7C,IAAAgC,EAAQ,YAAYrG,GAAmB,KAAK,SAAS;AAAA,MACnD,GAAGsG;AAAA,MACH,iBAAiBC,EAAgB;AAAA,MACjC,YAAYC,EAAW;AAAA,IAC7B,CAAK;AAGD,UAAMN,IAAW,KAAK,UAChBC,IAAS,KAAK,QACd/K,IAAU,KAAK;AAGrB,WAAAiL,EAAQ,iBAAiB,aAAa,CAACI,MAAM;AAE3C,YAAMC,IAAQD,EAAE,OAAO,QAAQ,YAAY;AAC3C,UAAIC,KAASF,EAAW,YAAY;AAClC,QAAAC,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjBD,EAAW,WAAWE,EAAM,aAAa,UAAU,CAAC;AACpD;AAAA,MACF;AAGA,YAAMC,IAAeF,EAAE,OAAO,QAAQ,iBAAiB;AACvD,UAAIE,GAAc;AAChB,QAAAF,EAAE,eAAc,GAChBA,EAAE,gBAAe;AACjB,cAAMG,IAAaD,EAAa,aAAa,eAAe,GAEtDE,IAAMT,EAAK,MAAM;AACvB,iBAASjK,IAAI,GAAGA,KAAK0K,EAAI,OAAO1K,KAAK;AACnC,gBAAMmD,IAAOuH,EAAI,KAAK1K,CAAC;AACvB,cAAImD,EAAK,KAAK,MAAM,IAAI,OAAO,UAAUsH,CAAU,MAAM,CAAC,GAAG;AAC3D,YAAAR,EAAK,SAAS;AAAA,cACZ,WAAW,EAAE,QAAQ9G,EAAK,KAAI;AAAA,cAC9B,gBAAgB;AAAA,YAC9B,CAAa,GACD8G,EAAK,MAAK;AACV;AAAA,UACF;AAAA,QACF;AACA;AAAA,MACF;AAGA,YAAMU,IAAkBL,EAAE,OAAO,QAAQ,qBAAqB;AAC9D,UAAIK,GAAiB;AACnB,QAAAL,EAAE,eAAc,GAChBA,EAAE,gBAAe;AACjB,cAAMG,IAAaE,EAAgB,aAAa,mBAAmB,GAC7DD,IAAMT,EAAK,MAAM;AACvB,iBAASjK,IAAI,GAAGA,KAAK0K,EAAI,OAAO1K,KAAK;AACnC,gBAAMmD,IAAOuH,EAAI,KAAK1K,CAAC;AACvB,cAAImD,EAAK,KAAK,MAAM,IAAI,OAAO,SAASsH,CAAU,UAAU,CAAC,GAAG;AAC9D,YAAAR,EAAK,SAAS;AAAA,cACZ,WAAW,EAAE,QAAQ9G,EAAK,KAAI;AAAA,cAC9B,gBAAgB;AAAA,YAC9B,CAAa,GACD8G,EAAK,MAAK;AACV;AAAA,UACF;AAAA,QACF;AACA;AAAA,MACF;AAGA,YAAMW,IAAWN,EAAE,OAAO,QAAQ,iBAAiB;AACnD,UAAIM,KAAYR,EAAgB,iBAAiB;AAC/C,QAAAE,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjBF,EAAgB,gBAAgBzB,EAAgBiC,CAAQ,CAAC;AACzD;AAAA,MACF;AAGA,YAAMC,IAAOP,EAAE,OAAO,QAAQ,GAAG;AACjC,UAAIO,KAAQA,EAAK,MAAM;AACrB,QAAAP,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjB,OAAO,KAAKO,EAAK,MAAM,UAAU,qBAAqB;AACtD;AAAA,MACF;AAIA,UADmBP,EAAE,OAAO,QAAQ,uCAAuC,GAC3D;AACd,QAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe;AAEjB,cAAMQ,IAAab,EAAK,MAAM,MAAMxC,EAAgB,GAC9Ca,IAAeH,GAAiBlJ,GAAS6L,CAAU;AACzD,YAAI,CAACxC;AACH;AAGF,cAAMI,IAAYoC,EAAW,oBACzBzC,GAAiBC,GAAcwC,EAAW,SAAS,IAClDxC,MAAiB,MAAM,MAAM,KAE5ByC,IAAatC,GAAiBxJ,GAASyJ,CAAS;AACtD,QAAIqC,MAAe9L,KACjBgL,EAAK,SAAS;AAAA,UACZ,SAAS,EAAE,MAAMF,GAAU,IAAIC,GAAQ,QAAQe,EAAU;AAAA,UACzD,aAAavM,EAAkB,GAAG,EAAI;AAAA,QAClD,CAAW;AAEH;AAAA,MACF;AAEA,MAAA8L,EAAE,eAAc,GAChBA,EAAE,gBAAe;AAGjB,YAAMU,IAAOd,EAAQ,sBAAqB,GACpCe,IAASX,EAAE,UAAUU,EAAK,MAC1BE,IAAaF,EAAK,OAGlBG,IAAalM,EAAQ;AAC3B,UAAImM;AAEJ,UAAIF,IAAa,KAAKC,IAAa,GAAG;AAEpC,cAAME,IAAQJ,IAASC;AACvB,QAAAE,IAAU,KAAK,MAAMC,IAAQF,CAAU,GACvCC,IAAU,KAAK,IAAI,GAAG,KAAK,IAAIA,GAASD,CAAU,CAAC;AAAA,MACrD;AACE,QAAAC,IAAU;AAGZ,YAAME,IAAYvB,IAAWqB;AAG7B,MAAAnB,EAAK,SAAS;AAAA,QACZ,WAAW,EAAE,QAAQqB,EAAS;AAAA,QAC9B,gBAAgB;AAAA,MACxB,CAAO,GAEDrB,EAAK,MAAK;AAAA,IACZ,CAAC,GAEMC;AAAA,EACT;AAAA,EAEA,GAAGqB,GAAO;AACR,WAAOA,EAAM,YAAY,KAAK,WACvBA,EAAM,aAAa,KAAK,YACxBA,EAAM,WAAW,KAAK;AAAA,EAC/B;AAAA,EAEA,YAAYC,GAAO;AAEjB,WAAOA,EAAM,SAAS;AAAA,EACxB;AACF;AAKA,MAAMC,WAA6B3B,EAAW;AAAA,EAC5C,YAAY7K,GAAS8K,GAAUC,GAAQ0B,GAAYrH,GAAOsH,GAAaC,GAAY;AACjF,UAAK,GACL,KAAK,UAAU3M,GACf,KAAK,WAAW8K,GAChB,KAAK,SAASC,GACd,KAAK,aAAa0B,GAClB,KAAK,QAAQrH,GACb,KAAK,cAAcsH,GACnB,KAAK,aAAaC;AAAA,EACpB;AAAA,EAEA,MAAM3B,GAAM;AACV,UAAMC,IAAU,SAAS,cAAc,MAAM;AAI7C,QAHAA,EAAQ,YAAY,0CAGhB,KAAK,YAAY;AACnB,YAAM2B,IAAS,SAAS,cAAc,MAAM;AAC5C,MAAAA,EAAO,YAAY,sBAAsB,KAAK,cAAc,cAAc,UAAU,IACpFA,EAAO,cAAc,KACrBA,EAAO,QAAQ,KAAK,cAAc,WAAW;AAE7C,YAAMH,IAAa,KAAK;AAGxB,MAAAG,EAAO,iBAAiB,SAAS,CAACvB,MAAM;AACtC,QAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjBA,EAAE,yBAAwB,GAG1BL,EAAK,SAAS;AAAA,UACZ,SAASpB,GAAqB,GAAG6C,CAAU;AAAA,QACrD,CAAS;AAAA,MACH,CAAC,GAGDG,EAAO,iBAAiB,aAAa,CAACvB,MAAM;AAC1C,QAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjBA,EAAE,yBAAwB;AAAA,MAC5B,CAAC,GAEDJ,EAAQ,YAAY2B,CAAM;AAAA,IAC5B;AAGA,UAAMC,IAAiB,SAAS,cAAc,MAAM,GAC9C3B,IAAoBF,EAAK,MAAM,MAAMxC,EAAgB,GACrD2C,IAAkBH,EAAK,MAAM,MAAMnC,CAAc,GACjDuC,IAAaJ,EAAK,MAAM,MAAM/B,EAAS;AAC7C,IAAA4D,EAAe,YAAYjI,GAAmB,KAAK,SAAS;AAAA,MAC1D,GAAGsG;AAAA,MACH,iBAAiBC,EAAgB;AAAA,MACjC,YAAYC,EAAW;AAAA,IAC7B,CAAK,GACDH,EAAQ,YAAY4B,CAAc;AAGlC,UAAM/B,IAAW,KAAK;AACP,SAAK;AACpB,UAAM9K,IAAU,KAAK;AAGrB,WAAA6M,EAAe,iBAAiB,aAAa,CAACxB,MAAM;AAElD,YAAMC,IAAQD,EAAE,OAAO,QAAQ,YAAY;AAC3C,UAAIC,KAASF,EAAW,YAAY;AAClC,QAAAC,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjBD,EAAW,WAAWE,EAAM,aAAa,UAAU,CAAC;AACpD;AAAA,MACF;AAGA,YAAMK,IAAWN,EAAE,OAAO,QAAQ,iBAAiB;AACnD,UAAIM,KAAYR,EAAgB,iBAAiB;AAC/C,QAAAE,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjBF,EAAgB,gBAAgBzB,EAAgBiC,CAAQ,CAAC;AACzD;AAAA,MACF;AAGA,YAAMC,IAAOP,EAAE,OAAO,QAAQ,GAAG;AACjC,UAAIO,KAAQA,EAAK,MAAM;AACrB,QAAAP,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjB,OAAO,KAAKO,EAAK,MAAM,UAAU,qBAAqB;AACtD;AAAA,MACF;AAEA,MAAAP,EAAE,eAAc,GAChBA,EAAE,gBAAe;AAGjB,YAAMU,IAAOc,EAAe,sBAAqB,GAC3Cb,IAASX,EAAE,UAAUU,EAAK,MAC1BE,IAAaF,EAAK,OAGlBG,IAAalM,EAAQ;AAC3B,UAAImM;AAEJ,UAAIF,IAAa,KAAKC,IAAa,GAAG;AACpC,cAAME,IAAQJ,IAASC;AACvB,QAAAE,IAAU,KAAK,MAAMC,IAAQF,CAAU,GACvCC,IAAU,KAAK,IAAI,GAAG,KAAK,IAAIA,GAASD,CAAU,CAAC;AAAA,MACrD;AACE,QAAAC,IAAU;AAGZ,YAAME,IAAYvB,IAAWqB;AAE7B,MAAAnB,EAAK,SAAS;AAAA,QACZ,WAAW,EAAE,QAAQqB,EAAS;AAAA,QAC9B,gBAAgB;AAAA,MACxB,CAAO,GAEDrB,EAAK,MAAK;AAAA,IACZ,CAAC,GAEMC;AAAA,EACT;AAAA,EAEA,GAAGqB,GAAO;AACR,WAAOA,EAAM,YAAY,KAAK,WACvBA,EAAM,aAAa,KAAK,YACxBA,EAAM,WAAW,KAAK,UACtBA,EAAM,gBAAgB,KAAK,eAC3BA,EAAM,eAAe,KAAK;AAAA,EACnC;AAAA,EAEA,YAAYC,GAAO;AACjB,WAAOA,EAAM,SAAS;AAAA,EACxB;AACF;AAKA,SAASO,EAAgB5K,GAAO;AAC9B,QAAM6K,IAAU,oBAAI,IAAG;AAEvB,aAAWC,KAAS9K,EAAM,UAAU,QAAQ;AAC1C,UAAM+K,IAAY/K,EAAM,IAAI,OAAO8K,EAAM,IAAI,EAAE,QACzCE,IAAUhL,EAAM,IAAI,OAAO8K,EAAM,EAAE,EAAE;AAE3C,aAASjM,IAAIkM,GAAWlM,KAAKmM,GAASnM;AACpC,MAAAgM,EAAQ,IAAIhM,CAAC;AAAA,EAEjB;AAEA,SAAOgM;AACT;AAkBA,SAASI,GAAwB1B,GAAK;AAGpC,MAFIA,EAAI,QAAQ,KACEA,EAAI,KAAK,CAAC,EAAE,KAAK,KAAI,MACrB,MAAO,QAAO;AAEhC,WAAS1K,IAAI,GAAGA,KAAK0K,EAAI,OAAO1K,KAAK;AACnC,UAAMN,IAAOgL,EAAI,KAAK1K,CAAC,EAAE,KAAK,KAAI;AAClC,QAAIN,MAAS,SAASA,MAAS;AAC7B,aAAO,EAAE,OAAO,GAAG,KAAKM,EAAC;AAAA,EAE7B;AAEA,SAAO;AACT;AAKA,SAASqM,GAAuB3B,GAAK;AACnC,QAAM4B,IAAS,CAAA;AACf,MAAIC,IAAc,IACdC,IAAa,GACbC,IAAgB;AAEpB,WAASzM,IAAI,GAAGA,KAAK0K,EAAI,OAAO1K,KAAK;AAEnC,UAAMN,IADOgL,EAAI,KAAK1K,CAAC,EACL;AAElB,IAAIN,EAAK,WAAW,KAAK,MAClB6M,KAKHD,EAAO,KAAK,EAAE,OAAOE,GAAY,KAAKxM,GAAG,UAAUyM,GAAe,GAClEF,IAAc,IACdE,IAAgB,OANhBF,IAAc,IACdC,IAAaxM,GACbyM,IAAgB/M,EAAK,MAAM,CAAC,EAAE,KAAI;AAAA,EAOxC;AAGA,SAAI6M,KACFD,EAAO,KAAK,EAAE,OAAOE,GAAY,KAAK9B,EAAI,OAAO,UAAU+B,GAAe,GAGrEH;AACT;AAKA,SAASI,GAAuBhC,GAAKiC,GAAkB;AACrD,QAAML,IAAS,CAAA;AACf,MAAIM,IAAY;AAEhB,WAAS,IAAI,GAAG,KAAKlC,EAAI,OAAO,KAAK;AAEnC,QAAIiC,EAAiB,IAAI,CAAC,GAAG;AAC3B,MAAIC,MAAc,SAChBA,IAAY;AAEd;AAAA,IACF;AAKA,IAHalC,EAAI,KAAK,CAAC,EACL,KAAK,KAAI,MAEd,SACPkC,MAAc,OAChBA,IAAY,KAEZN,EAAO,KAAK,EAAE,OAAOM,GAAW,KAAK,GAAG,GACxCA,IAAY;AAAA,EAGlB;AAEA,SAAON;AACT;AAKA,SAASO,GAAmBnC,GAAKiC,GAAkB;AACjD,QAAML,IAAS,CAAA;AACf,MAAIQ,IAAa;AAEjB,WAAS,IAAI,GAAG,KAAKpC,EAAI,OAAO,KAAK;AAEnC,QAAIiC,EAAiB,IAAI,CAAC,GAAG;AAC3B,MAAIG,MAAe,SACjBR,EAAO,KAAK,EAAE,OAAOQ,GAAY,KAAK,IAAI,GAAG,GAC7CA,IAAa;AAEf;AAAA,IACF;AAGA,UAAMpN,IADOgL,EAAI,KAAK,CAAC,EACL,KAAK,KAAI;AAG3B,IAFoBhL,EAAK,WAAW,GAAG,KAAKA,EAAK,SAAS,GAAG,IAGvDoN,MAAe,SACjBA,IAAa,KAGXA,MAAe,SACjBR,EAAO,KAAK,EAAE,OAAOQ,GAAY,KAAK,IAAI,GAAG,GAC7CA,IAAa;AAAA,EAGnB;AAGA,SAAIA,MAAe,QACjBR,EAAO,KAAK,EAAE,OAAOQ,GAAY,KAAKpC,EAAI,OAAO,GAG5C4B;AACT;AAEA,SAASS,GAAuBrN,GAAM;AACpC,SAAO,eAAe,KAAKA,CAAI;AACjC;AAKA,SAASsN,GAAgCtC,GAAKiC,GAAkB;AAC9D,QAAML,IAAS,CAAA;AAEf,WAAStM,IAAI,GAAGA,KAAK0K,EAAI,OAAO1K,KAAK;AACnC,QAAI2M,EAAiB,IAAI3M,CAAC,EAAG;AAG7B,UAAM8B,IADO4I,EAAI,KAAK1K,CAAC,EACJ,KAAK,MAAM,0BAA0B;AACxD,QAAI,CAAC8B,EAAO;AAEZ,UAAMQ,IAAKR,EAAM,CAAC;AAClB,QAAI7B,IAAMD;AAEV,aAASiN,IAAIjN,IAAI,GAAGiN,KAAKvC,EAAI,SACvB,CAAAiC,EAAiB,IAAIM,CAAC,GADQA,KAAK;AAEvC,YAAMC,IAAWxC,EAAI,KAAKuC,CAAC,EAAE;AAC7B,UAAI,CAACF,GAAuBG,CAAQ;AAClC;AAEF,MAAAjN,IAAMgN;AAAA,IACR;AAEA,IAAAX,EAAO,KAAK,EAAE,OAAOtM,GAAG,KAAAC,GAAK,IAAAqC,GAAI,GACjCtC,IAAIC;AAAA,EACN;AAEA,SAAOqM;AACT;AAKA,SAASa,GAA4BzC,GAAKiC,GAAkBS,GAAiB;AAC3E,QAAMd,IAAS,CAAA,GAETe,IAAmB,CAAC3N,MAAS,WAAW,KAAKA,CAAI,GACjD4N,IAAkB,CAAC5N,MAAS;AAMhC,QALI,CAACA,EAAK,KAAI,KACV,MAAM,KAAKA,CAAI,KACf,YAAY,KAAKA,CAAI,KACrB,YAAY,KAAKA,CAAI,KACrB,KAAK,KAAKA,CAAI,KACd,aAAa,KAAKA,CAAI,EAAG,QAAO;AACpC,UAAMqF,IAAUrF,EAAK,KAAI;AAEzB,WADI,EAAAqF,EAAQ,WAAW,GAAG,KAAKA,EAAQ,SAAS,GAAG,KAC/C,mBAAmB,KAAKrF,CAAI;AAAA,EAElC;AAEA,WAASM,IAAI,GAAGA,KAAK0K,EAAI,OAAO1K,KAAK;AACnC,QAAI2M,EAAiB,IAAI3M,CAAC,KAAKoN,EAAgB,IAAIpN,CAAC,EAAG;AAEvD,UAAMmD,IAAOuH,EAAI,KAAK1K,CAAC,EAAE;AACzB,QAAI,CAACsN,EAAgBnK,CAAI,EAAG;AAE5B,UAAMoK,IAAcvN,IAAI;AAExB,QADIuN,IAAc7C,EAAI,SAClBiC,EAAiB,IAAIY,CAAW,KAAKH,EAAgB,IAAIG,CAAW,EAAG;AAE3E,UAAML,IAAWxC,EAAI,KAAK6C,CAAW,EAAE;AACvC,QAAI,CAACF,EAAiBH,CAAQ,EAAG;AAEjC,QAAIjN,IAAMsN;AACV,aAASN,IAAIM,IAAc,GAAGN,KAAKvC,EAAI,SACjC,EAAAiC,EAAiB,IAAIM,CAAC,KAAKG,EAAgB,IAAIH,CAAC,IADRA,KAAK;AAEjD,YAAMvN,IAAOgL,EAAI,KAAKuC,CAAC,EAAE;AACzB,UAAII,EAAiB3N,CAAI,KAAKqN,GAAuBrN,CAAI,GAAG;AAC1D,QAAAO,IAAMgN;AACN;AAAA,MACF;AACA;AAAA,IACF;AAEA,IAAAX,EAAO,KAAK,EAAE,OAAOtM,GAAG,KAAAC,EAAG,CAAE,GAC7BD,IAAIC;AAAA,EACN;AAEA,SAAOqM;AACT;AAKA,SAASkB,EAAalB,GAAQ;AAC5B,QAAMmB,IAAU,oBAAI,IAAG;AACvB,aAAWxB,KAASK;AAClB,aAAStM,IAAIiM,EAAM,OAAOjM,KAAKiM,EAAM,KAAKjM;AACxC,MAAAyN,EAAQ,IAAIzN,CAAC;AAGjB,SAAOyN;AACT;AAOA,SAASC,GAAqBhD,GAAKiD,GAAgB;AACjD,QAAMC,IAAW,CAAA;AAGjB,WAAS5N,IAAI,GAAGA,KAAK0K,EAAI,OAAO1K,KAAK;AACnC,QAAI2N,EAAe,IAAI3N,CAAC,EAAG;AAG3B,UAAM8B,IADO4I,EAAI,KAAK1K,CAAC,EACJ,KAAK,MAAM,cAAc;AAC5C,IAAI8B,KACF8L,EAAS,KAAK;AAAA,MACZ,MAAM5N;AAAA,MACN,OAAO8B,EAAM,CAAC,EAAE;AAAA,MAChB,SAAS4I,EAAI;AAAA;AAAA,IACrB,CAAO;AAAA,EAEL;AAGA,WAAS1K,IAAI,GAAGA,IAAI4N,EAAS,QAAQ5N,KAAK;AACxC,UAAMuD,IAAUqK,EAAS5N,CAAC;AAE1B,aAASiN,IAAIjN,IAAI,GAAGiN,IAAIW,EAAS,QAAQX;AACvC,UAAIW,EAASX,CAAC,EAAE,SAAS1J,EAAQ,OAAO;AACtC,QAAAA,EAAQ,UAAUqK,EAASX,CAAC,EAAE,OAAO;AACrC;AAAA,MACF;AAAA,EAEJ;AAEA,SAAOW;AACT;AAMA,SAASC,GAAgBD,GAAU;AACjC,QAAME,IAAM,oBAAI,IAAG;AACnB,aAAWC,KAAWH;AAEpB,aAAS5N,IAAI+N,EAAQ,OAAO,GAAG/N,KAAK+N,EAAQ,SAAS/N;AAEnD,MAAK8N,EAAI,IAAI9N,CAAC,KACZ8N,EAAI,IAAI9N,GAAG+N,EAAQ,IAAI;AAI7B,SAAOD;AACT;AAMO,MAAME,IAAmBhF,EAAW,OAAO;AAAA,EAChD,OAAO7H,GAAO;AACZ,WAAO8M,GAAmB9M,EAAM,GAAG;AAAA,EACrC;AAAA,EACA,OAAOpC,GAAOmK,GAAI;AAEhB,WAAIA,EAAG,aACE+E,GAAmB/E,EAAG,MAAM,IAE9BnK;AAAA,EACT;AACF,CAAC;AAKD,SAASkP,GAAmBvD,GAAK;AAC/B,QAAMwD,IAAc9B,GAAwB1B,CAAG,GACzCyD,IAAmBD,IAAcV,EAAa,CAACU,CAAW,CAAC,IAAI,oBAAI,IAAG,GAEtEE,IAAa/B,GAAuB3B,CAAG,GACvCiD,IAAiBH,EAAaY,CAAU,GAExCC,IAAa3B,GAAuBhC,GAAKiD,CAAc,GACvDW,IAAiBd,EAAaa,CAAU,GAExCE,IAAS1B,GAAmBnC,GAAKiD,CAAc,GAC/Ca,IAAahB,EAAae,CAAM,GAEhCE,IAAiBzB,GAAgCtC,GAAKiD,CAAc,GACpEe,IAAqBlB,EAAaiB,CAAc,GAEhDE,IAAkBxB,GAA4BzC,GAAKiD,GAAgBe,CAAkB,GACrFE,IAAsBpB,EAAamB,CAAe,GAElDE,IAAgBT,EAAW,OAAO,CAAAzN,MAAKA,EAAE,aAAa,SAAS,GAC/DmO,IAAoBtB,EAAaqB,CAAa,GAG9CjB,IAAWF,GAAqBhD,GAAKiD,CAAc,GACnDoB,IAAalB,GAAgBD,CAAQ;AAE3C,SAAO;AAAA,IACL,aAAAM;AAAA,IACA,kBAAAC;AAAA,IACA,YAAAC;AAAA,IACA,gBAAAT;AAAA,IACA,YAAAU;AAAA,IACA,gBAAAC;AAAA,IACA,QAAAC;AAAA,IACA,YAAAC;AAAA,IACA,gBAAAC;AAAA,IACA,oBAAAC;AAAA,IACA,iBAAAC;AAAA,IACA,qBAAAC;AAAA,IACA,eAAAC;AAAA,IACA,mBAAAC;AAAA,IACA,UAAAlB;AAAA,IACA,YAAAmB;AAAA,EACJ;AACA;AAKA,MAAMC,WAAwBlF,EAAW;AAAA,EACvC,YAAY7K,GAASgQ,GAAUC,GAAQ;AACrC,UAAK,GACL,KAAK,UAAUjQ,GACf,KAAK,WAAWgQ,GAChB,KAAK,SAASC;AAAA,EAChB;AAAA,EAEA,MAAMjF,GAAM;AACV,UAAMC,IAAU,SAAS,cAAc,KAAK;AAC5C,IAAAA,EAAQ,YAAY,mBACpBA,EAAQ,YAAY3H,GAAgB,KAAK,OAAO;AAEhD,UAAM0M,IAAW,KAAK;AAEtB,WAAA/E,EAAQ,iBAAiB,aAAa,CAACI,MAAM;AAC3C,MAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe,GAEjBL,EAAK,SAAS;AAAA,QACZ,WAAW,EAAE,QAAQgF,EAAQ;AAAA,QAC7B,gBAAgB;AAAA,MACxB,CAAO,GACDhF,EAAK,MAAK;AAAA,IACZ,CAAC,GAEMC;AAAA,EACT;AAAA,EAEA,GAAGqB,GAAO;AACR,WAAOA,EAAM,YAAY,KAAK;AAAA,EAChC;AAAA,EAEA,YAAYC,GAAO;AACjB,WAAOA,EAAM,SAAS;AAAA,EACxB;AACF;AAKA,MAAM2D,WAA2BrF,EAAW;AAAA,EAC1C,YAAY7K,GAASmQ,GAAaC,GAAW;AAC3C,UAAK,GACL,KAAK,UAAUpQ,GACf,KAAK,cAAcmQ,GACnB,KAAK,YAAYC,GACjB,KAAK,KAAK,aAAa,KAAK,OAAM,EAAG,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC;AAAA,EAC/D;AAAA,EAEA,MAAMpF,GAAM;AACV,UAAMC,IAAU,SAAS,cAAc,KAAK;AAC5C,IAAAA,EAAQ,YAAY;AAEpB,UAAMkF,IAAc,KAAK,aACnBnQ,IAAU,KAAK,SACfqD,IAAK,KAAK;AAGhB,YAAC,YAAY;AACX,UAAI;AACF,cAAM,EAAE,KAAAgN,EAAG,IAAK,MAAM1F,GAAQ,OAAOtH,GAAIrD,CAAO;AAChD,QAAAiL,EAAQ,YAAYoF;AAAA,MACtB,SAAShF,GAAG;AACV,QAAAJ,EAAQ,YAAY,8BAA8BI,EAAE,OAAO;AAAA,MAC7D;AAAA,IACF,GAAC,GAEDJ,EAAQ,iBAAiB,aAAa,CAACI,MAAM;AAC3C,MAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe,GAEjBL,EAAK,SAAS;AAAA,QACZ,WAAW,EAAE,QAAQmF,EAAW;AAAA,QAChC,gBAAgB;AAAA,MACxB,CAAO,GACDnF,EAAK,MAAK;AAAA,IACZ,CAAC,GAEMC;AAAA,EACT;AAAA,EAEA,GAAGqB,GAAO;AACR,WAAOA,EAAM,YAAY,KAAK;AAAA,EAChC;AAAA,EAEA,YAAYC,GAAO;AACjB,WAAOA,EAAM,SAAS;AAAA,EACxB;AACF;AAMA,MAAM+D,WAAoBzF,EAAW;AAAA,EACnC,YAAY5E,GAAMsK,GAAWC,GAAS;AACpC,UAAK,GACL,KAAK,OAAOvK,GACZ,KAAK,YAAYsK,GACjB,KAAK,UAAUC;AAAA,EACjB;AAAA,EAEA,MAAMxF,GAAM;AACV,UAAMC,IAAU,SAAS,cAAc,KAAK;AAC5C,IAAAA,EAAQ,YAAY;AACpB,UAAME,IAAkBH,EAAK,MAAM,MAAMnC,CAAc;AACvD,IAAAoC,EAAQ,YAAYjF,GAAY,KAAK,MAAM,EAAE,iBAAiBmF,EAAgB,iBAAiB;AAE/F,UAAMoF,IAAY,KAAK;AAEvB,WAAAtF,EAAQ,iBAAiB,aAAa,CAACI,MAAM;AAC3C,YAAMM,IAAWN,EAAE,OAAO,QAAQ,iBAAiB;AACnD,UAAIM,KAAYR,EAAgB,iBAAiB;AAC/C,QAAAE,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjBF,EAAgB,gBAAgBzB,EAAgBiC,CAAQ,CAAC;AACzD;AAAA,MACF;AAEA,MAAAN,EAAE,eAAc,GAChBA,EAAE,gBAAe,GAGjBL,EAAK,SAAS;AAAA,QACZ,WAAW,EAAE,QAAQuF,EAAS;AAAA,QAC9B,gBAAgB;AAAA,MACxB,CAAO,GACDvF,EAAK,MAAK;AAAA,IACZ,CAAC,GAEMC;AAAA,EACT;AAAA,EAEA,GAAGqB,GAAO;AAER,QAAIA,EAAM,KAAK,WAAW,KAAK,KAAK,OAAQ,QAAO;AACnD,aAASvL,IAAI,GAAGA,IAAI,KAAK,KAAK,QAAQA;AACpC,UAAIuL,EAAM,KAAKvL,CAAC,MAAM,KAAK,KAAKA,CAAC,EAAG,QAAO;AAE7C,WAAO;AAAA,EACT;AAAA,EAEA,YAAYwL,GAAO;AACjB,WAAOA,EAAM,SAAS;AAAA,EACxB;AACF;AAKA,MAAMkE,WAA4B5F,EAAW;AAAA,EAC3C,YAAYxH,GAAIQ,GAAO2D,GAAMC,GAAI;AAC/B,UAAK,GACL,KAAK,KAAKpE,GACV,KAAK,QAAQQ,GACb,KAAK,OAAO2D,GACZ,KAAK,KAAKC;AAAA,EACZ;AAAA,EAEA,MAAMuD,GAAM;AACV,UAAMC,IAAU,SAAS,cAAc,KAAK;AAC5C,IAAAA,EAAQ,YAAY;AACpB,UAAME,IAAkBH,EAAK,MAAM,MAAMnC,CAAc;AACvD,IAAAoC,EAAQ,YAAYrH,GAAoB,KAAK,IAAI,KAAK,OAAO,EAAE,iBAAiBuH,EAAgB,gBAAe,CAAE;AAEjH,UAAM3D,IAAO,KAAK;AAElB,WAAAyD,EAAQ,iBAAiB,aAAa,CAACI,MAAM;AAC3C,YAAMM,IAAWN,EAAE,OAAO,QAAQ,iBAAiB;AACnD,UAAIM,KAAYR,EAAgB,iBAAiB;AAC/C,QAAAE,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjBF,EAAgB,gBAAgBzB,EAAgBiC,CAAQ,CAAC;AACzD;AAAA,MACF;AAEA,YAAMD,IAAkBL,EAAE,OAAO,QAAQ,qBAAqB;AAC9D,UAAIK,GAAiB;AACnB,QAAAL,EAAE,eAAc,GAChBA,EAAE,gBAAe;AACjB,cAAMG,IAAaE,EAAgB,aAAa,mBAAmB,GAC7DD,IAAMT,EAAK,MAAM;AACvB,iBAASjK,IAAI,GAAGA,KAAK0K,EAAI,OAAO1K,KAAK;AACnC,gBAAMmD,IAAOuH,EAAI,KAAK1K,CAAC;AACvB,cAAImD,EAAK,KAAK,MAAM,IAAI,OAAO,SAASsH,CAAU,UAAU,CAAC,GAAG;AAC9D,YAAAR,EAAK,SAAS;AAAA,cACZ,WAAW,EAAE,QAAQ9G,EAAK,KAAI;AAAA,cAC9B,gBAAgB;AAAA,YAC9B,CAAa,GACD8G,EAAK,MAAK;AACV;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAEA,MAAAK,EAAE,eAAc,GAChBA,EAAE,gBAAe,GAEjBL,EAAK,SAAS;AAAA,QACZ,WAAW,EAAE,QAAQxD,EAAI;AAAA,QACzB,gBAAgB;AAAA,MACxB,CAAO,GACDwD,EAAK,MAAK;AAAA,IACZ,CAAC,GAEMC;AAAA,EACT;AAAA,EAEA,GAAGqB,GAAO;AAER,QADIA,EAAM,OAAO,KAAK,MAClBA,EAAM,MAAM,WAAW,KAAK,MAAM,OAAQ,QAAO;AACrD,aAASvL,IAAI,GAAGA,IAAI,KAAK,MAAM,QAAQA;AACrC,UAAIuL,EAAM,MAAMvL,CAAC,MAAM,KAAK,MAAMA,CAAC,EAAG,QAAO;AAE/C,WAAO;AAAA,EACT;AAAA,EAEA,YAAYwL,GAAO;AACjB,WAAOA,EAAM,SAAS;AAAA,EACxB;AACF;AAKA,MAAMmE,WAA6B7F,EAAW;AAAA,EAC5C,YAAYhH,GAAO2D,GAAMC,GAAI;AAC3B,UAAK,GACL,KAAK,QAAQ5D,GACb,KAAK,OAAO2D,GACZ,KAAK,KAAKC;AAAA,EACZ;AAAA,EAEA,MAAMuD,GAAM;AACV,UAAMC,IAAU,SAAS,cAAc,KAAK;AAC5C,IAAAA,EAAQ,YAAY;AACpB,UAAME,IAAkBH,EAAK,MAAM,MAAMnC,CAAc;AACvD,IAAAoC,EAAQ,YAAY9G,GAAqB,KAAK,OAAO,EAAE,iBAAiBgH,EAAgB,iBAAiB;AAEzG,UAAM3D,IAAO,KAAK;AAElB,WAAAyD,EAAQ,iBAAiB,aAAa,CAACI,MAAM;AAC3C,YAAMM,IAAWN,EAAE,OAAO,QAAQ,iBAAiB;AACnD,UAAIM,KAAYR,EAAgB,iBAAiB;AAC/C,QAAAE,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjBF,EAAgB,gBAAgBzB,EAAgBiC,CAAQ,CAAC;AACzD;AAAA,MACF;AAEA,MAAAN,EAAE,eAAc,GAChBA,EAAE,gBAAe,GAEjBL,EAAK,SAAS;AAAA,QACZ,WAAW,EAAE,QAAQxD,EAAI;AAAA,QACzB,gBAAgB;AAAA,MACxB,CAAO,GACDwD,EAAK,MAAK;AAAA,IACZ,CAAC,GAEMC;AAAA,EACT;AAAA,EAEA,GAAGqB,GAAO;AACR,QAAIA,EAAM,MAAM,WAAW,KAAK,MAAM,OAAQ,QAAO;AACrD,aAASvL,IAAI,GAAGA,IAAI,KAAK,MAAM,QAAQA;AACrC,UAAIuL,EAAM,MAAMvL,CAAC,MAAM,KAAK,MAAMA,CAAC,EAAG,QAAO;AAE/C,WAAO;AAAA,EACT;AAAA,EAEA,YAAYwL,GAAO;AACjB,WAAOA,EAAM,SAAS;AAAA,EACxB;AACF;AASA,SAASoE,GAAgBtG,GAASsE,GAAU3E,GAAW;AACrD,aAAW8E,KAAWH;AAEpB,QAAI3E,EAAU,IAAI8E,EAAQ,IAAI,KAAKzE,IAAUyE,EAAQ,QAAQzE,KAAWyE,EAAQ;AAC9E,aAAO;AAGX,SAAO;AACT;AAKA,SAAS8B,GAAevG,GAASsE,GAAU;AACzC,aAAWG,KAAWH;AACpB,QAAIG,EAAQ,SAASzE;AACnB,aAAOyE;AAGX,SAAO;AACT;AAOA,SAAS+B,GAAiB7F,GAAM8F,GAAa;AAC3C,QAAM,EAAE,OAAA5O,EAAK,IAAK8I,GAGZ+F,IAFW/F,EAAK,WAEU8B,EAAgB5K,CAAK,IAAI,oBAAI,IAAG,GAC1D;AAAA,IACJ,kBAAAgN;AAAA,IACA,gBAAAR;AAAA,IACA,YAAAa;AAAA,IACA,gBAAAF;AAAA,IACA,oBAAAI;AAAA,IACA,qBAAAE;AAAA,IACA,UAAAhB;AAAA,EACJ,IAAMmC,GACEE,IAAc,CAAA,GAGdC,IAAkB/O,EAAM,MAAMyF,EAAmB,GAGjDqC,IAAYiH,IAAkB/O,EAAM,MAAM4H,EAAsB,IAAI,oBAAI,IAAG;AAGjF,aAAW,EAAE,MAAAtC,GAAM,IAAAC,EAAE,KAAMuD,EAAK,eAAe;AAC7C,UAAMiC,IAAY/K,EAAM,IAAI,OAAOsF,CAAI,EAAE,QACnC0F,IAAUhL,EAAM,IAAI,OAAOuF,CAAE,EAAE;AAErC,aAAS1G,IAAIkM,GAAWlM,KAAKmM,GAASnM,KAAK;AAEzC,UAAIkQ,KAAmBN,GAAgB5P,GAAG4N,GAAU3E,CAAS,GAAG;AAE9D,cAAM9F,IAAOhC,EAAM,IAAI,KAAKnB,CAAC;AAC7B,QAAAiQ,EAAY;AAAA,UACVE,EAAW,KAAK,EAAE,OAAO,oBAAmB,CAAE,EAAE,MAAMhN,EAAK,IAAI;AAAA,QACzE;AACQ;AAAA,MACF;AAiCA,UA9BIgL,EAAiB,IAAInO,CAAC,KAKtBgQ,EAAa,IAAIhQ,CAAC,KAKlB2N,EAAe,IAAI3N,CAAC,KAKpBwO,EAAW,IAAIxO,CAAC,KAKhBsO,EAAe,IAAItO,CAAC,KAKpB0O,EAAmB,IAAI1O,CAAC,KAKxB4O,EAAoB,IAAI5O,CAAC;AAC3B;AAGF,YAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC,GACvBf,IAAUkE,EAAK;AAGrB,UAAI,CAAAiN,GAAenR,CAAO,KAKrBA,EAAQ,QAKb;AAAA,YAAIiR,GAAiB;AACnB,gBAAMG,IAAcR,GAAe7P,GAAG4N,CAAQ;AAC9C,cAAIyC,GAAa;AAEf,kBAAMzE,IAAayE,EAAY,UAAUA,EAAY,MAC/C1E,IAAc1C,EAAU,IAAIjJ,CAAC;AAEnC,YAAAiQ,EAAY;AAAA,cACVE,EAAW,QAAQ;AAAA,gBACjB,QAAQ,IAAI1E;AAAA,kBACVxM;AAAA,kBACAkE,EAAK;AAAA,kBACLA,EAAK;AAAA,kBACLnD;AAAA,kBACAqQ,EAAY;AAAA,kBACZ1E;AAAA,kBACAC;AAAA,gBAChB;AAAA,gBACc,WAAW;AAAA,gBACX,OAAO;AAAA,cACrB,CAAa,EAAE,MAAMzI,EAAK,MAAMA,EAAK,EAAE;AAAA,YACvC;AACU;AAAA,UACF;AAAA,QACF;AAGA,QAAA8M,EAAY;AAAA,UACVE,EAAW,QAAQ;AAAA,YACjB,QAAQ,IAAItG,GAAsB5K,GAASkE,EAAK,MAAMA,EAAK,EAAE;AAAA,YAC7D,WAAW;AAAA,YACX,OAAO;AAAA,UACjB,CAAS,EAAE,MAAMA,EAAK,MAAMA,EAAK,EAAE;AAAA,QACnC;AAAA;AAAA,IACI;AAAA,EACF;AAEA,SAAOgN,EAAW,IAAIF,GAAa,EAAI;AACzC;AAKA,SAASK,GAAyBrG,GAAM8F,GAAa;AAEnD,MAAI,CADoB9F,EAAK,MAAM,MAAMnC,CAAc,EAClC;AACnB,WAAOqI,EAAW;AAGpB,MAAI,CAAClG,EAAK;AACR,WAAOkG,EAAW;AAGpB,QAAM,EAAE,OAAAhP,EAAK,IAAK8I,GACZ+F,IAAejE,EAAgB5K,CAAK,GACpC,EAAE,gBAAAwM,EAAc,IAAKoC,GACrBE,IAAc,CAAA;AAEpB,aAAW,EAAE,MAAAxJ,GAAM,IAAAC,EAAE,KAAMuD,EAAK,eAAe;AAC7C,UAAMiC,IAAY/K,EAAM,IAAI,OAAOsF,CAAI,EAAE,QACnC0F,IAAUhL,EAAM,IAAI,OAAOuF,CAAE,EAAE;AAErC,aAAS1G,IAAIkM,GAAWlM,KAAKmM,GAASnM,KAAK;AAEzC,UADI,CAACgQ,EAAa,IAAIhQ,CAAC,KACnB2N,EAAe,IAAI3N,CAAC,EAAG;AAE3B,YAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC;AAC7B,UAAI,CAACmD,EAAK,KAAK,SAAS,IAAI,EAAG;AAE/B,YAAMpD,IAAUD,GAAcqD,EAAK,IAAI;AACvC,iBAAWrB,KAAS/B;AAClB,QAAAkQ,EAAY;AAAA,UACVE,EAAW,KAAK,EAAE,OAAO,cAAa,CAAE,EAAE;AAAA,YACxChN,EAAK,OAAOrB,EAAM;AAAA,YAClBqB,EAAK,OAAOrB,EAAM;AAAA,UAC9B;AAAA,QACA;AAAA,IAEI;AAAA,EACF;AAEA,SAAOqO,EAAW,IAAIF,GAAa,EAAI;AACzC;AAKA,MAAMM,KAAsBC,EAAW;AAAA,EACrC,MAAM;AAAA,IACJ,YAAYvG,GAAM;AAChB,YAAM8F,IAAc9F,EAAK,MAAM,MAAM+D,CAAgB;AACrD,WAAK,cAAc8B,GAAiB7F,GAAM8F,CAAW;AAAA,IACvD;AAAA,IAEA,OAAOU,GAAQ;AAEb,YAAMC,IAAoBD,EAAO,aAAa;AAAA,QAAK,CAAAvH,MACjDA,EAAG,QAAQ,KAAK,CAAAoB,MAAKA,EAAE,GAAGzB,EAAoB,CAAC;AAAA,MACvD;AAGM,UAAI4H,EAAO,cAAcA,EAAO,gBAAgBA,EAAO,mBAAmBA,EAAO,gBAAgBC,GAAmB;AAClH,cAAMX,IAAcU,EAAO,MAAM,MAAMzC,CAAgB;AACvD,aAAK,cAAc8B,GAAiBW,EAAO,MAAMV,CAAW;AAAA,MAC9D;AAAA,IACF;AAAA,EACJ;AAAA,EACE;AAAA,IACE,aAAa,CAACY,MAAMA,EAAE;AAAA,EAC1B;AACA,GAEMC,KAAsBJ,EAAW;AAAA,EACrC,MAAM;AAAA,IACJ,YAAYvG,GAAM;AAChB,YAAM8F,IAAc9F,EAAK,MAAM,MAAM+D,CAAgB;AACrD,WAAK,cAAcsC,GAAyBrG,GAAM8F,CAAW;AAAA,IAC/D;AAAA,IAEA,OAAOU,GAAQ;AACb,UAAIA,EAAO,cAAcA,EAAO,gBAAgBA,EAAO,mBAAmBA,EAAO,cAAc;AAC7F,cAAMV,IAAcU,EAAO,MAAM,MAAMzC,CAAgB;AACvD,aAAK,cAAcsC,GAAyBG,EAAO,MAAMV,CAAW;AAAA,MACtE;AAAA,IACF;AAAA,EACJ;AAAA,EACE;AAAA,IACE,aAAa,CAACY,MAAMA,EAAE;AAAA,EAC1B;AACA;AAKA,SAASE,GAAoB5G,GAAM8F,GAAa;AAE9C,MAAI,CADe9F,EAAK,MAAM,MAAM/B,EAAS,EAC7B;AACd,WAAOiI,EAAW;AAGpB,MAAI,CAAClG,EAAK;AACR,WAAOkG,EAAW;AAGpB,QAAM,EAAE,OAAAhP,EAAK,IAAK8I,GACZ+F,IAAejE,EAAgB5K,CAAK,GACpC,EAAE,gBAAAwM,EAAc,IAAKoC,GACrBE,IAAc,CAAA;AAEpB,aAAW,EAAE,MAAAxJ,GAAM,IAAAC,EAAE,KAAMuD,EAAK,eAAe;AAC7C,UAAMiC,IAAY/K,EAAM,IAAI,OAAOsF,CAAI,EAAE,QACnC0F,IAAUhL,EAAM,IAAI,OAAOuF,CAAE,EAAE;AAErC,aAAS1G,IAAIkM,GAAWlM,KAAKmM,GAASnM,KAAK;AAEzC,UADI,CAACgQ,EAAa,IAAIhQ,CAAC,KACnB2N,EAAe,IAAI3N,CAAC,EAAG;AAE3B,YAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC;AAC7B,UAAI,CAACmD,EAAK,KAAK,SAAS,GAAG,EAAG;AAE9B,YAAMpD,IAAUK,GAAS+C,EAAK,IAAI;AAClC,iBAAWrB,KAAS/B;AAClB,QAAAkQ,EAAY;AAAA,UACVE,EAAW,KAAK,EAAE,OAAO,cAAa,CAAE,EAAE;AAAA,YACxChN,EAAK,OAAOrB,EAAM;AAAA,YAClBqB,EAAK,OAAOrB,EAAM;AAAA,UAC9B;AAAA,QACA;AAAA,IAEI;AAAA,EACF;AAEA,SAAOqO,EAAW,IAAIF,GAAa,EAAI;AACzC;AAEA,MAAMa,KAAiBN,EAAW;AAAA,EAChC,MAAM;AAAA,IACJ,YAAYvG,GAAM;AAChB,YAAM8F,IAAc9F,EAAK,MAAM,MAAM+D,CAAgB;AACrD,WAAK,cAAc6C,GAAoB5G,GAAM8F,CAAW;AAAA,IAC1D;AAAA,IAEA,OAAOU,GAAQ;AACb,UAAIA,EAAO,cAAcA,EAAO,gBAAgBA,EAAO,mBAAmBA,EAAO,cAAc;AAC7F,cAAMV,IAAcU,EAAO,MAAM,MAAMzC,CAAgB;AACvD,aAAK,cAAc6C,GAAoBJ,EAAO,MAAMV,CAAW;AAAA,MACjE;AAAA,IACF;AAAA,EACJ;AAAA,EACE;AAAA,IACE,aAAa,CAACY,MAAMA,EAAE;AAAA,EAC1B;AACA;AAKA,MAAMI,WAA8BjH,EAAW;AAAA,EAC7C,YAAY7K,GAASkH,GAAU4D,GAAUC,GAAQ;AAC/C,UAAK,GACL,KAAK,UAAU/K,GACf,KAAK,WAAWkH,GAChB,KAAK,WAAW4D,GAChB,KAAK,SAASC;AAAA,EAChB;AAAA,EAEA,MAAMC,GAAM;AACV,UAAMC,IAAU,SAAS,cAAc,MAAM;AAC7C,IAAAA,EAAQ,YAAY,uBACpBA,EAAQ,YAAYjE,GAAc,KAAK,SAAS,KAAK,QAAQ;AAE7D,UAAM8D,IAAW,KAAK;AACP,SAAK;AACpB,UAAM9K,IAAU,KAAK;AAErB,WAAAiL,EAAQ,iBAAiB,aAAa,CAACI,MAAM;AAC3C,MAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe;AAGjB,YAAMU,IAAOd,EAAQ,sBAAqB,GACpCe,IAASX,EAAE,UAAUU,EAAK,MAC1BE,IAAaF,EAAK,OAClBG,IAAalM,EAAQ;AAE3B,UAAImM,IAAU;AACd,UAAIF,IAAa,KAAKC,IAAa,GAAG;AACpC,cAAME,IAAQJ,IAASC;AACvB,QAAAE,IAAU,KAAK,MAAMC,IAAQF,CAAU,GACvCC,IAAU,KAAK,IAAI,GAAG,KAAK,IAAIA,GAASD,CAAU,CAAC;AAAA,MACrD;AAEA,YAAMG,IAAYvB,IAAWqB;AAE7B,MAAAnB,EAAK,SAAS;AAAA,QACZ,WAAW,EAAE,QAAQqB,EAAS;AAAA,QAC9B,gBAAgB;AAAA,MACxB,CAAO,GACDrB,EAAK,MAAK;AAAA,IACZ,CAAC,GAEMC;AAAA,EACT;AAAA,EAEA,GAAGqB,GAAO;AACR,WAAOA,EAAM,YAAY,KAAK,WAAWA,EAAM,aAAa,KAAK;AAAA,EACnE;AAAA,EAEA,YAAYC,GAAO;AACjB,WAAOA,EAAM,SAAS;AAAA,EACxB;AACF;AAOA,SAASwF,GAA0B/G,GAAM8F,GAAa;AACpD,QAAM,EAAE,OAAA5O,EAAK,IAAK8I,GACZgH,IAAWhH,EAAK,UAChBgG,IAAc,CAAA,GACd,EAAE,YAAA7B,EAAU,IAAK2B,GACjBC,IAAeiB,IAAWlF,EAAgB5K,CAAK,IAAI,oBAAI,IAAG;AAEhE,aAAW8K,KAASmC,GAAY;AAE9B,QAAInC,EAAM,aAAa;AACrB;AAGF,QAAIiF,IAAe;AACnB,aAASjE,IAAIhB,EAAM,OAAOgB,KAAKhB,EAAM,KAAKgB;AACxC,UAAI+C,EAAa,IAAI/C,CAAC,GAAG;AACvB,QAAAiE,IAAe;AACf;AAAA,MACF;AAIF,UAAMtF,IAAaK,EAAM,MAAMA,EAAM,QAAQ;AAE7C,aAASjM,IAAIiM,EAAM,OAAOjM,KAAKiM,EAAM,KAAKjM,KAAK;AAC7C,YAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC,GACvBmR,IAAUnR,MAAMiM,EAAM,SAASjM,MAAMiM,EAAM;AAGjD,UAAIkF,KAAW,CAACD,KAAgBtF,GAAY;AAC1C,QAAAqE,EAAY;AAAA,UACVE,EAAW,QAAQ,EAAE,EAAE,MAAMhN,EAAK,MAAMA,EAAK,EAAE;AAAA,QACzD;AACQ;AAAA,MACF;AAGA,YAAMiO,IAAYF,IAAe,6CAA6C;AAC9E,MAAAjB,EAAY;AAAA,QACVE,EAAW,KAAK,EAAE,OAAOiB,EAAS,CAAE,EAAE,MAAMjO,EAAK,IAAI;AAAA,MAC7D;AAGM,YAAMkO,IAAYrB,EAAa,IAAIhQ,CAAC;AAEpC,MAAI,CAACmR,KAAW,CAACE,KAAalO,EAAK,KAAK,SAAS,KAC/C8M,EAAY;AAAA,QACVE,EAAW,QAAQ;AAAA,UACjB,QAAQ,IAAIY,GAAsB5N,EAAK,MAAM8I,EAAM,UAAU9I,EAAK,MAAMA,EAAK,EAAE;AAAA,QAC3F,CAAW,EAAE,MAAMA,EAAK,MAAMA,EAAK,EAAE;AAAA,MACrC;AAAA,IAEI;AAAA,EACF;AAEA,SAAOgN,EAAW,IAAIF,GAAa,EAAI;AACzC;AAEA,MAAMqB,KAAuBd,EAAW;AAAA,EACtC,MAAM;AAAA,IACJ,YAAYvG,GAAM;AAChB,YAAM8F,IAAc9F,EAAK,MAAM,MAAM+D,CAAgB;AACrD,WAAK,cAAcgD,GAA0B/G,GAAM8F,CAAW;AAAA,IAChE;AAAA,IAEA,OAAOU,GAAQ;AACb,UAAIA,EAAO,cAAcA,EAAO,gBAAgBA,EAAO,cAAc;AACnE,cAAMV,IAAcU,EAAO,MAAM,MAAMzC,CAAgB;AACvD,aAAK,cAAcgD,GAA0BP,EAAO,MAAMV,CAAW;AAAA,MACvE;AAAA,IACF;AAAA,EACJ;AAAA,EACE;AAAA,IACE,aAAa,CAACY,MAAMA,EAAE;AAAA,EAC1B;AACA;AAOA,SAASY,GAAsBtH,GAAM8F,GAAa;AAChD,QAAM,EAAE,OAAA5O,EAAK,IAAK8I,GACZgH,IAAWhH,EAAK,UAChBgG,IAAc,CAAA,GACd,EAAE,QAAA1B,EAAM,IAAKwB,GACbC,IAAeiB,IAAWlF,EAAgB5K,CAAK,IAAI,oBAAI,IAAG;AAEhE,aAAW8K,KAASsC,GAAQ;AAE1B,QAAIiD,IAAe;AACnB,aAASvE,IAAIhB,EAAM,OAAOgB,KAAKhB,EAAM,KAAKgB;AACxC,UAAI+C,EAAa,IAAI/C,CAAC,GAAG;AACvB,QAAAuE,IAAe;AACf;AAAA,MACF;AAGF,QAAIA;AAEF,eAASxR,IAAIiM,EAAM,OAAOjM,KAAKiM,EAAM,KAAKjM,KAAK;AAC7C,cAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC;AAC7B,QAAAiQ,EAAY;AAAA,UACVE,EAAW,KAAK,EAAE,OAAO,gBAAe,CAAE,EAAE,MAAMhN,EAAK,IAAI;AAAA,QACrE;AAAA,MACM;AAAA,SACK;AAEL,YAAM+B,IAAO,CAAA;AACb,eAAS+H,IAAIhB,EAAM,OAAOgB,KAAKhB,EAAM,KAAKgB;AACxC,QAAA/H,EAAK,KAAK/D,EAAM,IAAI,KAAK8L,CAAC,EAAE,IAAI;AAElC,YAAMwE,IAAYtQ,EAAM,IAAI,KAAK8K,EAAM,KAAK;AAG5C,MAAAgE,EAAY;AAAA,QACVE,EAAW,QAAQ;AAAA,UACjB,QAAQ,IAAIZ,GAAYrK,GAAMuM,EAAU,MAAMA,EAAU,EAAE;AAAA,QACpE,CAAS,EAAE,MAAMA,EAAU,MAAMA,EAAU,EAAE;AAAA,MAC7C;AAGM,eAASzR,IAAIiM,EAAM,QAAQ,GAAGjM,KAAKiM,EAAM,KAAKjM,KAAK;AACjD,cAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC;AAC7B,QAAAiQ,EAAY;AAAA,UACVE,EAAW,KAAK,EAAE,OAAO,iBAAgB,CAAE,EAAE,MAAMhN,EAAK,IAAI;AAAA,UAC5DgN,EAAW,QAAQ,EAAE,EAAE,MAAMhN,EAAK,MAAMA,EAAK,EAAE;AAAA,QACzD;AAAA,MACM;AAAA,IACF;AAAA,EACF;AAEA,SAAOgN,EAAW,IAAIF,GAAa,EAAI;AACzC;AAEA,MAAMyB,KAAmBlB,EAAW;AAAA,EAClC,MAAM;AAAA,IACJ,YAAYvG,GAAM;AAChB,YAAM8F,IAAc9F,EAAK,MAAM,MAAM+D,CAAgB;AACrD,WAAK,cAAcuD,GAAsBtH,GAAM8F,CAAW;AAAA,IAC5D;AAAA,IAEA,OAAOU,GAAQ;AACb,UAAIA,EAAO,cAAcA,EAAO,gBAAgBA,EAAO,cAAc;AACnE,cAAMV,IAAcU,EAAO,MAAM,MAAMzC,CAAgB;AACvD,aAAK,cAAcuD,GAAsBd,EAAO,MAAMV,CAAW;AAAA,MACnE;AAAA,IACF;AAAA,EACJ;AAAA,EACE;AAAA,IACE,aAAa,CAACY,MAAMA,EAAE;AAAA,EAC1B;AACA;AAOA,SAASgB,GAA8B1H,GAAM8F,GAAa;AACxD,QAAM,EAAE,OAAA5O,EAAK,IAAK8I,GACZgH,IAAWhH,EAAK,UAChBgG,IAAc,CAAA,GACd,EAAE,gBAAAxB,EAAc,IAAKsB,GACrBC,IAAeiB,IAAWlF,EAAgB5K,CAAK,IAAI,oBAAI,IAAG;AAEhE,aAAW8K,KAASwC,GAAgB;AAClC,QAAIyC,IAAe;AACnB,aAASjE,IAAIhB,EAAM,OAAOgB,KAAKhB,EAAM,KAAKgB;AACxC,UAAI+C,EAAa,IAAI/C,CAAC,GAAG;AACvB,QAAAiE,IAAe;AACf;AAAA,MACF;AAGF,QAAIA;AACF,eAASlR,IAAIiM,EAAM,OAAOjM,KAAKiM,EAAM,KAAKjM,KAAK;AAC7C,cAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC;AAC7B,QAAAiQ,EAAY;AAAA,UACVE,EAAW,KAAK,EAAE,OAAO,mBAAkB,CAAE,EAAE,MAAMhN,EAAK,IAAI;AAAA,QACxE;AAAA,MACM;AAAA,SACK;AACL,YAAML,IAAQ,CAAA;AACd,eAASmK,IAAIhB,EAAM,OAAOgB,KAAKhB,EAAM,KAAKgB;AACxC,QAAAnK,EAAM,KAAK3B,EAAM,IAAI,KAAK8L,CAAC,EAAE,IAAI;AAEnC,YAAMwE,IAAYtQ,EAAM,IAAI,KAAK8K,EAAM,KAAK;AAE5C,MAAAgE,EAAY;AAAA,QACVE,EAAW,QAAQ;AAAA,UACjB,QAAQ,IAAIT,GAAoBzD,EAAM,IAAInJ,GAAO2O,EAAU,MAAMA,EAAU,EAAE;AAAA,QACvF,CAAS,EAAE,MAAMA,EAAU,MAAMA,EAAU,EAAE;AAAA,MAC7C;AAEM,eAASzR,IAAIiM,EAAM,QAAQ,GAAGjM,KAAKiM,EAAM,KAAKjM,KAAK;AACjD,cAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC;AAC7B,QAAAiQ,EAAY;AAAA,UACVE,EAAW,KAAK,EAAE,OAAO,iBAAgB,CAAE,EAAE,MAAMhN,EAAK,IAAI;AAAA,UAC5DgN,EAAW,QAAQ,EAAE,EAAE,MAAMhN,EAAK,MAAMA,EAAK,EAAE;AAAA,QACzD;AAAA,MACM;AAAA,IACF;AAAA,EACF;AAEA,SAAOgN,EAAW,IAAIF,GAAa,EAAI;AACzC;AAEA,MAAM2B,KAA2BpB,EAAW;AAAA,EAC1C,MAAM;AAAA,IACJ,YAAYvG,GAAM;AAChB,YAAM8F,IAAc9F,EAAK,MAAM,MAAM+D,CAAgB;AACrD,WAAK,cAAc2D,GAA8B1H,GAAM8F,CAAW;AAAA,IACpE;AAAA,IAEA,OAAOU,GAAQ;AACb,UAAIA,EAAO,cAAcA,EAAO,gBAAgBA,EAAO,cAAc;AACnE,cAAMV,IAAcU,EAAO,MAAM,MAAMzC,CAAgB;AACvD,aAAK,cAAc2D,GAA8BlB,EAAO,MAAMV,CAAW;AAAA,MAC3E;AAAA,IACF;AAAA,EACJ;AAAA,EACE;AAAA,IACE,aAAa,CAACY,MAAMA,EAAE;AAAA,EAC1B;AACA;AAOA,SAASkB,GAA+B5H,GAAM8F,GAAa;AACzD,QAAM,EAAE,OAAA5O,EAAK,IAAK8I,GACZgH,IAAWhH,EAAK,UAChBgG,IAAc,CAAA,GACd,EAAE,iBAAAtB,EAAe,IAAKoB,GACtBC,IAAeiB,IAAWlF,EAAgB5K,CAAK,IAAI,oBAAI,IAAG;AAEhE,aAAW8K,KAAS0C,GAAiB;AACnC,QAAIuC,IAAe;AACnB,aAASjE,IAAIhB,EAAM,OAAOgB,KAAKhB,EAAM,KAAKgB;AACxC,UAAI+C,EAAa,IAAI/C,CAAC,GAAG;AACvB,QAAAiE,IAAe;AACf;AAAA,MACF;AAGF,QAAIA;AACF,eAASlR,IAAIiM,EAAM,OAAOjM,KAAKiM,EAAM,KAAKjM,KAAK;AAC7C,cAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC;AAC7B,QAAAiQ,EAAY;AAAA,UACVE,EAAW,KAAK,EAAE,OAAO,0BAAyB,CAAE,EAAE,MAAMhN,EAAK,IAAI;AAAA,QAC/E;AAAA,MACM;AAAA,SACK;AACL,YAAML,IAAQ,CAAA;AACd,eAASmK,IAAIhB,EAAM,OAAOgB,KAAKhB,EAAM,KAAKgB;AACxC,QAAAnK,EAAM,KAAK3B,EAAM,IAAI,KAAK8L,CAAC,EAAE,IAAI;AAEnC,YAAMwE,IAAYtQ,EAAM,IAAI,KAAK8K,EAAM,KAAK;AAE5C,MAAAgE,EAAY;AAAA,QACVE,EAAW,QAAQ;AAAA,UACjB,QAAQ,IAAIR,GAAqB7M,GAAO2O,EAAU,MAAMA,EAAU,EAAE;AAAA,QAC9E,CAAS,EAAE,MAAMA,EAAU,MAAMA,EAAU,EAAE;AAAA,MAC7C;AAEM,eAASzR,IAAIiM,EAAM,QAAQ,GAAGjM,KAAKiM,EAAM,KAAKjM,KAAK;AACjD,cAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC;AAC7B,QAAAiQ,EAAY;AAAA,UACVE,EAAW,KAAK,EAAE,OAAO,iBAAgB,CAAE,EAAE,MAAMhN,EAAK,IAAI;AAAA,UAC5DgN,EAAW,QAAQ,EAAE,EAAE,MAAMhN,EAAK,MAAMA,EAAK,EAAE;AAAA,QACzD;AAAA,MACM;AAAA,IACF;AAAA,EACF;AAEA,SAAOgN,EAAW,IAAIF,GAAa,EAAI;AACzC;AAEA,MAAM6B,KAA4BtB,EAAW;AAAA,EAC3C,MAAM;AAAA,IACJ,YAAYvG,GAAM;AAChB,YAAM8F,IAAc9F,EAAK,MAAM,MAAM+D,CAAgB;AACrD,WAAK,cAAc6D,GAA+B5H,GAAM8F,CAAW;AAAA,IACrE;AAAA,IAEA,OAAOU,GAAQ;AACb,UAAIA,EAAO,cAAcA,EAAO,gBAAgBA,EAAO,cAAc;AACnE,cAAMV,IAAcU,EAAO,MAAM,MAAMzC,CAAgB;AACvD,aAAK,cAAc6D,GAA+BpB,EAAO,MAAMV,CAAW;AAAA,MAC5E;AAAA,IACF;AAAA,EACJ;AAAA,EACE;AAAA,IACE,aAAa,CAACY,MAAMA,EAAE;AAAA,EAC1B;AACA;AAOA,SAASoB,GAA0B9H,GAAM8F,GAAa;AACpD,QAAM,EAAE,OAAA5O,EAAK,IAAK8I,GACZgH,IAAWhH,EAAK,UAChBgG,IAAc,CAAA,GACd,EAAE,YAAA5B,EAAU,IAAK0B,GACjBC,IAAeiB,IAAWlF,EAAgB5K,CAAK,IAAI,oBAAI,IAAG;AAEhE,aAAW8K,KAASoC,GAAY;AAE9B,QAAI2D,IAAc;AAClB,aAAS/E,IAAIhB,EAAM,OAAOgB,KAAKhB,EAAM,KAAKgB;AACxC,UAAI+C,EAAa,IAAI/C,CAAC,GAAG;AACvB,QAAA+E,IAAc;AACd;AAAA,MACF;AAGF,QAAIA;AAEF,eAAShS,IAAIiM,EAAM,OAAOjM,KAAKiM,EAAM,KAAKjM,KAAK;AAC7C,cAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC;AAC7B,QAAAiQ,EAAY;AAAA,UACVE,EAAW,KAAK,EAAE,OAAO,qBAAoB,CAAE,EAAE,MAAMhN,EAAK,IAAI;AAAA,QAC1E;AAAA,MACM;AAAA,SACK;AAEL,YAAM8O,IAAY,CAAA;AAClB,eAAShF,IAAIhB,EAAM,QAAQ,GAAGgB,IAAIhB,EAAM,KAAKgB;AAC3C,QAAAgF,EAAU,KAAK9Q,EAAM,IAAI,KAAK8L,CAAC,EAAE,IAAI;AAEvC,YAAMiF,IAAcD,EAAU,KAAK;AAAA,CAAI,GACjCR,IAAYtQ,EAAM,IAAI,KAAK8K,EAAM,KAAK;AAG5C,MAAAgE,EAAY;AAAA,QACVE,EAAW,QAAQ;AAAA,UACjB,QAAQ,IAAInB,GAAgBkD,GAAaT,EAAU,MAAMA,EAAU,EAAE;AAAA,QAC/E,CAAS,EAAE,MAAMA,EAAU,MAAMA,EAAU,EAAE;AAAA,MAC7C;AAGM,eAASzR,IAAIiM,EAAM,QAAQ,GAAGjM,KAAKiM,EAAM,KAAKjM,KAAK;AACjD,cAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC;AAC7B,QAAAiQ,EAAY;AAAA,UACVE,EAAW,KAAK,EAAE,OAAO,iBAAgB,CAAE,EAAE,MAAMhN,EAAK,IAAI;AAAA,UAC5DgN,EAAW,QAAQ,EAAE,EAAE,MAAMhN,EAAK,MAAMA,EAAK,EAAE;AAAA,QACzD;AAAA,MACM;AAAA,IACF;AAAA,EACF;AAEA,SAAOgN,EAAW,IAAIF,GAAa,EAAI;AACzC;AAEA,MAAMkC,KAAuB3B,EAAW;AAAA,EACtC,MAAM;AAAA,IACJ,YAAYvG,GAAM;AAChB,YAAM8F,IAAc9F,EAAK,MAAM,MAAM+D,CAAgB;AACrD,WAAK,cAAc+D,GAA0B9H,GAAM8F,CAAW;AAAA,IAChE;AAAA,IAEA,OAAOU,GAAQ;AACb,UAAIA,EAAO,cAAcA,EAAO,gBAAgBA,EAAO,cAAc;AACnE,cAAMV,IAAcU,EAAO,MAAM,MAAMzC,CAAgB;AACvD,aAAK,cAAc+D,GAA0BtB,EAAO,MAAMV,CAAW;AAAA,MACvE;AAAA,IACF;AAAA,EACJ;AAAA,EACE;AAAA,IACE,aAAa,CAACY,MAAMA,EAAE;AAAA,EAC1B;AACA;AAOA,SAASyB,GAA6BnI,GAAM8F,GAAa;AACvD,QAAM,EAAE,OAAA5O,EAAK,IAAK8I,GACZgH,IAAWhH,EAAK,UAChBgG,IAAc,CAAA,GACd,EAAE,eAAApB,EAAa,IAAKkB,GACpBC,IAAeiB,IAAWlF,EAAgB5K,CAAK,IAAI,oBAAI,IAAG;AAEhE,aAAW8K,KAAS4C,GAAe;AAEjC,QAAIwD,IAAiB;AACrB,aAASpF,IAAIhB,EAAM,OAAOgB,KAAKhB,EAAM,KAAKgB;AACxC,UAAI+C,EAAa,IAAI/C,CAAC,GAAG;AACvB,QAAAoF,IAAiB;AACjB;AAAA,MACF;AAGF,QAAIA;AAEF,eAASrS,IAAIiM,EAAM,OAAOjM,KAAKiM,EAAM,KAAKjM,KAAK;AAC7C,cAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC;AAC7B,QAAAiQ,EAAY;AAAA,UACVE,EAAW,KAAK,EAAE,OAAO,wBAAuB,CAAE,EAAE,MAAMhN,EAAK,IAAI;AAAA,QAC7E;AAAA,MACM;AAAA,SACK;AAEL,YAAMmP,IAAe,CAAA;AACrB,eAASrF,IAAIhB,EAAM,QAAQ,GAAGgB,IAAIhB,EAAM,KAAKgB;AAC3C,QAAAqF,EAAa,KAAKnR,EAAM,IAAI,KAAK8L,CAAC,EAAE,IAAI;AAE1C,YAAMsF,IAAiBD,EAAa,KAAK;AAAA,CAAI,GACvCb,IAAYtQ,EAAM,IAAI,KAAK8K,EAAM,KAAK;AAG5C,MAAAgE,EAAY;AAAA,QACVE,EAAW,QAAQ;AAAA,UACjB,QAAQ,IAAIhB,GAAmBoD,GAAgBd,EAAU,MAAMA,EAAU,EAAE;AAAA,QACrF,CAAS,EAAE,MAAMA,EAAU,MAAMA,EAAU,EAAE;AAAA,MAC7C;AAGM,eAASzR,IAAIiM,EAAM,QAAQ,GAAGjM,KAAKiM,EAAM,KAAKjM,KAAK;AACjD,cAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC;AAC7B,QAAAiQ,EAAY;AAAA,UACVE,EAAW,KAAK,EAAE,OAAO,iBAAgB,CAAE,EAAE,MAAMhN,EAAK,IAAI;AAAA,UAC5DgN,EAAW,QAAQ,EAAE,EAAE,MAAMhN,EAAK,MAAMA,EAAK,EAAE;AAAA,QACzD;AAAA,MACM;AAAA,IACF;AAAA,EACF;AAEA,SAAOgN,EAAW,IAAIF,GAAa,EAAI;AACzC;AAEA,MAAMuC,KAA0BhC,EAAW;AAAA,EACzC,MAAM;AAAA,IACJ,YAAYvG,GAAM;AAChB,YAAM8F,IAAc9F,EAAK,MAAM,MAAM+D,CAAgB;AACrD,WAAK,cAAcoE,GAA6BnI,GAAM8F,CAAW;AAAA,IACnE;AAAA,IAEA,OAAOU,GAAQ;AACb,UAAIA,EAAO,cAAcA,EAAO,gBAAgBA,EAAO,cAAc;AACnE,cAAMV,IAAcU,EAAO,MAAM,MAAMzC,CAAgB;AACvD,aAAK,cAAcoE,GAA6B3B,EAAO,MAAMV,CAAW;AAAA,MAC1E;AAAA,IACF;AAAA,EACJ;AAAA,EACE;AAAA,IACE,aAAa,CAACY,MAAMA,EAAE;AAAA,EAC1B;AACA,GAMM8B,KAAmB;AAMzB,SAASrC,GAAe1Q,GAAM;AAC5B,QAAMoC,IAAQpC,EAAK,KAAI,EAAG,MAAM+S,EAAgB;AAChD,SAAK3Q,IACE,EAAE,KAAKA,EAAM,CAAC,GAAG,KAAKA,EAAM,CAAC,EAAE,OAAM,IADzB;AAErB;AAKA,MAAM4Q,WAA2B5I,EAAW;AAAA,EAC1C,YAAY6I,GAAKC,GAAK7I,GAAUC,GAAQ;AACtC,UAAK,GACL,KAAK,MAAM2I,GACX,KAAK,MAAMC,GACX,KAAK,WAAW7I,GAChB,KAAK,SAASC;AAAA,EAChB;AAAA,EAEA,MAAMC,GAAM;AACV,UAAMC,IAAU,SAAS,cAAc,KAAK;AAC5C,IAAAA,EAAQ,YAAY;AAEpB,UAAM2I,IAAM,SAAS,cAAc,KAAK;AAexC,QAdAA,EAAI,MAAM,KAAK,KACfA,EAAI,MAAM,KAAK,KACfA,EAAI,UAAU,QAEdA,EAAI,iBAAiB,SAAS,MAAM;AAClC,MAAA3I,EAAQ,cAAc;AACtB,YAAM4I,IAAQ,SAAS,cAAc,KAAK;AAC1C,MAAAA,EAAM,YAAY,kBAClBA,EAAM,cAAc,oBAAoB,KAAK,GAAG,IAChD5I,EAAQ,YAAY4I,CAAK;AAAA,IAC3B,CAAC,GAED5I,EAAQ,YAAY2I,CAAG,GAEnB,KAAK,KAAK;AACZ,YAAME,IAAU,SAAS,cAAc,MAAM;AAC7C,MAAAA,EAAQ,YAAY,gBACpBA,EAAQ,cAAc,KAAK,KAC3B7I,EAAQ,YAAY6I,CAAO;AAAA,IAC7B;AAEA,UAAMhJ,IAAW,KAAK;AACtB,WAAAG,EAAQ,iBAAiB,aAAa,CAACI,MAAM;AAC3C,MAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjBL,EAAK,SAAS;AAAA,QACZ,WAAW,EAAE,QAAQF,EAAQ;AAAA,QAC7B,gBAAgB;AAAA,MACxB,CAAO,GACDE,EAAK,MAAK;AAAA,IACZ,CAAC,GAEMC;AAAA,EACT;AAAA,EAEA,GAAGqB,GAAO;AACR,WAAOA,EAAM,QAAQ,KAAK,OAAOA,EAAM,QAAQ,KAAK;AAAA,EACtD;AAAA,EAEA,YAAYC,GAAO;AACjB,WAAOA,EAAM,SAAS;AAAA,EACxB;AACF;AAKA,SAASwH,GAAsB/I,GAAM8F,GAAa;AAChD,QAAM,EAAE,OAAA5O,EAAK,IAAK8I,GACZgH,IAAWhH,EAAK,UAChBgG,IAAc,CAAA,GACdD,IAAeiB,IAAWlF,EAAgB5K,CAAK,IAAI,oBAAI,IAAG,GAC1D;AAAA,IACJ,kBAAAgN;AAAA,IACA,gBAAAR;AAAA,IACA,YAAAa;AAAA,IACA,gBAAAF;AAAA,IACA,oBAAAI;AAAA,IACA,qBAAAE;AAAA,IACA,mBAAAE;AAAA,EACJ,IAAMiB;AAEJ,aAAW,EAAE,MAAAtJ,GAAM,IAAAC,EAAE,KAAMuD,EAAK,eAAe;AAC7C,UAAMiC,IAAY/K,EAAM,IAAI,OAAOsF,CAAI,EAAE,QACnC0F,IAAUhL,EAAM,IAAI,OAAOuF,CAAE,EAAE;AAErC,aAAS1G,IAAIkM,GAAWlM,KAAKmM,GAASnM,KAAK;AAQzC,UAPIgQ,EAAa,IAAIhQ,CAAC,KAClBmO,EAAiB,IAAInO,CAAC,KACtB2N,EAAe,IAAI3N,CAAC,KACpBwO,EAAW,IAAIxO,CAAC,KAChBsO,EAAe,IAAItO,CAAC,KACpB0O,EAAmB,IAAI1O,CAAC,KACxB4O,EAAoB,IAAI5O,CAAC,KACzB8O,EAAkB,IAAI9O,CAAC,EAAG;AAE9B,YAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC,GACvBiT,IAAY7C,GAAejN,EAAK,IAAI;AAC1C,MAAK8P,KAELhD,EAAY;AAAA,QACVE,EAAW,QAAQ;AAAA,UACjB,QAAQ,IAAIuC,GAAmBO,EAAU,KAAKA,EAAU,KAAK9P,EAAK,MAAMA,EAAK,EAAE;AAAA,QACzF,CAAS,EAAE,MAAMA,EAAK,MAAMA,EAAK,EAAE;AAAA,MACnC;AAAA,IACI;AAAA,EACF;AAEA,SAAOgN,EAAW,IAAIF,GAAa,EAAI;AACzC;AAEA,MAAMiD,KAAmB1C,EAAW;AAAA,EAClC,MAAM;AAAA,IACJ,YAAYvG,GAAM;AAChB,YAAM8F,IAAc9F,EAAK,MAAM,MAAM+D,CAAgB;AACrD,WAAK,cAAcgF,GAAsB/I,GAAM8F,CAAW;AAAA,IAC5D;AAAA,IAEA,OAAOU,GAAQ;AACb,UAAIA,EAAO,cAAcA,EAAO,gBAAgBA,EAAO,mBAAmBA,EAAO,cAAc;AAC7F,cAAMV,IAAcU,EAAO,MAAM,MAAMzC,CAAgB;AACvD,aAAK,cAAcgF,GAAsBvC,EAAO,MAAMV,CAAW;AAAA,MACnE;AAAA,IACF;AAAA,EACJ;AAAA,EACE;AAAA,IACE,aAAa,CAACY,MAAMA,EAAE;AAAA,EAC1B;AACA,GAaawC,IAAoBrK,EAAY,OAAM,GAKtCsK,IAAwBpK,EAAW,OAAO;AAAA,EACrD,SAAS;AACP,WAAO;AAAA,EACT;AAAA,EACA,OAAOqK,GAAMnK,GAAI;AACf,eAAWE,KAAUF,EAAG;AACtB,UAAIE,EAAO,GAAG+J,CAAiB;AAC7B,eAAO/J,EAAO;AAGlB,WAAOiK;AAAA,EACT;AACF,CAAC;AAUD,SAASC,EAAcC,GAAK;AAC1B,SAAI,CAACA,KAAO,OAAOA,KAAQ,YAAY,OAAO,KAAKA,CAAG,EAAE,WAAW,IAC1D,KAIFC,GAAK,KAAKD,GAAK;AAAA,IACpB,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa;AAAA,IACb,aAAa;AAAA,EACjB,CAAG,EAAE,QAAO;AACZ;AAKA,SAASE,GAAkBC,GAAK3U,GAAO4U,GAAYC,GAAeC,GAAa5J,GAAM;AACnF,QAAM6J,IAAY,SAAS,cAAc,MAAM;AAG/C,MAFAA,EAAU,YAAY,wBAElB,OAAO/U,KAAU,WAAW;AAC9B,UAAMgV,IAAW,SAAS,cAAc,OAAO;AAC/C,WAAAA,EAAS,OAAO,YAChBA,EAAS,UAAUhV,GACnBgV,EAAS,YAAY,2BACrBA,EAAS,iBAAiB,UAAU,CAACzJ,MAAM;AACzC,MAAAA,EAAE,gBAAe;AACjB,YAAM0J,IAAU,EAAE,GAAGL,GAAY,CAACD,CAAG,GAAGK,EAAS,QAAO,GAClDE,IAAUX,EAAcU,CAAO;AACrC,MAAA/J,EAAK,SAAS;AAAA,QACZ,SAAS,EAAE,MAAM2J,GAAe,IAAIC,GAAa,QAAQI,EAAO;AAAA,QAChE,aAAazV,EAAkB,GAAG,EAAI;AAAA,MAC9C,CAAO;AAAA,IACH,CAAC,GACDsV,EAAU,YAAYC,CAAQ,GACvBD;AAAA,EACT;AAEA,MAAI,MAAM,QAAQ/U,CAAK,GAAG;AACxB,aAASiB,IAAI,GAAGA,IAAIjB,EAAM,QAAQiB,KAAK;AACrC,YAAMkU,IAAM,SAAS,cAAc,MAAM;AACzC,MAAAA,EAAI,YAAY,sBAChBA,EAAI,cAAc,OAAOnV,EAAMiB,CAAC,CAAC,GACjCkU,EAAI,kBAAkB,QACtBA,EAAI,aAAa;AAEjB,YAAM3S,IAAMvB;AACZ,MAAAkU,EAAI,iBAAiB,QAAQ,CAAC5J,MAAM;AAClC,QAAAA,EAAE,gBAAe;AACjB,cAAM6J,IAAS,CAAC,GAAGpV,CAAK,GAClBqV,IAASF,EAAI,YAAY,KAAI;AACnC,QAAIE,MAAW,KACbD,EAAO,OAAO5S,GAAK,CAAC,IAEpB4S,EAAO5S,CAAG,IAAI6S;AAEhB,cAAMJ,IAAU,EAAE,GAAGL,GAAY,CAACD,CAAG,GAAGS,EAAM,GACxCF,IAAUX,EAAcU,CAAO;AACrC,QAAA/J,EAAK,SAAS;AAAA,UACZ,SAAS,EAAE,MAAM2J,GAAe,IAAIC,GAAa,QAAQI,EAAO;AAAA,UAChE,aAAazV,EAAkB,GAAG,EAAI;AAAA,QAChD,CAAS;AAAA,MACH,CAAC,GACD0V,EAAI,iBAAiB,WAAW,CAAC5J,MAAM;AACrC,QAAIA,EAAE,QAAQ,YACZA,EAAE,eAAc,GAChB4J,EAAI,KAAI,IAEV5J,EAAE,gBAAe;AAAA,MACnB,CAAC,GACD4J,EAAI,iBAAiB,aAAa,CAAC5J,MAAMA,EAAE,iBAAiB,GAC5DwJ,EAAU,YAAYI,CAAG;AAAA,IAC3B;AAGA,UAAMG,IAAS,SAAS,cAAc,MAAM;AAC5C,WAAAA,EAAO,YAAY,0BACnBA,EAAO,cAAc,KACrBA,EAAO,QAAQ,YACfA,EAAO,iBAAiB,aAAa,CAAC/J,MAAM;AAC1C,MAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe;AAAA,IACnB,CAAC,GACD+J,EAAO,iBAAiB,SAAS,CAAC/J,MAAM;AACtC,MAAAA,EAAE,gBAAe;AACjB,YAAM6J,IAAS,CAAC,GAAGpV,GAAO,KAAK,GACzBiV,IAAU,EAAE,GAAGL,GAAY,CAACD,CAAG,GAAGS,EAAM,GACxCF,IAAUX,EAAcU,CAAO;AACrC,MAAA/J,EAAK,SAAS;AAAA,QACZ,SAAS,EAAE,MAAM2J,GAAe,IAAIC,GAAa,QAAQI,EAAO;AAAA,QAChE,aAAazV,EAAkB,GAAG,EAAI;AAAA,MAC9C,CAAO;AAAA,IACH,CAAC,GACDsV,EAAU,YAAYO,CAAM,GACrBP;AAAA,EACT;AAEA,MAAI/U,MAAU,QAAQ,OAAOA,KAAU,UAAU;AAE/C,UAAMuV,IAAQ,SAAS,cAAc,OAAO;AAC5C,WAAAA,EAAM,OAAO,QACbA,EAAM,YAAY,wBAClBA,EAAM,QAAQ,KAAK,UAAUvV,CAAK,GAClCuV,EAAM,iBAAiB,QAAQ,CAAChK,MAAM;AACpC,MAAAA,EAAE,gBAAe;AACjB,UAAI;AACF,cAAMiK,IAAS,KAAK,MAAMD,EAAM,KAAK,GAC/BN,IAAU,EAAE,GAAGL,GAAY,CAACD,CAAG,GAAGa,EAAM,GACxCN,IAAUX,EAAcU,CAAO;AACrC,QAAA/J,EAAK,SAAS;AAAA,UACZ,SAAS,EAAE,MAAM2J,GAAe,IAAIC,GAAa,QAAQI,EAAO;AAAA,UAChE,aAAazV,EAAkB,GAAG,EAAI;AAAA,QAChD,CAAS;AAAA,MACH,QAAQ;AAEN,QAAA8V,EAAM,QAAQ,KAAK,UAAUvV,CAAK;AAAA,MACpC;AAAA,IACF,CAAC,GACDuV,EAAM,iBAAiB,WAAW,CAAChK,MAAM;AACvC,MAAIA,EAAE,QAAQ,YACZA,EAAE,eAAc,GAChBgK,EAAM,KAAI,IAEZhK,EAAE,gBAAe;AAAA,IACnB,CAAC,GACDgK,EAAM,iBAAiB,aAAa,CAAChK,MAAMA,EAAE,iBAAiB,GAC9DwJ,EAAU,YAAYQ,CAAK,GACpBR;AAAA,EACT;AAGA,QAAMQ,IAAQ,SAAS,cAAc,OAAO;AAC5C,SAAAA,EAAM,OAAO,QACbA,EAAM,YAAY,wBAClBA,EAAM,QAAQvV,MAAU,OAAO,KAAK,OAAOA,CAAK,GAChDuV,EAAM,cAAcvV,MAAU,OAAO,UAAU,IAC/CuV,EAAM,iBAAiB,QAAQ,CAAChK,MAAM;AACpC,IAAAA,EAAE,gBAAe;AACjB,UAAMjD,IAAMiN,EAAM;AAElB,QAAIE;AACJ,IAAInN,MAAQ,MAAMA,MAAQ,SACxBmN,IAAW,OACFnN,MAAQ,SACjBmN,IAAW,KACFnN,MAAQ,UACjBmN,IAAW,KACF,CAAC,MAAMnN,CAAG,KAAKA,EAAI,KAAI,MAAO,KACvCmN,IAAW,OAAOnN,CAAG,IAErBmN,IAAWnN;AAEb,UAAM2M,IAAU,EAAE,GAAGL,GAAY,CAACD,CAAG,GAAGc,EAAQ,GAC1CP,IAAUX,EAAcU,CAAO;AACrC,IAAA/J,EAAK,SAAS;AAAA,MACZ,SAAS,EAAE,MAAM2J,GAAe,IAAIC,GAAa,QAAQI,EAAO;AAAA,MAChE,aAAazV,EAAkB,GAAG,EAAI;AAAA,IAC5C,CAAK;AAAA,EACH,CAAC,GACD8V,EAAM,iBAAiB,WAAW,CAAChK,MAAM;AACvC,IAAIA,EAAE,QAAQ,YACZA,EAAE,eAAc,GAChBgK,EAAM,KAAI,IAEZhK,EAAE,gBAAe;AAAA,EACnB,CAAC,GACDgK,EAAM,iBAAiB,aAAa,CAAChK,MAAMA,EAAE,iBAAiB,GAC9DwJ,EAAU,YAAYQ,CAAK,GACpBR;AACT;AAeO,SAASW,GAA8BC,GAAaC,GAAaC,GAAWC,GAAW5K,GAAMxH,IAAU,IAAI;AAChH,QAAM,EAAE,WAAAqS,IAAY,CAAA,EAAE,IAAKrS,GACrByH,IAAU,SAAS,cAAc,KAAK;AAC5C,EAAAA,EAAQ,YAAY;AAEpB,MAAIyJ;AACJ,MAAI;AACF,IAAAA,IAAaH,GAAK,KAAKkB,CAAW;AAAA,EACpC,QAAQ;AACN,UAAM5B,IAAQ,SAAS,cAAc,KAAK;AAC1C,WAAAA,EAAM,YAAY,wBAClBA,EAAM,cAAc,4CACpB5I,EAAQ,YAAY4I,CAAK,GAClB,EAAE,KAAK5I,GAAS,OAAO,GAAI;AAAA,EACpC;AAEA,GAAI,CAACyJ,KAAc,OAAOA,KAAe,cACvCA,IAAa,CAAA;AAGf,QAAMoB,IAAQ,SAAS,cAAc,OAAO;AAC5C,EAAAA,EAAM,YAAY;AAGlB,QAAMC,IAAa,gBAAgB,KAAK,OAAM,EAAG,SAAS,EAAE,EAAE,MAAM,GAAG,CAAC,GAClEC,IAAW,SAAS,cAAc,UAAU;AAClD,EAAAA,EAAS,KAAKD;AACd,QAAME,IAAc,IAAI,IAAI,OAAO,KAAKvB,CAAU,CAAC;AACnD,aAAWwB,KAAKL;AACd,QAAI,CAACI,EAAY,IAAIC,CAAC,GAAG;AACvB,YAAMC,IAAM,SAAS,cAAc,QAAQ;AAC3C,MAAAA,EAAI,QAAQD,GACZF,EAAS,YAAYG,CAAG;AAAA,IAC1B;AAEF,EAAAlL,EAAQ,YAAY+K,CAAQ;AAE5B,QAAMI,IAAO,OAAO,KAAK1B,CAAU;AAEnC,aAAWD,KAAO2B,GAAM;AACtB,UAAMjQ,IAAM,SAAS,cAAc,IAAI,GAEjCkQ,IAAU,SAAS,cAAc,IAAI;AAC3C,IAAAA,EAAQ,YAAY;AACpB,UAAMC,IAAW,SAAS,cAAc,OAAO;AAC/C,IAAAA,EAAS,OAAO,QAChBA,EAAS,YAAY,4BACrBA,EAAS,QAAQ7B,GACjB6B,EAAS,OAAO,KAAK,IAAI7B,EAAI,QAAQ,CAAC,GACtC6B,EAAS,aAAa,IACtBA,EAAS,aAAa,QAAQP,CAAU,GACxCO,EAAS,iBAAiB,QAAQ,CAACjL,MAAM;AACvC,MAAAA,EAAE,gBAAe;AACjB,YAAMkL,IAASD,EAAS,MAAM,KAAI;AAClC,UAAIC,MAAW,MAAMA,MAAW9B,GAAK;AACnC,QAAA6B,EAAS,QAAQ7B;AACjB;AAAA,MACF;AAEA,YAAMM,IAAU,CAAA;AAChB,iBAAWmB,KAAK,OAAO,KAAKxB,CAAU;AACpC,QAAIwB,MAAMzB,IACRM,EAAQwB,CAAM,IAAI7B,EAAWwB,CAAC,IAE9BnB,EAAQmB,CAAC,IAAIxB,EAAWwB,CAAC;AAG7B,YAAMlB,IAAUX,EAAcU,CAAO;AACrC,MAAA/J,EAAK,SAAS;AAAA,QACZ,SAAS,EAAE,MAAM0K,GAAa,IAAIC,GAAW,QAAQX,EAAO;AAAA,QAC5D,aAAazV,EAAkB,GAAG,EAAI;AAAA,MAC9C,CAAO;AAAA,IACH,CAAC,GACD+W,EAAS,iBAAiB,WAAW,CAACjL,MAAM;AAC1C,MAAIA,EAAE,QAAQ,YACZA,EAAE,eAAc,GAChBiL,EAAS,KAAI,IAEfjL,EAAE,gBAAe;AAAA,IACnB,CAAC,GACDiL,EAAS,iBAAiB,aAAa,CAACjL,MAAMA,EAAE,iBAAiB,GACjEgL,EAAQ,YAAYC,CAAQ,GAC5BnQ,EAAI,YAAYkQ,CAAO;AAEvB,UAAMG,IAAY,SAAS,cAAc,IAAI;AAC7C,IAAAA,EAAU,YAAY,6BACtBA,EAAU;AAAA,MACRhC,GAAkBC,GAAKC,EAAWD,CAAG,GAAGC,GAAYgB,GAAaC,GAAW3K,CAAI;AAAA,IACtF,GACI7E,EAAI,YAAYqQ,CAAS;AAEzB,UAAMC,IAAa,SAAS,cAAc,IAAI;AAC9C,IAAAA,EAAW,YAAY;AACvB,UAAMC,IAAY,SAAS,cAAc,MAAM;AAC/C,IAAAA,EAAU,YAAY,yBACtBA,EAAU,cAAc,KACxBA,EAAU,QAAQ,mBAClBA,EAAU,iBAAiB,aAAa,CAACrL,MAAM;AAC7C,MAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe;AAAA,IACnB,CAAC,GACDqL,EAAU,iBAAiB,SAAS,CAACrL,MAAM;AACzC,MAAAA,EAAE,gBAAe;AACjB,YAAM0J,IAAU,EAAE,GAAGL,EAAU;AAC/B,aAAOK,EAAQN,CAAG;AAClB,YAAMO,IAAUX,EAAcU,CAAO;AACrC,MAAA/J,EAAK,SAAS;AAAA,QACZ,SAAS,EAAE,MAAM0K,GAAa,IAAIC,GAAW,QAAQX,EAAO;AAAA,QAC5D,aAAazV,EAAkB,GAAG,EAAI;AAAA,MAC9C,CAAO;AAAA,IACH,CAAC,GACDkX,EAAW,YAAYC,CAAS,GAChCvQ,EAAI,YAAYsQ,CAAU,GAE1BX,EAAM,YAAY3P,CAAG;AAAA,EACvB;AAEA,EAAA8E,EAAQ,YAAY6K,CAAK;AAEzB,QAAMa,IAAS,SAAS,cAAc,KAAK;AAC3C,SAAAA,EAAO,YAAY,sBACnBA,EAAO,cAAc,kBACrBA,EAAO,iBAAiB,aAAa,CAACtL,MAAM;AAC1C,IAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe;AAAA,EACnB,CAAC,GACDsL,EAAO,iBAAiB,SAAS,CAACtL,MAAM;AACtC,IAAAA,EAAE,gBAAe;AACjB,QAAIkL,IAAS,YACTK,IAAU;AACd,WAAOlC,EAAW6B,CAAM,MAAM;AAC5B,MAAAA,IAAS,WAAWK,CAAO,IAC3BA;AAEF,UAAM7B,IAAU,EAAE,GAAGL,GAAY,CAAC6B,CAAM,GAAG,GAAE,GACvCvB,IAAUX,EAAcU,CAAO;AACrC,IAAA/J,EAAK,SAAS;AAAA,MACZ,SAAS,EAAE,MAAM0K,GAAa,IAAIC,GAAW,QAAQX,EAAO;AAAA,MAC5D,aAAazV,EAAkB,GAAG,EAAI;AAAA,IAC5C,CAAK;AAAA,EACH,CAAC,GACD0L,EAAQ,YAAY0L,CAAM,GAEnB,EAAE,KAAK1L,GAAS,OAAO,GAAK;AACrC;AAKA,SAAS4L,GAA4B7L,GAAM8F,GAAa;AACtD,QAAM,EAAE,OAAA5O,EAAK,IAAK8I,GACZ,EAAE,aAAAiE,EAAW,IAAK6B;AAExB,MAAI,CAAC7B;AACH,WAAOiC,EAAW;AAIpB,QAAMF,IAAc,CAAA,GACdwB,IAAYtQ,EAAM,IAAI,KAAK+M,EAAY,KAAK;AAGlD,EAAA+B,EAAY;AAAA,IACVE,EAAW,QAAQ,EAAE,EAAE,MAAMsB,EAAU,MAAMA,EAAU,EAAE;AAAA,EAC7D,GACExB,EAAY;AAAA,IACVE,EAAW,KAAK,EAAE,OAAO,iBAAgB,CAAE,EAAE,MAAMsB,EAAU,IAAI;AAAA,EACrE;AAGE,WAASzR,IAAIkO,EAAY,QAAQ,GAAGlO,KAAKkO,EAAY,KAAKlO,KAAK;AAC7D,UAAMmD,IAAOhC,EAAM,IAAI,KAAKnB,CAAC;AAC7B,IAAAiQ,EAAY;AAAA,MACVE,EAAW,KAAK,EAAE,OAAO,iBAAgB,CAAE,EAAE,MAAMhN,EAAK,IAAI;AAAA,MAC5DgN,EAAW,QAAQ,EAAE,EAAE,MAAMhN,EAAK,MAAMA,EAAK,EAAE;AAAA,IACrD;AAAA,EACE;AAEA,SAAOgN,EAAW,IAAIF,GAAa,EAAI;AACzC;AAEA,MAAM8F,KAAyBvF,EAAW;AAAA,EACxC,MAAM;AAAA,IACJ,YAAYvG,GAAM;AAChB,YAAM8F,IAAc9F,EAAK,MAAM,MAAM+D,CAAgB;AACrD,WAAK,cAAc8H,GAA4B7L,GAAM8F,CAAW;AAAA,IAClE;AAAA,IAEA,OAAOU,GAAQ;AACb,UAAIA,EAAO,YAAY;AACrB,cAAMV,IAAcU,EAAO,MAAM,MAAMzC,CAAgB;AACvD,aAAK,cAAc8H,GAA4BrF,EAAO,MAAMV,CAAW;AAAA,MACzE;AAAA,IACF;AAAA,EACJ;AAAA,EACE;AAAA,IACE,aAAa,CAACY,MAAMA,EAAE;AAAA,EAC1B;AACA;AAOO,SAASqF,GAAcvT,IAAU,IAAI;AAC1C,QAAM;AAAA,IACJ,gBAAAwT,IAAiB;AAAA,IACjB,mBAAAnS,IAAoB;AAAA,IACpB,iBAAAC;AAAA,IACA,iBAAAE,IAAkB;AAAA,IAClB,iBAAA0D,IAAkB;AAAA,IAClB,iBAAAC;AAAA,IACA,YAAAI,IAAa;AAAA,IACb,YAAAC;AAAA,EACJ,IAAMxF,GAEE0H,IAAoB5C,GAAuBzD,GAAmBC,CAAe,GAC7EqG,IAAkB1C,GAAqBzD,GAAiB0D,GAAiBC,CAAe,GACxFyC,IAAatC,GAAgBC,GAAYC,CAAU;AAEzD,SAAO;AAAA;AAAA,IAELrB,GAAoB,GAAGqP,CAAc;AAAA;AAAA,IAErCxO,GAAiB,GAAG0C,CAAiB;AAAA;AAAA,IAErCrC,EAAe,GAAGsC,CAAe;AAAA;AAAA,IAEjClC,GAAU,GAAGmC,CAAU;AAAA;AAAA,IAEvBtB;AAAA;AAAA,IAEAqK;AAAA;AAAA,IAEApF;AAAA;AAAA,IAEA+H;AAAA,IACA7C;AAAA,IACA3C;AAAA,IACAK;AAAA,IACAE;AAAA,IACAQ;AAAA,IACAI;AAAA,IACAE;AAAA,IACAE;AAAA,IACAK;AAAA,IACAK;AAAA,EACJ;AACA;ACtnFA,SAAS0D,GAAkBjM,GAAM;AAC/B,wBAAsB,MAAM;AAC1B,UAAMkM,IAAQlM,EAAK,IAAI,cAAc,YAAY,GAC3CmM,IAAeD,KAAA,gBAAAA,EAAO,cAAc;AAC1C,IAAIC,aAAwB,qBAC1BA,EAAa,MAAK,GAClBA,EAAa,OAAM;AAAA,EAEvB,CAAC;AACH;AAKA,SAASC,GAAcpM,GAAMqM,GAAQC,GAAO;AAC1C,QAAM,EAAE,MAAA9P,GAAM,IAAAC,EAAE,IAAKuD,EAAK,MAAM,UAAU,MACpCvK,IAAOuK,EAAK,MAAM,SAASxD,GAAMC,CAAE;AAEzC,EAAAuD,EAAK,SAAS;AAAA,IACZ,SAAS,EAAE,MAAAxD,GAAM,IAAAC,GAAI,QAAQ4P,IAAS5W,IAAO6W,EAAK;AAAA,IAClD,WAAW,EAAE,QAAQ9P,IAAO6P,EAAO,QAAQ,MAAM5P,IAAK4P,EAAO,OAAM;AAAA,EACvE,CAAG;AACH;AAKA,SAASE,GAAWvM,GAAMwM,GAAQ;AAChC,QAAM,EAAE,MAAAhQ,EAAI,IAAKwD,EAAK,MAAM,UAAU,MAChC9G,IAAO8G,EAAK,MAAM,IAAI,OAAOxD,CAAI;AAEvC,EAAAwD,EAAK,SAAS;AAAA,IACZ,SAAS,EAAE,MAAM9G,EAAK,MAAM,IAAIA,EAAK,MAAM,QAAQsT,EAAM;AAAA,EAC7D,CAAG;AACH;AAOA,SAASC,GAAczM,GAAM5F,GAAO;AAClC,QAAM,EAAE,MAAAoC,EAAI,IAAKwD,EAAK,MAAM,UAAU,MAChC9G,IAAO8G,EAAK,MAAM,IAAI,OAAOxD,CAAI,GAIjCkQ,IAHOxT,EAAK,KAGQ,MAAM,aAAa,GACvCyT,IAAe,IAAI,OAAOvS,CAAK,IAAI;AAEzC,MAAIsS,GAAc;AAChB,UAAME,IAAgBF,EAAa,CAAC;AACpC,IAAIE,MAAkBD,IAEpB3M,EAAK,SAAS;AAAA,MACZ,SAAS,EAAE,MAAM9G,EAAK,MAAM,IAAIA,EAAK,OAAO0T,EAAc,QAAQ,QAAQ,GAAE;AAAA,IACpF,CAAO,IAGD5M,EAAK,SAAS;AAAA,MACZ,SAAS,EAAE,MAAM9G,EAAK,MAAM,IAAIA,EAAK,OAAO0T,EAAc,QAAQ,QAAQD,EAAY;AAAA,IAC9F,CAAO;AAAA,EAEL;AAEE,IAAA3M,EAAK,SAAS;AAAA,MACZ,SAAS,EAAE,MAAM9G,EAAK,MAAM,IAAIA,EAAK,MAAM,QAAQyT,EAAY;AAAA,IACrE,CAAK;AAEL;AAMA,SAASE,GAAW7M,GAAM8M,GAAM;AAC9B,QAAM,EAAE,MAAAtQ,EAAI,IAAKwD,EAAK,MAAM,UAAU,MAChC9G,IAAO8G,EAAK,MAAM,IAAI,OAAOxD,CAAI,GACjC/G,IAAOyD,EAAK,MAGZ6T,IAActX,EAAK,MAAM,2BAA2B,GACpDuX,IAAgBvX,EAAK,MAAM,YAAY,GACvCiF,IAAYjF,EAAK,MAAM,yBAAyB,GAQhDkX,IANW;AAAA,IACf,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,MAAM;AAAA,EACV,EAEgCG,CAAI;AAClC,MAAIG,IAAe,MACfC,IAAc;AAElB,EAAIxS,KACFuS,IAAevS,EAAU,CAAC,GAC1BwS,IAAc,UACLF,KACTC,IAAeD,EAAc,CAAC,GAC9BE,IAAc,cACLH,MACTE,IAAeF,EAAY,CAAC,GAC5BG,IAAc,WAGZD,IACEC,MAAgBJ,IAElB9M,EAAK,SAAS;AAAA,IACZ,SAAS,EAAE,MAAM9G,EAAK,MAAM,IAAIA,EAAK,OAAO+T,EAAa,QAAQ,QAAQ,GAAE;AAAA,EACnF,CAAO,IAGDjN,EAAK,SAAS;AAAA,IACZ,SAAS,EAAE,MAAM9G,EAAK,MAAM,IAAIA,EAAK,OAAO+T,EAAa,QAAQ,QAAQN,EAAY;AAAA,EAC7F,CAAO,IAIH3M,EAAK,SAAS;AAAA,IACZ,SAAS,EAAE,MAAM9G,EAAK,MAAM,IAAIA,EAAK,MAAM,QAAQyT,EAAY;AAAA,EACrE,CAAK;AAEL;AAeA,SAASQ,GAAanN,GAAM;AAC1B,QAAM,EAAE,MAAAxD,GAAM,IAAAC,EAAE,IAAKuD,EAAK,MAAM,UAAU;AAC1C,SAAOxD,MAASC,IAAKuD,EAAK,MAAM,SAASxD,GAAMC,CAAE,IAAI;AACvD;AAKY,MAAC2Q,IAAU;AAAA,EACrB,KAAKpN,GAAM;AACT,IAAAqN,GAAKrN,CAAI;AAAA,EACX;AAAA,EAEA,KAAKA,GAAM;AACT,IAAAsN,GAAKtN,CAAI;AAAA,EACX;AAAA,EAEA,OAAOA,GAAM;AACX,IAAAuN,GAAgBvN,CAAI;AAAA,EACtB;AAAA,EAEA,QAAQA,GAAM;AACZ,IAAAuN,GAAgBvN,CAAI,GACpBiM,GAAkBjM,CAAI;AAAA,EACxB;AAAA,EAEA,qBAAqBA,GAAM;AACzBwN,IAAAA,GAAuBxN,CAAI;AAAA,EAC7B;AAAA,EAEA,qBAAqBA,GAAM;AACzB,IAAIA,EAAK,MAAM,UAAU,KAAK,SAC5BwN,GAAuBxN,CAAI,GAE7ByN,GAAyBzN,CAAI;AAAA,EAC/B;AAAA,EAEA,KAAKA,GAAM;AACT,IAAAoM,GAAcpM,GAAM,MAAM,IAAI;AAAA,EAChC;AAAA,EAEA,OAAOA,GAAM;AACX,IAAAoM,GAAcpM,GAAM,KAAK,GAAG;AAAA,EAC9B;AAAA,EAEA,cAAcA,GAAM;AAClB,IAAAoM,GAAcpM,GAAM,MAAM,IAAI;AAAA,EAChC;AAAA,EAEA,GAAGA,GAAM;AACP,IAAAyM,GAAczM,GAAM,CAAC;AAAA,EACvB;AAAA,EAEA,GAAGA,GAAM;AACP,IAAAyM,GAAczM,GAAM,CAAC;AAAA,EACvB;AAAA,EAEA,GAAGA,GAAM;AACP,IAAAyM,GAAczM,GAAM,CAAC;AAAA,EACvB;AAAA,EAEA,KAAKA,GAAM;AACT,UAAM0N,IAAYP,GAAanN,CAAI,GAC7B2N,IAAa;AACnB,QAAID,GAAW;AACb,YAAM,EAAE,MAAAlR,GAAM,IAAAC,EAAE,IAAKuD,EAAK,MAAM,UAAU;AAC1C,MAAAA,EAAK,SAAS;AAAA,QACZ,SAAS,EAAE,MAAAxD,GAAM,IAAAC,GAAI,QAAQ,IAAIiR,CAAS,KAAKC,CAAU,IAAG;AAAA,QAC5D,WAAW,EAAE,QAAQnR,IAAOkR,EAAU,SAAS,GAAG,MAAMlR,IAAOkR,EAAU,SAAS,IAAIC,EAAW,OAAM;AAAA,MAC/G,CAAO;AAAA,IACH,OAAO;AACL,YAAM,EAAE,MAAAnR,EAAI,IAAKwD,EAAK,MAAM,UAAU;AACtC,MAAAA,EAAK,SAAS;AAAA,QACZ,SAAS,EAAE,MAAAxD,GAAM,QAAQ,eAAemR,CAAU,IAAG;AAAA,QACrD,WAAW,EAAE,QAAQnR,IAAO,GAAG,MAAMA,IAAO,GAAE;AAAA,MACtD,CAAO;AAAA,IACH;AAAA,EACF;AAAA,EAEA,MAAMwD,GAAM;AACV,UAAM,EAAE,MAAAxD,EAAI,IAAKwD,EAAK,MAAM,UAAU;AAEtC,IAAAA,EAAK,SAAS;AAAA,MACZ,SAAS,EAAE,MAAAxD,GAAM,QAAQ,4CAA4B;AAAA,MACrD,WAAW,EAAE,QAAQA,IAAO,GAAG,MAAMA,IAAO,GAAE;AAAA,IACpD,CAAK;AAAA,EACH;AAAA,EAEA,WAAWwD,GAAM;AACf,IAAA6M,GAAW7M,GAAM,QAAQ;AAAA,EAC3B;AAAA,EAEA,aAAaA,GAAM;AACjB,IAAA6M,GAAW7M,GAAM,UAAU;AAAA,EAC7B;AAAA,EAEA,SAASA,GAAM;AACb,IAAA6M,GAAW7M,GAAM,MAAM;AAAA,EACzB;AAAA,EAEA,WAAWA,GAAM;AACf,IAAAoM,GAAcpM,GAAM,KAAK,GAAG;AAAA,EAC9B;AAAA,EAEA,UAAUA,GAAM;AACd,UAAM,EAAE,MAAAxD,GAAM,IAAAC,EAAE,IAAKuD,EAAK,MAAM,UAAU,MACpCvK,IAAOuK,EAAK,MAAM,SAASxD,GAAMC,CAAE,GAMnCmR,IAAUnY,IAAO,UAAUA,IAAO,UAAU,QAL/B;AAAA;AAAA;AAAA;AAAA,YAKoD;AAEvE,IAAAuK,EAAK,SAAS;AAAA,MACZ,SAAS,EAAE,MAAAxD,GAAM,IAAAC,GAAI,QAAQmR,EAAO;AAAA,MACpC,WAAW,EAAE,QAAQpR,IAAO,EAAC;AAAA,IACnC,CAAK;AAAA,EACH;AAAA,EAEA,GAAGwD,GAAM;AACP,UAAM,EAAE,MAAAxD,EAAI,IAAKwD,EAAK,MAAM,UAAU,MAChC9G,IAAO8G,EAAK,MAAM,IAAI,OAAOxD,CAAI;AAEvC,IAAAwD,EAAK,SAAS;AAAA,MACZ,SAAS,EAAE,MAAM9G,EAAK,IAAI,QAAQ;AAAA;AAAA;AAAA,EAAW;AAAA,IACnD,CAAK;AAAA,EACH;AAAA,EAEA,MAAM8G,GAAM;AACV,IAAAuM,GAAWvM,GAAM,IAAI;AAAA,EACvB;AAAA,EAEA,MAAMA,GAAM;AACV,UAAM,EAAE,MAAAxD,EAAI,IAAKwD,EAAK,MAAM,UAAU,MAChC9G,IAAO8G,EAAK,MAAM,IAAI,OAAOxD,CAAI;AAMvC,IAAAwD,EAAK,SAAS;AAAA,MACZ,SAAS,EAAE,MAAM9G,EAAK,IAAI,QAAQ;AAAA;AAAA,IANhB;AAAA;AAAA;AAAA,sCAMuC;AAAA,EAAI;AAAA,MAC7D,WAAW,EAAE,QAAQA,EAAK,KAAK,EAAC;AAAA,IACtC,CAAK;AAAA,EACH;AAAA,EAEA,QAAQ8G,GAAM;AACZ,UAAM,EAAE,MAAAxD,EAAI,IAAKwD,EAAK,MAAM,UAAU,MAChC9G,IAAO8G,EAAK,MAAM,IAAI,OAAOxD,CAAI;AASvC,IAAAwD,EAAK,SAAS;AAAA,MACZ,SAAS,EAAE,MAAM9G,EAAK,IAAI,QAAQ;AAAA;AAAA,IATd,6IASuC;AAAA,EAAI;AAAA,MAC/D,WAAW,EAAE,QAAQA,EAAK,KAAK,EAAC;AAAA,IACtC,CAAK;AAAA,EACH;AAAA,EAEA,MAAM8G,GAAM;AACV,UAAM,EAAE,MAAAxD,EAAI,IAAKwD,EAAK,MAAM,UAAU;AACtC,IAAAA,EAAK,SAAS;AAAA,MACZ,SAAS,EAAE,MAAAxD,GAAM,QAAQ,UAAS;AAAA,MAClC,WAAW,EAAE,QAAQA,IAAO,GAAG,MAAMA,IAAO,EAAC;AAAA,IACnD,CAAK;AAAA,EACH;AACF,GC9SaqR,KAAyBjR,EAAM,OAAO;AAAA,EACjD,QAAQC,GAAQ;AACd,WAAIA,EAAO,WAAW,IAAU,CAAA,IACzBA,EAAOA,EAAO,SAAS,CAAC;AAAA,EACjC;AACF,CAAC,GAGYiR,IAA4BjP,EAAY,OAAM,GAG9CkP,IAAsBlP,EAAY,OAAM,GAGxCmP,IAAqBnP,EAAY,OAAM,GAGvCoP,KAAsBpP,EAAY,OAAM,GAGxCqP,KAAwBrP,EAAY,OAAM,GAM1CsP,IAAmBpP,EAAW,OAAO;AAAA,EAChD,OAAO7H,GAAO;AACZ,UAAMiH,IAASjH,EAAM,MAAM2W,EAAsB;AACjD,WAAO;AAAA,MACL,kBAAkB;AAAA,MAClB,YAAY1P,EAAO,eAAe;AAAA,MAClC,WAAWA,EAAO,cAAc;AAAA,MAChC,YAAYA,EAAO,cAAc;AAAA,MACjC,cAAcA,EAAO,gBAAgB,OAAOA,EAAO,eAAe;AAAA,IACxE;AAAA,EACE;AAAA,EACA,OAAOrJ,GAAOmK,GAAI;AAChB,eAAWE,KAAUF,EAAG;AACtB,MAAIE,EAAO,GAAG2O,CAAyB,IACrChZ,IAAQ,EAAE,GAAGA,GAAO,kBAAkBqK,EAAO,MAAK,IACzCA,EAAO,GAAG4O,CAAmB,IACtCjZ,IAAQ,EAAE,GAAGA,GAAO,YAAYqK,EAAO,MAAK,IACnCA,EAAO,GAAG6O,CAAkB,IACrClZ,IAAQ,EAAE,GAAGA,GAAO,WAAWqK,EAAO,MAAK,IAClCA,EAAO,GAAG8O,EAAmB,IACtCnZ,IAAQ,EAAE,GAAGA,GAAO,YAAYqK,EAAO,MAAK,IACnCA,EAAO,GAAG+O,EAAqB,MACxCpZ,IAAQ,EAAE,GAAGA,GAAO,cAAcqK,EAAO,MAAK;AAGlD,WAAOrK;AAAA,EACT;AACF,CAAC,GCxDYsZ,KAAiBC,GAAO,GAAG;AAAA,EACtC;AAAA,IACE,KAAK;AAAA,IACL,KAAK,CAACrO,MAAS;AACb,YAAM1G,IAAU0G,EAAK,MAAM,MAAMmO,CAAgB,EAAE;AACnD,aAAAnO,EAAK,SAAS,EAAE,SAAS+N,EAAoB,GAAG,CAACzU,CAAO,GAAG,GACpD;AAAA,IACT;AAAA,EACJ;AAAA,EACE;AAAA,IACE,KAAK;AAAA,IACL,KAAK,CAAC0G,MAAS;AACb,YAAM1G,IAAU0G,EAAK,MAAM,MAAMmO,CAAgB,EAAE;AACnD,aAAAnO,EAAK,SAAS,EAAE,SAASgO,EAAmB,GAAG,CAAC1U,CAAO,GAAG,GACnD;AAAA,IACT;AAAA,EACJ;AAAA,EACE;AAAA,IACE,KAAK;AAAA,IACL,KAAK,CAAC0G,OACJoN,EAAQ,KAAKpN,CAAI,GACV;AAAA,EAEb;AAAA,EACE;AAAA,IACE,KAAK;AAAA,IACL,KAAK,CAACA,OACJoN,EAAQ,OAAOpN,CAAI,GACZ;AAAA,EAEb;AAAA,EACE;AAAA,IACE,KAAK;AAAA,IACL,KAAK,CAACA,OACJoN,EAAQ,KAAKpN,CAAI,GACV;AAAA,EAEb;AAAA,EACE;AAAA,IACE,KAAK;AAAA,IACL,KAAK,CAACA,OACJoN,EAAQ,WAAWpN,CAAI,GAChB;AAAA,EAEb;AAAA,EACE;AAAA,IACE,KAAK;AAAA,IACL,KAAK,CAACA,OACJoN,EAAQ,UAAUpN,CAAI,GACf;AAAA,EAEb;AACA,CAAC,GCvDKsO,KAAyBpI,EAAW,KAAK,EAAE,OAAO,kBAAiB,CAAE,GAE9DqI,KAAyBhI,EAAW;AAAA,EAC/C,MAAM;AAAA,IACJ,YAAYvG,GAAM;AAChB,WAAK,cAAc,KAAK,iBAAiBA,CAAI;AAAA,IAC/C;AAAA,IAEA,OAAOwG,GAAQ;AACb,OAAIA,EAAO,cAAcA,EAAO,gBAAgBA,EAAO,kBACrD,KAAK,cAAc,KAAK,iBAAiBA,EAAO,IAAI;AAAA,IAExD;AAAA,IAEA,iBAAiBxG,GAAM;AAErB,UAAI,CAACA,EAAK;AACR,eAAOkG,EAAW;AAGpB,YAAMF,IAAc,CAAA,GACdwI,IAAgB,oBAAI,IAAG,GACvBtX,IAAQ8I,EAAK;AAEnB,iBAAWgC,KAAS9K,EAAM,UAAU,QAAQ;AAC1C,cAAM+K,IAAY/K,EAAM,IAAI,OAAO8K,EAAM,IAAI,EAAE,QACzCE,IAAUhL,EAAM,IAAI,OAAO8K,EAAM,EAAE,EAAE;AAC3C,iBAASjM,IAAIkM,GAAWlM,KAAKmM,GAASnM;AACpC,UAAAyY,EAAc,IAAIzY,CAAC;AAAA,MAEvB;AAEA,iBAAWsJ,KAAWmP,GAAe;AACnC,cAAMtV,IAAOhC,EAAM,IAAI,KAAKmI,CAAO;AACnC,QAAA2G,EAAY,KAAKsI,GAAuB,MAAMpV,EAAK,IAAI,CAAC;AAAA,MAC1D;AAEA,aAAOgN,EAAW,IAAIF,GAAa,EAAI;AAAA,IACzC;AAAA,EACJ;AAAA,EACE;AAAA,IACE,aAAa,CAACU,MAAMA,EAAE;AAAA,EAC1B;AACA,GCxCa+H,KAAmBlI,EAAW;AAAA,EACzC,MAAM;AAAA,IACJ,YAAYvG,GAAM;AAChB,WAAK,OAAOA;AAAA,IACd;AAAA,IAEA,OAAOwG,GAAQ;AACb,MAAI,CAACA,EAAO,gBAAgB,CAACA,EAAO,cAAc,CAACA,EAAO,mBAI1D,KAAK,KAAK,eAAe;AAAA,QACvB,KAAK;AAAA,QACL,MAAM,CAACxG,MAAS;AACd,gBAAM0O,IAAO1O,EAAK,MAAM,UAAU,KAAK,MACjC2O,IAAS3O,EAAK,YAAY0O,CAAI;AACpC,cAAI,CAACC,EAAQ,QAAO;AAEpB,gBAAM5N,IAAOf,EAAK,UAAU,sBAAqB,GAC3C4O,IAAiB7N,EAAK,MAAMA,EAAK,SAAS,GAC1C8N,IAAOF,EAAO,MAAMC;AAE1B,iBAAI,KAAK,IAAIC,CAAI,IAAI,IAAU,OACxBA;AAAA,QACT;AAAA,QACA,OAAO,CAACA,GAAM7O,MAAS;AACrB,UAAI6O,KAAQ,QACZ7O,EAAK,UAAU,SAAS,EAAE,KAAK6O,GAAM,UAAU,QAAQ;AAAA,QACzD;AAAA,MACR,CAAO;AAAA,IACH;AAAA,EACJ;AACA,GCrCMC,KAAgB5I,EAAW,KAAK,EAAE,OAAO,oBAAmB,CAAE;AAMpE,SAAS6I,GAAmBtO,GAAKhK,GAAK;AACpC,QAAMyC,IAAOuH,EAAI,OAAOhK,CAAG;AAC3B,MAAI+F,IAAOtD,EAAK,QACZuD,IAAKvD,EAAK;AAGd,SAAOsD,IAAO,KACCiE,EAAI,KAAKjE,IAAO,CAAC,EACrB,KAAK,KAAI,MAAO;AACzB,IAAAA;AAIF,SAAOC,IAAKgE,EAAI,SACDA,EAAI,KAAKhE,IAAK,CAAC,EACnB,KAAK,KAAI,MAAO;AACzB,IAAAA;AAGF,SAAO,EAAE,MAAAD,GAAM,IAAAC,EAAE;AACnB;AAOA,SAASuS,GAAkBvO,GAAKhK,GAAK;AACnC,QAAMwY,IAAWxO,EAAI,SAAQ;AAG7B,MAAIyO,IAAgB;AACpB,WAASnZ,IAAIU,IAAM,GAAGV,KAAK,GAAGA,KAAK;AACjC,UAAMoZ,IAAKF,EAASlZ,CAAC;AAErB,SAAKoZ,MAAO,OAAOA,MAAO,OAAOA,MAAO,QAAQpZ,IAAI,IAAIkZ,EAAS,UAAU,KAAK,KAAKA,EAASlZ,IAAI,CAAC,CAAC,GAAG;AAGrG,WAFAmZ,IAAgBnZ,IAAI,GAEbmZ,IAAgBzY,KAAO,KAAK,KAAKwY,EAASC,CAAa,CAAC,IAAG,CAAAA;AAClE;AAAA,IACF;AAEA,QAAIC,MAAO;AAAA,KAAQpZ,IAAI,KAAKkZ,EAASlZ,IAAI,CAAC,MAAM;AAAA,GAAM;AACpD,MAAAmZ,IAAgBnZ,IAAI;AACpB;AAAA,IACF;AAAA,EACF;AAGA,MAAIqZ,IAAcH,EAAS;AAC3B,WAASlZ,IAAIU,GAAKV,IAAIkZ,EAAS,QAAQlZ,KAAK;AAC1C,UAAMoZ,IAAKF,EAASlZ,CAAC;AACrB,SAAKoZ,MAAO,OAAOA,MAAO,OAAOA,MAAO,SAASpZ,IAAI,KAAKkZ,EAAS,UAAU,KAAK,KAAKA,EAASlZ,IAAI,CAAC,CAAC,IAAI;AACxG,MAAAqZ,IAAcrZ,IAAI;AAClB;AAAA,IACF;AAEA,QAAIoZ,MAAO;AAAA,KAAQpZ,IAAI,IAAIkZ,EAAS,UAAUA,EAASlZ,IAAI,CAAC,MAAM;AAAA,GAAM;AACtE,MAAAqZ,IAAcrZ;AACd;AAAA,IACF;AAAA,EACF;AAGA,QAAMsZ,IAAW5O,EAAI,OAAO,KAAK,IAAI,GAAGyO,CAAa,CAAC,EAAE,QAClDI,IAAS7O,EAAI,OAAO,KAAK,IAAIwO,EAAS,QAAQ,KAAK,IAAIC,GAAeE,IAAc,CAAC,CAAC,CAAC,EAAE;AAE/F,SAAO,EAAE,MAAMC,GAAU,IAAIC,EAAM;AACrC;AAQO,SAASC,GAAsBnV,IAAQ,aAAaoV,IAAY,IAAI;AACzE,SAAOjJ,EAAW;AAAA,IAChB,MAAM;AAAA,MACJ,YAAYvG,GAAM;AAChB,aAAK,aAAaA,GAAMwP,CAAS,GACjC,KAAK,cAAc,KAAK,iBAAiBxP,CAAI;AAAA,MAC/C;AAAA,MAEA,OAAOwG,GAAQ;AACb,SACEA,EAAO,gBACPA,EAAO,cACPA,EAAO,kBAEP,KAAK,cAAc,KAAK,iBAAiBA,EAAO,IAAI;AAAA,MAExD;AAAA,MAEA,aAAaxG,GAAMlL,GAAO;AAExB,cAAM2a,IAAU,KAAK,IAAI,GAAG,KAAK,IAAI,GAAG,IAAI3a,IAAQ,GAAG,CAAC;AACxD,QAAAkL,EAAK,IAAI,MAAM,YAAY,0BAA0B,OAAOyP,CAAO,CAAC;AAAA,MACtE;AAAA,MAEA,iBAAiBzP,GAAM;AACrB,YAAI,CAACA,EAAK;AACR,iBAAO0P,GAAS;AAGlB,cAAMjP,IAAMT,EAAK,MAAM,KACjB2P,IAAc,oBAAI,IAAG;AAE3B,mBAAW3N,KAAShC,EAAK,MAAM,UAAU,QAAQ;AAC/C,cAAI3D;AACJ,cAAIjC,MAAU,QAAQ;AACpB,kBAAMlB,IAAOuH,EAAI,OAAOuB,EAAM,IAAI;AAClC,YAAA3F,IAAS,EAAE,MAAMnD,EAAK,QAAQ,IAAIA,EAAK,OAAM;AAAA,UAC/C,MAAO,CAAIkB,MAAU,aACnBiC,IAAS2S,GAAkBvO,GAAKuB,EAAM,IAAI,IAE1C3F,IAAS0S,GAAmBtO,GAAKuB,EAAM,IAAI;AAE7C,mBAASjM,IAAIsG,EAAO,MAAMtG,KAAKsG,EAAO,IAAItG;AACxC,YAAA4Z,EAAY,IAAI5Z,CAAC;AAAA,QAErB;AAEA,cAAMiQ,IAAc,CAAA;AACpB,iBAASjQ,IAAI,GAAGA,KAAK0K,EAAI,OAAO1K;AAC9B,cAAI,CAAC4Z,EAAY,IAAI5Z,CAAC,GAAG;AACvB,kBAAMmD,IAAOuH,EAAI,KAAK1K,CAAC;AACvB,YAAAiQ,EAAY,KAAK8I,GAAc,MAAM5V,EAAK,IAAI,CAAC;AAAA,UACjD;AAGF,eAAOwW,GAAS,GAAG1J,CAAW;AAAA,MAChC;AAAA,MAEA,UAAU;AAAA,MAEV;AAAA,IACN;AAAA,IACI;AAAA,MACE,aAAa,CAACU,MAAMA,EAAE;AAAA,IAC5B;AAAA,EACA;AACA;AAQY,MAACkJ,KAAkBL,GAAsB,aAAa,EAAE;AChJpE,SAASM,GAAapP,GAAKiN,GAAW;AACpC,QAAMjY,IAAOgL,EAAI,SAAQ,GACnBqP,IAAQra,EAAK,MAAM,KAAK,EAAE,OAAO,CAAAsa,MAAKA,EAAE,SAAS,CAAC,EAAE,QACpDC,IAAQva,EAAK,QACbwa,IAAgBxa,EAAK,QAAQ,OAAO,EAAE,EAAE,QACxCya,IAAc,KAAK,IAAI,GAAG,KAAK,KAAKJ,IAAQ,GAAG,CAAC;AAEtD,MAAIK,IAAW,GACXC,IAAW;AACf,QAAMC,IAAe3C,KAAa,CAACA,EAAU,KAAK;AAElD,MAAI2C,GAAc;AAChB,UAAMC,IAAU7P,EAAI,YAAYiN,EAAU,KAAK,MAAMA,EAAU,KAAK,EAAE;AACtE,IAAAyC,IAAWG,EAAQ,MAAM,KAAK,EAAE,OAAO,CAAAP,MAAKA,EAAE,SAAS,CAAC,EAAE,QAC1DK,IAAWE,EAAQ;AAAA,EACrB;AAEA,SAAO,EAAE,OAAAR,GAAO,OAAAE,GAAO,eAAAC,GAAe,aAAAC,GAAa,UAAAC,GAAU,UAAAC,GAAU,cAAAC,EAAY;AACrF;AAKA,SAASE,GAAkBC,GAAS;AAClC,SAAIA,IAAU,IAAU,iBACpBA,MAAY,IAAU,eACnB,GAAGA,CAAO;AACnB;AAKA,SAASC,GAAWhZ,GAAO3C,GAAO;AAChC,QAAM4b,IAAO,SAAS,cAAc,MAAM;AAC1C,EAAAA,EAAK,YAAY;AAEjB,QAAMC,IAAU,SAAS,cAAc,MAAM;AAC7C,EAAAA,EAAQ,YAAY,uBACpBA,EAAQ,cAAc7b;AAEtB,QAAM8b,IAAU,SAAS,cAAc,MAAM;AAC7C,SAAAA,EAAQ,YAAY,uBACpBA,EAAQ,cAAc,IAAInZ,CAAK,IAE/BiZ,EAAK,YAAYC,CAAO,GACxBD,EAAK,YAAYE,CAAO,GACjBF;AACT;AAKA,SAASG,KAAgB;AACvB,QAAMC,IAAM,SAAS,cAAc,MAAM;AACzC,SAAAA,EAAI,YAAY,yBACTA;AACT;AAKA,SAASC,GAAsB/Q,GAAM;AACnC,QAAMgR,IAAM,SAAS,cAAc,KAAK;AACxC,EAAAA,EAAI,YAAY;AAEhB,WAASC,EAAO/Z,GAAO;AACrB,UAAMga,IAAQrB,GAAa3Y,EAAM,KAAKA,EAAM,SAAS;AASrD,QARA8Z,EAAI,cAAc,IAElBA,EAAI,YAAYP,GAAW,SAASS,EAAM,MAAM,eAAc,CAAE,CAAC,GACjEF,EAAI,YAAYH,IAAe,GAC/BG,EAAI,YAAYP,GAAW,cAAcS,EAAM,MAAM,eAAc,CAAE,CAAC,GACtEF,EAAI,YAAYH,IAAe,GAC/BG,EAAI,YAAYP,GAAW,IAAIF,GAAkBW,EAAM,WAAW,CAAC,CAAC,GAEhEA,EAAM,cAAc;AACtB,MAAAF,EAAI,YAAYH,IAAe;AAE/B,YAAMM,IAAU,SAAS,cAAc,MAAM;AAC7C,MAAAA,EAAQ,YAAY;AAEpB,YAAMC,IAAW,SAAS,cAAc,MAAM;AAC9C,MAAAA,EAAS,YAAY,uBACrBA,EAAS,cAAc,GAAGF,EAAM,QAAQ,WAAWA,EAAM,QAAQ;AAEjE,YAAMG,IAAW,SAAS,cAAc,MAAM;AAC9C,MAAAA,EAAS,YAAY,uBACrBA,EAAS,cAAc,aAEvBF,EAAQ,YAAYC,CAAQ,GAC5BD,EAAQ,YAAYE,CAAQ,GAC5BL,EAAI,YAAYG,CAAO;AAAA,IACzB;AAAA,EACF;AAEA,SAAAF,EAAOjR,EAAK,KAAK,GAEV;AAAA,IACL,KAAAgR;AAAA,IACA,KAAK;AAAA,IACL,OAAOxK,GAAQ;AACb,OAAIA,EAAO,cAAcA,EAAO,iBAC9ByK,EAAOzK,EAAO,KAAK;AAAA,IAEvB;AAAA,EACJ;AACA;AAMY,MAAC8K,KAAiBC,GAAU,GAAGR,EAAqB,GC3H1DS,KAAiB;AAAA,EACrB,EAAE,MAAM,KAAK,OAAO,QAAQ,QAAQ,OAAM;AAAA,EAC1C,EAAE,MAAM,KAAK,OAAO,QAAQ,QAAQ,OAAM;AAAA,EAC1C,EAAE,MAAM,KAAK,OAAO,QAAQ,QAAQ,OAAM;AAAA,EAC1C,EAAE,MAAM,KAAK,OAAO,UAAU,QAAQ,SAAQ;AAAA,EAC9C,EAAE,MAAM,KAAK,OAAO,iBAAiB,QAAQ,gBAAe;AAAA,EAC5D,EAAE,MAAM,MAAW,OAAO,aAAa,QAAQ,KAAI;AAAA,EACnD,EAAE,MAAM,MAAW,OAAO,aAAa,QAAQ,KAAI;AAAA,EACnD,EAAE,MAAM,MAAW,OAAO,aAAa,QAAQ,KAAI;AAAA,EACnD,EAAE,MAAM,MAAa,OAAO,QAAQ,QAAQ,OAAM;AAAA,EAClD,EAAE,MAAM,MAAa,OAAO,SAAS,QAAQ,QAAO;AAAA,EACpD,EAAE,MAAM,KAAU,OAAO,eAAe,QAAQ,aAAY;AAAA,EAC5D,EAAE,MAAM,MAAM,OAAO,iBAAiB,QAAQ,eAAc;AAAA,EAC5D,EAAE,MAAM,KAAU,OAAO,aAAa,QAAQ,WAAU;AAAA,EACxD,EAAE,MAAM,OAAO,OAAO,eAAe,QAAQ,aAAY;AAAA,EACzD,EAAE,MAAM,OAAO,OAAO,cAAc,QAAQ,YAAW;AAAA,EACvD,EAAE,MAAM,KAAU,OAAO,mBAAmB,QAAQ,KAAI;AAAA,EACxD,EAAE,MAAM,KAAU,OAAO,cAAc,QAAQ,QAAO;AAAA,EACtD,EAAE,MAAM,KAAU,OAAO,SAAS,QAAQ,QAAO;AACnD,GAEMC,KAAmBC,EAAW,UAAU;AAAA,EAC5C,sBAAsB;AAAA,IACpB,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,KAAK;AAAA,IACL,SAAS;AAAA,IACT,eAAe;AAAA,IACf,WAAW;AAAA,IACX,yBAAyB;AAAA,IACzB,gBAAgB;AAAA,IAChB,YAAY;AAAA,IACZ,WAAW;AAAA,IACX,YAAY;AAAA,IACZ,YAAY;AAAA,IACZ,qBAAqB;AAAA,IACrB,aAAa;AAAA,EACjB;AAAA,EACE,yCAAyC;AAAA,IACvC,SAAS;AAAA,EACb;AAAA,EACE,0BAA0B;AAAA,IACxB,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ,cAAc;AAAA,IACd,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,OAAO;AAAA,IACP,YAAY;AAAA,IACZ,SAAS;AAAA,IACT,YAAY;AAAA,EAChB;AAAA,EACE,gCAAgC;AAAA,IAC9B,YAAY;AAAA,EAChB;AAAA,EACE,iCAAiC;AAAA,IAC/B,YAAY;AAAA,EAChB;AAAA,EACE,mCAAmC;AAAA,IACjC,SAAS;AAAA,IACT,QAAQ;AAAA,EACZ;AAAA;AAAA,EAEE,4BAA4B;AAAA,IAC1B,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,OAAO;AAAA,EACX;AAAA,EACE,sCAAsC;AAAA,IACpC,YAAY;AAAA,EAChB;AAAA,EACE,uCAAuC;AAAA,IACrC,YAAY;AAAA,EAChB;AACA,CAAC;AAWM,SAASC,GAAcnZ,IAAU,IAAI;AAC1C,QAAMoZ,IAAUpZ,EAAQ,WAAWgZ,IAC7BK,IAAerZ,EAAQ,gBAAgB,CAAA;AAgF7C,SAAO,CA9EgB+Y,GAAU,GAAG,CAACvR,MAAS;AAC5C,UAAMgR,IAAM,SAAS,cAAc,KAAK;AACxC,IAAAA,EAAI,YAAY;AAEhB,UAAMc,IAAkB,oBAAI,IAAG;AAE/B,eAAWC,KAAOH,GAAS;AACzB,YAAMI,IAAK,SAAS,cAAc,QAAQ;AAC1C,MAAAA,EAAG,YAAY,yBACfA,EAAG,cAAcD,EAAI,MACrBC,EAAG,QAAQD,EAAI,OAEXA,EAAI,WACND,EAAgB,IAAIC,EAAI,QAAQC,CAAE,GAClCA,EAAG,iBAAiB,SAAS,CAAC3R,MAAM;AAClC,QAAAA,EAAE,eAAc,GACZ+M,EAAQ2E,EAAI,MAAM,MACpB3E,EAAQ2E,EAAI,MAAM,EAAE/R,CAAI,GACxBA,EAAK,MAAK;AAAA,MAEd,CAAC,IAGHgR,EAAI,YAAYgB,CAAE;AAAA,IACpB;AAGA,eAAWD,KAAOF,GAAc;AAC9B,YAAMG,IAAK,SAAS,cAAc,QAAQ;AAC1C,MAAAA,EAAG,YAAY,yBACfA,EAAG,cAAcD,EAAI,MACrBC,EAAG,QAAQD,EAAI,OACfC,EAAG,iBAAiB,SAAS,CAAC3R,MAAM;AAClC,QAAAA,EAAE,eAAc,GACZ0R,EAAI,WACNA,EAAI,QAAQ/R,CAAI,GAElBA,EAAK,MAAK;AAAA,MACZ,CAAC,GACDgR,EAAI,YAAYgB,CAAE;AAAA,IACpB;AAGA,QAAIC,IAAc;AAClB,IAAAjB,EAAI,iBAAiB,cAAc,CAAC3Q,MAAM;AACxC,MAAA4R,IAAc5R,EAAE,QAAQ,CAAC,EAAE;AAAA,IAC7B,GAAG,EAAE,SAAS,IAAM,GACpB2Q,EAAI,iBAAiB,aAAa,CAAC3Q,MAAM;AACvC,YAAM6R,IAAK7R,EAAE,QAAQ,CAAC,EAAE,UAAU4R,GAC5BE,IAASnB,EAAI,cAAc,GAC3BoB,IAAUpB,EAAI,aAAaA,EAAI,eAAeA,EAAI,cAAc;AACtE,OAAKmB,KAAUD,IAAK,KAAOE,KAAWF,IAAK,MACzC7R,EAAE,eAAc;AAAA,IAEpB,GAAG,EAAE,SAAS,IAAO;AAErB,UAAMgS,IAAuB,CAACnb,MAAU;AACtC,YAAMob,IAAUR,EAAgB,IAAI,MAAM;AAC1C,MAAIQ,MACFA,EAAQ,WAAWC,GAAUrb,CAAK,MAAM;AAE1C,YAAMsb,IAAUV,EAAgB,IAAI,MAAM;AAC1C,MAAIU,MACFA,EAAQ,WAAWC,GAAUvb,CAAK,MAAM;AAAA,IAE5C;AAEA,WAAAmb,EAAqBrS,EAAK,KAAK,GAExB;AAAA,MACL,KAAAgR;AAAA,MACA,KAAK;AAAA,MACL,OAAOxK,GAAQ;AACb,QAAA6L,EAAqB7L,EAAO,KAAK;AAAA,MACnC;AAAA,IACN;AAAA,EACE,CAAC,GAEuBiL,EAAgB;AAC1C;ACrKO,MAAMiB,KAAiB9V,EAAM,OAAO;AAAA,EACzC,QAAQC,GAAQ;AACd,WAAIA,EAAO,WAAW,IACb,EAAE,UAAU,MAAM,sBAAsB,MAAM,iBAAiB,KAAI,IAErEA,EAAOA,EAAO,SAAS,CAAC;AAAA,EACjC;AACF,CAAC;AAKD,SAAS8V,GAAwBlS,GAAK;AAGpC,MAFIA,EAAI,QAAQ,KACEA,EAAI,KAAK,CAAC,EAAE,KAAK,KAAI,MACrB,MAAO,QAAO;AAEhC,WAAS1K,IAAI,GAAGA,KAAK0K,EAAI,OAAO1K,KAAK;AACnC,UAAMN,IAAOgL,EAAI,KAAK1K,CAAC,EAAE,KAAK,KAAI;AAClC,QAAIN,MAAS,SAASA,MAAS,OAAO;AAEpC,eAASuN,IAAI,GAAGA,IAAIjN,GAAGiN,KAAK;AAE1B,cAAMnL,IADO4I,EAAI,KAAKuC,CAAC,EAAE,KACN,MAAM,iBAAiB;AAC1C,YAAInL,GAAO;AACT,cAAIxC,IAAQwC,EAAM,CAAC,EAAE,KAAI;AAEzB,kBAAKxC,EAAM,WAAW,GAAG,KAAKA,EAAM,SAAS,GAAG,KAC3CA,EAAM,WAAW,GAAG,KAAKA,EAAM,SAAS,GAAG,OAC9CA,IAAQA,EAAM,MAAM,GAAG,EAAE,IAEpBA;AAAA,QACT;AAAA,MACF;AACA,aAAO;AAAA,IACT;AAAA,EACF;AAEA,SAAO;AACT;AAKA,SAASud,GAAgB5B,GAAK6B,GAAWC,GAAiB;AACxD,EAAA9B,EAAI,cAAc;AAElB,QAAMvZ,IAAQ,SAAS,cAAc,MAAM;AAK3C,MAJAA,EAAM,YAAY,sBAClBA,EAAM,cAAc,aACpBuZ,EAAI,YAAYvZ,CAAK,GAEjB,CAACob,KAAaA,EAAU,WAAW,GAAG;AACxC,UAAME,IAAQ,SAAS,cAAc,MAAM;AAC3C,IAAAA,EAAM,YAAY,sBAClBA,EAAM,cAAc,QACpB/B,EAAI,YAAY+B,CAAK;AACrB;AAAA,EACF;AAEA,QAAMC,IAAO,SAAS,cAAc,MAAM;AAC1C,EAAAA,EAAK,YAAY;AAEjB,aAAWC,KAAYJ,GAAW;AAChC,UAAMK,IAAO,SAAS,cAAc,MAAM;AAC1C,IAAAA,EAAK,YAAY,qBACjBA,EAAK,cAAcD,EAAS,OACxBA,EAAS,YACXC,EAAK,QAAQD,EAAS,UAExBC,EAAK,iBAAiB,aAAa,CAAC7S,MAAM;AACxC,MAAAA,EAAE,eAAc,GACZyS,KACFA,EAAgBG,CAAQ;AAAA,IAE5B,CAAC,GACDD,EAAK,YAAYE,CAAI;AAAA,EACvB;AAEA,EAAAlC,EAAI,YAAYgC,CAAI;AACtB;AAKA,SAASG,GAAsBnT,GAAM;AACnC,QAAMgR,IAAM,SAAS,cAAc,KAAK;AACxC,EAAAA,EAAI,YAAY,sBAEDhR,EAAK,MAAM,MAAM0S,EAAc;AAC9C,MAAIU,IAAY,MACZC,IAAiB;AAErB,WAASC,EAAapc,GAAO;AAC3B,UAAMiH,IAASjH,EAAM,MAAMwb,EAAc;AACzC,WAAIvU,EAAO,WAAiBA,EAAO,WAC5BwU,GAAwBzb,EAAM,GAAG;AAAA,EAC1C;AAEA,iBAAeqc,EAAerc,GAAO;AACnC,UAAMiH,IAASjH,EAAM,MAAMwb,EAAc;AACzC,QAAI,CAACvU,EAAO,sBAAsB;AAChC,MAAA6S,EAAI,cAAc;AAClB;AAAA,IACF;AAEA,UAAM3b,IAAQie,EAAapc,CAAK;AAChC,QAAI7B,MAAU+d,EAAW;AAGzB,QAFAA,IAAY/d,GAER,CAACA,GAAO;AACV,MAAAud,GAAgB5B,GAAK,IAAI7S,EAAO,eAAe;AAC/C;AAAA,IACF;AAGA,IAAA6S,EAAI,cAAc;AAClB,UAAMwC,IAAe,SAAS,cAAc,MAAM;AAClD,IAAAA,EAAa,YAAY,sBACzBA,EAAa,cAAc,aAC3BxC,EAAI,YAAYwC,CAAY;AAC5B,UAAMC,IAAU,SAAS,cAAc,MAAM;AAC7C,IAAAA,EAAQ,YAAY,sBACpBA,EAAQ,cAAc,YACtBzC,EAAI,YAAYyC,CAAO;AAEvB,UAAMC,IAAY,EAAEL;AAEpB,QAAI;AACF,YAAMR,IAAY,MAAM1U,EAAO,qBAAqB9I,CAAK;AAEzD,MAAIqe,MAAcL,KAChBT,GAAgB5B,GAAK6B,GAAW1U,EAAO,eAAe;AAAA,IAE1D,QAAQ;AACN,MAAIuV,MAAcL,KAChBT,GAAgB5B,GAAK,IAAI7S,EAAO,eAAe;AAAA,IAEnD;AAAA,EACF;AAGA,SAAAoV,EAAevT,EAAK,KAAK,GAElB;AAAA,IACL,KAAAgR;AAAA,IACA,KAAK;AAAA,IACL,OAAOxK,GAAQ;AACb,MAAIA,EAAO,cACT+M,EAAe/M,EAAO,KAAK;AAAA,IAE/B;AAAA,EACJ;AACA;AAQY,MAACmN,KAAiBpC,GAAU,GAAG4B,EAAqB,GCxJnDS,KAAuBhX,EAAM,OAAO;AAAA,EAC/C,QAAQC,GAAQ;AACd,WAAIA,EAAO,WAAW,IAAU,CAAA,IACzBA,EAAOA,EAAO,SAAS,CAAC;AAAA,EACjC;AACF,CAAC,GAEYgX,KAAyBtN,EAAW;AAAA,EAC/C,MAAM;AAAA,IACJ,YAAYvG,GAAM;AAChB,WAAK,OAAOA,GACZ,KAAK,WAAW,MAChB,KAAK,QAAQ,MACb,KAAK,aAAa,MAClB,KAAK,SAASA,EAAK,MAAM,MAAMmJ,CAAqB,GAChD,KAAK,UAAQ,KAAK,KAAI;AAAA,IAC5B;AAAA,IAEA,OAAO3C,GAAQ;AACb,YAAMsN,IAAU,KAAK;AACrB,WAAK,SAAStN,EAAO,MAAM,MAAM2C,CAAqB,GAElD,CAAC2K,KAAW,KAAK,SACnB,KAAK,KAAI,IACAA,KAAW,CAAC,KAAK,SAC1B,KAAK,MAAK,IACD,KAAK,UAAUtN,EAAO,cAC/B,KAAK,eAAc;AAAA,IAEvB;AAAA,IAEA,OAAO;AACL,YAAMxG,IAAO,KAAK;AAGlB,WAAK,WAAW,SAAS,cAAc,KAAK,GAC5C,KAAK,SAAS,YAAY,iCAC1B,KAAK,SAAS,iBAAiB,aAAa,CAACK,MAAM;AACjD,QAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjBL,EAAK,SAAS,EAAE,SAASkJ,EAAkB,GAAG,EAAK,GAAG;AAAA,MACxD,CAAC,GAGD,KAAK,QAAQ,SAAS,cAAc,KAAK,GACzC,KAAK,MAAM,YAAY;AAGvB,YAAM6K,IAAS,SAAS,cAAc,KAAK;AAC3C,MAAAA,EAAO,YAAY;AACnB,YAAM1e,IAAQ,SAAS,cAAc,MAAM;AAC3C,MAAAA,EAAM,YAAY,8BAClBA,EAAM,cAAc,cACpB0e,EAAO,YAAY1e,CAAK;AAExB,YAAM2e,IAAW,SAAS,cAAc,QAAQ;AAChD,MAAAA,EAAS,YAAY,8BACrBA,EAAS,cAAc,KACvBA,EAAS,QAAQ,SACjBA,EAAS,iBAAiB,aAAa,CAAC3T,MAAM;AAC5C,QAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe;AAAA,MACnB,CAAC,GACD2T,EAAS,iBAAiB,SAAS,CAAC3T,MAAM;AACxC,QAAAA,EAAE,gBAAe,GACjBL,EAAK,SAAS,EAAE,SAASkJ,EAAkB,GAAG,EAAK,GAAG;AAAA,MACxD,CAAC,GACD6K,EAAO,YAAYC,CAAQ,GAE3B,KAAK,MAAM,YAAYD,CAAM,GAG7B,KAAK,YAAY,SAAS,cAAc,KAAK,GAC7C,KAAK,UAAU,YAAY,gCAC3B,KAAK,MAAM,YAAY,KAAK,SAAS,GAErC,KAAK,aAAY,GAGjB/T,EAAK,IAAI,YAAY,KAAK,QAAQ,GAClCA,EAAK,IAAI,YAAY,KAAK,KAAK,GAG/BA,EAAK,UAAU,MAAM,WAAW,UAGhC,KAAK,aAAa,CAACK,MAAM;AACvB,QAAIA,EAAE,QAAQ,aACZA,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjBL,EAAK,SAAS,EAAE,SAASkJ,EAAkB,GAAG,EAAK,GAAG;AAAA,MAE1D,GACAlJ,EAAK,IAAI,iBAAiB,WAAW,KAAK,YAAY,EAAI,GAG1D,sBAAsB,MAAM;AAC1B,QAAI,KAAK,YAAU,KAAK,SAAS,UAAU,IAAI,uCAAuC,GAClF,KAAK,SAAO,KAAK,MAAM,UAAU,IAAI,2BAA2B;AAAA,MACtE,CAAC;AAAA,IACH;AAAA,IAEA,QAAQ;AACN,YAAMA,IAAO,KAAK;AAGlB,MAAAA,EAAK,UAAU,MAAM,WAAW,IAG5B,KAAK,eACPA,EAAK,IAAI,oBAAoB,WAAW,KAAK,YAAY,EAAI,GAC7D,KAAK,aAAa,OAIhB,KAAK,SAAO,KAAK,MAAM,UAAU,OAAO,2BAA2B,GACnE,KAAK,YAAU,KAAK,SAAS,UAAU,OAAO,uCAAuC;AAGzF,YAAMiU,IAAQ,KAAK,OACbC,IAAW,KAAK;AACtB,iBAAW,MAAM;AACf,QAAAD,KAAA,QAAAA,EAAO,UACPC,KAAA,QAAAA,EAAU;AAAA,MACZ,GAAG,GAAG,GAEN,KAAK,QAAQ,MACb,KAAK,WAAW,MAChB,KAAK,YAAY;AAAA,IACnB;AAAA,IAEA,eAAe;AACb,UAAI,CAAC,KAAK,UAAW;AACrB,WAAK,UAAU,YAAY;AAE3B,YAAMhd,IAAQ,KAAK,KAAK,OAClB4O,IAAc5O,EAAM,MAAM6M,CAAgB,GAC1C,EAAE,aAAAE,EAAW,IAAK6B;AAExB,UAAI,CAAC7B,GAAa;AAEhB,cAAM8O,IAAQ,SAAS,cAAc,KAAK;AAC1C,QAAAA,EAAM,YAAY,8BAClBA,EAAM,cAAc,oCACpB,KAAK,UAAU,YAAYA,CAAK;AAEhC,cAAMoB,IAAS,SAAS,cAAc,QAAQ;AAC9C,QAAAA,EAAO,YAAY,gCACnBA,EAAO,cAAc,mBACrBA,EAAO,iBAAiB,SAAS,CAAC9T,MAAM;AACtC,UAAAA,EAAE,gBAAe,GACjB,KAAK,KAAK,SAAS;AAAA,YACjB,SAAS,EAAE,MAAM,GAAG,IAAI,GAAG,QAAQ;AAAA;AAAA,EAAY;AAAA,YAC/C,aAAa9L,EAAkB,GAAG,EAAI;AAAA,UAClD,CAAW;AAAA,QACH,CAAC,GACD,KAAK,UAAU,YAAY4f,CAAM;AACjC;AAAA,MACF;AAGA,YAAMxS,IAAasC,EAAY,MAAMA,EAAY,QAAQ,GACnDyG,IAAc/I,IAChBzK,EAAM,IAAI,KAAK+M,EAAY,QAAQ,CAAC,EAAE,OACtC/M,EAAM,IAAI,KAAK+M,EAAY,KAAK,EAAE,KAAK,GACrC0G,IAAYhJ,IACdzK,EAAM,IAAI,KAAK+M,EAAY,MAAM,CAAC,EAAE,KACpCyG,GAEE0J,IAAY,CAAA;AAClB,eAASpR,IAAIiB,EAAY,QAAQ,GAAGjB,IAAIiB,EAAY,KAAKjB;AACvD,QAAAoR,EAAU,KAAKld,EAAM,IAAI,KAAK8L,CAAC,EAAE,IAAI;AAEvC,YAAMyH,IAAc2J,EAAU,KAAK;AAAA,CAAI,GACjCxJ,IAAY1T,EAAM,IAAI,KAAK+M,EAAY,KAAK,EAAE,MAE9C4G,IAAY,KAAK,KAAK,MAAM,MAAM+I,EAAoB,GACtD,EAAE,KAAA5C,EAAG,IAAKxG;AAAA,QACdC;AAAA,QAAaC;AAAA,QAAaC;AAAA,QAAWC;AAAA,QAAW,KAAK;AAAA,QACrD,EAAE,WAAAC,EAAS;AAAA,MACnB;AACM,WAAK,UAAU,YAAYmG,CAAG;AAAA,IAChC;AAAA,IAEA,iBAAiB;AACf,WAAK,aAAY;AAAA,IACnB;AAAA,IAEA,UAAU;;AACR,MAAI,KAAK,WACH,KAAK,cACP,KAAK,KAAK,IAAI,oBAAoB,WAAW,KAAK,YAAY,EAAI,IAEpEqD,IAAA,KAAK,UAAL,QAAAA,EAAY,WACZC,IAAA,KAAK,aAAL,QAAAA,EAAe,UACf,KAAK,KAAK,UAAU,MAAM,WAAW;AAAA,IAEzC;AAAA,EACJ;AACA,GC3MMC,KAAQ,OAAO,YAAc,OAAe,MAAM,KAAK,UAAU,QAAQ,GACzEC,KAASD,KAAQ,MAAW,SAErBE,KAAyBlO,EAAW;AAAA,EAC/C,MAAM;AAAA,IACJ,YAAYvG,GAAM;AAChB,WAAK,OAAOA,GACZ,KAAK,WAAW,MAChB,KAAK,QAAQ,MACb,KAAK,aAAa,MAClB,KAAK,SAASA,EAAK,MAAM,MAAMmO,CAAgB,EAAE,kBAC7C,KAAK,UAAQ,KAAK,KAAI;AAAA,IAC5B;AAAA,IAEA,OAAO3H,GAAQ;AACb,YAAMsN,IAAU,KAAK,QACf5c,IAAQsP,EAAO,MAAM,MAAM2H,CAAgB;AACjD,WAAK,SAASjX,EAAM,kBAEhB,CAAC4c,KAAW,KAAK,SACnB,KAAK,KAAI,IACAA,KAAW,CAAC,KAAK,SAC1B,KAAK,MAAK,IACD,KAAK,UAEd,KAAK,eAAc;AAAA,IAEvB;AAAA,IAEA,OAAO;AACL,YAAM9T,IAAO,KAAK;AAGlB,WAAK,WAAW,SAAS,cAAc,KAAK,GAC5C,KAAK,SAAS,YAAY,kCAC1B,KAAK,SAAS,iBAAiB,aAAa,CAACK,MAAM;AACjD,QAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjBL,EAAK,SAAS,EAAE,SAAS8N,EAA0B,GAAG,EAAK,GAAG;AAAA,MAChE,CAAC,GAGD,KAAK,QAAQ,SAAS,cAAc,KAAK,GACzC,KAAK,MAAM,YAAY;AAGvB,YAAMiG,IAAS,SAAS,cAAc,KAAK;AAC3C,MAAAA,EAAO,YAAY;AAEnB,YAAM1e,IAAQ,SAAS,cAAc,MAAM;AAC3C,MAAAA,EAAM,YAAY,+BAClBA,EAAM,cAAc,gBACpB0e,EAAO,YAAY1e,CAAK;AAExB,YAAM2e,IAAW,SAAS,cAAc,QAAQ;AAChD,MAAAA,EAAS,YAAY,+BACrBA,EAAS,cAAc,KACvBA,EAAS,QAAQ,SACjBA,EAAS,iBAAiB,aAAa,CAAC3T,MAAM;AAC5C,QAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe;AAAA,MACnB,CAAC,GACD2T,EAAS,iBAAiB,SAAS,CAAC3T,MAAM;AACxC,QAAAA,EAAE,gBAAe,GACjBL,EAAK,SAAS,EAAE,SAAS8N,EAA0B,GAAG,EAAK,GAAG;AAAA,MAChE,CAAC,GACDiG,EAAO,YAAYC,CAAQ,GAE3B,KAAK,MAAM,YAAYD,CAAM,GAG7B,KAAK,YAAY,SAAS,cAAc,KAAK,GAC7C,KAAK,UAAU,YAAY,iCAC3B,KAAK,MAAM,YAAY,KAAK,SAAS,GAErC,KAAK,aAAY,GAGjB/T,EAAK,IAAI,YAAY,KAAK,QAAQ,GAClCA,EAAK,IAAI,YAAY,KAAK,KAAK,GAG/BA,EAAK,UAAU,MAAM,WAAW,UAGhC,KAAK,aAAa,CAACK,MAAM;AACvB,QAAIA,EAAE,QAAQ,aACZA,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjBL,EAAK,SAAS,EAAE,SAAS8N,EAA0B,GAAG,EAAK,GAAG;AAAA,MAElE,GACA9N,EAAK,IAAI,iBAAiB,WAAW,KAAK,YAAY,EAAI,GAG1D,sBAAsB,MAAM;AAC1B,QAAI,KAAK,YAAU,KAAK,SAAS,UAAU,IAAI,wCAAwC,GACnF,KAAK,SAAO,KAAK,MAAM,UAAU,IAAI,4BAA4B;AAAA,MACvE,CAAC;AAAA,IACH;AAAA,IAEA,QAAQ;AACN,YAAMA,IAAO,KAAK;AAElB,MAAAA,EAAK,UAAU,MAAM,WAAW,IAE5B,KAAK,eACPA,EAAK,IAAI,oBAAoB,WAAW,KAAK,YAAY,EAAI,GAC7D,KAAK,aAAa,OAGhB,KAAK,SAAO,KAAK,MAAM,UAAU,OAAO,4BAA4B,GACpE,KAAK,YAAU,KAAK,SAAS,UAAU,OAAO,wCAAwC;AAE1F,YAAMiU,IAAQ,KAAK,OACbC,IAAW,KAAK;AACtB,iBAAW,MAAM;AACf,QAAAD,KAAA,QAAAA,EAAO,UACPC,KAAA,QAAAA,EAAU;AAAA,MACZ,GAAG,GAAG,GAEN,KAAK,QAAQ,MACb,KAAK,WAAW,MAChB,KAAK,YAAY;AAAA,IACnB;AAAA,IAEA,eAAe;AACb,UAAI,CAAC,KAAK,UAAW;AACrB,WAAK,UAAU,YAAY;AAE3B,YAAMlU,IAAO,KAAK,MACZ9I,IAAQ8I,EAAK,MAAM,MAAMmO,CAAgB,GACzC,EAAE,YAAAuG,GAAY,WAAAC,GAAW,YAAAC,GAAY,cAAAC,EAAY,IAAK3d;AAG5D,UAAI4d,IAAc;AAClB,MAAIJ,KAAcC,IAAWG,IAAc,SAClCJ,IAAYI,IAAc,eAC1BH,MAAWG,IAAc;AAGlC,YAAMC,IAAc,KAAK,cAAc,MAAM,GACvCC,IAAc,SAAS,cAAc,KAAK;AAChD,MAAAA,EAAY,YAAY;AAExB,YAAMC,IAAQ;AAAA,QACZ,EAAE,IAAI,UAAU,OAAO,UAAU,MAAM,IAAQ;AAAA,QAC/C,EAAE,IAAI,cAAc,OAAO,cAAc,MAAM,IAAQ;AAAA,QACvD,EAAE,IAAI,SAAS,OAAO,SAAS,MAAM,IAAQ;AAAA,QAC7C,EAAE,IAAI,QAAQ,OAAO,QAAQ,MAAM,IAAQ;AAAA,MACnD;AAEM,iBAAWC,KAAQD,GAAO;AACxB,cAAMlD,IAAM,SAAS,cAAc,QAAQ;AAC3C,QAAAA,EAAI,YAAY,0BACZmD,EAAK,OAAOJ,KAAa/C,EAAI,UAAU,IAAI,+BAA+B,GAC9EA,EAAI,QAAQmD,EAAK;AAEjB,cAAMC,IAAO,SAAS,cAAc,MAAM;AAC1C,QAAAA,EAAK,YAAY,+BACjBA,EAAK,cAAcD,EAAK,MACxBnD,EAAI,YAAYoD,CAAI;AAEpB,cAAM1d,IAAQ,SAAS,cAAc,MAAM;AAC3C,QAAAA,EAAM,YAAY,gCAClBA,EAAM,cAAcyd,EAAK,OACzBnD,EAAI,YAAYta,CAAK,GAErBsa,EAAI,iBAAiB,aAAa,CAAC1R,MAAMA,EAAE,gBAAgB,GAC3D0R,EAAI,iBAAiB,SAAS,CAAC1R,MAAM;AACnC,UAAAA,EAAE,gBAAe;AACjB,gBAAM+U,IAAKF,EAAK,OAAO,gBAAgBA,EAAK,OAAO,QAC7CG,IAAKH,EAAK,OAAO,WAAWA,EAAK,OAAO;AAC9C,UAAAlV,EAAK,SAAS;AAAA,YACZ,SAAS;AAAA,cACP+N,EAAoB,GAAGqH,CAAE;AAAA,cACzBpH,EAAmB,GAAGqH,CAAE;AAAA,YACtC;AAAA,UACA,CAAW;AAAA,QACH,CAAC,GAEDL,EAAY,YAAYjD,CAAG;AAAA,MAC7B;AAMA,UAJAgD,EAAY,YAAYC,CAAW,GACnC,KAAK,UAAU,YAAYD,CAAW,GAGlCJ,GAAW;AACb,cAAMW,IAAe,KAAK,cAAc,aAAa,GAC/CC,IAAQ,SAAS,cAAc,KAAK;AAC1C,QAAAA,EAAM,YAAY;AAElB,cAAMC,IAAS;AAAA,UACb,EAAE,IAAI,QAAQ,OAAO,OAAM;AAAA,UAC3B,EAAE,IAAI,YAAY,OAAO,WAAU;AAAA,UACnC,EAAE,IAAI,aAAa,OAAO,YAAW;AAAA,QAC/C;AAEQ,mBAAWC,KAAOD,GAAQ;AACxB,gBAAME,IAAO,SAAS,cAAc,QAAQ;AAC5C,UAAAA,EAAK,YAAY,wBACbD,EAAI,OAAOb,KAAYc,EAAK,UAAU,IAAI,6BAA6B,GAC3EA,EAAK,cAAcD,EAAI,OAEvBC,EAAK,iBAAiB,aAAa,CAACrV,OAAMA,GAAE,gBAAgB,GAC5DqV,EAAK,iBAAiB,SAAS,CAACrV,OAAM;AACpC,YAAAA,GAAE,gBAAe,GACjBL,EAAK,SAAS,EAAE,SAASiO,GAAoB,GAAGwH,EAAI,EAAE,GAAG;AAAA,UAC3D,CAAC,GAEDF,EAAM,YAAYG,CAAI;AAAA,QACxB;AAEA,QAAAJ,EAAa,YAAYC,CAAK,GAC9B,KAAK,UAAU,YAAYD,CAAY;AAGvC,cAAMK,IAAa,KAAK,cAAc,kBAAkBd,CAAY,GAAG;AACvE,aAAK,WAAWc,EAAW,cAAc,gCAAgC;AAEzE,cAAMC,IAAa,SAAS,cAAc,KAAK;AAC/C,QAAAA,EAAW,YAAY;AAEvB,cAAMC,IAAS,SAAS,cAAc,OAAO;AAC7C,QAAAA,EAAO,OAAO,SACdA,EAAO,YAAY,0BACnBA,EAAO,MAAM,KACbA,EAAO,MAAM,OACbA,EAAO,QAAQ,OAAOhB,CAAY,GAElCgB,EAAO,iBAAiB,aAAa,CAACxV,MAAMA,EAAE,iBAAiB,GAC/DwV,EAAO,iBAAiB,SAAS,CAACxV,MAAM;AACtC,UAAAA,EAAE,gBAAe;AACjB,gBAAMyV,IAAM,OAAOzV,EAAE,OAAO,KAAK;AACjC,UAAI,KAAK,aACP,KAAK,SAAS,cAAc,kBAAkByV,CAAG,MAEnD9V,EAAK,SAAS,EAAE,SAASkO,GAAsB,GAAG4H,CAAG,GAAG;AAAA,QAC1D,CAAC;AAED,cAAMC,IAAS,SAAS,cAAc,KAAK;AAC3C,QAAAA,EAAO,YAAY;AACnB,cAAMC,IAAY,SAAS,cAAc,MAAM;AAC/C,QAAAA,EAAU,cAAc;AACxB,cAAMC,IAAY,SAAS,cAAc,MAAM;AAC/C,QAAAA,EAAU,cAAc,YACxBF,EAAO,YAAYC,CAAS,GAC5BD,EAAO,YAAYE,CAAS,GAE5BL,EAAW,YAAYC,CAAM,GAC7BD,EAAW,YAAYG,CAAM,GAC7BJ,EAAW,YAAYC,CAAU,GACjC,KAAK,UAAU,YAAYD,CAAU;AAAA,MACvC;AAGA,YAAMO,IAAY,SAAS,cAAc,KAAK;AAC9C,MAAAA,EAAU,YAAY;AAEtB,YAAMC,IAAgB,SAAS,cAAc,MAAM;AACnD,MAAAA,EAAc,YAAY,mCAC1BA,EAAc,cAAc,cAC5BD,EAAU,YAAYC,CAAa;AAEnC,YAAMC,IAAQ,SAAS,cAAc,KAAK;AAC1C,MAAAA,EAAM,YAAY,uBAClBA,EAAM,cAAc,GAAG5B,EAAM,WAC7B0B,EAAU,YAAYE,CAAK;AAE3B,YAAMC,IAAS,SAAS,cAAc,MAAM;AAC5C,MAAAA,EAAO,YAAY,4BACnBA,EAAO,cAAc,cACrBH,EAAU,YAAYG,CAAM;AAE5B,YAAMC,IAAQ,SAAS,cAAc,KAAK;AAC1C,MAAAA,EAAM,YAAY,uBAClBA,EAAM,cAAc,GAAG9B,EAAM,WAC7B0B,EAAU,YAAYI,CAAK;AAE3B,YAAMC,IAAS,SAAS,cAAc,MAAM;AAC5C,MAAAA,EAAO,YAAY,4BACnBA,EAAO,cAAc,SACrBL,EAAU,YAAYK,CAAM,GAE5B,KAAK,UAAU,YAAYL,CAAS;AAAA,IACtC;AAAA,IAEA,cAAcM,GAAW;AACvB,YAAMlhB,IAAU,SAAS,cAAc,KAAK;AAC5C,MAAAA,EAAQ,YAAY;AAEpB,YAAMmC,IAAQ,SAAS,cAAc,OAAO;AAC5C,aAAAA,EAAM,YAAY,iCAClBA,EAAM,cAAc+e,GACpBlhB,EAAQ,YAAYmC,CAAK,GAElBnC;AAAA,IACT;AAAA,IAEA,iBAAiB;AACf,WAAK,aAAY;AAAA,IACnB;AAAA,IAEA,UAAU;;AACR,MAAI,KAAK,WACH,KAAK,cACP,KAAK,KAAK,IAAI,oBAAoB,WAAW,KAAK,YAAY,EAAI,IAEpE+e,IAAA,KAAK,UAAL,QAAAA,EAAY,WACZC,IAAA,KAAK,aAAL,QAAAA,EAAe,UACf,KAAK,KAAK,UAAU,MAAM,WAAW;AAAA,IAEzC;AAAA,EACJ;AACA;AC1UA,IAAI,OAAO,WAAa,KAAa;AACnC,QAAMmC,IAAQ,SAAS,cAAc,OAAO;AAC5C,EAAAA,EAAM,cAAc,iEACpB,SAAS,KAAK,YAAYA,CAAK;AACjC;AAMY,MAACC,KAAYhF,EAAW,UAAU;AAAA;AAAA,EAE5C,KAAK;AAAA,IACH,QAAQ;AAAA,IACR,UAAU;AAAA,EACd;AAAA,EACE,eAAe;AAAA,IACb,YAAY;AAAA,IACZ,SAAS;AAAA,IACT,YAAY;AAAA,EAChB;AAAA,EACE,YAAY;AAAA,IACV,SAAS;AAAA,EACb;AAAA,EACE,gBAAgB;AAAA,IACd,UAAU;AAAA,IACV,YAAY;AAAA,EAChB;AAAA,EACE,gBAAgB;AAAA,IACd,SAAS;AAAA,EACb;AAAA;AAAA,EAGE,wBAAwB;AAAA,IACtB,SAAS;AAAA,IACT,WAAW;AAAA,EACf;AAAA;AAAA,EAGE,mCAAmC;AAAA,IACjC,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,YAAY;AAAA,EAChB;AAAA,EACE,+BAA+B;AAAA,IAC7B,UAAU;AAAA,EACd;AAAA,EACE,+BAA+B;AAAA,IAC7B,UAAU;AAAA,EACd;AAAA,EACE,+BAA+B;AAAA,IAC7B,UAAU;AAAA,EACd;AAAA,EACE,+BAA+B;AAAA,IAC7B,UAAU;AAAA,EACd;AAAA,EACE,+BAA+B;AAAA,IAC7B,UAAU;AAAA,EACd;AAAA,EACE,+BAA+B;AAAA,IAC7B,UAAU;AAAA,EACd;AAAA;AAAA,EAGE,+BAA+B;AAAA,IAC7B,YAAY;AAAA,EAChB;AAAA,EACE,2BAA2B;AAAA,IACzB,WAAW;AAAA,EACf;AAAA,EACE,4BAA4B;AAAA,IAC1B,gBAAgB;AAAA,EACpB;AAAA,EACE,iEAAiE;AAAA,IAC/D,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,SAAS;AAAA,IACT,cAAc;AAAA,EAClB;AAAA,EACE,gEAAgE;AAAA,IAC9D,UAAU;AAAA,IACV,eAAe;AAAA,EACnB;AAAA,EACE,kEAAkE;AAAA,IAChE,UAAU;AAAA,IACV,eAAe;AAAA,EACnB;AAAA;AAAA,EAGE,6BAA6B;AAAA,IAC3B,SAAS;AAAA,IACT,cAAc;AAAA,IACd,YAAY;AAAA,IACZ,UAAU;AAAA,EACd;AAAA;AAAA,EAGE,0BAA0B;AAAA,IACxB,gBAAgB;AAAA,IAChB,QAAQ;AAAA,EACZ;AAAA,EACE,gCAAgC;AAAA,IAC9B,gBAAgB;AAAA,EACpB;AAAA;AAAA,EAGE,4BAA4B;AAAA,IAC1B,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,cAAc;AAAA,EAClB;AAAA;AAAA,EAGE,uCAAuC;AAAA,IACrC,SAAS;AAAA,IACT,WAAW;AAAA,IACX,aAAa;AAAA,IACb,YAAY;AAAA,EAChB;AAAA;AAAA,EAGE,sCAAsC;AAAA,IACpC,SAAS;AAAA,EACb;AAAA,EACE,wCAAwC;AAAA,IACtC,aAAa;AAAA,EACjB;AAAA;AAAA,EAGE,wDAAwD;AAAA,IACtD,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,EACZ;AAAA;AAAA,EAGE,+CAA+C;AAAA,IAC7C,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,aAAa;AAAA,IACb,QAAQ;AAAA,EACZ;AAAA,EACE,sCAAsC;AAAA,IACpC,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,OAAO;AAAA,IACP,aAAa;AAAA,IACb,QAAQ;AAAA,IACR,YAAY;AAAA,EAChB;AAAA,EACE,sCAAsC;AAAA,IACpC,OAAO;AAAA,EACX;AAAA,EACE,wCAAwC;AAAA,IACtC,OAAO;AAAA,EACX;AAAA,EACE,0CAA0C;AAAA,IACxC,OAAO;AAAA,EACX;AAAA,EACE,2CAA2C;AAAA,IACzC,OAAO;AAAA,EACX;AAAA,EACE,2CAA2C;AAAA,IACzC,OAAO;AAAA,EACX;AAAA,EACE,2CAA2C;AAAA,IACzC,OAAO;AAAA,EACX;AAAA;AAAA,EAGE,uBAAuB;AAAA,IACrB,YAAY;AAAA,IACZ,UAAU;AAAA,EACd;AAAA;AAAA,EAGE,wBAAwB;AAAA,IACtB,YAAY;AAAA,EAChB;AAAA;AAAA,EAGE,qBAAqB;AAAA,IACnB,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,WAAW;AAAA,EACf;AAAA;AAAA,EAGE,+BAA+B;AAAA,IAC7B,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,WAAW;AAAA,EACf;AAAA,EACE,uBAAuB;AAAA,IACrB,QAAQ;AAAA,EACZ;AAAA,EACE,0BAA0B;AAAA,IACxB,YAAY;AAAA,EAChB;AAAA,EACE,0BAA0B;AAAA,IACxB,QAAQ;AAAA,EACZ;AAAA;AAAA,EAGE,wBAAwB;AAAA,IACtB,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,WAAW;AAAA,EACf;AAAA,EACE,sBAAsB;AAAA,IACpB,SAAS;AAAA,EACb;AAAA,EACE,qBAAqB;AAAA,IACnB,SAAS;AAAA,EACb;AAAA,EACE,wBAAwB;AAAA,IACtB,SAAS;AAAA,EACb;AAAA,EACE,6BAA6B;AAAA,IAC3B,QAAQ;AAAA,IACR,UAAU;AAAA,EACd;AAAA,EACE,gBAAgB;AAAA,IACd,QAAQ;AAAA,IACR,gBAAgB;AAAA,IAChB,qBAAqB;AAAA,EACzB;AAAA,EACE,gBAAgB;AAAA,IACd,gBAAgB;AAAA,IAChB,qBAAqB;AAAA,EACzB;AAAA;AAAA,EAGE,aAAa;AAAA,IACX,gBAAgB;AAAA,IAChB,cAAc;AAAA,IACd,UAAU;AAAA,EACd;AAAA,EACE,8BAA8B;AAAA,IAC5B,SAAS;AAAA,IACT,WAAW;AAAA,EACf;AAAA,EACE,gBAAgB;AAAA,IACd,YAAY;AAAA,EAChB;AAAA;AAAA,EAGE,sCAAsC;AAAA,IACpC,SAAS;AAAA,IACT,cAAc;AAAA,EAClB;AAAA,EACE,uCAAuC;AAAA,IACrC,SAAS;AAAA,IACT,SAAS;AAAA,IACT,UAAU;AAAA,EACd;AAAA,EACE,kDAAkD;AAAA,IAChD,aAAa;AAAA,EACjB;AAAA,EACE,4CAA4C;AAAA,IAC1C,SAAS;AAAA,EACb;AAAA;AAAA,EAGE,oBAAoB;AAAA,IAClB,SAAS;AAAA,IACT,SAAS;AAAA,IACT,WAAW;AAAA,EACf;AAAA,EACE,mCAAmC;AAAA,IACjC,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,gBAAgB;AAAA,EACpB;AAAA,EACE,4CAA4C;AAAA,IAC1C,WAAW;AAAA,EACf;AAAA;AAAA,EAGE,uBAAuB;AAAA,IACrB,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,WAAW;AAAA,EACf;AAAA,EACE,2BAA2B;AAAA,IACzB,UAAU;AAAA,IACV,QAAQ;AAAA,EACZ;AAAA,EACE,sCAAsC;AAAA,IACpC,OAAO;AAAA,IACP,YAAY;AAAA,IACZ,UAAU;AAAA,EACd;AAAA,EACE,0BAA0B;AAAA,IACxB,YAAY;AAAA,IACZ,UAAU;AAAA,EACd;AAAA;AAAA,EAGE,mBAAmB;AAAA,IACjB,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,WAAW;AAAA,EACf;AAAA;AAAA,EAGE,sBAAsB;AAAA,IACpB,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,YAAY;AAAA,EAChB;AAAA;AAAA,EAGE,uBAAuB;AAAA,IACrB,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,WAAW;AAAA,EACf;AAAA;AAAA,EAGE,uBAAuB;AAAA,IACrB,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,YAAY;AAAA,IACZ,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,YAAY;AAAA,EAChB;AAAA;AAAA,EAEE,iCAAiC;AAAA,IAC/B,WAAW;AAAA,IACX,SAAS;AAAA,EACb;AAAA,EACE,uCAAuC;AAAA,IACrC,SAAS;AAAA,EACb;AAAA;AAAA,EAEE,gCAAgC;AAAA,IAC9B,WAAW;AAAA,EACf;AAAA,EACE,+CAA+C;AAAA,IAC7C,SAAS;AAAA,EACb;AAAA,EACE,qDAAqD;AAAA,IACnD,SAAS;AAAA,EACb;AAAA;AAAA,EAGE,gCAAgC;AAAA,IAC9B,QAAQ;AAAA,IACR,UAAU;AAAA,EACd;AAAA,EACE,iBAAiB;AAAA,IACf,SAAS;AAAA,IACT,UAAU;AAAA,EACd;AAAA,EACE,qBAAqB;AAAA,IACnB,aAAa;AAAA,EACjB;AAAA;AAAA,EAGE,gBAAgB,CAAA;AAAA,EAChB,iBAAiB,CAAA;AAAA,EACjB,qBAAqB,CAAA;AAAA,EACrB,kCAAkC,CAAA;AAAA,EAClC,6BAA6B,CAAA;AAAA,EAC7B,eAAe,CAAA;AAAA,EACf,wBAAwB,CAAA;AAAA,EACxB,gBAAgB,EAAE,WAAW,SAAQ;AAAA,EACrC,oBAAoB,CAAA;AAAA,EACpB,qBAAqB,CAAA;AAAA,EACrB,iCAAiC,CAAA;AAAA,EACjC,gBAAgB,CAAA;AAAA,EAChB,sBAAsB,CAAA;AAAA,EACtB,uBAAuB,CAAA;AAAA,EACvB,eAAe,CAAA;AAAA,EACf,aAAa,CAAA;AAAA;AAAA,EAGb,qBAAqB;AAAA,IACnB,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,WAAW;AAAA,EACf;AAAA,EACE,yBAAyB;AAAA,IACvB,UAAU;AAAA,IACV,WAAW;AAAA,IACX,WAAW;AAAA,IACX,cAAc;AAAA,IACd,SAAS;AAAA,EACb;AAAA,EACE,iBAAiB;AAAA,IACf,SAAS;AAAA,IACT,UAAU;AAAA,IACV,WAAW;AAAA,IACX,WAAW;AAAA,EACf;AAAA,EACE,mBAAmB;AAAA,IACjB,SAAS;AAAA,IACT,SAAS;AAAA,IACT,UAAU;AAAA,IACV,cAAc;AAAA,IACd,YAAY;AAAA,EAChB;AAAA;AAAA,EAGE,2BAA2B;AAAA,IACzB,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,cAAc;AAAA,IACd,WAAW;AAAA,EACf;AAAA,EACE,yBAAyB;AAAA,IACvB,OAAO;AAAA,IACP,gBAAgB;AAAA,IAChB,UAAU;AAAA,EACd;AAAA,EACE,4BAA4B;AAAA,IAC1B,SAAS;AAAA,IACT,eAAe;AAAA,EACnB;AAAA,EACE,uBAAuB;AAAA,IACrB,YAAY;AAAA,IACZ,YAAY;AAAA,IACZ,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,OAAO;AAAA,IACP,cAAc;AAAA,EAClB;AAAA,EACE,6BAA6B;AAAA,IAC3B,YAAY;AAAA,IACZ,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,OAAO;AAAA,IACP,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,cAAc;AAAA,IACd,WAAW;AAAA,IACX,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,eAAe;AAAA,IACf,kBAAkB;AAAA,EACtB;AAAA,EACE,gEAAgE;AAAA,IAC9D,SAAS;AAAA,EACb;AAAA,EACE,8BAA8B;AAAA,IAC5B,OAAO;AAAA,EACX;AAAA,EACE,yBAAyB;AAAA,IACvB,SAAS;AAAA,IACT,UAAU;AAAA,IACV,KAAK;AAAA,IACL,YAAY;AAAA,EAChB;AAAA,EACE,yBAAyB;AAAA,IACvB,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ,OAAO;AAAA,IACP,MAAM;AAAA,IACN,UAAU;AAAA,IACV,SAAS;AAAA,IACT,SAAS;AAAA,IACT,cAAc;AAAA,EAClB;AAAA,EACE,+BAA+B;AAAA,IAC7B,SAAS;AAAA,EACb;AAAA,EACE,4BAA4B;AAAA,IAC1B,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,EACZ;AAAA,EACE,uBAAuB;AAAA,IACrB,SAAS;AAAA,IACT,SAAS;AAAA,IACT,cAAc;AAAA,IACd,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,YAAY;AAAA,EAChB;AAAA,EACE,2BAA2B;AAAA,IACzB,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,SAAS;AAAA,IACT,YAAY;AAAA,EAChB;AAAA,EACE,iCAAiC;AAAA,IAC/B,SAAS;AAAA,EACb;AAAA,EACE,+BAA+B;AAAA,IAC7B,OAAO;AAAA,IACP,YAAY;AAAA,EAChB;AAAA,EACE,0BAA0B;AAAA,IACxB,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,UAAU;AAAA,IACV,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,YAAY;AAAA,EAChB;AAAA,EACE,yDAAyD;AAAA,IACvD,SAAS;AAAA,EACb;AAAA,EACE,+DAA+D;AAAA,IAC7D,SAAS;AAAA,EACb;AAAA,EACE,uBAAuB;AAAA,IACrB,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,UAAU;AAAA,IACV,SAAS;AAAA,IACT,YAAY;AAAA,EAChB;AAAA,EACE,6BAA6B;AAAA,IAC3B,SAAS;AAAA,EACb;AAAA,EACE,yBAAyB;AAAA,IACvB,WAAW;AAAA,IACX,UAAU;AAAA,IACV,SAAS;AAAA,IACT,QAAQ;AAAA,EACZ;AAAA,EACE,wBAAwB;AAAA,IACtB,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,WAAW;AAAA,EACf;AAAA;AAAA,EAGE,kCAAkC;AAAA,IAChC,UAAU;AAAA,IACV,KAAK;AAAA,IACL,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,YAAY;AAAA,EAChB;AAAA,EACE,0CAA0C;AAAA,IACxC,SAAS;AAAA,EACb;AAAA,EACE,yBAAyB;AAAA,IACvB,UAAU;AAAA,IACV,KAAK;AAAA,IACL,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,WAAW;AAAA,IACX,WAAW;AAAA,IACX,YAAY;AAAA,IACZ,wBAAwB;AAAA,IACxB,yBAAyB;AAAA,EAC7B;AAAA,EACE,8BAA8B;AAAA,IAC5B,WAAW;AAAA,EACf;AAAA,EACE,gCAAgC;AAAA,IAC9B,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,SAAS;AAAA,EACb;AAAA,EACE,+BAA+B;AAAA,IAC7B,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,YAAY;AAAA,EAChB;AAAA,EACE,+BAA+B;AAAA,IAC7B,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,SAAS;AAAA,EACb;AAAA,EACE,qCAAqC;AAAA,IACnC,SAAS;AAAA,EACb;AAAA,EACE,iCAAiC;AAAA,IAC/B,SAAS;AAAA,EACb;AAAA,EACE,yDAAyD;AAAA,IACvD,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,WAAW;AAAA,EACf;AAAA,EACE,+BAA+B;AAAA,IAC7B,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,SAAS;AAAA,IACT,SAAS;AAAA,EACb;AAAA,EACE,iCAAiC;AAAA,IAC/B,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,SAAS;AAAA,IACT,cAAc;AAAA,IACd,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,WAAW;AAAA,EACf;AAAA;AAAA,EAGE,wBAAwB;AAAA,IACtB,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,KAAK;AAAA,IACL,SAAS;AAAA,IACT,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,YAAY;AAAA,EAChB;AAAA,EACE,uBAAuB;AAAA,IACrB,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,SAAS;AAAA,EACb;AAAA,EACE,wBAAwB;AAAA,IACtB,YAAY;AAAA,IACZ,oBAAoB;AAAA,EACxB;AAAA,EACE,wBAAwB;AAAA,IACtB,YAAY;AAAA,EAChB;AAAA,EACE,0BAA0B;AAAA,IACxB,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,YAAY;AAAA,EAChB;AAAA;AAAA,EAGE,WAAW;AAAA,IACT,SAAS;AAAA,IACT,SAAS;AAAA,IACT,cAAc;AAAA,IACd,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ,YAAY;AAAA,IACZ,eAAe;AAAA,EACnB;AAAA,EACE,gBAAgB;AAAA,IACd,cAAc;AAAA,EAClB;AAAA;AAAA,EAGE,oBAAoB;AAAA,IAClB,WAAW;AAAA,EACf;AAAA,EACE,kBAAkB;AAAA,IAChB,WAAW;AAAA,EACf;AAAA,EACE,uBAAuB;AAAA,IACrB,WAAW;AAAA,EACf;AAAA,EACE,0BAA0B;AAAA,IACxB,WAAW;AAAA,EACf;AAAA;AAAA,EAEE,uBAAuB;AAAA,IACrB,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,KAAK;AAAA,IACL,SAAS;AAAA,IACT,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,YAAY;AAAA,EAChB;AAAA,EACE,uBAAuB;AAAA,IACrB,YAAY;AAAA,IACZ,YAAY;AAAA,EAChB;AAAA,EACE,sBAAsB;AAAA,IACpB,SAAS;AAAA,IACT,UAAU;AAAA,IACV,KAAK;AAAA,IACL,YAAY;AAAA,EAChB;AAAA,EACE,sBAAsB;AAAA,IACpB,SAAS;AAAA,IACT,SAAS;AAAA,IACT,cAAc;AAAA,IACd,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,YAAY;AAAA,EAChB;AAAA,EACE,4BAA4B;AAAA,IAC1B,gBAAgB;AAAA,EACpB;AAAA,EACE,uBAAuB;AAAA,IACrB,WAAW;AAAA,IACX,SAAS;AAAA,EACb;AAAA;AAAA,EAGE,sBAAsB;AAAA,IACpB,SAAS;AAAA,IACT,YAAY;AAAA,EAChB;AAAA;AAAA,EAGE,mCAAmC;AAAA,IACjC,UAAU;AAAA,IACV,KAAK;AAAA,IACL,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,YAAY;AAAA,EAChB;AAAA,EACE,2CAA2C;AAAA,IACzC,SAAS;AAAA,EACb;AAAA,EACE,0BAA0B;AAAA,IACxB,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,WAAW;AAAA,IACX,WAAW;AAAA,IACX,YAAY;AAAA,IACZ,qBAAqB;AAAA,IACrB,sBAAsB;AAAA,EAC1B;AAAA,EACE,+BAA+B;AAAA,IAC7B,WAAW;AAAA,EACf;AAAA,EACE,iCAAiC;AAAA,IAC/B,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,SAAS;AAAA,EACb;AAAA,EACE,gCAAgC;AAAA,IAC9B,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,YAAY;AAAA,EAChB;AAAA,EACE,gCAAgC;AAAA,IAC9B,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,SAAS;AAAA,EACb;AAAA,EACE,sCAAsC;AAAA,IACpC,SAAS;AAAA,EACb;AAAA,EACE,kCAAkC;AAAA,IAChC,SAAS;AAAA,IACT,YAAY;AAAA,EAChB;AAAA,EACE,4BAA4B;AAAA,IAC1B,cAAc;AAAA,EAClB;AAAA,EACE,kCAAkC;AAAA,IAChC,SAAS;AAAA,IACT,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,eAAe;AAAA,IACf,eAAe;AAAA,IACf,cAAc;AAAA,EAClB;AAAA,EACE,4BAA4B;AAAA,IAC1B,SAAS;AAAA,IACT,KAAK;AAAA,EACT;AAAA,EACE,2BAA2B;AAAA,IACzB,MAAM;AAAA,IACN,SAAS;AAAA,IACT,eAAe;AAAA,IACf,YAAY;AAAA,IACZ,KAAK;AAAA,IACL,SAAS;AAAA,IACT,cAAc;AAAA,IACd,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,YAAY;AAAA,EAChB;AAAA,EACE,gCAAgC;AAAA,IAC9B,UAAU;AAAA,IACV,YAAY;AAAA,EAChB;AAAA,EACE,iCAAiC;AAAA,IAC/B,UAAU;AAAA,EACd;AAAA,EACE,0BAA0B;AAAA,IACxB,SAAS;AAAA,IACT,KAAK;AAAA,EACT;AAAA,EACE,yBAAyB;AAAA,IACvB,SAAS;AAAA,IACT,cAAc;AAAA,IACd,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,YAAY;AAAA,IACZ,YAAY;AAAA,IACZ,YAAY;AAAA,EAChB;AAAA,EACE,gCAAgC;AAAA,IAC9B,SAAS;AAAA,IACT,eAAe;AAAA,IACf,KAAK;AAAA,EACT;AAAA,EACE,2BAA2B;AAAA,IACzB,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ,kBAAkB;AAAA,IAClB,cAAc;AAAA,IACd,SAAS;AAAA,IACT,QAAQ;AAAA,EACZ;AAAA,EACE,kCAAkC;AAAA,IAChC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,UAAU;AAAA,EACd;AAAA,EACE,8BAA8B;AAAA,IAC5B,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,KAAK;AAAA,IACL,UAAU;AAAA,IACV,UAAU;AAAA,IACV,WAAW;AAAA,IACX,YAAY;AAAA,EAChB;AAAA,EACE,oCAAoC;AAAA,IAClC,YAAY;AAAA,EAChB;AAAA,EACE,wBAAwB;AAAA,IACtB,SAAS;AAAA,IACT,SAAS;AAAA,IACT,cAAc;AAAA,IACd,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,YAAY;AAAA,EAChB;AAAA,EACE,6BAA6B;AAAA,IAC3B,aAAa;AAAA,EACjB;AACA,CAAC,GCj3BYiF,KAAajF,EAAW,MAAM;AAAA;AAAA,EAEzC,KAAK;AAAA,IACH,iBAAiB;AAAA,EACrB;AAAA,EACE,eAAe;AAAA,IACb,YAAY;AAAA,EAChB;AAAA,EACE,cAAc;AAAA,IACZ,iBAAiB;AAAA,IACjB,iBAAiB;AAAA,EACrB;AAAA,EACE,2BAA2B;AAAA,IACzB,iBAAiB;AAAA,EACrB;AAAA,EACE,wCAAwC;AAAA,IACtC,iBAAiB;AAAA,EACrB;AAAA;AAAA,EAGE,+BAA+B,EAAE,OAAO,UAAS;AAAA,EACjD,+BAA+B,EAAE,OAAO,UAAS;AAAA,EACjD,+BAA+B,EAAE,OAAO,UAAS;AAAA,EACjD,+BAA+B,EAAE,OAAO,UAAS;AAAA,EACjD,+BAA+B,EAAE,OAAO,UAAS;AAAA,EACjD,+BAA+B,EAAE,OAAO,UAAS;AAAA;AAAA,EAGjD,4BAA4B,EAAE,OAAO,UAAS;AAAA,EAC9C,6BAA6B;AAAA,IAC3B,iBAAiB;AAAA,IACjB,OAAO;AAAA,EACX;AAAA,EACE,0BAA0B,EAAE,OAAO,UAAS;AAAA,EAC5C,uCAAuC;AAAA,IACrC,OAAO;AAAA,IACP,YAAY;AAAA,EAChB;AAAA,EACE,wCAAwC,EAAE,OAAO,OAAM;AAAA,EACvD,wDAAwD;AAAA,IACtD,YAAY;AAAA,EAChB;AAAA;AAAA,EAGE,uBAAuB;AAAA,IACrB,iBAAiB;AAAA,IACjB,YAAY;AAAA,EAChB;AAAA,EACE,6CAA6C;AAAA,IAC3C,iBAAiB;AAAA,IACjB,YAAY;AAAA,EAChB;AAAA;AAAA,EAGE,iFAAiF;AAAA,IAC/E,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,YAAY;AAAA,IACZ,cAAc;AAAA,IACd,YAAY;AAAA,IACZ,UAAU;AAAA,EACd;AAAA,EACE,uCAAuC;AAAA,IACrC,iBAAiB;AAAA,IACjB,YAAY;AAAA,IACZ,OAAO;AAAA,IACP,YAAY;AAAA,IACZ,cAAc;AAAA,EAClB;AAAA;AAAA,EAGE,oDAAoD,EAAE,OAAO,qBAAoB;AAAA,EACjF,qDAAqD,EAAE,OAAO,qBAAoB;AAAA,EAClF,yDAAyD,EAAE,OAAO,qBAAoB;AAAA,EACtF,0GAA0G,EAAE,OAAO,qBAAoB;AAAA,EACvI,qGAAqG,EAAE,OAAO,qBAAoB;AAAA,EAClI,mDAAmD,EAAE,OAAO,qBAAoB;AAAA,EAChF,gGAAgG,EAAE,OAAO,qBAAoB;AAAA,EAC7H,oDAAoD,EAAE,OAAO,qBAAoB;AAAA,EACjF,wDAAwD,EAAE,OAAO,qBAAoB;AAAA,EACrF,yDAAyD,EAAE,OAAO,qBAAoB;AAAA,EACtF,yGAAyG,EAAE,OAAO,qBAAoB;AAAA,EACtI,oDAAoD,EAAE,OAAO,qBAAoB;AAAA,EACjF,0DAA0D,EAAE,OAAO,qBAAoB;AAAA,EACvF,2DAA2D,EAAE,OAAO,qBAAoB;AAAA,EACxF,mDAAmD,EAAE,OAAO,qBAAoB;AAAA,EAChF,iDAAiD,EAAE,OAAO,qBAAoB;AAAA;AAAA,EAG9E,yBAAyB;AAAA,IACvB,WAAW;AAAA,EACf;AAAA,EACE,iBAAiB;AAAA,IACf,OAAO;AAAA,EACX;AAAA,EACE,mBAAmB;AAAA,IACjB,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,QAAQ;AAAA,EACZ;AAAA;AAAA,EAGE,2BAA2B;AAAA,IACzB,iBAAiB;AAAA,IACjB,QAAQ;AAAA,EACZ;AAAA,EACE,4BAA4B;AAAA,IAC1B,cAAc;AAAA,EAClB;AAAA,EACE,0CAA0C;AAAA,IACxC,cAAc;AAAA,EAClB;AAAA,EACE,uBAAuB;AAAA,IACrB,OAAO;AAAA,EACX;AAAA,EACE,mCAAmC;AAAA,IACjC,iBAAiB;AAAA,IACjB,WAAW;AAAA,EACf;AAAA,EACE,+BAA+B;AAAA,IAC7B,iBAAiB;AAAA,IACjB,WAAW;AAAA,EACf;AAAA,EACE,uBAAuB;AAAA,IACrB,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,QAAQ;AAAA,EACZ;AAAA,EACE,2BAA2B;AAAA,IACzB,iBAAiB;AAAA,IACjB,OAAO;AAAA,EACX;AAAA,EACE,0BAA0B;AAAA,IACxB,OAAO;AAAA,EACX;AAAA,EACE,yBAAyB;AAAA,IACvB,OAAO;AAAA,EACX;AAAA,EACE,wBAAwB;AAAA,IACtB,iBAAiB;AAAA,IACjB,YAAY;AAAA,EAChB;AAAA;AAAA,EAGE,kCAAkC;AAAA,IAChC,iBAAiB;AAAA,EACrB;AAAA,EACE,yBAAyB;AAAA,IACvB,iBAAiB;AAAA,IACjB,WAAW;AAAA,EACf;AAAA,EACE,+BAA+B;AAAA,IAC7B,OAAO;AAAA,EACX;AAAA,EACE,+BAA+B;AAAA,IAC7B,OAAO;AAAA,EACX;AAAA,EACE,iCAAiC;AAAA,IAC/B,iBAAiB;AAAA,IACjB,aAAa;AAAA,IACb,OAAO;AAAA,EACX;AAAA,EACE,uCAAuC;AAAA,IACrC,iBAAiB;AAAA,EACrB;AAAA;AAAA,EAGE,wBAAwB;AAAA,IACtB,iBAAiB;AAAA,IACjB,WAAW;AAAA,IACX,OAAO;AAAA,EACX;AAAA,EACE,wBAAwB;AAAA,IACtB,OAAO;AAAA,EACX;AAAA,EACE,wBAAwB;AAAA,IACtB,OAAO;AAAA,EACX;AAAA,EACE,0BAA0B;AAAA,IACxB,iBAAiB;AAAA,EACrB;AAAA,EACE,4BAA4B;AAAA,IAC1B,OAAO;AAAA,EACX;AAAA,EACE,iDAAiD;AAAA,IAC/C,OAAO;AAAA,EACX;AAAA,EACE,iDAAiD;AAAA,IAC/C,OAAO;AAAA,IACP,SAAS;AAAA,EACb;AAAA;AAAA,EAGE,eAAe;AAAA,IACb,YAAY;AAAA,IACZ,aAAa;AAAA,EACjB;AAAA;AAAA,EAGE,aAAa,EAAE,QAAQ,oBAAmB;AAAA,EAC1C,8BAA8B,EAAE,QAAQ,oBAAmB;AAAA,EAC3D,gBAAgB,EAAE,YAAY,UAAS;AAAA,EACvC,4BAA4B,EAAE,YAAY,UAAS;AAAA,EACnD,sCAAsC;AAAA,IACpC,YAAY;AAAA,IACZ,QAAQ;AAAA,EACZ;AAAA,EACE,uCAAuC;AAAA,IACrC,aAAa;AAAA,EACjB;AAAA;AAAA,EAGE,gBAAgB,EAAE,OAAO,UAAS;AAAA,EAClC,iBAAiB,EAAE,OAAO,UAAS;AAAA,EACnC,qBAAqB,EAAE,OAAO,UAAS;AAAA,EACvC,kCAAkC,EAAE,OAAO,UAAS;AAAA,EACpD,6BAA6B,EAAE,OAAO,UAAS;AAAA,EAC/C,eAAe,EAAE,OAAO,UAAS;AAAA,EACjC,wBAAwB,EAAE,OAAO,UAAS;AAAA,EAC1C,gBAAgB,EAAE,OAAO,UAAS;AAAA,EAClC,oBAAoB,EAAE,OAAO,UAAS;AAAA,EACtC,qBAAqB,EAAE,OAAO,UAAS;AAAA,EACvC,iCAAiC,EAAE,OAAO,UAAS;AAAA,EACnD,gBAAgB,EAAE,OAAO,UAAS;AAAA,EAClC,sBAAsB,EAAE,OAAO,UAAS;AAAA,EACxC,uBAAuB,EAAE,OAAO,UAAS;AAAA,EACzC,eAAe,EAAE,OAAO,UAAS;AAAA,EACjC,aAAa,EAAE,OAAO,UAAS;AAAA;AAAA,EAG/B,uBAAuB;AAAA,IACrB,iBAAiB;AAAA,IACjB,WAAW;AAAA,IACX,OAAO;AAAA,EACX;AAAA,EACE,uBAAuB;AAAA,IACrB,OAAO;AAAA,EACX;AAAA,EACE,sBAAsB;AAAA,IACpB,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,QAAQ;AAAA,EACZ;AAAA;AAAA,EAGE,WAAW;AAAA,IACT,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,QAAQ;AAAA,EACZ;AAAA,EACE,gBAAgB;AAAA,IACd,OAAO;AAAA,EACX;AAAA;AAAA,EAGE,mCAAmC;AAAA,IACjC,iBAAiB;AAAA,EACrB;AAAA,EACE,0BAA0B;AAAA,IACxB,iBAAiB;AAAA,IACjB,WAAW;AAAA,EACf;AAAA,EACE,gCAAgC;AAAA,IAC9B,OAAO;AAAA,EACX;AAAA,EACE,gCAAgC;AAAA,IAC9B,OAAO;AAAA,EACX;AAAA,EACE,kCAAkC;AAAA,IAChC,OAAO;AAAA,EACX;AAAA,EACE,2BAA2B;AAAA,IACzB,OAAO;AAAA,IACP,iBAAiB;AAAA,EACrB;AAAA,EACE,iCAAiC;AAAA,IAC/B,iBAAiB;AAAA,EACrB;AAAA,EACE,kCAAkC;AAAA,IAChC,iBAAiB;AAAA,IACjB,aAAa;AAAA,IACb,OAAO;AAAA,EACX;AAAA,EACE,yBAAyB;AAAA,IACvB,OAAO;AAAA,IACP,iBAAiB;AAAA,EACrB;AAAA,EACE,+BAA+B;AAAA,IAC7B,iBAAiB;AAAA,EACrB;AAAA,EACE,gCAAgC;AAAA,IAC9B,iBAAiB;AAAA,IACjB,aAAa;AAAA,IACb,OAAO;AAAA,EACX;AAAA,EACE,2BAA2B;AAAA,IACzB,YAAY;AAAA,EAChB;AAAA,EACE,kCAAkC;AAAA,IAChC,OAAO;AAAA,EACX;AAAA,EACE,8BAA8B;AAAA,IAC5B,OAAO;AAAA,IACP,WAAW;AAAA,EACf;AAAA,EACE,wBAAwB;AAAA,IACtB,iBAAiB;AAAA,IACjB,QAAQ;AAAA,IACR,OAAO;AAAA,EACX;AAAA;AAAA,EAGE,gCAAgC,EAAE,OAAO,UAAS;AAAA,EAClD,iBAAiB,EAAE,OAAO,OAAM;AAAA,EAChC,qBAAqB,EAAE,OAAO,UAAS;AAAA,EACvC,8BAA8B,EAAE,OAAO,UAAS;AAClD,CAAC,GC5TYkF,KAAYlF,EAAW,MAAM;AAAA;AAAA,EAExC,KAAK;AAAA,IACH,iBAAiB;AAAA,EACrB;AAAA,EACE,eAAe;AAAA,IACb,YAAY;AAAA,IACZ,OAAO;AAAA,EACX;AAAA,EACE,cAAc;AAAA,IACZ,iBAAiB;AAAA,IACjB,iBAAiB;AAAA,EACrB;AAAA,EACE,2BAA2B;AAAA,IACzB,iBAAiB;AAAA,EACrB;AAAA,EACE,wCAAwC;AAAA,IACtC,iBAAiB;AAAA,EACrB;AAAA;AAAA,EAGE,+BAA+B,EAAE,OAAO,UAAS;AAAA,EACjD,+BAA+B,EAAE,OAAO,UAAS;AAAA,EACjD,+BAA+B,EAAE,OAAO,UAAS;AAAA,EACjD,+BAA+B,EAAE,OAAO,UAAS;AAAA,EACjD,+BAA+B,EAAE,OAAO,UAAS;AAAA,EACjD,+BAA+B,EAAE,OAAO,UAAS;AAAA;AAAA,EAGjD,4BAA4B,EAAE,OAAO,OAAM;AAAA,EAC3C,6BAA6B;AAAA,IAC3B,iBAAiB;AAAA,IACjB,OAAO;AAAA,EACX;AAAA,EACE,0BAA0B,EAAE,OAAO,UAAS;AAAA,EAC5C,uCAAuC;AAAA,IACrC,OAAO;AAAA,IACP,YAAY;AAAA,EAChB;AAAA,EACE,wCAAwC,EAAE,OAAO,OAAM;AAAA,EACvD,wDAAwD;AAAA,IACtD,YAAY;AAAA,EAChB;AAAA;AAAA,EAGE,uBAAuB;AAAA,IACrB,iBAAiB;AAAA,IACjB,YAAY;AAAA,EAChB;AAAA,EACE,6CAA6C;AAAA,IAC3C,iBAAiB;AAAA,IACjB,YAAY;AAAA,EAChB;AAAA;AAAA,EAGE,iFAAiF;AAAA,IAC/E,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,YAAY;AAAA,IACZ,cAAc;AAAA,IACd,YAAY;AAAA,IACZ,UAAU;AAAA,EACd;AAAA,EACE,uCAAuC;AAAA,IACrC,iBAAiB;AAAA,IACjB,YAAY;AAAA,IACZ,OAAO;AAAA,IACP,YAAY;AAAA,IACZ,cAAc;AAAA,EAClB;AAAA;AAAA,EAGE,oDAAoD,EAAE,OAAO,qBAAoB;AAAA,EACjF,qDAAqD,EAAE,OAAO,qBAAoB;AAAA,EAClF,yDAAyD,EAAE,OAAO,qBAAoB;AAAA,EACtF,0GAA0G,EAAE,OAAO,qBAAoB;AAAA,EACvI,qGAAqG,EAAE,OAAO,qBAAoB;AAAA,EAClI,mDAAmD,EAAE,OAAO,qBAAoB;AAAA,EAChF,gGAAgG,EAAE,OAAO,qBAAoB;AAAA,EAC7H,oDAAoD,EAAE,OAAO,qBAAoB;AAAA,EACjF,wDAAwD,EAAE,OAAO,qBAAoB;AAAA,EACrF,yDAAyD,EAAE,OAAO,qBAAoB;AAAA,EACtF,yGAAyG,EAAE,OAAO,qBAAoB;AAAA,EACtI,oDAAoD,EAAE,OAAO,qBAAoB;AAAA,EACjF,0DAA0D,EAAE,OAAO,qBAAoB;AAAA,EACvF,2DAA2D,EAAE,OAAO,qBAAoB;AAAA,EACxF,mDAAmD,EAAE,OAAO,qBAAoB;AAAA,EAChF,iDAAiD,EAAE,OAAO,qBAAoB;AAAA;AAAA,EAG9E,yBAAyB;AAAA,IACvB,WAAW;AAAA,EACf;AAAA,EACE,iBAAiB;AAAA,IACf,OAAO;AAAA,EACX;AAAA,EACE,mBAAmB;AAAA,IACjB,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,QAAQ;AAAA,EACZ;AAAA;AAAA,EAGE,2BAA2B;AAAA,IACzB,iBAAiB;AAAA,IACjB,QAAQ;AAAA,EACZ;AAAA,EACE,4BAA4B;AAAA,IAC1B,cAAc;AAAA,EAClB;AAAA,EACE,0CAA0C;AAAA,IACxC,cAAc;AAAA,EAClB;AAAA,EACE,uBAAuB;AAAA,IACrB,OAAO;AAAA,EACX;AAAA,EACE,yBAAyB;AAAA,IACvB,OAAO;AAAA,EACX;AAAA,EACE,mCAAmC;AAAA,IACjC,iBAAiB;AAAA,IACjB,WAAW;AAAA,EACf;AAAA,EACE,+BAA+B;AAAA,IAC7B,iBAAiB;AAAA,IACjB,WAAW;AAAA,EACf;AAAA,EACE,uBAAuB;AAAA,IACrB,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,QAAQ;AAAA,EACZ;AAAA,EACE,2BAA2B;AAAA,IACzB,iBAAiB;AAAA,IACjB,OAAO;AAAA,EACX;AAAA,EACE,0BAA0B;AAAA,IACxB,OAAO;AAAA,EACX;AAAA,EACE,yBAAyB;AAAA,IACvB,OAAO;AAAA,EACX;AAAA,EACE,wBAAwB;AAAA,IACtB,iBAAiB;AAAA,IACjB,YAAY;AAAA,EAChB;AAAA;AAAA,EAGE,kCAAkC;AAAA,IAChC,iBAAiB;AAAA,EACrB;AAAA,EACE,yBAAyB;AAAA,IACvB,iBAAiB;AAAA,IACjB,WAAW;AAAA,EACf;AAAA,EACE,+BAA+B;AAAA,IAC7B,OAAO;AAAA,EACX;AAAA,EACE,+BAA+B;AAAA,IAC7B,OAAO;AAAA,EACX;AAAA,EACE,iCAAiC;AAAA,IAC/B,iBAAiB;AAAA,IACjB,aAAa;AAAA,IACb,OAAO;AAAA,EACX;AAAA,EACE,uCAAuC;AAAA,IACrC,iBAAiB;AAAA,EACrB;AAAA;AAAA,EAGE,wBAAwB;AAAA,IACtB,iBAAiB;AAAA,IACjB,WAAW;AAAA,IACX,OAAO;AAAA,EACX;AAAA,EACE,wBAAwB;AAAA,IACtB,OAAO;AAAA,EACX;AAAA,EACE,wBAAwB;AAAA,IACtB,OAAO;AAAA,EACX;AAAA,EACE,0BAA0B;AAAA,IACxB,iBAAiB;AAAA,EACrB;AAAA,EACE,4BAA4B;AAAA,IAC1B,OAAO;AAAA,EACX;AAAA,EACE,iDAAiD;AAAA,IAC/C,OAAO;AAAA,EACX;AAAA,EACE,iDAAiD;AAAA,IAC/C,OAAO;AAAA,IACP,SAAS;AAAA,EACb;AAAA;AAAA,EAGE,eAAe;AAAA,IACb,YAAY;AAAA,IACZ,aAAa;AAAA,EACjB;AAAA;AAAA,EAGE,aAAa,EAAE,QAAQ,iBAAgB;AAAA,EACvC,8BAA8B,EAAE,QAAQ,iBAAgB;AAAA,EACxD,gBAAgB,EAAE,YAAY,UAAS;AAAA,EACvC,4BAA4B,EAAE,YAAY,UAAS;AAAA,EACnD,sCAAsC;AAAA,IACpC,YAAY;AAAA,IACZ,QAAQ;AAAA,EACZ;AAAA,EACE,uCAAuC;AAAA,IACrC,aAAa;AAAA,EACjB;AAAA;AAAA,EAGE,gBAAgB,EAAE,OAAO,UAAS;AAAA,EAClC,iBAAiB,EAAE,OAAO,UAAS;AAAA,EACnC,qBAAqB,EAAE,OAAO,UAAS;AAAA,EACvC,kCAAkC,EAAE,OAAO,UAAS;AAAA,EACpD,6BAA6B,EAAE,OAAO,UAAS;AAAA,EAC/C,eAAe,EAAE,OAAO,UAAS;AAAA,EACjC,wBAAwB,EAAE,OAAO,UAAS;AAAA,EAC1C,gBAAgB,EAAE,OAAO,UAAS;AAAA,EAClC,oBAAoB,EAAE,OAAO,UAAS;AAAA,EACtC,qBAAqB,EAAE,OAAO,UAAS;AAAA,EACvC,iCAAiC,EAAE,OAAO,UAAS;AAAA,EACnD,gBAAgB,EAAE,OAAO,UAAS;AAAA,EAClC,sBAAsB,EAAE,OAAO,UAAS;AAAA,EACxC,uBAAuB,EAAE,OAAO,UAAS;AAAA,EACzC,eAAe,EAAE,OAAO,UAAS;AAAA,EACjC,aAAa,EAAE,OAAO,UAAS;AAAA;AAAA,EAG/B,uBAAuB;AAAA,IACrB,iBAAiB;AAAA,IACjB,WAAW;AAAA,IACX,OAAO;AAAA,EACX;AAAA,EACE,uBAAuB;AAAA,IACrB,OAAO;AAAA,EACX;AAAA,EACE,sBAAsB;AAAA,IACpB,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,QAAQ;AAAA,EACZ;AAAA;AAAA,EAGE,WAAW;AAAA,IACT,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,QAAQ;AAAA,EACZ;AAAA,EACE,gBAAgB;AAAA,IACd,OAAO;AAAA,EACX;AAAA;AAAA,EAGE,mCAAmC;AAAA,IACjC,iBAAiB;AAAA,EACrB;AAAA,EACE,0BAA0B;AAAA,IACxB,iBAAiB;AAAA,IACjB,WAAW;AAAA,EACf;AAAA,EACE,gCAAgC;AAAA,IAC9B,OAAO;AAAA,EACX;AAAA,EACE,gCAAgC;AAAA,IAC9B,OAAO;AAAA,EACX;AAAA,EACE,kCAAkC;AAAA,IAChC,OAAO;AAAA,EACX;AAAA,EACE,2BAA2B;AAAA,IACzB,OAAO;AAAA,IACP,iBAAiB;AAAA,EACrB;AAAA,EACE,iCAAiC;AAAA,IAC/B,iBAAiB;AAAA,EACrB;AAAA,EACE,kCAAkC;AAAA,IAChC,iBAAiB;AAAA,IACjB,aAAa;AAAA,IACb,OAAO;AAAA,EACX;AAAA,EACE,yBAAyB;AAAA,IACvB,OAAO;AAAA,IACP,iBAAiB;AAAA,EACrB;AAAA,EACE,+BAA+B;AAAA,IAC7B,iBAAiB;AAAA,EACrB;AAAA,EACE,gCAAgC;AAAA,IAC9B,iBAAiB;AAAA,IACjB,aAAa;AAAA,IACb,OAAO;AAAA,EACX;AAAA,EACE,2BAA2B;AAAA,IACzB,YAAY;AAAA,EAChB;AAAA,EACE,kCAAkC;AAAA,IAChC,OAAO;AAAA,EACX;AAAA,EACE,8BAA8B;AAAA,IAC5B,OAAO;AAAA,IACP,WAAW;AAAA,EACf;AAAA,EACE,wBAAwB;AAAA,IACtB,iBAAiB;AAAA,IACjB,QAAQ;AAAA,IACR,OAAO;AAAA,EACX;AAAA;AAAA,EAGE,gCAAgC,EAAE,OAAO,UAAS;AAAA,EAClD,iBAAiB,EAAE,OAAO,OAAM;AAAA,EAChC,qBAAqB,EAAE,OAAO,UAAS;AAAA,EACvC,8BAA8B,EAAE,OAAO,UAAS;AAClD,CAAC,GC/TYmF,KAAenF,EAAW,MAAM;AAAA;AAAA,EAE3C,uCAAuC;AAAA,IACrC,YAAY;AAAA,EAChB;AAAA;AAAA,EAGE,yDAAyD;AAAA,IACvD,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,UAAU;AAAA,EACd;AACA,CAAC,GAKYoF,KAAmBpF,EAAW,MAAM;AAAA;AAAA,EAE/C,uCAAuC;AAAA,IACrC,YAAY;AAAA,EAChB;AAAA;AAAA,EAGE,yDAAyD;AAAA,IACvD,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,UAAU;AAAA,EACd;AACA,CAAC;ACtBM,SAASqF,GAAgB,EAAE,MAAAC,IAAO,CAAA,EAAE,IAAK,CAAA,GAAI;AAClD,SAAO,CAACC,MAAY;AAClB,UAAMpf,IAAQof,EAAQ,YAAY,WAAW;AAC7C,QAAI,CAACpf,EAAO,QAAO;AAInB,UAAMqf,IADOD,EAAQ,MAAM,IAAI,OAAOpf,EAAM,IAAI,EAC1B;AAGtB,QAAI,YAAY,KAAKqf,CAAQ,EAAG,QAAO;AAEvC,UAAMC,IAAQtf,EAAM,KAAK,MAAM,CAAC,EAAE,YAAW,GAEvCW,IAAUwe,EACb,OAAO,CAAC/M,MAAQA,EAAI,YAAW,EAAG,SAASkN,CAAK,CAAC,EACjD,KAAK,CAACC,GAAGC,MAAM;AACd,YAAMC,IAASF,EAAE,YAAW,GACtBG,IAASF,EAAE,YAAW,GAEtBG,IAAUF,EAAO,WAAWH,CAAK,IAAI,IAAI,GACzCM,IAAUF,EAAO,WAAWJ,CAAK,IAAI,IAAI;AAC/C,aAAIK,MAAYC,IAAgBD,IAAUC,IACnCH,EAAO,cAAcC,CAAM;AAAA,IACpC,CAAC,EACA,IAAI,CAACtN,OAAS;AAAA,MACb,OAAO,IAAIA,CAAG;AAAA,MACd,OAAO,IAAIA,CAAG;AAAA,MACd,MAAM;AAAA,IACd,EAAQ;AAEJ,WAAO;AAAA,MACL,MAAMpS,EAAM;AAAA,MACZ,IAAIA,EAAM;AAAA,MACV,SAAAW;AAAA,MACA,UAAU;AAAA,IAChB;AAAA,EACE;AACF;AC7CO,SAASkf,GAAgBC,IAAQ,IAAI;AAC1C,QAAMC,IAAUD,EAAM,IAAI,CAACE,OAAU;AAAA,IACnC,OAAOA,EAAK;AAAA,IACZ,SAAS,MAAM,QAAQA,EAAK,OAAO,IAAIA,EAAK,UAAU,CAAA;AAAA,IACtD,iBAAiBA,EAAK,MAAM,YAAW;AAAA,IACvC,mBAAmB,MAAM,QAAQA,EAAK,OAAO,IACzCA,EAAK,QAAQ,IAAI,CAAC1iB,MAAUA,EAAM,YAAW,CAAE,IAC/C,CAAA;AAAA,EACR,EAAI;AAEF,SAAO;AAAA,IACL,OAAOgiB,GAAO;AACZ,YAAMW,IAASX,EAAM,KAAI,EAAG,YAAW;AACvC,aAAKW,IAIUF,EACZ,IAAI,CAACG,MAAU;AACd,cAAMC,IAAaD,EAAM,gBAAgB,QAAQD,CAAM,GACjDG,IAAaF,EAAM,kBAAkB,SACvC,KAAK;AAAA,UACH,GAAGA,EAAM,kBACN,IAAI,CAAC5iB,MAAUA,EAAM,QAAQ2iB,CAAM,CAAC,EACpC,OAAO,CAACvZ,MAAUA,MAAU,EAAE;AAAA,QACjD,IACc,IACE2Z,IAAY,KAAK;AAAA,UACrBF,MAAe,KAAK,OAAO,oBAAoBA;AAAA,UAC/CC,MAAe,KAAK,OAAO,oBAAoBA;AAAA,QAC3D;AACU,eAAO,EAAE,OAAAF,GAAO,OAAOG,EAAS;AAAA,MAClC,CAAC,EACA,OAAO,CAAC7b,MAAW,OAAO,SAASA,EAAO,KAAK,CAAC,EAChD,KAAK,CAAC+a,GAAGC,MAAMD,EAAE,QAAQC,EAAE,KAAK,EAErB,IAAI,CAAChb,MAAWA,EAAO,KAAK,IAtBjCub;AAAA,IAuBX;AAAA,IAEA,QAAQviB,GAAO;AACb,YAAMyiB,IAASziB,EAAM,KAAI,EAAG,YAAW;AACvC,aACEuiB,EAAQ,KAAK,CAACG,MAAUA,EAAM,oBAAoBD,CAAM,KACxDF,EAAQ,KAAK,CAACG,MAAUA,EAAM,kBAAkB,SAASD,CAAM,CAAC,KAChE;AAAA,IAEJ;AAAA,EACJ;AACA;AAEA,SAASK,GAAkBN,GAAM;AAC/B,SAAO,GAAGA,EAAK,KAAK;AACtB;AASO,SAASO,GAAgBC,GAAWzX,GAAM;AAC/C,SAAI,CAACyX,KAAa,CAACzX,KAAQ,CAACA,EAAK,QAAc,OACxCyX,EAAU,QAAQzX,EAAK,KAAK;AACrC;AAuBO,SAAS0X,GAAqB,EAAE,WAAAD,GAAW,YAAAE,EAAU,IAAK,CAAA,GAAI;AACnE,QAAMC,IAAS,OAAOD,KAAe,aAAaA,IAAaJ;AAE/D,SAAO,CAAClB,MAAY;AAClB,QAAI,CAACoB,EAAW,QAAO;AACvB,UAAMxgB,IAAQof,EAAQ,YAAY,iBAAiB;AACnD,QAAI,CAACpf,EAAO,QAAO;AAEnB,UAAMsf,IAAQtf,EAAM,KAAK,MAAM,CAAC,GAE1BW,IADU6f,EAAU,OAAOlB,CAAK,EACd,IAAI,CAACU,OAAU;AAAA,MACrC,OAAOA,EAAK;AAAA,MACZ,QAAQA,EAAK,QAAQ,SAAS,YAAYA,EAAK,QAAQ,KAAK,IAAI,CAAC,KAAK;AAAA,MACtE,OAAOW,EAAOX,CAAI;AAAA,MAClB,MAAM;AAAA,IACZ,EAAM;AAEF,WAAO;AAAA,MACL,MAAMhgB,EAAM,OAAO;AAAA,MACnB,IAAIA,EAAM;AAAA,MACV,SAAAW;AAAA,MACA,UAAU;AAAA,IAChB;AAAA,EACE;AACF;ACzHA,MAAMigB,KAAgB/G,EAAW,UAAU;AAAA,EACzC,2BAA2B;AAAA,IACzB,UAAU;AAAA,IACV,KAAK;AAAA,IACL,OAAO;AAAA,IACP,QAAQ;AAAA,EACZ;AAAA,EACE,yBAAyB;AAAA,IACvB,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,OAAO;AAAA,IACP,YAAY;AAAA,EAChB;AAAA,EACE,+BAA+B;AAAA,IAC7B,YAAY;AAAA,EAChB;AAAA,EACE,0BAA0B;AAAA,IACxB,UAAU;AAAA,IACV,KAAK;AAAA,IACL,OAAO;AAAA,IACP,WAAW;AAAA,IACX,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,cAAc;AAAA,IACd,WAAW;AAAA,IACX,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,UAAU;AAAA,EACd;AAAA,EACE,sBAAsB;AAAA,IACpB,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,KAAK;AAAA,IACL,OAAO;AAAA,IACP,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,OAAO;AAAA,IACP,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,YAAY;AAAA,EAChB;AAAA,EACE,4BAA4B;AAAA,IAC1B,YAAY;AAAA,EAChB;AAAA,EACE,uBAAuB;AAAA,IACrB,OAAO;AAAA,IACP,WAAW;AAAA,IACX,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,OAAO;AAAA,EACX;AAAA;AAAA,EAEE,+BAA+B;AAAA,IAC7B,YAAY;AAAA,IACZ,OAAO;AAAA,EACX;AAAA,EACE,qCAAqC;AAAA,IACnC,YAAY;AAAA,EAChB;AAAA,EACE,gCAAgC;AAAA,IAC9B,YAAY;AAAA,IACZ,WAAW;AAAA,EACf;AAAA,EACE,4BAA4B;AAAA,IAC1B,OAAO;AAAA,EACX;AAAA,EACE,kCAAkC;AAAA,IAChC,YAAY;AAAA,EAChB;AAAA,EACE,6BAA6B;AAAA,IAC3B,OAAO;AAAA,EACX;AACA,CAAC;AAYM,SAASgH,GAASlgB,IAAU,IAAI;AACrC,QAAMmgB,IAAQngB,EAAQ,SAAS,CAAA;AAkH/B,SAAO,CAhHQ+N,EAAW,UAAU,MAAM;AAAA,IACxC,YAAYvG,GAAM;AAChB,WAAK,OAAOA,GACZ,KAAK,OAAO,IAGZ,KAAK,YAAY,SAAS,cAAc,KAAK,GAC7C,KAAK,UAAU,YAAY,0BAC3B,OAAO,OAAO,KAAK,UAAU,OAAO;AAAA,QAClC,UAAU;AAAA,QACV,KAAK;AAAA,QACL,OAAO;AAAA,QACP,QAAQ;AAAA,MAChB,CAAO,GAGD,KAAK,UAAU,SAAS,cAAc,QAAQ,GAC9C,KAAK,QAAQ,YAAY,wBACzB,KAAK,QAAQ,cAAc,KAC3B,KAAK,QAAQ,QAAQ,gBACrB,KAAK,QAAQ,iBAAiB,SAAS,CAACK,MAAM;AAC5C,QAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjB,KAAK,OAAM;AAAA,MACb,CAAC,GACD,KAAK,UAAU,YAAY,KAAK,OAAO,GAGvC,KAAK,WAAW,SAAS,cAAc,KAAK,GAC5C,KAAK,SAAS,YAAY,yBAC1B,KAAK,SAAS,MAAM,UAAU,QAC9B,KAAK,UAAU,YAAY,KAAK,QAAQ,GAGxC,KAAK,WAAW,CAAA;AAChB,iBAAWuY,KAAQD,GAAO;AACxB,cAAM5G,IAAM,SAAS,cAAc,QAAQ;AAC3C,QAAAA,EAAI,YAAY;AAEhB,cAAM8G,IAAQ,SAAS,cAAc,MAAM;AAC3C,QAAAA,EAAM,YAAY,sBAClBA,EAAM,cAAcD,EAAK,YAAYA,EAAK,SAAS5Y,CAAI,IAAI,MAAY,IACvE,KAAK,SAAS,KAAK,EAAE,OAAA6Y,GAAO,MAAAD,EAAI,CAAE;AAElC,cAAMnhB,IAAQ,SAAS,cAAc,MAAM;AAC3C,QAAAA,EAAM,cAAcmhB,EAAK,OAEzB7G,EAAI,YAAY8G,CAAK,GACrB9G,EAAI,YAAYta,CAAK,GAErBsa,EAAI,iBAAiB,SAAS,CAAC1R,MAAM;AACnC,UAAAA,EAAE,eAAc,GAChBA,EAAE,gBAAe,GACjBuY,EAAK,QAAQ5Y,CAAI,GACjB,KAAK,cAAa;AAAA,QACpB,CAAC,GAED,KAAK,SAAS,YAAY+R,CAAG;AAAA,MAC/B;AAGA,WAAK,cAAc,CAAC1R,MAAM;AACxB,QAAI,KAAK,QAAQ,CAAC,KAAK,UAAU,SAASA,EAAE,MAAM,KAChD,KAAK,MAAK;AAAA,MAEd,GACA,KAAK,aAAa,CAACA,MAAM;AACvB,QAAI,KAAK,QAAQA,EAAE,QAAQ,YACzB,KAAK,MAAK;AAAA,MAEd,GACA,SAAS,iBAAiB,SAAS,KAAK,aAAa,EAAI,GACzD,SAAS,iBAAiB,WAAW,KAAK,UAAU,GAGpDL,EAAK,IAAI,YAAY,KAAK,SAAS;AAAA,IACrC;AAAA,IAEA,SAAS;AACP,WAAK,OAAO,KAAK,MAAK,IAAK,KAAK,KAAI;AAAA,IACtC;AAAA,IAEA,OAAO;AACL,WAAK,OAAO,IACZ,KAAK,cAAa,GAClB,KAAK,SAAS,MAAM,UAAU;AAAA,IAChC;AAAA,IAEA,QAAQ;AACN,WAAK,OAAO,IACZ,KAAK,SAAS,MAAM,UAAU;AAAA,IAChC;AAAA,IAEA,gBAAgB;AACd,iBAAW,EAAE,OAAA6Y,GAAO,MAAAD,EAAI,KAAM,KAAK;AACjC,QAAAC,EAAM,cAAcD,EAAK,YAAYA,EAAK,SAAS,KAAK,IAAI,IAAI,MAAY;AAAA,IAEhF;AAAA,IAEA,OAAOpS,GAAQ;AACb,MAAI,KAAK,QACP,KAAK,cAAa;AAAA,IAEtB;AAAA,IAEA,UAAU;AACR,eAAS,oBAAoB,SAAS,KAAK,aAAa,EAAI,GAC5D,SAAS,oBAAoB,WAAW,KAAK,UAAU,GACvD,KAAK,UAAU,OAAM;AAAA,IACvB;AAAA,EACJ,CAAG,GAEeiS,EAAa;AAC/B;AC/KY,MAACK,KAAuBlc,EAAM,OAAO;AAAA,EAC/C,QAAQmc,GAAS;AACf,WAAO;AAAA,MACL,eAAeA,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,iBAAiB5B,GAAG,EAAI;AAAA,MAClE,cAAc2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,gBAAgB5B,GAAG,EAAI;AAAA,MAChE,gBAAgB2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,kBAAkB5B,GAAG,EAAI;AAAA,MACpE,mBAAmB2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,qBAAqB5B,GAAG,EAAK;AAAA,MAC3E,iBAAiB2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,mBAAmB5B,GAAG,MAAS;AAAA,MAC3E,iBAAiB2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,mBAAmB5B,GAAG,EAAK;AAAA,MACvE,YAAY2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,cAAc5B,GAAG,EAAK;AAAA,MAC7D,YAAY2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,cAAc5B,GAAG,MAAS;AAAA,MACjE,iBAAiB2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,mBAAmB5B,GAAG,EAAI;AAAA,MACtE,iBAAiB2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,mBAAmB5B,GAAG,MAAS;AAAA,MAC3E,UAAU2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,YAAY5B,GAAG,EAAK;AAAA,MACzD,YAAY2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,cAAc5B,GAAG,EAAK;AAAA,MAC7D,WAAW2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,aAAa5B,GAAG,EAAK;AAAA,MAC3D,YAAY2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,cAAc5B,GAAG,WAAW;AAAA,MACnE,cAAc2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,gBAAgB5B,GAAG,EAAE;AAAA,MAC9D,SAAS2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,WAAW5B,GAAG,EAAI;AAAA,MACtD,WAAW2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,aAAa5B,GAAG,EAAK;AAAA,MAC3D,WAAW2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,aAAa5B,GAAG,EAAK;AAAA,MAC3D,UAAU2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,YAAY5B,GAAG,MAAS;AAAA,MAC7D,sBAAsB2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,wBAAwB5B,GAAG,MAAS;AAAA,MACrF,iBAAiB2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,mBAAmB5B,GAAG,MAAS;AAAA,MAC3E,iBAAiB2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,mBAAmB5B,GAAG,MAAS;AAAA,MAC3E,OAAO2B,EAAQ,OAAO,CAAC3B,GAAG4B,MAAMA,EAAE,SAAS5B,GAAG,OAAO;AAAA,IAC3D;AAAA,EACE;AACF,CAAC,GAmBK6B,KAAiBpa,EAAY,OAAM,GAMnCqa,KAAgBra,EAAY,OAAM,GAMlCsa,KAAoBta,EAAY,OAAM,GAMtCua,KAAmBva,EAAY,OAAM,GAMrCwa,KAAqBxa,EAAY,OAAM,GAMvCya,KAAqBza,EAAY,OAAM,GAMvC0a,IAAmBxa,EAAW,OAAO;AAAA,EACzC,OAAO7H,GAAO;AAEZ,UAAMiH,IAASjH,EAAM,MAAM4hB,EAAoB;AAC/C,WAAO;AAAA,MACL,OAAO3a,EAAO,SAAS;AAAA,MACvB,MAAMA,EAAO,kBAAkB,KAAQ,WAAW;AAAA,MAClD,UAAUA,EAAO,aAAa;AAAA,MAC9B,YAAYA,EAAO,eAAe;AAAA,MAClC,WAAWA,EAAO,cAAc;AAAA,MAChC,YAAYA,EAAO,cAAc;AAAA,MACjC,cAAcA,EAAO,gBAAgB,OAAOA,EAAO,eAAe;AAAA,MAClE,kBAAkB;AAAA,MAClB,SAASA,EAAO,YAAY;AAAA,MAC5B,WAAWA,EAAO,cAAc;AAAA,MAChC,WAAWA,EAAO,cAAc;AAAA,IACtC;AAAA,EACE;AAAA,EACA,OAAOrJ,GAAOmK,GAAI;AAEhB,eAAWE,KAAUF,EAAG;AACtB,MAAIE,EAAO,GAAG8Z,EAAc,IAC1BnkB,IAAQ,EAAE,GAAGA,GAAO,OAAOqK,EAAO,MAAK,IAC9BA,EAAO,GAAG+Z,EAAa,IAChCpkB,IAAQ,EAAE,GAAGA,GAAO,MAAMqK,EAAO,MAAK,IAC7BA,EAAO,GAAGga,EAAiB,IACpCrkB,IAAQ,EAAE,GAAGA,GAAO,UAAUqK,EAAO,MAAK,IACjCA,EAAO,GAAG4O,CAAmB,IACtCjZ,IAAQ,EAAE,GAAGA,GAAO,YAAYqK,EAAO,MAAK,IACnCA,EAAO,GAAG6O,CAAkB,IACrClZ,IAAQ,EAAE,GAAGA,GAAO,WAAWqK,EAAO,MAAK,IAClCA,EAAO,GAAG8O,EAAmB,IACtCnZ,IAAQ,EAAE,GAAGA,GAAO,YAAYqK,EAAO,MAAK,IACnCA,EAAO,GAAG+O,EAAqB,IACxCpZ,IAAQ,EAAE,GAAGA,GAAO,cAAcqK,EAAO,MAAK,IACrCA,EAAO,GAAG2O,CAAyB,IAC5ChZ,IAAQ,EAAE,GAAGA,GAAO,kBAAkBqK,EAAO,MAAK,IACzCA,EAAO,GAAGia,EAAgB,IACnCtkB,IAAQ,EAAE,GAAGA,GAAO,SAASqK,EAAO,MAAK,IAChCA,EAAO,GAAGka,EAAkB,IACrCvkB,IAAQ,EAAE,GAAGA,GAAO,WAAWqK,EAAO,MAAK,IAClCA,EAAO,GAAGma,EAAkB,MACrCxkB,IAAQ,EAAE,GAAGA,GAAO,WAAWqK,EAAO,MAAK;AAG/C,WAAOrK;AAAA,EACT;AACF,CAAC,GAGK0kB,KAAmB,IAAIC,EAAW,GAClCC,KAAqB,IAAID,EAAW,GACpCE,KAAqB,IAAIF,EAAW,GACpCG,KAA0B,IAAIH,EAAW,GACzCI,KAAsB,IAAIJ,EAAW,GACrCK,KAAwB,IAAIL,EAAW,GACvCM,KAAuB,IAAIN,EAAW,GACtCO,KAAqB,IAAIP,EAAW,GACpCQ,KAAuB,IAAIR,EAAW,GACtCS,KAAuB,IAAIT,EAAW,GAEtCU,KAA4BC,EAAY,kBAAkB,GAAG,CAACnb,MAC9D,CAACA,EAAG,WAAW,YAAY,CAACA,EAAG,cAI/BA,EAAG,WAAW1K,CAAiB,IAC1B0K,IAGF,EAAE,SAAS,GAAE,CACrB,GAMKob,KAAiCD,EAAY,oBAAoB,GAAG,CAACnb,MAAO;AAChF,QAAMqb,IAAU,CAAA;AAChB,MAAIC,IAAkB,MAClBC,IAAiB,MACjBC,IAAkB,MAClBC,IAAoB;AAExB,aAAWvb,KAAUF,EAAG;AACtB,IAAIE,EAAO,GAAG4O,CAAmB,MAAGwM,IAAkBpb,EAAO,QACzDA,EAAO,GAAG6O,CAAkB,MAAGwM,IAAiBrb,EAAO,QACvDA,EAAO,GAAG8O,EAAmB,MAAGwM,IAAkBtb,EAAO,QACzDA,EAAO,GAAG+O,EAAqB,MAAGwM,IAAoBvb,EAAO;AAInE,QAAM7F,IAAU2F,EAAG,WAAW,MAAMsa,CAAgB;AAMpD,MAJIgB,MAAoB,QACtBD,EAAQ,KAAKR,GAAsB,YAAYS,IAAkB9L,KAAmB,CAAA,CAAE,CAAC,GAGrF+L,MAAmB,QAAQC,MAAoB,QAAQC,MAAsB,MAAM;AACrF,UAAMrF,IAAKmF,MAAmB,OAAOA,IAAiBlhB,EAAQ,WACxDc,IAAQqgB,MAAoB,OAAOA,IAAkBnhB,EAAQ,YAC7DkW,IAAYkL,MAAsB,OAAOA,IAAoBphB,EAAQ;AAC3E,IAAAghB,EAAQ,KAAKP,GAAqB,YAAY1E,IAAK9F,GAAsBnV,GAAOoV,CAAS,IAAI,CAAA,CAAE,CAAC;AAAA,EAClG;AAEA,SAAO8K,EAAQ,SAAS,IAAI,EAAE,SAAAA,EAAO,IAAK;AAC5C,CAAC;AAKD,SAASK,GAAkBC,GAAO;AAChC,SAAOA,MAAU,SAAShE,KAAYD;AACxC;AAKA,SAASkE,GAAoBD,GAAOhd,GAAS;AAC3C,SAAKA,IACEgd,MAAU,SAAS9D,KAAmBD,KADxB,CAAA;AAEvB;AAgCO,SAASiE,GAAetiB,IAAU,IAAI;AAC3C,QAAM;AAAA,IACJ,eAAAuiB,IAAgB;AAAA,IAChB,cAAAC,IAAe;AAAA,IACf,gBAAAhP,IAAiB;AAAA,IACjB,OAAA4O,IAAQ;AAAA,IACR,mBAAA/gB,IAAoB;AAAA,IACpB,iBAAAC;AAAA,IACA,iBAAAE,IAAkB;AAAA,IAClB,iBAAA0D,IAAkB;AAAA,IAClB,iBAAAC;AAAA,IACA,YAAAI,IAAa;AAAA,IACb,YAAAC;AAAA,IACA,UAAAid,IAAW;AAAA,IACX,YAAAvG,IAAa;AAAA,IACb,WAAAC,IAAY;AAAA,IACZ,YAAAC,IAAa;AAAA,IACb,cAAAC,IAAe;AAAA,IACf,SAAAqG,IAAU;AAAA,IACV,WAAAC,IAAY;AAAA,IACZ,WAAAtI,IAAY;AAAA,IACZ,UAAAuI;AAAA,IACA,sBAAAC;AAAA,IACA,iBAAAvI;AAAA,IACA,iBAAAwI;AAAA,EACJ,IAAM9iB,GAEE+iB,IAAa;AAAA;AAAA,IAEjBzC,GAAqB,GAAGtgB,CAAO;AAAA;AAAA,IAG/B+gB;AAAA;AAAA,IAGAY;AAAA;AAAA,IAGAE;AAAA,IACAR,GAAoB,GAAGO,EAAY,SAAS,GAAGa,CAAQ,CAAC;AAAA;AAAA,IAGxDO,GAAO;AAAA,IACPnN,GAAO,GAAG,CAAC,GAAGoN,IAAe,GAAGC,IAAe,GAAGC,EAAY,CAAC;AAAA;AAAA,IAG/DC,GAAM;AAAA;AAAA,IAGNC,GAAoB;AAAA,IACpBC,GAAe;AAAA;AAAA,IAGf7kB,GAAQ;AAAA;AAAA,IAGRyf;AAAA;AAAA,IAGA8C,GAAiB,GAAGmB,GAAkBC,CAAK,CAAC;AAAA;AAAA,IAG5CjB,GAAmB,GAAGkB,GAAoBD,GAAO,CAACG,CAAa,CAAC;AAAA;AAAA,IAGhEnB,GAAwB,GAAGmB,IAAgBxM,KAAyB,CAAA,CAAE;AAAA;AAAA,IAGtEuL,GAAsB,GAAGpF,IAAajG,KAAmB,CAAA,CAAE;AAAA;AAAA,IAG3DsL,GAAqB,GAAGpF,IAAYpF,GAAsBqF,GAAYC,CAAY,IAAI,EAAE;AAAA;AAAA,IAGxFmF,GAAmB,GAAGkB,IAAUa,GAAsB,IAAK,CAAA,CAAE;AAAA;AAAA,IAG7D9B,GAAqB,GAAGkB,IAAY7J,KAAiB,CAAA,CAAE;AAAA;AAAA,IAGvDoB,GAAe,GAAG;AAAA,MAChB,UAAU0I,KAAY;AAAA,MACtB,sBAAsB,OAAOC,KAAyB,aAAaA,IAAuB;AAAA,MAC1F,iBAAiB,OAAOvI,KAAoB,aAAaA,IAAkB;AAAA,IACjF,CAAK;AAAA,IACDoH,GAAqB,GAAGrH,IAAYc,KAAiB,CAAA,CAAE;AAAA;AAAA,IAGvDC,GAAqB,GAAG,MAAM,QAAQ0H,CAAe,IAAIA,IAAkB,EAAE;AAAA,IAC7EzH;AAAA;AAAA,IAGAhG,GAAuB,GAAG,EAAE,YAAA6G,GAAY,WAAAC,GAAW,YAAAC,GAAY,cAAAC,GAAc;AAAA,IAC7E1G;AAAA;AAAA,IAGAsG;AAAA;AAAA,IAGA/C,EAAW;AAAA,EACf;AAGE,SAAIqJ,IACFQ,EAAW,KAAK7B,GAAmB,GAAG3N,GAAc;AAAA,IAClD,gBAAAC;AAAA,IACA,mBAAAnS;AAAA,IACA,iBAAAC;AAAA,IACA,iBAAAE;AAAA,IACA,iBAAA0D;AAAA,IACA,iBAAAC;AAAA,IACA,YAAAI;AAAA,IACA,YAAAC;AAAA,EACN,CAAK,CAAC,CAAC,IAEHud,EAAW,KAAK7B,GAAmB,GAAG,CAAA,CAAE,CAAC,GAIvCsB,KACFO,EAAW,KAAKnN,EAAc,GAGzBmN;AACT;AAOO,SAASS,GAAYhc,GAAM;AAChC,QAAMic,IAAejc,EAAK,MAAM,MAAMuZ,CAAgB,GAChD2C,IAAWD,EAAa,UAAU,UAAU,SAAS;AAE3D,SAAAjc,EAAK,SAAS;AAAA,IACZ,SAAS;AAAA,MACPiZ,GAAe,GAAGiD,CAAQ;AAAA,MAC1B1C,GAAiB,YAAYmB,GAAkBuB,CAAQ,CAAC;AAAA,MACxDvC,GAAmB,YAAYkB,GAAoBqB,GAAUD,EAAa,SAAS,KAAK,CAAC;AAAA,IAC/F;AAAA,EACA,CAAG,GAEMC,MAAa;AACtB;AAOO,SAASC,GAAiBnc,GAAM;AACrC,QAAMic,IAAejc,EAAK,MAAM,MAAMuZ,CAAgB,GAChD6C,IAAUH,EAAa,SAAS,WAAW,QAAQ,UACnDI,IAAWD,MAAY,UACvBje,IAAS6B,EAAK,MAAM,MAAM8Y,EAAoB;AAEpD,SAAA9Y,EAAK,SAAS;AAAA,IACZ,SAAS;AAAA,MACPkZ,GAAc,GAAGkD,CAAO;AAAA,MACxB1C,GAAmB,YAAY2C,IAAWtQ,GAAc;AAAA,QACtD,gBAAgB5N,EAAO;AAAA,QACvB,mBAAmBA,EAAO;AAAA,QAC1B,iBAAiBA,EAAO;AAAA,MAChC,CAAO,IAAI,CAAA,CAAE;AAAA,MACPwb,GAAmB,YAAYkB,GAAoBoB,EAAa,OAAO,CAACI,CAAQ,CAAC;AAAA,MACjFzC,GAAwB,YAAYyC,IAAW9N,KAAyB,CAAA,CAAE;AAAA,IAChF;AAAA,EACA,CAAG,GAEM8N;AACT;AAOO,SAASC,GAAetc,GAAM;AAEnC,QAAMuc,IAAc,CADCvc,EAAK,MAAM,MAAMuZ,CAAgB,EACpB;AAElC,SAAAvZ,EAAK,SAAS;AAAA,IACZ,SAAS;AAAA,MACPmZ,GAAkB,GAAGoD,CAAW;AAAA,MAChC1C,GAAoB,YAAYO,EAAY,SAAS,GAAGmC,CAAW,CAAC;AAAA,IAC1E;AAAA,EACA,CAAG,GAEMA;AACT;AAOO,SAASC,GAAYxc,GAAMib,GAAU;AAC1C,EAAAjb,EAAK,SAAS;AAAA,IACZ,SAAS;AAAA,MACPmZ,GAAkB,GAAG8B,CAAQ;AAAA,MAC7BpB,GAAoB,YAAYO,EAAY,SAAS,GAAGa,CAAQ,CAAC;AAAA,IACvE;AAAA,EACA,CAAG;AACH;AAOO,SAASwB,GAAiBzc,GAAM;AAErC,QAAMpC,IAAU,CADKoC,EAAK,MAAM,MAAMuZ,CAAgB,EACxB;AAC9B,SAAAvZ,EAAK,SAAS,EAAE,SAAS+N,EAAoB,GAAGnQ,CAAO,GAAG,GACnDA;AACT;AAOO,SAAS8e,GAAc1c,GAAMpC,GAAS;AAC3C,EAAAoC,EAAK,SAAS,EAAE,SAAS+N,EAAoB,GAAGnQ,CAAO,GAAG;AAC5D;AAOO,SAAS+e,GAAa3c,GAAM;AACjC,SAAOA,EAAK,MAAM,MAAMuZ,CAAgB,EAAE;AAC5C;AAOO,SAASqD,GAAgB5c,GAAM;AAEpC,QAAMpC,IAAU,CADKoC,EAAK,MAAM,MAAMuZ,CAAgB,EACxB;AAC9B,SAAAvZ,EAAK,SAAS,EAAE,SAASgO,EAAmB,GAAGpQ,CAAO,GAAG,GAClDA;AACT;AAOO,SAASif,GAAa7c,GAAMpC,GAAS;AAC1C,EAAAoC,EAAK,SAAS,EAAE,SAASgO,EAAmB,GAAGpQ,CAAO,GAAG;AAC3D;AAOO,SAASkf,GAAY9c,GAAM;AAChC,SAAOA,EAAK,MAAM,MAAMuZ,CAAgB,EAAE;AAC5C;AAOO,SAASwD,GAAc/c,GAAM5F,GAAO;AACzC,EAAA4F,EAAK,SAAS,EAAE,SAASiO,GAAoB,GAAG7T,CAAK,GAAG;AAC1D;AAOO,SAAS4iB,GAAchd,GAAM;AAClC,SAAOA,EAAK,MAAM,MAAMuZ,CAAgB,EAAE;AAC5C;AAOO,SAAS0D,GAAgBjd,GAAMwP,GAAW;AAC/C,EAAAxP,EAAK,SAAS,EAAE,SAASkO,GAAsB,GAAGsB,CAAS,GAAG;AAChE;AAOO,SAAS0N,GAAgBld,GAAM;AACpC,SAAOA,EAAK,MAAM,MAAMuZ,CAAgB,EAAE;AAC5C;AAOO,SAAS4D,GAAend,GAAM;AACnC,QAAMod,IAAIpd,EAAK,MAAM,MAAMuZ,CAAgB;AAC3C,SAAI6D,EAAE,cAAcA,EAAE,YAAkB,SACpCA,EAAE,aAAmB,eACrBA,EAAE,YAAkB,UACjB;AACT;AAOO,SAASC,GAAerd,GAAMkV,GAAM;AACzC,QAAME,IAAKF,MAAS,gBAAgBA,MAAS,QACvCG,IAAKH,MAAS,WAAWA,MAAS;AACxC,EAAAlV,EAAK,SAAS;AAAA,IACZ,SAAS;AAAA,MACP+N,EAAoB,GAAGqH,CAAE;AAAA,MACzBpH,EAAmB,GAAGqH,CAAE;AAAA,IAC9B;AAAA,EACA,CAAG;AACH;AAOO,SAASiI,GAAuBtd,GAAM;AAC3C,QAAMud,IAASvd,EAAK,MAAM,MAAMuZ,CAAgB,EAAE;AAClD,SAAAvZ,EAAK,SAAS,EAAE,SAAS8N,EAA0B,GAAG,CAACyP,CAAM,GAAG,GACzD,CAACA;AACV;AAOO,SAASC,GAAoBxd,GAAMoJ,GAAM;AAC9C,EAAApJ,EAAK,SAAS,EAAE,SAAS8N,EAA0B,GAAG1E,CAAI,GAAG;AAC/D;AAOO,SAASqU,GAAmBzd,GAAM;AACvC,SAAOA,EAAK,MAAM,MAAMuZ,CAAgB,EAAE;AAC5C;AAOO,SAASmE,GAAc1d,GAAM;AAElC,QAAMpC,IAAU,CADKoC,EAAK,MAAM,MAAMuZ,CAAgB,EACxB;AAE9B,SAAAvZ,EAAK,SAAS;AAAA,IACZ,SAAS;AAAA,MACPoZ,GAAiB,GAAGxb,CAAO;AAAA,MAC3Boc,GAAmB,YAAYpc,IAAUme,GAAsB,IAAK,CAAA,CAAE;AAAA,IAC5E;AAAA,EACA,CAAG,GAEMne;AACT;AAOO,SAAS+f,GAAW3d,GAAMpC,GAAS;AACxC,EAAAoC,EAAK,SAAS;AAAA,IACZ,SAAS;AAAA,MACPoZ,GAAiB,GAAGxb,CAAO;AAAA,MAC3Boc,GAAmB,YAAYpc,IAAUme,GAAsB,IAAK,CAAA,CAAE;AAAA,IAC5E;AAAA,EACA,CAAG;AACH;AAOO,SAAS6B,GAAU5d,GAAM;AAC9B,SAAOA,EAAK,MAAM,MAAMuZ,CAAgB,EAAE;AAC5C;AAOO,SAASsE,GAAgB7d,GAAM;AAEpC,QAAMpC,IAAU,CADKoC,EAAK,MAAM,MAAMuZ,CAAgB,EACxB;AAE9B,SAAAvZ,EAAK,SAAS;AAAA,IACZ,SAAS;AAAA,MACPqZ,GAAmB,GAAGzb,CAAO;AAAA,MAC7Bqc,GAAqB,YAAYrc,IAAU0T,KAAiB,CAAA,CAAE;AAAA,IACpE;AAAA,EACA,CAAG,GAEM1T;AACT;AAOO,SAASkgB,GAAa9d,GAAMpC,GAAS;AAC1C,EAAAoC,EAAK,SAAS;AAAA,IACZ,SAAS;AAAA,MACPqZ,GAAmB,GAAGzb,CAAO;AAAA,MAC7Bqc,GAAqB,YAAYrc,IAAU0T,KAAiB,CAAA,CAAE;AAAA,IACpE;AAAA,EACA,CAAG;AACH;AAOO,SAASyM,GAAY/d,GAAM;AAChC,SAAOA,EAAK,MAAM,MAAMuZ,CAAgB,EAAE;AAC5C;AAOO,SAASyE,GAAgBhe,GAAM;AAEpC,QAAMpC,IAAU,CADKoC,EAAK,MAAM,MAAMuZ,CAAgB,EACxB;AAE9B,SAAAvZ,EAAK,SAAS;AAAA,IACZ,SAAS;AAAA,MACPsZ,GAAmB,GAAG1b,CAAO;AAAA,MAC7Bsc,GAAqB,YAAYtc,IAAU+V,KAAiB,CAAA,CAAE;AAAA,IACpE;AAAA,EACA,CAAG,GAEM/V;AACT;AAOO,SAASqgB,GAAaje,GAAMpC,GAAS;AAC1C,EAAAoC,EAAK,SAAS;AAAA,IACZ,SAAS;AAAA,MACPsZ,GAAmB,GAAG1b,CAAO;AAAA,MAC7Bsc,GAAqB,YAAYtc,IAAU+V,KAAiB,CAAA,CAAE;AAAA,IACpE;AAAA,EACA,CAAG;AACH;AAOO,SAASuK,GAAYle,GAAM;AAChC,SAAOA,EAAK,MAAM,MAAMuZ,CAAgB,EAAE;AAC5C;AAOO,SAAS4E,GAAuBne,GAAM;AAC3C,QAAMud,IAASvd,EAAK,MAAM,MAAMmJ,CAAqB;AACrD,SAAAnJ,EAAK,SAAS,EAAE,SAASkJ,EAAkB,GAAG,CAACqU,CAAM,GAAG,GACjD,CAACA;AACV;AAOO,SAASa,GAAoBpe,GAAMoJ,GAAM;AAC9C,EAAApJ,EAAK,SAAS,EAAE,SAASkJ,EAAkB,GAAGE,CAAI,GAAG;AACvD;AAOO,SAASiV,GAAmBre,GAAM;AACvC,SAAOA,EAAK,MAAM,MAAMmJ,CAAqB;AAC/C;AAOO,SAASmV,GAASte,GAAM4a,GAAO;AACpC,QAAMqB,IAAejc,EAAK,MAAM,MAAMuZ,CAAgB;AAEtD,EAAAvZ,EAAK,SAAS;AAAA,IACZ,SAAS;AAAA,MACPiZ,GAAe,GAAG2B,CAAK;AAAA,MACvBpB,GAAiB,YAAYmB,GAAkBC,CAAK,CAAC;AAAA,MACrDjB,GAAmB,YAAYkB,GAAoBD,GAAOqB,EAAa,SAAS,KAAK,CAAC;AAAA,IAC5F;AAAA,EACA,CAAG;AACH;AAOO,SAASsC,GAAQve,GAAMkV,GAAM;AAClC,QAAM+G,IAAejc,EAAK,MAAM,MAAMuZ,CAAgB,GAChD8C,IAAWnH,MAAS,UACpB/W,IAAS6B,EAAK,MAAM,MAAM8Y,EAAoB;AAEpD,EAAA9Y,EAAK,SAAS;AAAA,IACZ,SAAS;AAAA,MACPkZ,GAAc,GAAGhE,CAAI;AAAA,MACrBwE,GAAmB,YAAY2C,IAAWtQ,GAAc;AAAA,QACtD,gBAAgB5N,EAAO;AAAA,QACvB,mBAAmBA,EAAO;AAAA,QAC1B,iBAAiBA,EAAO;AAAA,MAChC,CAAO,IAAI,CAAA,CAAE;AAAA,MACPwb,GAAmB,YAAYkB,GAAoBoB,EAAa,OAAO,CAACI,CAAQ,CAAC;AAAA,MACjFzC,GAAwB,YAAYyC,IAAW9N,KAAyB,CAAA,CAAE;AAAA,IAChF;AAAA,EACA,CAAG;AACH;AAOO,SAASiQ,GAAWxe,GAAM;AAC/B,SAAOA,EAAK,MAAM,MAAMuZ,CAAgB,EAAE;AAC5C;AAOO,SAASkF,GAASze,GAAM;AAC7B,SAAOA,EAAK,MAAM,MAAMuZ,CAAgB,EAAE;AAC5C;AAOO,SAASmF,GAAQ1e,GAAM;AAC5B,SAAOA,EAAK,MAAM,MAAMuZ,CAAgB,EAAE;AAC5C;"}