"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const u=require("@codemirror/view"),g=require("@codemirror/state"),ht=require("@codemirror/lang-markdown"),O=require("@codemirror/commands"),A=require("@codemirror/search"),Xe=require("js-yaml"),kt=require("markdown-it"),gt=require("markdown-it-emoji"),Ye=require("katex"),We=require("@lezer/highlight"),z=require("@codemirror/lang-javascript"),Be=require("@codemirror/lang-python"),bt=require("@codemirror/lang-css"),wt=require("@codemirror/lang-html"),Ct=require("@codemirror/lang-json"),Ge=require("mermaid"),M=g.Annotation.define(),Je=["i","!","?","*",">","<"],xt={i:{emoji:"üß†",label:"Idea",className:"idea"},"!":{emoji:"‚ö†Ô∏è",label:"Urgent",className:"urgent"},"?":{emoji:"‚ùì",label:"Question",className:"question"},"*":{emoji:"‚≠ê",label:"Important",className:"important"},">":{emoji:"‚û°Ô∏è",label:"Forwarded",className:"forwarded"},"<":{emoji:"üìÖ",label:"Scheduled",className:"scheduled"}},Ze="[[",pe="]]";function X(e){return e===e.trim()}function Qe(e){if(!e||!X(e)||e.includes(`
`)||e.includes("[")||e.includes("]"))return null;const t=e.indexOf("|"),n=t===-1?e:e.slice(0,t),o=t===-1?null:e.slice(t+1);if(!n||o!==null&&(!o||!X(o)))return null;const r=n.indexOf("#"),i=r===-1?n:n.slice(0,r),a=r===-1?null:n.slice(r+1);if(!i||!X(i)||a!==null&&(!a||!X(a)))return null;const s=o??a??i;return{raw:`${Ze}${e}${pe}`,title:i,section:a,alias:o,display:s}}function et(e,t,n){const o="`".repeat(n);return e.indexOf(o,t+n)}function yt(e){const t=[];let n=0;for(;n<e.length;){if(e[n]==="`"){let o=1;for(;e[n+o]==="`";)o+=1;const r=et(e,n,o);if(r===-1){n+=o;continue}n=r+o;continue}if(e.startsWith(Ze,n)){const o=e.indexOf(pe,n+2);if(o===-1){n+=2;continue}const r=e.slice(n+2,o),i=Qe(r);if(i){t.push({from:n,to:o+2,meta:i}),n=o+2;continue}n+=2;continue}n+=1}return t}const Pe=new RegExp("(?:^|(?<=\\s))#([a-zA-Z][\\w/-]*)","g");function Lt(e){const t=[],n=[];let o;const r=/`+/g;for(;(o=r.exec(e))!==null;){const s=o[0].length,l=et(e,o.index,s);l!==-1&&(n.push({from:o.index,to:l+s}),r.lastIndex=l+s)}const i=s=>n.some(l=>s>=l.from&&s<l.to);Pe.lastIndex=0;let a;for(;(a=Pe.exec(e))!==null;){const s=a.index+(a[0].startsWith("#")?0:a[0].indexOf("#"));i(s)||t.push({from:s,to:s+1+a[1].length,tag:a[1]})}return t}const W=new kt({html:!1,linkify:!0,breaks:!1,typographer:!1});W.use(gt.full);function St(e){e.inline.ruler.before("link","wikilink",(t,n)=>{if(!t.env||t.env.enableWikiLinks!==!0)return!1;const o=t.pos;if(t.src.charCodeAt(o)!==91||t.src.charCodeAt(o+1)!==91)return!1;const r=t.src.indexOf(pe,o+2);if(r===-1)return!1;const i=t.src.slice(o+2,r),a=Qe(i);if(!a)return!1;if(!n){const s=t.push("wikilink","",0);s.meta=a}return t.pos=r+2,!0}),e.renderer.rules.wikilink=(t,n)=>{const o=t[n].meta||{},r=e.utils.escapeHtml,i=['class="md-wikilink"',`data-wikilink="${r(o.raw||"")}"`,`data-wikilink-title="${r(o.title||"")}"`];o.section&&i.push(`data-wikilink-section="${r(o.section)}"`),o.alias&&i.push(`data-wikilink-alias="${r(o.alias)}"`);const a=r(o.display||o.title||"");return`<span ${i.join(" ")}>${a}</span>`}}const vt=/^#([a-zA-Z][\w/-]*)/;function Tt(e){e.inline.ruler.before("link","tag",(t,n)=>{if(!t.env||t.env.enableTags!==!0)return!1;const o=t.pos;if(t.src.charCodeAt(o)!==35)return!1;if(o>0){const s=t.src.charCodeAt(o-1);if(s!==32&&s!==9&&s!==10&&s!==13)return!1}const i=t.src.slice(o).match(vt);if(!i)return!1;const a=i[1];if(!n){const s=t.push("tag","",0);s.meta={tag:a}}return t.pos=o+1+a.length,!0}),e.renderer.rules.tag=(t,n)=>{const o=t[n].meta||{},r=e.utils.escapeHtml,i=r(o.tag||"");return`<span class="md-tag" data-tag="${i}">#${i}</span>`}}function Et(e){e.inline.ruler.before("escape","katex_inline",(t,n)=>{const o=t.pos;if(t.src.charCodeAt(o)!==36||t.src.charCodeAt(o+1)===36)return!1;let r=o+1;for(;(r=t.src.indexOf("$",r))!==-1&&t.src.charCodeAt(r-1)===92;)r+=1;if(r===-1)return!1;const i=t.src.slice(o+1,r);if(!i||i.includes(`
`))return!1;if(!n){const a=t.push("math_inline","",0);a.content=i}return t.pos=r+1,!0}),e.renderer.rules.math_inline=(t,n)=>{try{return Ye.renderToString(t[n].content,{displayMode:!1,throwOnError:!1})}catch{return t[n].content}}}function Ft(e){e.inline.ruler.before("emphasis","highlight",(t,n)=>{const o=t.pos;if(t.src.charCodeAt(o)!==61||t.src.charCodeAt(o+1)!==61)return!1;let r=o+2;for(;(r=t.src.indexOf("==",r))!==-1&&!(r>o+2);)r+=2;if(r===-1)return!1;const i=t.src.slice(o+2,r);return!i||i.includes(`
`)?!1:(n||(t.push("mark_open","mark",1).attrSet("class","md-highlight"),e.inline.parse(i,e,t.env,t.tokens),t.push("mark_close","mark",-1)),t.pos=r+2,!0)})}function Dt(e){e.inline.ruler.before("emphasis","subscript",(t,n)=>{const o=t.pos;if(t.src.charCodeAt(o)!==126||t.src.charCodeAt(o+1)===126)return!1;let r=o+1;for(;(r=t.src.indexOf("~",r))!==-1;){if(t.src.charCodeAt(r-1)===92){r+=1;continue}if(t.src.charCodeAt(r+1)===126){r+=1;continue}break}if(r===-1)return!1;const i=t.src.slice(o+1,r);return!i||i.includes(`
`)?!1:(n||(t.push("sub_open","sub",1).attrSet("class","md-subscript"),e.inline.parse(i,e,t.env,t.tokens),t.push("sub_close","sub",-1)),t.pos=r+1,!0)})}function Mt(e){e.inline.ruler.before("emphasis","superscript",(t,n)=>{const o=t.pos;if(t.src.charCodeAt(o)!==94||t.src.charCodeAt(o+1)===94)return!1;let r=o+1;for(;(r=t.src.indexOf("^",r))!==-1;){if(t.src.charCodeAt(r-1)===92){r+=1;continue}break}if(r===-1)return!1;const i=t.src.slice(o+1,r);return!i||i.includes(`
`)?!1:(n||(t.push("sup_open","sup",1).attrSet("class","md-superscript"),e.inline.parse(i,e,t.env,t.tokens),t.push("sup_close","sup",-1)),t.pos=r+1,!0)})}function Rt(e){e.inline.ruler.before("link","footnote_ref",(t,n)=>{const o=t.pos;if(t.src.charCodeAt(o)!==91||t.src.charCodeAt(o+1)!==94)return!1;const r=t.src.indexOf("]",o+2);if(r===-1)return!1;const i=t.src.slice(o+2,r);if(!i)return!1;if(!n){const a=t.push("footnote_ref","",0);a.meta={id:i}}return t.pos=r+1,!0}),e.renderer.rules.footnote_ref=(t,n)=>{const o=t[n].meta.id;return`<sup class="footnote-ref"><span class="footnote-link" data-footnote="${o}">[${o}]</span></sup>`}}Et(W);Ft(W);Dt(W);Mt(W);Rt(W);St(W);Tt(W);function Nt(e){try{return Ye.renderToString(e,{displayMode:!0,throwOnError:!1})}catch{return`<span class="math-error">${e}</span>`}}function Wt(e,t,n={}){const o=D(t,n);return`<span class="footnote-def">[${e}]: ${o} <span class="md-footnote-backref-link" data-footnote-ref="${e}" title="Back to reference">‚Ü©</span></span>`}function D(e,t={}){const n={enableWikiLinks:t.enableWikiLinks===!0,enableTags:t.enableTags===!0};return W.renderInline(e,n)}function Bt(e,t,n={}){if(!t.length)return"";const o=t[0].match(/^\[\^([^\]]+)\]:\s*(.*)$/),r=o?o[2]:t[0],i=[],a=D(r,n);i.push(`<div class="md-footnote-line md-footnote-first">[${e}]: ${a}</div>`);for(let s=1;s<t.length;s++){const l=t[s].replace(/^\s{2,}|\t/,""),c=l.trim()?D(l,n):"";i.push(`<div class="md-footnote-line md-footnote-continuation">${c}</div>`)}return i.push(`<div class="md-footnote-backref"><span class="md-footnote-backref-link" data-footnote-ref="${e}" title="Back to reference">‚Ü©</span></div>`),`<div class="md-footnote-block" data-footnote="${e}">${i.join("")}</div>`}function Pt(e,t={}){if(e.length===0)return"";const n=e[0].trim(),o=[];let r=null;for(let s=1;s<e.length;s++){const l=e[s],c=l.match(/^\s*:\s*(.*)$/);if(c){r&&o.push(r),r=[c[1]];continue}if(r){const d=l.replace(/^\s{2,}|\t/,"");r.push(d)}}r&&o.push(r);const i=D(n,t),a=o.map(s=>`<dd>${s.map(c=>D(c,t)).join("<br>")}</dd>`).join("");return`<dl class="md-definition-list"><dt>${i}</dt>${a}</dl>`}function tt(e,t={}){if(!e.trim())return e;const n=t.enableCustomTasks===!0,o=Array.isArray(t.customTaskTypes)?t.customTaskTypes:Je,r=t.customTaskTypeSet??new Set(o),i=t.enableWikiLinks===!0,a={...t,enableWikiLinks:i},s=e.match(/^\[\^([^\]]+)\]:\s*(.*)$/);if(s)return Wt(s[1],s[2],a);const l=e.match(/^(#{1,6})\s+(.*)$/);if(l){const d=l[1].length;let m=l[2],f=null;const p=m.match(/^(.*)\s+(?:\[#([A-Za-z0-9_-]+)\]|\{#([A-Za-z0-9_-]+)\})\s*$/);p&&(m=p[1],f=p[2]||p[3]);const k=f?` id="${f}" data-heading-id="${f}"`:"";return`<span class="md-header md-h${d}"${k}>${D(m,a)}</span>`}if(e.startsWith(">")){const d=e.replace(/^>\s*/,"");return`<span class="md-blockquote">${D(d,a)}</span>`}const c=e.match(/^(\s*)([-*+]|\d+\.)\s+(.*)$/);if(c){const d=c[2],m=c[3],f=m.match(/^\[([ xX])\]\s*(.*)$/);if(f){const p=f[1].toLowerCase()==="x",k=p?"‚úÖ":"‚¨úÔ∏è",h=p?"Completed":"Incomplete";return`<span class="md-list-item md-task-item"><span class="md-list-marker">${d}</span> <span class="md-task-icon md-task-${p?"complete":"incomplete"}" data-task="${p?"x":" "}" role="button" aria-label="${h}" title="${h}">${k}</span> ${D(f[2],a)}</span>`}if(n){const p=m.match(/^\[([!?>i*<])\]\s*(.*)$/);if(p){const k=p[1],h=xt[k];if(h&&r.has(k))return`<span class="md-list-item md-task-item"><span class="md-list-marker">${d}</span> <span class="md-task-icon md-task-${h.className}" data-task="${k}" role="button" aria-label="${h.label}" title="${h.label}">${h.emoji}</span> ${D(p[2],a)}</span>`}}return`<span class="md-list-item"><span class="md-list-marker">${d}</span> ${D(m,a)}</span>`}if(/^(-{3,}|_{3,}|\*{3,})$/.test(e.trim()))return'<hr class="md-hr">';if(e.trim().startsWith("|")&&e.trim().endsWith("|")){const d=e.trim();return/^\|[-:\s|]+\|$/.test(d)&&d.includes("-")?'<span class="md-table-separator"></span>':`<span class="md-table-row">${d.slice(1,-1).split("|").map(p=>p.trim()).map(p=>`<span class="md-table-cell">${D(p,a)}</span>`).join("")}</span>`}return D(e,a)}function It(e,t={}){if(e.length===0)return"";const n=l=>{const c=l.trim();return!c.startsWith("|")||!c.endsWith("|")?null:c.slice(1,-1).split("|").map(d=>d.trim())},o=l=>{const c=l.trim();return/^\|[-:\s|]+\|$/.test(c)&&c.includes("-")};let r=null,i=[],a=!1;for(const l of e){if(o(l)){a=!0;continue}const c=n(l);c&&(!a&&!r?r=c:i.push(c))}let s='<table class="md-table">';if(r){s+="<thead><tr>";for(const l of r)s+=`<th>${D(l,t)}</th>`;s+="</tr></thead>"}if(i.length>0){s+="<tbody>";for(const l of i){s+="<tr>";for(const c of l)s+=`<td>${D(c,t)}</td>`;s+="</tr>"}s+="</tbody>"}return s+="</table>",s}const At={javascript:z.javascript,js:z.javascript,typescript:()=>z.javascript({typescript:!0}),ts:()=>z.javascript({typescript:!0}),jsx:()=>z.javascript({jsx:!0}),tsx:()=>z.javascript({jsx:!0,typescript:!0}),python:Be.python,py:Be.python,css:bt.css,html:wt.html,json:Ct.json};function Y(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Ot(e,t){const n=At[t==null?void 0:t.toLowerCase()];if(!n)return Y(e);const r=n().language.parser.parse(e);let i="",a=0;return We.highlightTree(r,We.classHighlighter,(s,l,c)=>{s>a&&(i+=Y(e.slice(a,s))),i+=`<span class="${c}">${Y(e.slice(s,l))}</span>`,a=l}),a<e.length&&(i+=Y(e.slice(a))),i}const nt=g.Facet.define({combine(e){return e.length>0?e[e.length-1]:!0}}),ue=Je,ot=/^(\s*(?:[-*+]|\d+\.)\s+)\[([ xX!?>i*<])\]/;function $t(e){if(!Array.isArray(e))return[...ue];const t=[],n=new Set;for(const o of e){if(typeof o!="string"||o.length===0)continue;const r=o.toLowerCase();ue.includes(r)&&(n.has(r)||(n.add(r),t.push(r)))}return t}function zt(e){return[" ","x",...e]}function rt(e,t){const n=$t(t);return{enableCustomTasks:e===!0,customTaskTypes:n,customTaskTypeSet:new Set(n),taskCycle:zt(n)}}const Z=g.Facet.define({combine(e){return e.length===0?rt(!1,ue):e[e.length-1]}});function it(e,t,n){const o=e===!0;return{enableWikiLinks:o,renderWikiLinks:o&&t!==!1,onWikiLinkClick:typeof n=="function"?n:null}}const $=g.Facet.define({combine(e){return e.length===0?it(!1,!1,null):e[e.length-1]}});function st(e,t){return{enableTags:e===!0,onTagClick:typeof t=="function"?t:null}}const ee=g.Facet.define({combine(e){return e.length===0?st(!1,null):e[e.length-1]}});function jt(e,t){const n=e.match(ot);if(!n)return null;const o=n[2].toLowerCase();return o===" "||o==="x"||t.enableCustomTasks&&t.customTaskTypeSet.has(o)?o:null}function Ht(e,t){if(!Array.isArray(t)||t.length===0)return e;const n=t.indexOf(e);return n===-1?t[0]:t[(n+1)%t.length]}function qt(e,t){return e.replace(ot,`$1[${t}]`)}function q(e){return{raw:e.getAttribute("data-wikilink")||"",title:e.getAttribute("data-wikilink-title")||"",section:e.getAttribute("data-wikilink-section")||"",alias:e.getAttribute("data-wikilink-alias")||"",display:e.textContent||""}}const he=g.StateEffect.define(),ct=g.StateField.define({create(){return new Set},update(e,t){let n=e;for(const o of t.effects)o.is(he)&&(n=new Set(e),n.has(o.value)?n.delete(o.value):n.add(o.value));if(t.docChanged&&n.size>0){const o=new Set;for(const r of n){const i=t.startState.doc;if(r<=i.lines){const a=i.line(r),s=t.changes.mapPos(a.from),l=t.newDoc.lineAt(s).number,c=t.newDoc.line(l).text;/^#{1,6}\s/.test(c)&&o.add(l)}}n=o}return n}});Ge.initialize({startOnLoad:!1,theme:"base",securityLevel:"loose",themeVariables:{primaryColor:"#f5f5f5",secondaryColor:"#f5f5f5",tertiaryColor:"#f5f5f5",primaryBorderColor:"#ddd",secondaryBorderColor:"#ddd",tertiaryBorderColor:"#ddd",lineColor:"#aaa",edgeLabelBackground:"#fff"}});class Vt extends u.WidgetType{constructor(t,n,o){super(),this.content=t,this.lineFrom=n,this.lineTo=o}toDOM(t){const n=document.createElement("span");n.className="cm-markdown-preview";const o=t.state.facet(Z),r=t.state.facet($),i=t.state.facet(ee);n.innerHTML=tt(this.content,{...o,enableWikiLinks:r.renderWikiLinks,enableTags:i.enableTags});const a=this.lineFrom,s=this.lineTo,l=this.content;return n.addEventListener("mousedown",c=>{const d=c.target.closest("[data-tag]");if(d&&i.onTagClick){c.preventDefault(),c.stopPropagation(),i.onTagClick(d.getAttribute("data-tag"));return}const m=c.target.closest("[data-footnote]");if(m){c.preventDefault(),c.stopPropagation();const w=m.getAttribute("data-footnote"),T=t.state.doc;for(let E=1;E<=T.lines;E++){const R=T.line(E);if(R.text.match(new RegExp(`^\\[\\^${w}\\]:`))){t.dispatch({selection:{anchor:R.from},scrollIntoView:!0}),t.focus();return}}return}const f=c.target.closest("[data-footnote-ref]");if(f){c.preventDefault(),c.stopPropagation();const w=f.getAttribute("data-footnote-ref"),T=t.state.doc;for(let E=1;E<=T.lines;E++){const R=T.line(E);if(R.text.match(new RegExp(`\\[\\^${w}\\](?!:)`))){t.dispatch({selection:{anchor:R.from},scrollIntoView:!0}),t.focus();return}}return}const p=c.target.closest("[data-wikilink]");if(p&&r.onWikiLinkClick){c.preventDefault(),c.stopPropagation(),r.onWikiLinkClick(q(p));return}const k=c.target.closest("a");if(k&&k.href){c.preventDefault(),c.stopPropagation(),window.open(k.href,"_blank","noopener,noreferrer");return}if(c.target.closest('input[type="checkbox"], .md-task-icon')){c.preventDefault(),c.stopPropagation();const w=t.state.facet(Z),T=jt(l,w);if(!T)return;const E=w.enableCustomTasks?Ht(T,w.taskCycle):T==="x"?" ":"x",R=qt(l,E);R!==l&&t.dispatch({changes:{from:a,to:s,insert:R},annotations:M.of(!0)});return}c.preventDefault(),c.stopPropagation();const y=n.getBoundingClientRect(),C=c.clientX-y.left,x=y.width,b=l.length;let S;if(x>0&&b>0){const w=C/x;S=Math.round(w*b),S=Math.max(0,Math.min(S,b))}else S=0;const F=a+S;t.dispatch({selection:{anchor:F},scrollIntoView:!0}),t.focus()}),n}eq(t){return t.content===this.content&&t.lineFrom===this.lineFrom&&t.lineTo===this.lineTo}ignoreEvent(t){return t.type!=="mousedown"}}class _t extends u.WidgetType{constructor(t,n,o,r,i,a,s){super(),this.content=t,this.lineFrom=n,this.lineTo=o,this.lineNumber=r,this.level=i,this.isCollapsed=a,this.hasContent=s}toDOM(t){const n=document.createElement("span");if(n.className="cm-markdown-preview cm-heading-preview",this.hasContent){const c=document.createElement("span");c.className=`cm-collapse-toggle ${this.isCollapsed?"collapsed":"expanded"}`,c.textContent="‚Ä∫",c.title=this.isCollapsed?"Expand":"Collapse";const d=this.lineNumber;c.addEventListener("click",m=>{m.preventDefault(),m.stopPropagation(),m.stopImmediatePropagation(),t.dispatch({effects:he.of(d)})}),c.addEventListener("mousedown",m=>{m.preventDefault(),m.stopPropagation(),m.stopImmediatePropagation()}),n.appendChild(c)}const o=document.createElement("span"),r=t.state.facet(Z),i=t.state.facet($),a=t.state.facet(ee);o.innerHTML=tt(this.content,{...r,enableWikiLinks:i.renderWikiLinks,enableTags:a.enableTags}),n.appendChild(o);const s=this.lineFrom;this.lineTo;const l=this.content;return o.addEventListener("mousedown",c=>{const d=c.target.closest("[data-tag]");if(d&&a.onTagClick){c.preventDefault(),c.stopPropagation(),a.onTagClick(d.getAttribute("data-tag"));return}const m=c.target.closest("[data-wikilink]");if(m&&i.onWikiLinkClick){c.preventDefault(),c.stopPropagation(),i.onWikiLinkClick(q(m));return}const f=c.target.closest("a");if(f&&f.href){c.preventDefault(),c.stopPropagation(),window.open(f.href,"_blank","noopener,noreferrer");return}c.preventDefault(),c.stopPropagation();const p=o.getBoundingClientRect(),k=c.clientX-p.left,h=p.width,y=l.length;let C;if(h>0&&y>0){const b=k/h;C=Math.round(b*y),C=Math.max(0,Math.min(C,y))}else C=0;const x=s+C;t.dispatch({selection:{anchor:x},scrollIntoView:!0}),t.focus()}),n}eq(t){return t.content===this.content&&t.lineFrom===this.lineFrom&&t.lineTo===this.lineTo&&t.isCollapsed===this.isCollapsed&&t.hasContent===this.hasContent}ignoreEvent(t){return t.type!=="mousedown"}}function N(e){const t=new Set;for(const n of e.selection.ranges){const o=e.doc.lineAt(n.from).number,r=e.doc.lineAt(n.to).number;for(let i=o;i<=r;i++)t.add(i)}return t}function Kt(e){if(e.lines<2||e.line(1).text.trim()!=="---")return null;for(let n=2;n<=e.lines;n++){const o=e.line(n).text.trim();if(o==="---"||o==="...")return{start:1,end:n}}return null}function Ut(e){const t=[];let n=!1,o=0,r="";for(let i=1;i<=e.lines;i++){const s=e.line(i).text;s.startsWith("```")&&(n?(t.push({start:o,end:i,language:r}),n=!1,r=""):(n=!0,o=i,r=s.slice(3).trim()))}return n&&t.push({start:o,end:e.lines,language:r}),t}function Xt(e,t){const n=[];let o=null;for(let r=1;r<=e.lines;r++){if(t.has(r)){o!==null&&(o=null);continue}e.line(r).text.trim()==="$$"&&(o===null?o=r:(n.push({start:o,end:r}),o=null))}return n}function Yt(e,t){const n=[];let o=null;for(let r=1;r<=e.lines;r++){if(t.has(r)){o!==null&&(n.push({start:o,end:r-1}),o=null);continue}const a=e.line(r).text.trim();a.startsWith("|")&&a.endsWith("|")?o===null&&(o=r):o!==null&&(n.push({start:o,end:r-1}),o=null)}return o!==null&&n.push({start:o,end:e.lines}),n}function at(e){return/^(\s{2,}|\t)/.test(e)}function Gt(e,t){const n=[];for(let o=1;o<=e.lines;o++){if(t.has(o))continue;const i=e.line(o).text.match(/^\[\^([^\]]+)\]:\s*(.*)$/);if(!i)continue;const a=i[1];let s=o;for(let l=o+1;l<=e.lines&&!t.has(l);l++){const c=e.line(l).text;if(!at(c))break;s=l}n.push({start:o,end:s,id:a}),o=s}return n}function Jt(e,t,n){const o=[],r=a=>/^\s*:\s*/.test(a),i=a=>{if(!a.trim()||/^\s/.test(a)||/^[-*+]\s+/.test(a)||/^\d+\.\s+/.test(a)||/^>/.test(a)||/^#{1,6}\s+/.test(a))return!1;const s=a.trim();return!(s.startsWith("|")&&s.endsWith("|")||/^\[\^([^\]]+)\]:/.test(a))};for(let a=1;a<=e.lines;a++){if(t.has(a)||n.has(a))continue;const s=e.line(a).text;if(!i(s))continue;const l=a+1;if(l>e.lines||t.has(l)||n.has(l))continue;const c=e.line(l).text;if(!r(c))continue;let d=l;for(let m=l+1;m<=e.lines&&!(t.has(m)||n.has(m));m++){const f=e.line(m).text;if(r(f)||at(f)){d=m;continue}break}o.push({start:a,end:d}),a=d}return o}function I(e){const t=new Set;for(const n of e)for(let o=n.start;o<=n.end;o++)t.add(o);return t}function Zt(e,t){const n=[];for(let o=1;o<=e.lines;o++){if(t.has(o))continue;const i=e.line(o).text.match(/^(#{1,6})\s+/);i&&n.push({line:o,level:i[1].length,endLine:e.lines})}for(let o=0;o<n.length;o++){const r=n[o];for(let i=o+1;i<n.length;i++)if(n[i].level<=r.level){r.endLine=n[i].line-1;break}}return n}function Qt(e){const t=new Map;for(const n of e)for(let o=n.line+1;o<=n.endLine;o++)t.has(o)||t.set(o,n.line);return t}const L=g.StateField.define({create(e){return Ie(e.doc)},update(e,t){return t.docChanged?Ie(t.newDoc):e}});function Ie(e){const t=Kt(e),n=t?I([t]):new Set,o=Ut(e),r=I(o),i=Xt(e,r),a=I(i),s=Yt(e,r),l=I(s),c=Gt(e,r),d=I(c),m=Jt(e,r,d),f=I(m),p=o.filter(C=>C.language==="mermaid"),k=I(p),h=Zt(e,r),y=Qt(h);return{frontmatter:t,frontmatterLines:n,codeBlocks:o,codeBlockLines:r,mathBlocks:i,mathBlockLines:a,tables:s,tableLines:l,footnoteBlocks:c,footnoteBlockLines:d,definitionLists:m,definitionListLines:f,mermaidBlocks:p,mermaidBlockLines:k,headings:h,headingMap:y}}class en extends u.WidgetType{constructor(t,n,o){super(),this.content=t,this.mathFrom=n,this.mathTo=o}toDOM(t){const n=document.createElement("div");n.className="cm-math-preview",n.innerHTML=Nt(this.content);const o=this.mathFrom;return n.addEventListener("mousedown",r=>{r.preventDefault(),r.stopPropagation(),t.dispatch({selection:{anchor:o},scrollIntoView:!0}),t.focus()}),n}eq(t){return t.content===this.content}ignoreEvent(t){return t.type!=="mousedown"}}class tn extends u.WidgetType{constructor(t,n,o){super(),this.content=t,this.mermaidFrom=n,this.mermaidTo=o,this.id="mermaid-"+Math.random().toString(36).substr(2,9)}toDOM(t){const n=document.createElement("div");n.className="cm-mermaid-preview";const o=this.mermaidFrom,r=this.content,i=this.id;return(async()=>{try{const{svg:a}=await Ge.render(i,r);n.innerHTML=a}catch(a){n.innerHTML=`<pre class="mermaid-error">${a.message}</pre>`}})(),n.addEventListener("mousedown",a=>{a.preventDefault(),a.stopPropagation(),t.dispatch({selection:{anchor:o},scrollIntoView:!0}),t.focus()}),n}eq(t){return t.content===this.content}ignoreEvent(t){return t.type!=="mousedown"}}class nn extends u.WidgetType{constructor(t,n,o){super(),this.rows=t,this.tableFrom=n,this.tableTo=o}toDOM(t){const n=document.createElement("div");n.className="cm-table-preview";const o=t.state.facet($);n.innerHTML=It(this.rows,{enableWikiLinks:o.renderWikiLinks});const r=this.tableFrom;return n.addEventListener("mousedown",i=>{const a=i.target.closest("[data-wikilink]");if(a&&o.onWikiLinkClick){i.preventDefault(),i.stopPropagation(),o.onWikiLinkClick(q(a));return}i.preventDefault(),i.stopPropagation(),t.dispatch({selection:{anchor:r},scrollIntoView:!0}),t.focus()}),n}eq(t){if(t.rows.length!==this.rows.length)return!1;for(let n=0;n<this.rows.length;n++)if(t.rows[n]!==this.rows[n])return!1;return!0}ignoreEvent(t){return t.type!=="mousedown"}}class on extends u.WidgetType{constructor(t,n,o,r){super(),this.id=t,this.lines=n,this.from=o,this.to=r}toDOM(t){const n=document.createElement("div");n.className="cm-footnote-preview";const o=t.state.facet($);n.innerHTML=Bt(this.id,this.lines,{enableWikiLinks:o.renderWikiLinks});const r=this.from;return n.addEventListener("mousedown",i=>{const a=i.target.closest("[data-wikilink]");if(a&&o.onWikiLinkClick){i.preventDefault(),i.stopPropagation(),o.onWikiLinkClick(q(a));return}const s=i.target.closest("[data-footnote-ref]");if(s){i.preventDefault(),i.stopPropagation();const l=s.getAttribute("data-footnote-ref"),c=t.state.doc;for(let d=1;d<=c.lines;d++){const m=c.line(d);if(m.text.match(new RegExp(`\\[\\^${l}\\](?!:)`))){t.dispatch({selection:{anchor:m.from},scrollIntoView:!0}),t.focus();return}}}i.preventDefault(),i.stopPropagation(),t.dispatch({selection:{anchor:r},scrollIntoView:!0}),t.focus()}),n}eq(t){if(t.id!==this.id||t.lines.length!==this.lines.length)return!1;for(let n=0;n<this.lines.length;n++)if(t.lines[n]!==this.lines[n])return!1;return!0}ignoreEvent(t){return t.type!=="mousedown"}}class rn extends u.WidgetType{constructor(t,n,o){super(),this.lines=t,this.from=n,this.to=o}toDOM(t){const n=document.createElement("div");n.className="cm-definition-list-preview";const o=t.state.facet($);n.innerHTML=Pt(this.lines,{enableWikiLinks:o.renderWikiLinks});const r=this.from;return n.addEventListener("mousedown",i=>{const a=i.target.closest("[data-wikilink]");if(a&&o.onWikiLinkClick){i.preventDefault(),i.stopPropagation(),o.onWikiLinkClick(q(a));return}i.preventDefault(),i.stopPropagation(),t.dispatch({selection:{anchor:r},scrollIntoView:!0}),t.focus()}),n}eq(t){if(t.lines.length!==this.lines.length)return!1;for(let n=0;n<this.lines.length;n++)if(t.lines[n]!==this.lines[n])return!1;return!0}ignoreEvent(t){return t.type!=="mousedown"}}function sn(e,t,n){for(const o of t)if(n.has(o.line)&&e>o.line&&e<=o.endLine)return!0;return!1}function cn(e,t){for(const n of t)if(n.line===e)return n;return null}function Ae(e,t){const{state:n}=e,r=e.hasFocus?N(n):new Set,{frontmatterLines:i,codeBlockLines:a,tableLines:s,mathBlockLines:l,footnoteBlockLines:c,definitionListLines:d,headings:m}=t,f=[],p=n.facet(nt),k=p?n.field(ct):new Set;for(const{from:h,to:y}of e.visibleRanges){const C=n.doc.lineAt(h).number,x=n.doc.lineAt(y).number;for(let b=C;b<=x;b++){if(p&&sn(b,m,k)){const w=n.doc.line(b);f.push(u.Decoration.line({class:"cm-collapsed-line"}).range(w.from));continue}if(i.has(b)||r.has(b)||a.has(b)||s.has(b)||l.has(b)||c.has(b)||d.has(b))continue;const S=n.doc.line(b),F=S.text;if(!lt(F)&&F.trim()){if(p){const w=cn(b,m);if(w){const T=w.endLine>w.line,E=k.has(b);f.push(u.Decoration.replace({widget:new _t(F,S.from,S.to,b,w.level,E,T),inclusive:!1,block:!1}).range(S.from,S.to));continue}}f.push(u.Decoration.replace({widget:new Vt(F,S.from,S.to),inclusive:!1,block:!1}).range(S.from,S.to))}}}return u.Decoration.set(f,!0)}function Oe(e,t){if(!e.state.facet($).enableWikiLinks||!e.hasFocus)return u.Decoration.none;const{state:o}=e,r=N(o),{codeBlockLines:i}=t,a=[];for(const{from:s,to:l}of e.visibleRanges){const c=o.doc.lineAt(s).number,d=o.doc.lineAt(l).number;for(let m=c;m<=d;m++){if(!r.has(m)||i.has(m))continue;const f=o.doc.line(m);if(!f.text.includes("[["))continue;const p=yt(f.text);for(const k of p)a.push(u.Decoration.mark({class:"cm-wikilink"}).range(f.from+k.from,f.from+k.to))}}return u.Decoration.set(a,!0)}const an=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(L);this.decorations=Ae(e,t)}update(e){const t=e.transactions.some(n=>n.effects.some(o=>o.is(he)));if(e.docChanged||e.selectionSet||e.viewportChanged||e.focusChanged||t){const n=e.state.field(L);this.decorations=Ae(e.view,n)}}},{decorations:e=>e.decorations}),ln=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(L);this.decorations=Oe(e,t)}update(e){if(e.docChanged||e.selectionSet||e.viewportChanged||e.focusChanged){const t=e.state.field(L);this.decorations=Oe(e.view,t)}}},{decorations:e=>e.decorations});function $e(e,t){if(!e.state.facet(ee).enableTags||!e.hasFocus)return u.Decoration.none;const{state:o}=e,r=N(o),{codeBlockLines:i}=t,a=[];for(const{from:s,to:l}of e.visibleRanges){const c=o.doc.lineAt(s).number,d=o.doc.lineAt(l).number;for(let m=c;m<=d;m++){if(!r.has(m)||i.has(m))continue;const f=o.doc.line(m);if(!f.text.includes("#"))continue;const p=Lt(f.text);for(const k of p)a.push(u.Decoration.mark({class:"cm-tag-mark"}).range(f.from+k.from,f.from+k.to))}}return u.Decoration.set(a,!0)}const dn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(L);this.decorations=$e(e,t)}update(e){if(e.docChanged||e.selectionSet||e.viewportChanged||e.focusChanged){const t=e.state.field(L);this.decorations=$e(e.view,t)}}},{decorations:e=>e.decorations});class mn extends u.WidgetType{constructor(t,n,o,r){super(),this.content=t,this.language=n,this.lineFrom=o,this.lineTo=r}toDOM(t){const n=document.createElement("span");n.className="cm-highlighted-code",n.innerHTML=Ot(this.content,this.language);const o=this.lineFrom;this.lineTo;const r=this.content;return n.addEventListener("mousedown",i=>{i.preventDefault(),i.stopPropagation();const a=n.getBoundingClientRect(),s=i.clientX-a.left,l=a.width,c=r.length;let d=0;if(l>0&&c>0){const f=s/l;d=Math.round(f*c),d=Math.max(0,Math.min(d,c))}const m=o+d;t.dispatch({selection:{anchor:m},scrollIntoView:!0}),t.focus()}),n}eq(t){return t.content===this.content&&t.language===this.language}ignoreEvent(t){return t.type!=="mousedown"}}function ze(e,t){const{state:n}=e,o=e.hasFocus,r=[],{codeBlocks:i}=t,a=o?N(n):new Set;for(const s of i){if(s.language==="mermaid")continue;let l=!1;for(let d=s.start;d<=s.end;d++)if(a.has(d)){l=!0;break}const c=s.end-s.start>1;for(let d=s.start;d<=s.end;d++){const m=n.doc.line(d),f=d===s.start||d===s.end;if(f&&!l&&c){r.push(u.Decoration.replace({}).range(m.from,m.to));continue}const p=l?"cm-code-block-line cm-code-block-focused":"cm-code-block-line";r.push(u.Decoration.line({class:p}).range(m.from));const k=a.has(d);!f&&!k&&m.text.length>0&&r.push(u.Decoration.replace({widget:new mn(m.text,s.language,m.from,m.to)}).range(m.from,m.to))}}return u.Decoration.set(r,!0)}const fn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(L);this.decorations=ze(e,t)}update(e){if(e.docChanged||e.selectionSet||e.focusChanged){const t=e.state.field(L);this.decorations=ze(e.view,t)}}},{decorations:e=>e.decorations});function je(e,t){const{state:n}=e,o=e.hasFocus,r=[],{tables:i}=t,a=o?N(n):new Set;for(const s of i){let l=!1;for(let c=s.start;c<=s.end;c++)if(a.has(c)){l=!0;break}if(l)for(let c=s.start;c<=s.end;c++){const d=n.doc.line(c);r.push(u.Decoration.line({class:"cm-table-line"}).range(d.from))}else{const c=[];for(let m=s.start;m<=s.end;m++)c.push(n.doc.line(m).text);const d=n.doc.line(s.start);r.push(u.Decoration.replace({widget:new nn(c,d.from,d.to)}).range(d.from,d.to));for(let m=s.start+1;m<=s.end;m++){const f=n.doc.line(m);r.push(u.Decoration.line({class:"cm-hidden-line"}).range(f.from),u.Decoration.replace({}).range(f.from,f.to))}}}return u.Decoration.set(r,!0)}const un=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(L);this.decorations=je(e,t)}update(e){if(e.docChanged||e.selectionSet||e.focusChanged){const t=e.state.field(L);this.decorations=je(e.view,t)}}},{decorations:e=>e.decorations});function He(e,t){const{state:n}=e,o=e.hasFocus,r=[],{footnoteBlocks:i}=t,a=o?N(n):new Set;for(const s of i){let l=!1;for(let c=s.start;c<=s.end;c++)if(a.has(c)){l=!0;break}if(l)for(let c=s.start;c<=s.end;c++){const d=n.doc.line(c);r.push(u.Decoration.line({class:"cm-footnote-line"}).range(d.from))}else{const c=[];for(let m=s.start;m<=s.end;m++)c.push(n.doc.line(m).text);const d=n.doc.line(s.start);r.push(u.Decoration.replace({widget:new on(s.id,c,d.from,d.to)}).range(d.from,d.to));for(let m=s.start+1;m<=s.end;m++){const f=n.doc.line(m);r.push(u.Decoration.line({class:"cm-hidden-line"}).range(f.from),u.Decoration.replace({}).range(f.from,f.to))}}}return u.Decoration.set(r,!0)}const pn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(L);this.decorations=He(e,t)}update(e){if(e.docChanged||e.selectionSet||e.focusChanged){const t=e.state.field(L);this.decorations=He(e.view,t)}}},{decorations:e=>e.decorations});function qe(e,t){const{state:n}=e,o=e.hasFocus,r=[],{definitionLists:i}=t,a=o?N(n):new Set;for(const s of i){let l=!1;for(let c=s.start;c<=s.end;c++)if(a.has(c)){l=!0;break}if(l)for(let c=s.start;c<=s.end;c++){const d=n.doc.line(c);r.push(u.Decoration.line({class:"cm-definition-list-line"}).range(d.from))}else{const c=[];for(let m=s.start;m<=s.end;m++)c.push(n.doc.line(m).text);const d=n.doc.line(s.start);r.push(u.Decoration.replace({widget:new rn(c,d.from,d.to)}).range(d.from,d.to));for(let m=s.start+1;m<=s.end;m++){const f=n.doc.line(m);r.push(u.Decoration.line({class:"cm-hidden-line"}).range(f.from),u.Decoration.replace({}).range(f.from,f.to))}}}return u.Decoration.set(r,!0)}const hn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(L);this.decorations=qe(e,t)}update(e){if(e.docChanged||e.selectionSet||e.focusChanged){const t=e.state.field(L);this.decorations=qe(e.view,t)}}},{decorations:e=>e.decorations});function Ve(e,t){const{state:n}=e,o=e.hasFocus,r=[],{mathBlocks:i}=t,a=o?N(n):new Set;for(const s of i){let l=!1;for(let c=s.start;c<=s.end;c++)if(a.has(c)){l=!0;break}if(l)for(let c=s.start;c<=s.end;c++){const d=n.doc.line(c);r.push(u.Decoration.line({class:"cm-math-block-line"}).range(d.from))}else{const c=[];for(let f=s.start+1;f<s.end;f++)c.push(n.doc.line(f).text);const d=c.join(`
`),m=n.doc.line(s.start);r.push(u.Decoration.replace({widget:new en(d,m.from,m.to)}).range(m.from,m.to));for(let f=s.start+1;f<=s.end;f++){const p=n.doc.line(f);r.push(u.Decoration.line({class:"cm-hidden-line"}).range(p.from),u.Decoration.replace({}).range(p.from,p.to))}}}return u.Decoration.set(r,!0)}const kn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(L);this.decorations=Ve(e,t)}update(e){if(e.docChanged||e.selectionSet||e.focusChanged){const t=e.state.field(L);this.decorations=Ve(e.view,t)}}},{decorations:e=>e.decorations});function _e(e,t){const{state:n}=e,o=e.hasFocus,r=[],{mermaidBlocks:i}=t,a=o?N(n):new Set;for(const s of i){let l=!1;for(let c=s.start;c<=s.end;c++)if(a.has(c)){l=!0;break}if(l)for(let c=s.start;c<=s.end;c++){const d=n.doc.line(c);r.push(u.Decoration.line({class:"cm-mermaid-block-line"}).range(d.from))}else{const c=[];for(let f=s.start+1;f<s.end;f++)c.push(n.doc.line(f).text);const d=c.join(`
`),m=n.doc.line(s.start);r.push(u.Decoration.replace({widget:new tn(d,m.from,m.to)}).range(m.from,m.to));for(let f=s.start+1;f<=s.end;f++){const p=n.doc.line(f);r.push(u.Decoration.line({class:"cm-hidden-line"}).range(p.from),u.Decoration.replace({}).range(p.from,p.to))}}}return u.Decoration.set(r,!0)}const gn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(L);this.decorations=_e(e,t)}update(e){if(e.docChanged||e.selectionSet||e.focusChanged){const t=e.state.field(L);this.decorations=_e(e.view,t)}}},{decorations:e=>e.decorations}),bn=/^!\[([^\]]*)\]\(([^)]+)\)$/;function lt(e){const t=e.trim().match(bn);return t?{alt:t[1],url:t[2].trim()}:null}class wn extends u.WidgetType{constructor(t,n,o,r){super(),this.alt=t,this.url=n,this.lineFrom=o,this.lineTo=r}toDOM(t){const n=document.createElement("div");n.className="cm-image-preview";const o=document.createElement("img");if(o.src=this.url,o.alt=this.alt,o.loading="lazy",o.addEventListener("error",()=>{n.textContent="";const i=document.createElement("div");i.className="cm-image-error",i.textContent=`Image not found: ${this.url}`,n.appendChild(i)}),n.appendChild(o),this.alt){const i=document.createElement("span");i.className="cm-image-alt",i.textContent=this.alt,n.appendChild(i)}const r=this.lineFrom;return n.addEventListener("mousedown",i=>{i.preventDefault(),i.stopPropagation(),t.dispatch({selection:{anchor:r},scrollIntoView:!0}),t.focus()}),n}eq(t){return t.url===this.url&&t.alt===this.alt}ignoreEvent(t){return t.type!=="mousedown"}}function Ke(e,t){const{state:n}=e,o=e.hasFocus,r=[],i=o?N(n):new Set,{frontmatterLines:a,codeBlockLines:s,tableLines:l,mathBlockLines:c,footnoteBlockLines:d,definitionListLines:m,mermaidBlockLines:f}=t;for(const{from:p,to:k}of e.visibleRanges){const h=n.doc.lineAt(p).number,y=n.doc.lineAt(k).number;for(let C=h;C<=y;C++){if(i.has(C)||a.has(C)||s.has(C)||l.has(C)||c.has(C)||d.has(C)||m.has(C)||f.has(C))continue;const x=n.doc.line(C),b=lt(x.text);b&&r.push(u.Decoration.replace({widget:new wn(b.alt,b.url,x.from,x.to)}).range(x.from,x.to))}}return u.Decoration.set(r,!0)}const Cn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(L);this.decorations=Ke(e,t)}update(e){if(e.docChanged||e.selectionSet||e.viewportChanged||e.focusChanged){const t=e.state.field(L);this.decorations=Ke(e.view,t)}}},{decorations:e=>e.decorations}),j=g.StateEffect.define(),H=g.StateField.define({create(){return!1},update(e,t){for(const n of t.effects)if(n.is(j))return n.value;return e}});function B(e){return!e||typeof e!="object"||Object.keys(e).length===0?"":Xe.dump(e,{indent:2,lineWidth:-1,noRefs:!0,quotingType:'"',forceQuotes:!1}).trimEnd()}function xn(e,t,n,o,r,i){const a=document.createElement("span");if(a.className="cm-frontmatter-value",typeof t=="boolean"){const l=document.createElement("input");return l.type="checkbox",l.checked=t,l.className="cm-frontmatter-checkbox",l.addEventListener("change",c=>{c.stopPropagation();const d={...n,[e]:l.checked},m=B(d);i.dispatch({changes:{from:o,to:r,insert:m},annotations:M.of(!0)})}),a.appendChild(l),a}if(Array.isArray(t)){for(let c=0;c<t.length;c++){const d=document.createElement("span");d.className="cm-frontmatter-tag",d.textContent=String(t[c]),d.contentEditable="true",d.spellcheck=!1;const m=c;d.addEventListener("blur",f=>{f.stopPropagation();const p=[...t],k=d.textContent.trim();k===""?p.splice(m,1):p[m]=k;const h={...n,[e]:p},y=B(h);i.dispatch({changes:{from:o,to:r,insert:y},annotations:M.of(!0)})}),d.addEventListener("keydown",f=>{f.key==="Enter"&&(f.preventDefault(),d.blur()),f.stopPropagation()}),d.addEventListener("mousedown",f=>f.stopPropagation()),a.appendChild(d)}const l=document.createElement("span");return l.className="cm-frontmatter-add-tag",l.textContent="+",l.title="Add item",l.addEventListener("mousedown",c=>{c.preventDefault(),c.stopPropagation()}),l.addEventListener("click",c=>{c.stopPropagation();const d=[...t,"new"],m={...n,[e]:d},f=B(m);i.dispatch({changes:{from:o,to:r,insert:f},annotations:M.of(!0)})}),a.appendChild(l),a}if(t!==null&&typeof t=="object"){const l=document.createElement("input");return l.type="text",l.className="cm-frontmatter-input",l.value=JSON.stringify(t),l.addEventListener("blur",c=>{c.stopPropagation();try{const d=JSON.parse(l.value),m={...n,[e]:d},f=B(m);i.dispatch({changes:{from:o,to:r,insert:f},annotations:M.of(!0)})}catch{l.value=JSON.stringify(t)}}),l.addEventListener("keydown",c=>{c.key==="Enter"&&(c.preventDefault(),l.blur()),c.stopPropagation()}),l.addEventListener("mousedown",c=>c.stopPropagation()),a.appendChild(l),a}const s=document.createElement("input");return s.type="text",s.className="cm-frontmatter-input",s.value=t===null?"":String(t),s.placeholder=t===null?"empty":"",s.addEventListener("blur",l=>{l.stopPropagation();const c=s.value;let d;c===""||c==="null"?d=null:c==="true"?d=!0:c==="false"?d=!1:!isNaN(c)&&c.trim()!==""?d=Number(c):d=c;const m={...n,[e]:d},f=B(m);i.dispatch({changes:{from:o,to:r,insert:f},annotations:M.of(!0)})}),s.addEventListener("keydown",l=>{l.key==="Enter"&&(l.preventDefault(),s.blur()),l.stopPropagation()}),s.addEventListener("mousedown",l=>l.stopPropagation()),a.appendChild(s),a}function yn(e,t,n,o,r,i={}){const{knownKeys:a=[]}=i,s=document.createElement("div");s.className="cm-frontmatter-preview";let l;try{l=Xe.load(e)}catch{const h=document.createElement("div");return h.className="cm-frontmatter-error",h.textContent="Invalid YAML frontmatter ‚Äî click to edit",s.appendChild(h),{dom:s,error:!0}}(!l||typeof l!="object")&&(l={});const c=document.createElement("table");c.className="cm-frontmatter-table";const d="cm-fm-keys-"+Math.random().toString(36).slice(2,8),m=document.createElement("datalist");m.id=d;const f=new Set(Object.keys(l));for(const h of a)if(!f.has(h)){const y=document.createElement("option");y.value=h,m.appendChild(y)}s.appendChild(m);const p=Object.keys(l);for(const h of p){const y=document.createElement("tr"),C=document.createElement("td");C.className="cm-frontmatter-key";const x=document.createElement("input");x.type="text",x.className="cm-frontmatter-key-input",x.value=h,x.size=Math.max(h.length,1),x.spellcheck=!1,x.setAttribute("list",d),x.addEventListener("blur",w=>{w.stopPropagation();const T=x.value.trim();if(T===""||T===h){x.value=h;return}const E={};for(const U of Object.keys(l))U===h?E[T]=l[U]:E[U]=l[U];const R=B(E);r.dispatch({changes:{from:t,to:n,insert:R},annotations:M.of(!0)})}),x.addEventListener("keydown",w=>{w.key==="Enter"&&(w.preventDefault(),x.blur()),w.stopPropagation()}),x.addEventListener("mousedown",w=>w.stopPropagation()),C.appendChild(x),y.appendChild(C);const b=document.createElement("td");b.className="cm-frontmatter-value-cell",b.appendChild(xn(h,l[h],l,t,n,r)),y.appendChild(b);const S=document.createElement("td");S.className="cm-frontmatter-action-cell";const F=document.createElement("span");F.className="cm-frontmatter-delete",F.textContent="√ó",F.title="Remove property",F.addEventListener("mousedown",w=>{w.preventDefault(),w.stopPropagation()}),F.addEventListener("click",w=>{w.stopPropagation();const T={...l};delete T[h];const E=B(T);r.dispatch({changes:{from:t,to:n,insert:E},annotations:M.of(!0)})}),S.appendChild(F),y.appendChild(S),c.appendChild(y)}s.appendChild(c);const k=document.createElement("div");return k.className="cm-frontmatter-add",k.textContent="+ Add property",k.addEventListener("mousedown",h=>{h.preventDefault(),h.stopPropagation()}),k.addEventListener("click",h=>{h.stopPropagation();let y="property",C=1;for(;l[y]!==void 0;)y=`property${C}`,C++;const x={...l,[y]:""},b=B(x);r.dispatch({changes:{from:t,to:n,insert:b},annotations:M.of(!0)})}),s.appendChild(k),{dom:s,error:!1}}function Ue(e,t){const{state:n}=e,{frontmatter:o}=t;if(!o)return u.Decoration.none;const r=[],i=n.doc.line(o.start);r.push(u.Decoration.replace({}).range(i.from,i.to)),r.push(u.Decoration.line({class:"cm-hidden-line"}).range(i.from));for(let a=o.start+1;a<=o.end;a++){const s=n.doc.line(a);r.push(u.Decoration.line({class:"cm-hidden-line"}).range(s.from),u.Decoration.replace({}).range(s.from,s.to))}return u.Decoration.set(r,!0)}const Ln=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(L);this.decorations=Ue(e,t)}update(e){if(e.docChanged){const t=e.state.field(L);this.decorations=Ue(e.view,t)}}},{decorations:e=>e.decorations});function te(e={}){const{enableCollapse:t=!0,enableCustomTasks:n=!1,customTaskTypes:o,enableWikiLinks:r=!1,renderWikiLinks:i=!0,onWikiLinkClick:a,enableTags:s=!1,onTagClick:l}=e,c=rt(n,o),d=it(r,i,a),m=st(s,l);return[nt.of(t),Z.of(c),$.of(d),ee.of(m),ct,H,L,Ln,Cn,an,ln,dn,fn,un,pn,hn,kn,gn]}function Sn(e){requestAnimationFrame(()=>{const t=e.dom.querySelector(".cm-search"),n=t==null?void 0:t.querySelector('input[name="replace"]');n instanceof HTMLInputElement&&(n.focus(),n.select())})}function G(e,t,n){const{from:o,to:r}=e.state.selection.main,i=e.state.sliceDoc(o,r);e.dispatch({changes:{from:o,to:r,insert:t+i+n},selection:{anchor:o+t.length,head:r+t.length}})}function vn(e,t){const{from:n}=e.state.selection.main,o=e.state.doc.lineAt(n);e.dispatch({changes:{from:o.from,to:o.from,insert:t}})}function ae(e,t){const{from:n}=e.state.selection.main,o=e.state.doc.lineAt(n),i=o.text.match(/^(#{1,6})\s/),a="#".repeat(t)+" ";if(i){const s=i[0];s===a?e.dispatch({changes:{from:o.from,to:o.from+s.length,insert:""}}):e.dispatch({changes:{from:o.from,to:o.from+s.length,insert:a}})}else e.dispatch({changes:{from:o.from,to:o.from,insert:a}})}function le(e,t){const{from:n}=e.state.selection.main,o=e.state.doc.lineAt(n),r=o.text,i=r.match(/^(-|\*|\+)\s(?!\[[ xX]\])/),a=r.match(/^(\d+)\.\s/),s=r.match(/^(-|\*|\+)\s\[[ xX]\]\s/),c={bullet:"- ",numbered:"1. ",task:"- [ ] "}[t];let d=null,m=null;s?(d=s[0],m="task"):a?(d=a[0],m="numbered"):i&&(d=i[0],m="bullet"),d?m===t?e.dispatch({changes:{from:o.from,to:o.from+d.length,insert:""}}):e.dispatch({changes:{from:o.from,to:o.from+d.length,insert:c}}):e.dispatch({changes:{from:o.from,to:o.from,insert:c}})}function Tn(e){const{from:t,to:n}=e.state.selection.main;return t!==n?e.state.sliceDoc(t,n):null}const P={undo(e){O.undo(e)},redo(e){O.redo(e)},search(e){A.openSearchPanel(e)},replace(e){A.openSearchPanel(e),Sn(e)},selectNextOccurrence(e){A.selectNextOccurrence(e)},selectAllOccurrences(e){e.state.selection.main.empty&&A.selectNextOccurrence(e),A.selectSelectionMatches(e)},bold(e){G(e,"**","**")},italic(e){G(e,"_","_")},strikethrough(e){G(e,"~~","~~")},h1(e){ae(e,1)},h2(e){ae(e,2)},h3(e){ae(e,3)},link(e){const t=Tn(e),n="https://example.com";if(t){const{from:o,to:r}=e.state.selection.main;e.dispatch({changes:{from:o,to:r,insert:`[${t}](${n})`},selection:{anchor:o+t.length+3,head:o+t.length+3+n.length}})}else{const{from:o}=e.state.selection.main;e.dispatch({changes:{from:o,insert:`[link text](${n})`},selection:{anchor:o+1,head:o+10}})}},image(e){const{from:t}=e.state.selection.main;e.dispatch({changes:{from:t,insert:"![alt text](https://placehold.co/400x200)"},selection:{anchor:t+2,head:t+10}})},bulletList(e){le(e,"bullet")},numberedList(e){le(e,"numbered")},taskList(e){le(e,"task")},inlineCode(e){G(e,"`","`")},codeBlock(e){const{from:t,to:n}=e.state.selection.main,o=e.state.sliceDoc(t,n),i=o?"```\n"+o+"\n```":"```"+`javascript
function hello() {
  alert("hello world");
}
hello();`+"\n```";e.dispatch({changes:{from:t,to:n,insert:i},selection:{anchor:t+4}})},hr(e){const{from:t}=e.state.selection.main,n=e.state.doc.lineAt(t);e.dispatch({changes:{from:n.to,insert:`

---
`}})},quote(e){vn(e,"> ")},table(e){const{from:t}=e.state.selection.main,n=e.state.doc.lineAt(t);e.dispatch({changes:{from:n.to,insert:`

`+`| Column 1 | Column 2 | Column 3 |
|----------|----------|----------|
| Cell 1   | Cell 2   | Cell 3   |
| Cell 4   | Cell 5   | Cell 6   |`+`
`},selection:{anchor:n.to+4}})},diagram(e){const{from:t}=e.state.selection.main,n=e.state.doc.lineAt(t);e.dispatch({changes:{from:n.to,insert:`

`+"```mermaid\nflowchart LR\n    A[Start] --> B[Process]\n    B --> C{Decision}\n    C -->|Yes| D[Result 1]\n    C -->|No| E[Result 2]\n```"+`
`},selection:{anchor:n.to+4}})},emoji(e){const{from:t}=e.state.selection.main;e.dispatch({changes:{from:t,insert:":smile:"},selection:{anchor:t+1,head:t+6}})}},dt=u.keymap.of([{key:"Mod-b",run:e=>(P.bold(e),!0)},{key:"Mod-i",run:e=>(P.italic(e),!0)},{key:"Mod-k",run:e=>(P.link(e),!0)},{key:"Mod-`",run:e=>(P.inlineCode(e),!0)},{key:"Mod-Shift-`",run:e=>(P.codeBlock(e),!0)}]),En=u.Decoration.line({class:"cm-selectedLine"}),ne=u.ViewPlugin.fromClass(class{constructor(e){this.decorations=this.buildDecorations(e)}update(e){(e.docChanged||e.selectionSet||e.focusChanged)&&(this.decorations=this.buildDecorations(e.view))}buildDecorations(e){if(!e.hasFocus)return u.Decoration.none;const t=[],n=new Set,o=e.state;for(const r of o.selection.ranges){const i=o.doc.lineAt(r.from).number,a=o.doc.lineAt(r.to).number;for(let s=i;s<=a;s++)n.add(s)}for(const r of n){const i=o.doc.line(r);t.push(En.range(i.from))}return u.Decoration.set(t,!0)}},{decorations:e=>e.decorations}),oe=u.ViewPlugin.fromClass(class{constructor(e){this.view=e}update(e){!e.selectionSet&&!e.docChanged&&!e.geometryChanged||this.view.requestMeasure({key:"typewriter-scroll",read:t=>{const n=t.state.selection.main.head,o=t.coordsAtPos(n);if(!o)return null;const r=t.scrollDOM.getBoundingClientRect(),i=r.top+r.height/2,a=o.top-i;return Math.abs(a)<2?null:a},write:(t,n)=>{t!=null&&n.scrollDOM.scrollBy({top:t,behavior:"auto"})}})}}),Fn=u.Decoration.line({class:"cm-unfocused-line"});function Dn(e,t){const n=e.lineAt(t);let o=n.number,r=n.number;for(;o>1&&e.line(o-1).text.trim()!=="";)o--;for(;r<e.lines&&e.line(r+1).text.trim()!=="";)r++;return{from:o,to:r}}const re=u.ViewPlugin.fromClass(class{constructor(e){this.decorations=this.buildDecorations(e)}update(e){(e.selectionSet||e.docChanged||e.focusChanged)&&(this.decorations=this.buildDecorations(e.view))}buildDecorations(e){if(!e.hasFocus)return g.RangeSet.empty;const t=e.state.doc,n=new Set;for(const r of e.state.selection.ranges){const i=Dn(t,r.head);for(let a=i.from;a<=i.to;a++)n.add(a)}const o=[];for(let r=1;r<=t.lines;r++)if(!n.has(r)){const i=t.line(r);o.push(Fn.range(i.from))}return g.RangeSet.of(o)}},{decorations:e=>e.decorations});function Mn(e,t){const n=e.toString(),o=n.split(/\s+/).filter(d=>d.length>0).length,r=n.length,i=n.replace(/\s/g,"").length,a=Math.max(1,Math.ceil(o/238));let s=0,l=0;const c=t&&!t.main.empty;if(c){const d=e.sliceString(t.main.from,t.main.to);s=d.split(/\s+/).filter(m=>m.length>0).length,l=d.length}return{words:o,chars:r,charsNoSpaces:i,readingTime:a,selWords:s,selChars:l,hasSelection:c}}function Rn(e){return e<1?"< 1 min read":e===1?"1 min read":`${e} min read`}function de(e,t){const n=document.createElement("span");n.className="cm-word-count-stat";const o=document.createElement("span");o.className="cm-word-count-value",o.textContent=t;const r=document.createElement("span");return r.className="cm-word-count-label",r.textContent=` ${e}`,n.appendChild(o),n.appendChild(r),n}function me(){const e=document.createElement("span");return e.className="cm-word-count-divider",e}function Nn(e){const t=document.createElement("div");t.className="cm-word-count-panel";function n(o){const r=Mn(o.doc,o.selection);if(t.textContent="",t.appendChild(de("words",r.words.toLocaleString())),t.appendChild(me()),t.appendChild(de("characters",r.chars.toLocaleString())),t.appendChild(me()),t.appendChild(de("",Rn(r.readingTime))),r.hasSelection){t.appendChild(me());const i=document.createElement("span");i.className="cm-word-count-stat cm-word-count-selection";const a=document.createElement("span");a.className="cm-word-count-value",a.textContent=`${r.selWords} words, ${r.selChars} chars`;const s=document.createElement("span");s.className="cm-word-count-label",s.textContent=" selected",i.appendChild(a),i.appendChild(s),t.appendChild(i)}}return n(e.state),{dom:t,top:!1,update(o){(o.docChanged||o.selectionSet)&&n(o.state)}}}const ie=u.showPanel.of(Nn),Wn=[{icon:"‚Ü∂",title:"Undo",action:"undo"},{icon:"‚Ü∑",title:"Redo",action:"redo"},{icon:"B",title:"Bold",action:"bold"},{icon:"I",title:"Italic",action:"italic"},{icon:"S",title:"Strikethrough",action:"strikethrough"},{icon:"H‚ÇÅ",title:"Heading 1",action:"h1"},{icon:"H‚ÇÇ",title:"Heading 2",action:"h2"},{icon:"H‚ÇÉ",title:"Heading 3",action:"h3"},{icon:"üîó",title:"Link",action:"link"},{icon:"üñº",title:"Image",action:"image"},{icon:"‚Ä¢",title:"Bullet List",action:"bulletList"},{icon:"1.",title:"Numbered List",action:"numberedList"},{icon:"‚òë",title:"Task List",action:"taskList"},{icon:"< >",title:"Inline Code",action:"inlineCode"},{icon:"{ }",title:"Code Block",action:"codeBlock"},{icon:"‚Äî",title:"Horizontal Rule",action:"hr"},{icon:"‚Äú",title:"Blockquote",action:"quote"},{icon:"‚äû",title:"Table",action:"table"}],Bn=u.EditorView.baseTheme({".cm-bottom-toolbar":{display:"flex",alignItems:"center",gap:"2px",padding:"6px 8px",paddingBottom:"max(6px, env(safe-area-inset-bottom))",overflowX:"auto",WebkitOverflowScrolling:"touch",scrollbarWidth:"none",whiteSpace:"nowrap",borderTop:"1px solid #dee2e6",fontFamily:'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',background:"#f8f9fa",overscrollBehaviorX:"contain",touchAction:"pan-x"},".cm-bottom-toolbar::-webkit-scrollbar":{display:"none"},".cm-bottom-toolbar-btn":{minWidth:"36px",height:"36px",flexShrink:"0",display:"inline-flex",alignItems:"center",justifyContent:"center",border:"none",background:"transparent",borderRadius:"6px",cursor:"pointer",fontSize:"15px",color:"inherit",transition:"background 0.1s",padding:"0 4px",fontFamily:"inherit"},".cm-bottom-toolbar-btn:hover":{background:"rgba(0, 0, 0, 0.08)"},".cm-bottom-toolbar-btn:active":{background:"rgba(0, 0, 0, 0.15)"},".cm-bottom-toolbar-btn:disabled":{opacity:"0.3",cursor:"not-allowed"},"&dark .cm-bottom-toolbar":{background:"#252526",borderTopColor:"#3c3c3c",color:"#d4d4d4"},"&dark .cm-bottom-toolbar-btn:hover":{background:"rgba(255, 255, 255, 0.1)"},"&dark .cm-bottom-toolbar-btn:active":{background:"rgba(255, 255, 255, 0.18)"}});function se(e={}){const t=e.buttons||Wn,n=e.extraButtons||[];return[u.showPanel.of(r=>{const i=document.createElement("div");i.className="cm-bottom-toolbar";const a=new Map;for(const c of t){const d=document.createElement("button");d.className="cm-bottom-toolbar-btn",d.textContent=c.icon,d.title=c.title,c.action&&(a.set(c.action,d),d.addEventListener("click",m=>{m.preventDefault(),P[c.action]&&(P[c.action](r),r.focus())})),i.appendChild(d)}for(const c of n){const d=document.createElement("button");d.className="cm-bottom-toolbar-btn",d.textContent=c.icon,d.title=c.title,d.addEventListener("click",m=>{m.preventDefault(),c.handler&&c.handler(r),r.focus()}),i.appendChild(d)}let s=0;i.addEventListener("touchstart",c=>{s=c.touches[0].clientX},{passive:!0}),i.addEventListener("touchmove",c=>{const d=c.touches[0].clientX-s,m=i.scrollLeft<=0,f=i.scrollLeft+i.clientWidth>=i.scrollWidth-1;(m&&d>0||f&&d<0)&&c.preventDefault()},{passive:!1});const l=c=>{const d=a.get("undo");d&&(d.disabled=O.undoDepth(c)===0);const m=a.get("redo");m&&(m.disabled=O.redoDepth(c)===0)};return l(r.state),{dom:i,top:!1,update(c){l(c.state)}}}),Bn]}const J=g.Facet.define({combine(e){return e.length===0?{docTitle:null,onBacklinksRequested:null,onBacklinkClick:null}:e[e.length-1]}});function Pn(e){if(e.lines<2||e.line(1).text.trim()!=="---")return null;for(let n=2;n<=e.lines;n++){const o=e.line(n).text.trim();if(o==="---"||o==="..."){for(let r=2;r<n;r++){const a=e.line(r).text.match(/^title:\s*(.+)$/);if(a){let s=a[1].trim();return(s.startsWith('"')&&s.endsWith('"')||s.startsWith("'")&&s.endsWith("'"))&&(s=s.slice(1,-1)),s}}return null}}return null}function fe(e,t,n){e.textContent="";const o=document.createElement("span");if(o.className="cm-backlinks-label",o.textContent="Backlinks",e.appendChild(o),!t||t.length===0){const i=document.createElement("span");i.className="cm-backlinks-empty",i.textContent="None",e.appendChild(i);return}const r=document.createElement("span");r.className="cm-backlinks-list";for(const i of t){const a=document.createElement("span");a.className="cm-backlinks-link",a.textContent=i.title,i.excerpt&&(a.title=i.excerpt),a.addEventListener("mousedown",s=>{s.preventDefault(),n&&n(i)}),r.appendChild(a)}e.appendChild(r)}function In(e){const t=document.createElement("div");t.className="cm-backlinks-panel",e.state.facet(J);let n=null,o=0;function r(a){const s=a.facet(J);return s.docTitle?s.docTitle:Pn(a.doc)}async function i(a){const s=a.facet(J);if(!s.onBacklinksRequested){t.textContent="";return}const l=r(a);if(l===n)return;if(n=l,!l){fe(t,[],s.onBacklinkClick);return}t.textContent="";const c=document.createElement("span");c.className="cm-backlinks-label",c.textContent="Backlinks",t.appendChild(c);const d=document.createElement("span");d.className="cm-backlinks-empty",d.textContent="Loading‚Ä¶",t.appendChild(d);const m=++o;try{const f=await s.onBacklinksRequested(l);m===o&&fe(t,f,s.onBacklinkClick)}catch{m===o&&fe(t,[],s.onBacklinkClick)}}return i(e.state),{dom:t,top:!1,update(a){a.docChanged&&i(a.state)}}}const ce=u.showPanel.of(In),mt=g.Facet.define({combine(e){return e.length===0?[]:e[e.length-1]}}),An=u.ViewPlugin.fromClass(class{constructor(e){this.view=e,this.backdrop=null,this.sheet=null,this.escHandler=null,this.isOpen=e.state.field(H),this.isOpen&&this.open()}update(e){const t=this.isOpen;this.isOpen=e.state.field(H),!t&&this.isOpen?this.open():t&&!this.isOpen?this.close():this.isOpen&&e.docChanged&&this.rebuildContent()}open(){const e=this.view;this.backdrop=document.createElement("div"),this.backdrop.className="cm-frontmatter-sheet-backdrop",this.backdrop.addEventListener("mousedown",r=>{r.preventDefault(),r.stopPropagation(),e.dispatch({effects:j.of(!1)})}),this.sheet=document.createElement("div"),this.sheet.className="cm-frontmatter-sheet";const t=document.createElement("div");t.className="cm-frontmatter-sheet-header";const n=document.createElement("span");n.className="cm-frontmatter-sheet-title",n.textContent="Properties",t.appendChild(n);const o=document.createElement("button");o.className="cm-frontmatter-sheet-close",o.textContent="√ó",o.title="Close",o.addEventListener("mousedown",r=>{r.preventDefault(),r.stopPropagation()}),o.addEventListener("click",r=>{r.stopPropagation(),e.dispatch({effects:j.of(!1)})}),t.appendChild(o),this.sheet.appendChild(t),this.contentEl=document.createElement("div"),this.contentEl.className="cm-frontmatter-sheet-content",this.sheet.appendChild(this.contentEl),this.buildContent(),e.dom.appendChild(this.backdrop),e.dom.appendChild(this.sheet),e.scrollDOM.style.overflow="hidden",this.escHandler=r=>{r.key==="Escape"&&(r.preventDefault(),r.stopPropagation(),e.dispatch({effects:j.of(!1)}))},e.dom.addEventListener("keydown",this.escHandler,!0),requestAnimationFrame(()=>{this.backdrop&&this.backdrop.classList.add("cm-frontmatter-sheet-backdrop-visible"),this.sheet&&this.sheet.classList.add("cm-frontmatter-sheet-open")})}close(){const e=this.view;e.scrollDOM.style.overflow="",this.escHandler&&(e.dom.removeEventListener("keydown",this.escHandler,!0),this.escHandler=null),this.sheet&&this.sheet.classList.remove("cm-frontmatter-sheet-open"),this.backdrop&&this.backdrop.classList.remove("cm-frontmatter-sheet-backdrop-visible");const t=this.sheet,n=this.backdrop;setTimeout(()=>{t==null||t.remove(),n==null||n.remove()},200),this.sheet=null,this.backdrop=null,this.contentEl=null}buildContent(){if(!this.contentEl)return;this.contentEl.innerHTML="";const e=this.view.state,t=e.field(L),{frontmatter:n}=t;if(!n){const m=document.createElement("div");m.className="cm-frontmatter-sheet-empty",m.textContent="No frontmatter in this document.",this.contentEl.appendChild(m);const f=document.createElement("button");f.className="cm-frontmatter-sheet-add-btn",f.textContent="Add Frontmatter",f.addEventListener("click",p=>{p.stopPropagation(),this.view.dispatch({changes:{from:0,to:0,insert:`---
---
`},annotations:M.of(!0)})}),this.contentEl.appendChild(f);return}const o=n.end-n.start>1,r=o?e.doc.line(n.start+1).from:e.doc.line(n.start).to+1,i=o?e.doc.line(n.end-1).to:r,a=[];for(let m=n.start+1;m<n.end;m++)a.push(e.doc.line(m).text);const s=a.join(`
`),l=e.doc.line(n.start).from,c=this.view.state.facet(mt),{dom:d}=yn(s,r,i,l,this.view,{knownKeys:c});this.contentEl.appendChild(d)}rebuildContent(){this.buildContent()}destroy(){var e,t;this.isOpen&&(this.escHandler&&this.view.dom.removeEventListener("keydown",this.escHandler,!0),(e=this.sheet)==null||e.remove(),(t=this.backdrop)==null||t.remove(),this.view.scrollDOM.style.overflow="")}});if(typeof document<"u"){const e=document.createElement("style");e.textContent="@keyframes cmFadeIn { from { opacity: 0 } to { opacity: 1 } }",document.head.appendChild(e)}const ft=u.EditorView.baseTheme({"&":{height:"100%",fontSize:"17px"},".cm-content":{fontFamily:'Charter, "Bitstream Charter", "Sitka Text", Cambria, serif',padding:"20px 48px",lineHeight:"1.75"},".cm-line":{padding:"4px 0"},".cm-scroller":{overflow:"auto",fontFamily:'Charter, "Bitstream Charter", "Sitka Text", Cambria, serif'},"&.cm-focused":{outline:"none"},".cm-markdown-preview":{display:"inline",animation:"cmFadeIn 0.12s ease-out"},".cm-markdown-preview .md-header":{display:"inline",fontWeight:"600",lineHeight:"1.4"},".cm-markdown-preview .md-h1":{fontSize:"2em"},".cm-markdown-preview .md-h2":{fontSize:"1.5em"},".cm-markdown-preview .md-h3":{fontSize:"1.25em"},".cm-markdown-preview .md-h4":{fontSize:"1.1em"},".cm-markdown-preview .md-h5":{fontSize:"1em"},".cm-markdown-preview .md-h6":{fontSize:"0.9em"},".cm-markdown-preview strong":{fontWeight:"700"},".cm-markdown-preview em":{fontStyle:"italic"},".cm-markdown-preview del":{textDecoration:"line-through"},".cm-markdown-preview .md-highlight, .cm-markdown-preview mark":{backgroundColor:"#fde68a",color:"inherit",padding:"0 2px",borderRadius:"3px"},".cm-markdown-preview .md-subscript, .cm-markdown-preview sub":{fontSize:"0.85em",verticalAlign:"sub"},".cm-markdown-preview .md-superscript, .cm-markdown-preview sup":{fontSize:"0.85em",verticalAlign:"super"},".cm-markdown-preview code":{padding:"2px 6px",borderRadius:"4px",fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace',fontSize:"0.9em"},".cm-markdown-preview a":{textDecoration:"none",cursor:"pointer"},".cm-markdown-preview a:hover":{textDecoration:"underline"},".cm-markdown-preview img":{maxWidth:"100%",height:"auto",borderRadius:"4px"},".cm-markdown-preview .md-blockquote":{display:"inline",fontStyle:"italic",paddingLeft:"16px",marginLeft:"0"},".cm-markdown-preview .md-list-item":{display:"inline"},".cm-markdown-preview .md-list-marker":{marginRight:"4px"},".cm-markdown-preview .md-hr, .cm-markdown-preview hr":{display:"block",border:"none",margin:"16px 0",height:"1px"},'.cm-markdown-preview input[type="checkbox"]':{width:"19.2px",height:"19.2px",marginRight:"6px",cursor:"pointer"},".cm-markdown-preview .md-task-icon":{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"1.2em",marginRight:"6px",cursor:"pointer",userSelect:"none"},".cm-markdown-preview .md-task-idea":{color:"#0ea5e9"},".cm-markdown-preview .md-task-urgent":{color:"#ef4444"},".cm-markdown-preview .md-task-question":{color:"#a855f7"},".cm-markdown-preview .md-task-important":{color:"#ec4899"},".cm-markdown-preview .md-task-forwarded":{color:"#3b82f6"},".cm-markdown-preview .md-task-scheduled":{color:"#f59e0b"},".cm-code-block-line":{fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace',fontSize:"0.9em"},".cm-highlighted-code":{fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace'},".cm-table-preview":{display:"block",margin:"0",animation:"cmFadeIn 0.15s ease-out"},".cm-definition-list-preview":{display:"block",margin:"0",animation:"cmFadeIn 0.15s ease-out"},".md-definition-list":{margin:"4px 0 8px 0"},".md-definition-list dt":{fontWeight:"600"},".md-definition-list dd":{margin:"2px 0 6px 16px"},".cm-footnote-preview":{display:"block",margin:"4px 0",animation:"cmFadeIn 0.15s ease-out"},".md-footnote-block":{display:"block"},".md-footnote-line":{display:"block"},".md-footnote-backref":{display:"block"},".md-footnote-backref-link":{cursor:"pointer",fontSize:"0.85em"},".md-wikilink":{cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px"},".cm-wikilink":{textDecoration:"underline",textUnderlineOffset:"2px"},".md-table":{borderCollapse:"collapse",borderRadius:"6px",overflow:"hidden"},".md-table th, .md-table td":{padding:"8px 12px",textAlign:"left"},".md-table th":{fontWeight:"600"},".cm-markdown-preview .md-table-row":{display:"inline-flex",borderRadius:"4px"},".cm-markdown-preview .md-table-cell":{display:"inline-block",padding:"6px 12px",minWidth:"80px"},".cm-markdown-preview .md-table-cell:last-child":{borderRight:"none"},".cm-markdown-preview .md-table-separator":{display:"none"},".cm-math-preview":{display:"block",padding:"8px 0",animation:"cmFadeIn 0.15s ease-out"},".cm-math-preview .katex-display":{textAlign:"left !important",margin:"0 !important",justifyContent:"flex-start !important"},".cm-math-preview .katex-display > .katex":{textAlign:"left !important"},".cm-mermaid-preview":{display:"block",padding:"16px 0",cursor:"pointer",animation:"cmFadeIn 0.15s ease-out"},".cm-mermaid-preview svg":{maxWidth:"100%",height:"auto"},".cm-mermaid-preview .mermaid-error":{color:"#d73a49",fontFamily:"monospace",fontSize:"0.9em"},".cm-mermaid-block-line":{fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace',fontSize:"0.9em"},".cm-hidden-line":{height:"0 !important",padding:"0 !important",minHeight:"0 !important"},".cm-collapsed-line":{height:"0 !important",minHeight:"0 !important",padding:"0 !important",margin:"0 !important",overflow:"hidden !important",opacity:"0",lineHeight:"0 !important",transition:"height 0.15s ease-out, opacity 0.1s ease-out, padding 0.15s ease-out"},".cm-heading-preview":{display:"inline-flex",alignItems:"center",animation:"cmFadeIn 0.12s ease-out"},".cm-collapse-toggle":{display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",userSelect:"none",fontSize:"0.8em",opacity:"0",transition:"opacity 0.15s ease, transform 0.15s ease",marginLeft:"-20px",width:"20px",height:"1em",flexShrink:"0"},".cm-collapse-toggle.collapsed":{transform:"rotate(0deg)",opacity:"0.4"},".cm-collapse-toggle.collapsed:hover":{opacity:"1"},".cm-collapse-toggle.expanded":{transform:"rotate(90deg)"},".cm-line:hover .cm-collapse-toggle.expanded":{opacity:"0.4"},".cm-line:hover .cm-collapse-toggle.expanded:hover":{opacity:"1"},".footnote-ref .footnote-link":{cursor:"pointer",fontSize:"0.85em"},".footnote-def":{display:"inline",fontSize:"0.9em"},".footnote-def sup":{marginRight:"4px"},".tok-keyword":{},".tok-operator":{},".tok-variableName":{},".tok-function, .tok-definition":{},".tok-string, .tok-string2":{},".tok-number":{},".tok-bool, .tok-null":{},".tok-comment":{fontStyle:"italic"},".tok-punctuation":{},".tok-propertyName":{},".tok-typeName, .tok-className":{},".tok-tagName":{},".tok-attributeName":{},".tok-attributeValue":{},".tok-regexp":{},".tok-meta":{},".cm-image-preview":{display:"block",padding:"8px 0",cursor:"pointer",animation:"cmFadeIn 0.15s ease-out"},".cm-image-preview img":{maxWidth:"100%",maxHeight:"400px",objectFit:"contain",borderRadius:"6px",display:"block"},".cm-image-alt":{display:"block",fontSize:"0.8em",marginTop:"4px",fontStyle:"italic"},".cm-image-error":{display:"block",padding:"12px",fontSize:"0.85em",borderRadius:"6px",fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace'},".cm-frontmatter-preview":{display:"block",margin:"0",padding:"8px 12px",borderRadius:"6px",animation:"cmFadeIn 0.15s ease-out"},".cm-frontmatter-table":{width:"100%",borderCollapse:"collapse",fontSize:"0.9em"},".cm-frontmatter-table td":{padding:"3px 8px",verticalAlign:"middle"},".cm-frontmatter-key":{fontWeight:"600",whiteSpace:"nowrap",fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace',fontSize:"0.9em",width:"1%",paddingRight:"16px"},".cm-frontmatter-key-input":{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",color:"inherit",background:"transparent",border:"none",outline:"none",padding:"2px 4px",borderRadius:"3px",boxSizing:"border-box",minWidth:"3ch",appearance:"none",MozAppearance:"none",WebkitAppearance:"none"},".cm-frontmatter-key-input::-webkit-calendar-picker-indicator":{display:"none !important"},".cm-frontmatter-value-cell":{width:"100%"},".cm-frontmatter-value":{display:"flex",flexWrap:"wrap",gap:"4px",alignItems:"center"},".cm-frontmatter-input":{border:"none",background:"transparent",width:"100%",font:"inherit",fontSize:"1em",outline:"none",padding:"2px 4px",borderRadius:"3px"},".cm-frontmatter-input:focus":{outline:"none"},".cm-frontmatter-checkbox":{width:"16px",height:"16px",cursor:"pointer",margin:"0"},".cm-frontmatter-tag":{display:"inline-block",padding:"1px 8px",borderRadius:"10px",fontSize:"0.9em",cursor:"text",outline:"none",lineHeight:"1.5"},".cm-frontmatter-add-tag":{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px",borderRadius:"50%",cursor:"pointer",fontSize:"0.85em",opacity:"0.4",userSelect:"none"},".cm-frontmatter-add-tag:hover":{opacity:"1"},".cm-frontmatter-action-cell":{width:"1%",whiteSpace:"nowrap"},".cm-frontmatter-delete":{cursor:"pointer",opacity:"0",fontSize:"1.1em",padding:"0 4px",userSelect:"none",transition:"opacity 0.1s ease"},".cm-frontmatter-table tr:hover .cm-frontmatter-delete":{opacity:"0.3"},".cm-frontmatter-table tr:hover .cm-frontmatter-delete:hover":{opacity:"1"},".cm-frontmatter-add":{cursor:"pointer",opacity:"0.4",fontSize:"0.85em",padding:"4px 8px",userSelect:"none"},".cm-frontmatter-add:hover":{opacity:"0.8"},".cm-frontmatter-error":{fontStyle:"italic",fontSize:"0.9em",padding:"4px 0",cursor:"pointer"},".cm-frontmatter-line":{fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace',fontSize:"0.9em",animation:"cmFadeIn 0.1s ease-out"},".cm-frontmatter-sheet-backdrop":{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",zIndex:"10",opacity:"0",transition:"opacity 0.2s ease"},".cm-frontmatter-sheet-backdrop-visible":{opacity:"1"},".cm-frontmatter-sheet":{position:"absolute",top:"0",left:"0",right:"0",zIndex:"11",maxHeight:"70%",overflowY:"auto",transform:"translateY(-100%)",transition:"transform 0.2s ease",borderBottomLeftRadius:"8px",borderBottomRightRadius:"8px"},".cm-frontmatter-sheet-open":{transform:"translateY(0)"},".cm-frontmatter-sheet-header":{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 20px 0"},".cm-frontmatter-sheet-title":{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',fontSize:"0.9em",fontWeight:"600"},".cm-frontmatter-sheet-close":{background:"none",border:"none",fontSize:"18px",cursor:"pointer",padding:"0 4px",lineHeight:"1",opacity:"0.5"},".cm-frontmatter-sheet-close:hover":{opacity:"1"},".cm-frontmatter-sheet-content":{padding:"8px 20px 16px"},".cm-frontmatter-sheet-content .cm-frontmatter-preview":{border:"none",padding:"0",margin:"0",borderRadius:"0",animation:"none"},".cm-frontmatter-sheet-empty":{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',fontSize:"0.9em",padding:"8px 0",opacity:"0.6"},".cm-frontmatter-sheet-add-btn":{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',fontSize:"0.85em",padding:"6px 16px",borderRadius:"6px",cursor:"pointer",border:"1px solid",marginTop:"8px"},".cm-word-count-panel":{display:"flex",alignItems:"center",gap:"0",padding:"4px 16px",fontSize:"12px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',userSelect:"none"},".cm-word-count-stat":{display:"inline-flex",alignItems:"center",padding:"0 10px"},".cm-word-count-value":{fontWeight:"600",fontVariantNumeric:"tabular-nums"},".cm-word-count-label":{fontWeight:"400"},".cm-word-count-divider":{width:"1px",height:"12px",flexShrink:"0"},".md-tag":{display:"inline-block",padding:"1px 8px",borderRadius:"10px",fontSize:"0.9em",cursor:"pointer",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',lineHeight:"1.5",verticalAlign:"baseline"},".cm-tag-mark":{borderRadius:"3px"},".cm-selectedLine":{animation:"cmFadeIn 0.1s ease-out"},".cm-table-line":{animation:"cmFadeIn 0.1s ease-out"},".cm-math-block-line":{animation:"cmFadeIn 0.1s ease-out"},".cm-mermaid-block-line":{animation:"cmFadeIn 0.1s ease-out"},".cm-backlinks-panel":{display:"flex",alignItems:"center",gap:"8px",padding:"4px 16px",fontSize:"12px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',userSelect:"none"},".cm-backlinks-label":{fontWeight:"600",flexShrink:"0"},".cm-backlinks-list":{display:"flex",flexWrap:"wrap",gap:"4px",alignItems:"center"},".cm-backlinks-link":{display:"inline-block",padding:"1px 8px",borderRadius:"10px",cursor:"pointer",fontSize:"11px",lineHeight:"1.5"},".cm-backlinks-link:hover":{textDecoration:"underline"},".cm-backlinks-empty":{fontStyle:"italic",opacity:"0.6"},".cm-unfocused-line":{opacity:"0.25",transition:"opacity 0.2s ease"}}),ut=u.EditorView.theme({"&":{backgroundColor:"#fff"},".cm-content":{caretColor:"#333"},".cm-cursor":{borderLeftColor:"#333",borderLeftWidth:"2px"},".cm-selectionBackground":{backgroundColor:"#b4d5fe"},"&.cm-focused .cm-selectionBackground":{backgroundColor:"#b4d5fe"},".cm-markdown-preview .md-h1":{color:"#1a1a2e"},".cm-markdown-preview .md-h2":{color:"#2d2d3f"},".cm-markdown-preview .md-h3":{color:"#3d3d4d"},".cm-markdown-preview .md-h4":{color:"#555566"},".cm-markdown-preview .md-h5":{color:"#666677"},".cm-markdown-preview .md-h6":{color:"#777788"},".cm-markdown-preview del":{color:"#868e96"},".cm-markdown-preview code":{backgroundColor:"#f1f3f5",color:"#e83e8c"},".cm-markdown-preview a":{color:"#228be6"},".cm-markdown-preview .md-blockquote":{color:"#555",borderLeft:"3px solid #c0c8d0"},".cm-markdown-preview .md-list-marker":{color:"#888"},".cm-markdown-preview .md-hr, .cm-markdown-preview hr":{background:"linear-gradient(to right, transparent, #c0c8d0, transparent)"},".cm-code-block-line":{backgroundColor:"#f6f8fa !important",borderLeft:"3px solid #e1e4e8"},".cm-code-block-line.cm-code-block-focused":{backgroundColor:"#e8f4fc !important",borderLeft:"3px solid #228be6"},".cm-selectedLine, .cm-table-line, .cm-math-block-line, .cm-mermaid-block-line":{backgroundColor:"#1e1e1e !important",color:"#d4d4d4 !important",caretColor:"#fff !important",borderRadius:"4px",fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace',fontSize:"0.90em"},".cm-selectedLine.cm-code-block-line":{backgroundColor:"#1e1e1e !important",borderLeft:"3px solid #569cd6",color:"#d4d4d4 !important",caretColor:"#fff !important",borderRadius:"0"},".cm-selectedLine.cm-code-block-line .tok-keyword":{color:"#569cd6 !important"},".cm-selectedLine.cm-code-block-line .tok-operator":{color:"#d4d4d4 !important"},".cm-selectedLine.cm-code-block-line .tok-variableName":{color:"#9cdcfe !important"},".cm-selectedLine.cm-code-block-line .tok-function, .cm-selectedLine.cm-code-block-line .tok-definition":{color:"#dcdcaa !important"},".cm-selectedLine.cm-code-block-line .tok-string, .cm-selectedLine.cm-code-block-line .tok-string2":{color:"#ce9178 !important"},".cm-selectedLine.cm-code-block-line .tok-number":{color:"#b5cea8 !important"},".cm-selectedLine.cm-code-block-line .tok-bool, .cm-selectedLine.cm-code-block-line .tok-null":{color:"#569cd6 !important"},".cm-selectedLine.cm-code-block-line .tok-comment":{color:"#6a9955 !important"},".cm-selectedLine.cm-code-block-line .tok-punctuation":{color:"#d4d4d4 !important"},".cm-selectedLine.cm-code-block-line .tok-propertyName":{color:"#9cdcfe !important"},".cm-selectedLine.cm-code-block-line .tok-typeName, .cm-selectedLine.cm-code-block-line .tok-className":{color:"#4ec9b0 !important"},".cm-selectedLine.cm-code-block-line .tok-tagName":{color:"#569cd6 !important"},".cm-selectedLine.cm-code-block-line .tok-attributeName":{color:"#9cdcfe !important"},".cm-selectedLine.cm-code-block-line .tok-attributeValue":{color:"#ce9178 !important"},".cm-selectedLine.cm-code-block-line .tok-regexp":{color:"#d16969 !important"},".cm-selectedLine.cm-code-block-line .tok-meta":{color:"#6a9955 !important"},".cm-image-preview img":{boxShadow:"0 1px 4px rgba(0, 0, 0, 0.1)"},".cm-image-alt":{color:"#888"},".cm-image-error":{backgroundColor:"#fff3f3",color:"#d73a49",border:"1px solid #fdd"},".cm-frontmatter-preview":{backgroundColor:"#f8f9fa",border:"1px solid #e1e4e8"},".cm-frontmatter-table td":{borderBottom:"1px solid #eee"},".cm-frontmatter-table tr:last-child td":{borderBottom:"none"},".cm-frontmatter-key":{color:"#555"},".cm-frontmatter-key-input:focus":{backgroundColor:"#fff",boxShadow:"0 0 0 1px #228be6"},".cm-frontmatter-input:focus":{backgroundColor:"#fff",boxShadow:"0 0 0 1px #228be6"},".cm-frontmatter-tag":{backgroundColor:"#e8f0fe",color:"#1a73e8",border:"1px solid #d2e3fc"},".cm-frontmatter-add-tag":{backgroundColor:"#e8f0fe",color:"#1a73e8"},".cm-frontmatter-delete":{color:"#d73a49"},".cm-frontmatter-error":{color:"#d73a49"},".cm-frontmatter-line":{backgroundColor:"#f6f8fa !important",borderLeft:"3px solid #e1e4e8"},".cm-frontmatter-sheet-backdrop":{backgroundColor:"rgba(0, 0, 0, 0.3)"},".cm-frontmatter-sheet":{backgroundColor:"#fff",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.12)"},".cm-frontmatter-sheet-title":{color:"#333"},".cm-frontmatter-sheet-close":{color:"#666"},".cm-frontmatter-sheet-add-btn":{backgroundColor:"#f8f9fa",borderColor:"#e1e4e8",color:"#333"},".cm-frontmatter-sheet-add-btn:hover":{backgroundColor:"#e9ecef"},".cm-word-count-panel":{backgroundColor:"#f8f9fa",borderTop:"1px solid #e1e4e8",color:"#555"},".cm-word-count-value":{color:"#333"},".cm-word-count-label":{color:"#888"},".cm-word-count-divider":{backgroundColor:"#dee2e6"},".cm-word-count-selection":{color:"#228be6"},".cm-word-count-selection .cm-word-count-value":{color:"#228be6"},".cm-word-count-selection .cm-word-count-label":{color:"#228be6",opacity:"0.7"},".cm-gutters":{background:"#f8f9fa",borderRight:"1px solid #dee2e6"},".md-table":{border:"1px solid #d0d7de"},".md-table th, .md-table td":{border:"1px solid #d0d7de"},".md-table th":{background:"#f6f8fa"},".md-table tbody tr:hover":{background:"#f6f8fa"},".cm-markdown-preview .md-table-row":{background:"#fff",border:"1px solid #d0d7de"},".cm-markdown-preview .md-table-cell":{borderRight:"1px solid #d0d7de"},".tok-keyword":{color:"#d73a49"},".tok-operator":{color:"#d73a49"},".tok-variableName":{color:"#24292e"},".tok-function, .tok-definition":{color:"#6f42c1"},".tok-string, .tok-string2":{color:"#032f62"},".tok-number":{color:"#005cc5"},".tok-bool, .tok-null":{color:"#005cc5"},".tok-comment":{color:"#6a737d"},".tok-punctuation":{color:"#24292e"},".tok-propertyName":{color:"#005cc5"},".tok-typeName, .tok-className":{color:"#22863a"},".tok-tagName":{color:"#22863a"},".tok-attributeName":{color:"#6f42c1"},".tok-attributeValue":{color:"#032f62"},".tok-regexp":{color:"#032f62"},".tok-meta":{color:"#6a737d"},".cm-backlinks-panel":{backgroundColor:"#f8f9fa",borderTop:"1px solid #e1e4e8",color:"#555"},".cm-backlinks-label":{color:"#333"},".cm-backlinks-link":{backgroundColor:"#e8f0fe",color:"#1a73e8",border:"1px solid #d2e3fc"},".md-tag":{backgroundColor:"#e8f5e9",color:"#2e7d32",border:"1px solid #c8e6c9"},".cm-tag-mark":{color:"#2e7d32"},".footnote-ref .footnote-link":{color:"#228be6"},".footnote-def":{color:"#666"},".footnote-def sup":{color:"#228be6"},".md-wikilink, .cm-wikilink":{color:"#228be6"}}),pt=u.EditorView.theme({"&":{backgroundColor:"#1e1e1e"},".cm-content":{caretColor:"#fff",color:"#d4d4d4"},".cm-cursor":{borderLeftColor:"#fff",borderLeftWidth:"2px"},".cm-selectionBackground":{backgroundColor:"#264f78"},"&.cm-focused .cm-selectionBackground":{backgroundColor:"#264f78"},".cm-markdown-preview .md-h1":{color:"#e8e8ec"},".cm-markdown-preview .md-h2":{color:"#d5d5db"},".cm-markdown-preview .md-h3":{color:"#c2c2ca"},".cm-markdown-preview .md-h4":{color:"#acacb8"},".cm-markdown-preview .md-h5":{color:"#9696a4"},".cm-markdown-preview .md-h6":{color:"#808090"},".cm-markdown-preview del":{color:"#777"},".cm-markdown-preview code":{backgroundColor:"#2d2d2d",color:"#ce9178"},".cm-markdown-preview a":{color:"#228be6"},".cm-markdown-preview .md-blockquote":{color:"#aaa",borderLeft:"3px solid #4a4a5a"},".cm-markdown-preview .md-list-marker":{color:"#888"},".cm-markdown-preview .md-hr, .cm-markdown-preview hr":{background:"linear-gradient(to right, transparent, #4a4a5a, transparent)"},".cm-code-block-line":{backgroundColor:"#2d2d2d !important",borderLeft:"3px solid #444"},".cm-code-block-line.cm-code-block-focused":{backgroundColor:"#3a3d41 !important",borderLeft:"3px solid #569cd6"},".cm-selectedLine, .cm-table-line, .cm-math-block-line, .cm-mermaid-block-line":{backgroundColor:"#fff !important",color:"#1e1e1e !important",caretColor:"#333 !important",borderRadius:"4px",fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace',fontSize:"0.90em"},".cm-selectedLine.cm-code-block-line":{backgroundColor:"#fff !important",borderLeft:"3px solid #228be6",color:"#1e1e1e !important",caretColor:"#333 !important",borderRadius:"0"},".cm-selectedLine.cm-code-block-line .tok-keyword":{color:"#d73a49 !important"},".cm-selectedLine.cm-code-block-line .tok-operator":{color:"#d73a49 !important"},".cm-selectedLine.cm-code-block-line .tok-variableName":{color:"#24292e !important"},".cm-selectedLine.cm-code-block-line .tok-function, .cm-selectedLine.cm-code-block-line .tok-definition":{color:"#6f42c1 !important"},".cm-selectedLine.cm-code-block-line .tok-string, .cm-selectedLine.cm-code-block-line .tok-string2":{color:"#032f62 !important"},".cm-selectedLine.cm-code-block-line .tok-number":{color:"#005cc5 !important"},".cm-selectedLine.cm-code-block-line .tok-bool, .cm-selectedLine.cm-code-block-line .tok-null":{color:"#005cc5 !important"},".cm-selectedLine.cm-code-block-line .tok-comment":{color:"#6a737d !important"},".cm-selectedLine.cm-code-block-line .tok-punctuation":{color:"#24292e !important"},".cm-selectedLine.cm-code-block-line .tok-propertyName":{color:"#005cc5 !important"},".cm-selectedLine.cm-code-block-line .tok-typeName, .cm-selectedLine.cm-code-block-line .tok-className":{color:"#22863a !important"},".cm-selectedLine.cm-code-block-line .tok-tagName":{color:"#22863a !important"},".cm-selectedLine.cm-code-block-line .tok-attributeName":{color:"#6f42c1 !important"},".cm-selectedLine.cm-code-block-line .tok-attributeValue":{color:"#032f62 !important"},".cm-selectedLine.cm-code-block-line .tok-regexp":{color:"#032f62 !important"},".cm-selectedLine.cm-code-block-line .tok-meta":{color:"#6a737d !important"},".cm-image-preview img":{boxShadow:"0 1px 4px rgba(0, 0, 0, 0.3)"},".cm-image-alt":{color:"#888"},".cm-image-error":{backgroundColor:"#3a2020",color:"#f48771",border:"1px solid #5a3030"},".cm-frontmatter-preview":{backgroundColor:"#2d2d2d",border:"1px solid #444"},".cm-frontmatter-table td":{borderBottom:"1px solid #3c3c3c"},".cm-frontmatter-table tr:last-child td":{borderBottom:"none"},".cm-frontmatter-key":{color:"#9cdcfe"},".cm-frontmatter-input":{color:"#d4d4d4"},".cm-frontmatter-key-input:focus":{backgroundColor:"#3a3d41",boxShadow:"0 0 0 1px #569cd6"},".cm-frontmatter-input:focus":{backgroundColor:"#3a3d41",boxShadow:"0 0 0 1px #569cd6"},".cm-frontmatter-tag":{backgroundColor:"#264f78",color:"#9cdcfe",border:"1px solid #3a6ea5"},".cm-frontmatter-add-tag":{backgroundColor:"#264f78",color:"#9cdcfe"},".cm-frontmatter-delete":{color:"#f48771"},".cm-frontmatter-error":{color:"#f48771"},".cm-frontmatter-line":{backgroundColor:"#2d2d2d !important",borderLeft:"3px solid #444"},".cm-frontmatter-sheet-backdrop":{backgroundColor:"rgba(0, 0, 0, 0.5)"},".cm-frontmatter-sheet":{backgroundColor:"#252526",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.4)"},".cm-frontmatter-sheet-title":{color:"#d4d4d4"},".cm-frontmatter-sheet-close":{color:"#aaa"},".cm-frontmatter-sheet-add-btn":{backgroundColor:"#3c3c3c",borderColor:"#555",color:"#d4d4d4"},".cm-frontmatter-sheet-add-btn:hover":{backgroundColor:"#4a4a4a"},".cm-word-count-panel":{backgroundColor:"#252526",borderTop:"1px solid #3c3c3c",color:"#aaa"},".cm-word-count-value":{color:"#d4d4d4"},".cm-word-count-label":{color:"#777"},".cm-word-count-divider":{backgroundColor:"#444"},".cm-word-count-selection":{color:"#569cd6"},".cm-word-count-selection .cm-word-count-value":{color:"#569cd6"},".cm-word-count-selection .cm-word-count-label":{color:"#569cd6",opacity:"0.7"},".cm-gutters":{background:"#252526",borderRight:"1px solid #3c3c3c"},".md-table":{border:"1px solid #444"},".md-table th, .md-table td":{border:"1px solid #444"},".md-table th":{background:"#2d2d2d"},".md-table tbody tr:hover":{background:"#2d2d2d"},".cm-markdown-preview .md-table-row":{background:"#1e1e1e",border:"1px solid #444"},".cm-markdown-preview .md-table-cell":{borderRight:"1px solid #444"},".tok-keyword":{color:"#569cd6"},".tok-operator":{color:"#d4d4d4"},".tok-variableName":{color:"#9cdcfe"},".tok-function, .tok-definition":{color:"#dcdcaa"},".tok-string, .tok-string2":{color:"#ce9178"},".tok-number":{color:"#b5cea8"},".tok-bool, .tok-null":{color:"#569cd6"},".tok-comment":{color:"#6a9955"},".tok-punctuation":{color:"#d4d4d4"},".tok-propertyName":{color:"#9cdcfe"},".tok-typeName, .tok-className":{color:"#4ec9b0"},".tok-tagName":{color:"#569cd6"},".tok-attributeName":{color:"#9cdcfe"},".tok-attributeValue":{color:"#ce9178"},".tok-regexp":{color:"#d16969"},".tok-meta":{color:"#6a9955"},".cm-backlinks-panel":{backgroundColor:"#252526",borderTop:"1px solid #3c3c3c",color:"#aaa"},".cm-backlinks-label":{color:"#d4d4d4"},".cm-backlinks-link":{backgroundColor:"#264f78",color:"#9cdcfe",border:"1px solid #3a6ea5"},".md-tag":{backgroundColor:"#1b3a1b",color:"#81c784",border:"1px solid #2e5a2e"},".cm-tag-mark":{color:"#81c784"},".footnote-ref .footnote-link":{color:"#228be6"},".footnote-def":{color:"#aaa"},".footnote-def sup":{color:"#228be6"},".md-wikilink, .cm-wikilink":{color:"#228be6"}}),On=u.EditorView.theme({".cm-scroller, .cm-content, .cm-line":{fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace !important'},".cm-selectedLine, .cm-selectedLine.cm-code-block-line":{backgroundColor:"rgba(0, 0, 0, 0.05) !important",color:"inherit !important",caretColor:"#333 !important",filter:"none !important",borderRadius:"0",fontSize:"inherit !important"}}),$n=u.EditorView.theme({".cm-scroller, .cm-content, .cm-line":{fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace !important'},".cm-selectedLine, .cm-selectedLine.cm-code-block-line":{backgroundColor:"rgba(255, 255, 255, 0.1) !important",color:"inherit !important",caretColor:"#fff !important",filter:"none !important",borderRadius:"0",fontSize:"inherit !important"}});function zn({tags:e=[]}={}){return t=>{const n=t.matchBefore(/#[\w/-]*$/);if(!n)return null;const r=t.state.doc.lineAt(n.from).text;if(/^#{1,6}\s/.test(r))return null;const i=n.text.slice(1).toLowerCase(),a=e.filter(s=>s.toLowerCase().includes(i)).sort((s,l)=>{const c=s.toLowerCase(),d=l.toLowerCase(),m=c.startsWith(i)?0:1,f=d.startsWith(i)?0:1;return m!==f?m-f:c.localeCompare(d)}).map(s=>({label:`#${s}`,apply:`#${s}`,type:"keyword"}));return{from:n.from,to:n.to,options:a,validFor:/^#[\w/-]*$/}}}function jn(e=[]){const t=e.map(n=>({title:n.title,aliases:Array.isArray(n.aliases)?n.aliases:[],normalizedTitle:n.title.toLowerCase(),normalizedAliases:Array.isArray(n.aliases)?n.aliases.map(o=>o.toLowerCase()):[]}));return{search(n){const o=n.trim().toLowerCase();return o?t.map(i=>{const a=i.normalizedTitle.indexOf(o),s=i.normalizedAliases.length?Math.min(...i.normalizedAliases.map(c=>c.indexOf(o)).filter(c=>c!==-1)):-1,l=Math.min(a===-1?Number.POSITIVE_INFINITY:a,s===-1?Number.POSITIVE_INFINITY:s);return{entry:i,score:l}}).filter(i=>Number.isFinite(i.score)).sort((i,a)=>i.score-a.score).map(i=>i.entry):t},resolve(n){const o=n.trim().toLowerCase();return t.find(r=>r.normalizedTitle===o)||t.find(r=>r.normalizedAliases.includes(o))||null}}}function Hn(e){return`${e.title}]]`}function qn(e,t){return!e||!t||!t.title?null:e.resolve(t.title)}function Vn({noteIndex:e,formatLink:t}={}){const n=typeof t=="function"?t:Hn;return o=>{if(!e)return null;const r=o.matchBefore(/\[\[[^\[\]\n]*$/);if(!r)return null;const i=r.text.slice(2),s=e.search(i).map(l=>({label:l.title,detail:l.aliases.length?`aliases: ${l.aliases.join(", ")}`:void 0,apply:n(l),type:"text"}));return{from:r.from+2,to:r.to,options:s,validFor:/^[^\[\]\n]*$/}}}const _n=u.EditorView.baseTheme({".cm-more-menu-container":{position:"absolute",top:"8px",right:"8px",zIndex:"6"},".cm-more-menu-trigger":{width:"32px",height:"32px",borderRadius:"6px",border:"none",background:"rgba(0, 0, 0, 0.05)",cursor:"pointer",fontSize:"18px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",color:"#555",fontFamily:'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},".cm-more-menu-trigger:hover":{background:"rgba(0, 0, 0, 0.1)"},".cm-more-menu-dropdown":{position:"absolute",top:"100%",right:"0",marginTop:"4px",minWidth:"180px",background:"#fff",borderRadius:"8px",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(0, 0, 0, 0.06)",padding:"4px 0",fontFamily:'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',fontSize:"14px",overflow:"hidden"},".cm-more-menu-item":{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"8px 12px",border:"none",background:"transparent",cursor:"pointer",textAlign:"left",color:"#333",fontSize:"inherit",fontFamily:"inherit",lineHeight:"1.3"},".cm-more-menu-item:hover":{background:"rgba(0, 0, 0, 0.05)"},".cm-more-menu-check":{width:"16px",textAlign:"center",flexShrink:"0",fontSize:"13px",color:"#555"},"&dark .cm-more-menu-trigger":{background:"rgba(255, 255, 255, 0.08)",color:"#aaa"},"&dark .cm-more-menu-trigger:hover":{background:"rgba(255, 255, 255, 0.14)"},"&dark .cm-more-menu-dropdown":{background:"#2d2d2d",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.08)"},"&dark .cm-more-menu-item":{color:"#d4d4d4"},"&dark .cm-more-menu-item:hover":{background:"rgba(255, 255, 255, 0.08)"},"&dark .cm-more-menu-check":{color:"#aaa"}});function Kn(e={}){const t=e.items||[];return[u.ViewPlugin.fromClass(class{constructor(o){this.view=o,this.open=!1,this.container=document.createElement("div"),this.container.className="cm-more-menu-container",Object.assign(this.container.style,{position:"absolute",top:"8px",right:"8px",zIndex:"6"}),this.trigger=document.createElement("button"),this.trigger.className="cm-more-menu-trigger",this.trigger.textContent="‚ãØ",this.trigger.title="More options",this.trigger.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),this.toggle()}),this.container.appendChild(this.trigger),this.dropdown=document.createElement("div"),this.dropdown.className="cm-more-menu-dropdown",this.dropdown.style.display="none",this.container.appendChild(this.dropdown),this.checkEls=[];for(const r of t){const i=document.createElement("button");i.className="cm-more-menu-item";const a=document.createElement("span");a.className="cm-more-menu-check",a.textContent=r.getState&&r.getState(o)?"‚úì":"",this.checkEls.push({check:a,item:r});const s=document.createElement("span");s.textContent=r.label,i.appendChild(a),i.appendChild(s),i.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation(),r.handler(o),this.refreshChecks()}),this.dropdown.appendChild(i)}this._onDocClick=r=>{this.open&&!this.container.contains(r.target)&&this.close()},this._onKeyDown=r=>{this.open&&r.key==="Escape"&&this.close()},document.addEventListener("click",this._onDocClick,!0),document.addEventListener("keydown",this._onKeyDown),o.dom.appendChild(this.container)}toggle(){this.open?this.close():this.show()}show(){this.open=!0,this.refreshChecks(),this.dropdown.style.display=""}close(){this.open=!1,this.dropdown.style.display="none"}refreshChecks(){for(const{check:o,item:r}of this.checkEls)o.textContent=r.getState&&r.getState(this.view)?"‚úì":""}update(o){this.open&&this.refreshChecks()}destroy(){document.removeEventListener("click",this._onDocClick,!0),document.removeEventListener("keydown",this._onKeyDown),this.container.remove()}}),_n]}const V=g.Facet.define({combine(e){return{enablePreview:e.reduce((t,n)=>n.enablePreview??t,!0),enableKeymap:e.reduce((t,n)=>n.enableKeymap??t,!0),enableCollapse:e.reduce((t,n)=>n.enableCollapse??t,!0),enableCustomTasks:e.reduce((t,n)=>n.enableCustomTasks??t,!1),customTaskTypes:e.reduce((t,n)=>n.customTaskTypes??t,void 0),enableWikiLinks:e.reduce((t,n)=>n.enableWikiLinks??t,!1),enableTags:e.reduce((t,n)=>n.enableTags??t,!1),onTagClick:e.reduce((t,n)=>n.onTagClick??t,void 0),renderWikiLinks:e.reduce((t,n)=>n.renderWikiLinks??t,!0),onWikiLinkClick:e.reduce((t,n)=>n.onWikiLinkClick??t,void 0),readOnly:e.reduce((t,n)=>n.readOnly??t,!1),typewriter:e.reduce((t,n)=>n.typewriter??t,!1),focusMode:e.reduce((t,n)=>n.focusMode??t,!1),toolbar:e.reduce((t,n)=>n.toolbar??t,!0),wordCount:e.reduce((t,n)=>n.wordCount??t,!1),backlinks:e.reduce((t,n)=>n.backlinks??t,!1),docTitle:e.reduce((t,n)=>n.docTitle??t,void 0),onBacklinksRequested:e.reduce((t,n)=>n.onBacklinksRequested??t,void 0),onBacklinkClick:e.reduce((t,n)=>n.onBacklinkClick??t,void 0),frontmatterKeys:e.reduce((t,n)=>n.frontmatterKeys??t,void 0),theme:e.reduce((t,n)=>n.theme??t,"light")}}}),ke=g.StateEffect.define(),ge=g.StateEffect.define(),be=g.StateEffect.define(),we=g.StateEffect.define(),Ce=g.StateEffect.define(),xe=g.StateEffect.define(),ye=g.StateEffect.define(),Le=g.StateEffect.define(),v=g.StateField.define({create(e){const t=e.facet(V);return{theme:t.theme||"light",mode:t.enablePreview!==!1?"hybrid":"raw",readOnly:t.readOnly===!0,typewriter:t.typewriter===!0,focusMode:t.focusMode===!0,toolbar:t.toolbar!==!1,wordCount:t.wordCount===!0,backlinks:t.backlinks===!0}},update(e,t){for(const n of t.effects)n.is(ke)?e={...e,theme:n.value}:n.is(ge)?e={...e,mode:n.value}:n.is(be)?e={...e,readOnly:n.value}:n.is(we)?e={...e,typewriter:n.value}:n.is(Ce)?e={...e,focusMode:n.value}:n.is(xe)?e={...e,toolbar:n.value}:n.is(ye)?e={...e,wordCount:n.value}:n.is(Le)&&(e={...e,backlinks:n.value});return e}}),Se=new g.Compartment,Q=new g.Compartment,_=new g.Compartment,ve=new g.Compartment,Te=new g.Compartment,Ee=new g.Compartment,Fe=new g.Compartment,De=new g.Compartment,Me=new g.Compartment,Re=new g.Compartment,Un=g.EditorState.transactionFilter.of(e=>!e.startState.readOnly||!e.docChanged||e.annotation(M)?e:{changes:[]});function Ne(e){return e==="dark"?pt:ut}function K(e,t){return t?e==="dark"?$n:On:[]}function Xn(e={}){const{enablePreview:t=!0,enableKeymap:n=!0,enableCollapse:o=!0,theme:r="light",enableCustomTasks:i=!1,customTaskTypes:a,enableWikiLinks:s=!1,renderWikiLinks:l=!0,onWikiLinkClick:c,enableTags:d=!1,onTagClick:m,readOnly:f=!1,typewriter:p=!1,focusMode:k=!1,toolbar:h=!0,wordCount:y=!1,backlinks:C=!1,docTitle:x,onBacklinksRequested:b,onBacklinkClick:S,frontmatterKeys:F}=e,w=[V.of(e),v,Un,Te.of(g.EditorState.readOnly.of(f)),O.history(),u.keymap.of([...O.defaultKeymap,...O.historyKeymap,...A.searchKeymap]),A.search(),u.rectangularSelection(),u.crosshairCursor(),ht.markdown(),ft,Se.of(Ne(r)),_.of(K(r,!t)),ve.of(t?ne:[]),Ee.of(p?oe:[]),Fe.of(k?re:[]),De.of(h?se():[]),Me.of(y?ie:[]),J.of({docTitle:x||null,onBacklinksRequested:typeof b=="function"?b:null,onBacklinkClick:typeof S=="function"?S:null}),Re.of(C?ce:[]),mt.of(Array.isArray(F)?F:[]),An,u.EditorView.lineWrapping];return t?w.push(Q.of(te({enableCollapse:o,enableCustomTasks:i,customTaskTypes:a,enableWikiLinks:s,renderWikiLinks:l,onWikiLinkClick:c,enableTags:d,onTagClick:m}))):w.push(Q.of([])),n&&w.push(dt),w}function Yn(e){const t=e.state.field(v),n=t.theme==="light"?"dark":"light";return e.dispatch({effects:[ke.of(n),Se.reconfigure(Ne(n)),_.reconfigure(K(n,t.mode==="raw"))]}),n==="dark"}function Gn(e){const t=e.state.field(v),n=t.mode==="hybrid"?"raw":"hybrid",o=n==="hybrid",r=e.state.facet(V);return e.dispatch({effects:[ge.of(n),Q.reconfigure(o?te({enableCollapse:r.enableCollapse,enableCustomTasks:r.enableCustomTasks,customTaskTypes:r.customTaskTypes}):[]),_.reconfigure(K(t.theme,!o)),ve.reconfigure(o?ne:[])]}),o}function Jn(e){const n=!e.state.field(v).readOnly;return e.dispatch({effects:[be.of(n),Te.reconfigure(g.EditorState.readOnly.of(n))]}),n}function Zn(e,t){e.dispatch({effects:[be.of(t),Te.reconfigure(g.EditorState.readOnly.of(t))]})}function Qn(e){const n=!e.state.field(v).typewriter;return e.dispatch({effects:[we.of(n),Ee.reconfigure(n?oe:[])]}),n}function eo(e,t){e.dispatch({effects:[we.of(t),Ee.reconfigure(t?oe:[])]})}function to(e){return e.state.field(v).typewriter}function no(e){const n=!e.state.field(v).focusMode;return e.dispatch({effects:[Ce.of(n),Fe.reconfigure(n?re:[])]}),n}function oo(e,t){e.dispatch({effects:[Ce.of(t),Fe.reconfigure(t?re:[])]})}function ro(e){return e.state.field(v).focusMode}function io(e){const n=!e.state.field(v).toolbar;return e.dispatch({effects:[xe.of(n),De.reconfigure(n?se():[])]}),n}function so(e,t){e.dispatch({effects:[xe.of(t),De.reconfigure(t?se():[])]})}function co(e){return e.state.field(v).toolbar}function ao(e){const n=!e.state.field(v).wordCount;return e.dispatch({effects:[ye.of(n),Me.reconfigure(n?ie:[])]}),n}function lo(e,t){e.dispatch({effects:[ye.of(t),Me.reconfigure(t?ie:[])]})}function mo(e){return e.state.field(v).wordCount}function fo(e){const n=!e.state.field(v).backlinks;return e.dispatch({effects:[Le.of(n),Re.reconfigure(n?ce:[])]}),n}function uo(e,t){e.dispatch({effects:[Le.of(t),Re.reconfigure(t?ce:[])]})}function po(e){return e.state.field(v).backlinks}function ho(e){const t=e.state.field(H);return e.dispatch({effects:j.of(!t)}),!t}function ko(e,t){e.dispatch({effects:j.of(t)})}function go(e){return e.state.field(H)}function bo(e,t){const n=e.state.field(v);e.dispatch({effects:[ke.of(t),Se.reconfigure(Ne(t)),_.reconfigure(K(t,n.mode==="raw"))]})}function wo(e,t){const n=e.state.field(v),o=t==="hybrid",r=e.state.facet(V);e.dispatch({effects:[ge.of(t),Q.reconfigure(o?te({enableCollapse:r.enableCollapse,enableCustomTasks:r.enableCustomTasks,customTaskTypes:r.customTaskTypes}):[]),_.reconfigure(K(n.theme,!o)),ve.reconfigure(o?ne:[])]})}function Co(e){return e.state.field(v).readOnly}function xo(e){return e.state.field(v).theme}function yo(e){return e.state.field(v).mode}exports.HybridMarkdownConfig=V;exports.actions=P;exports.backlinksPanel=ce;exports.baseTheme=ft;exports.bottomToolbar=se;exports.createNoteIndex=jn;exports.darkTheme=pt;exports.focusModePlugin=re;exports.getMode=yo;exports.getTheme=xo;exports.highlightSelectedLines=ne;exports.hybridMarkdown=Xn;exports.hybridPreview=te;exports.isBacklinks=po;exports.isFocusMode=ro;exports.isFrontmatterSheet=go;exports.isReadOnly=Co;exports.isToolbar=co;exports.isTypewriter=to;exports.isWordCount=mo;exports.lightTheme=ut;exports.markdownKeymap=dt;exports.moreMenu=Kn;exports.resolveWikiLink=qn;exports.setBacklinks=uo;exports.setFocusMode=oo;exports.setFrontmatterSheet=ko;exports.setMode=wo;exports.setReadOnly=Zn;exports.setTheme=bo;exports.setToolbar=so;exports.setTypewriter=eo;exports.setWordCount=lo;exports.tagAutocomplete=zn;exports.toggleBacklinks=fo;exports.toggleFocusMode=no;exports.toggleFrontmatterSheet=ho;exports.toggleHybridMode=Gn;exports.toggleReadOnly=Jn;exports.toggleTheme=Yn;exports.toggleToolbar=io;exports.toggleTypewriter=Qn;exports.toggleWordCount=ao;exports.typewriterPlugin=oe;exports.wikiLinkAutocomplete=Vn;exports.wordCountPanel=ie;
//# sourceMappingURL=index.cjs.map
