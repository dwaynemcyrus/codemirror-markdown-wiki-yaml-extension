"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const u=require("@codemirror/view"),b=require("@codemirror/state"),Lt=require("@codemirror/lang-markdown"),H=require("@codemirror/commands"),$=require("@codemirror/search"),Ze=require("js-yaml"),vt=require("markdown-it"),St=require("markdown-it-emoji"),Qe=require("katex"),Be=require("@lezer/highlight"),V=require("@codemirror/lang-javascript"),Ae=require("@codemirror/lang-python"),Et=require("@codemirror/lang-css"),Tt=require("@codemirror/lang-html"),Mt=require("@codemirror/lang-json"),et=require("mermaid"),R=b.Annotation.define(),tt=["i","!","?","*",">","<"],Ft={i:{emoji:"üß†",label:"Idea",className:"idea"},"!":{emoji:"‚ö†Ô∏è",label:"Urgent",className:"urgent"},"?":{emoji:"‚ùì",label:"Question",className:"question"},"*":{emoji:"‚≠ê",label:"Important",className:"important"},">":{emoji:"‚û°Ô∏è",label:"Forwarded",className:"forwarded"},"<":{emoji:"üìÖ",label:"Scheduled",className:"scheduled"}},nt="[[",Ce="]]";function ee(e){return e===e.trim()}function ot(e){if(!e||!ee(e)||e.includes(`
`)||e.includes("[")||e.includes("]"))return null;const t=e.indexOf("|"),n=t===-1?e:e.slice(0,t),o=t===-1?null:e.slice(t+1);if(!n||o!==null&&(!o||!ee(o)))return null;const i=n.indexOf("#"),s=i===-1?n:n.slice(0,i),a=i===-1?null:n.slice(i+1);if(!s||!ee(s)||a!==null&&(!a||!ee(a)))return null;const r=o??a??s;return{raw:`${nt}${e}${Ce}`,title:s,section:a,alias:o,display:r}}function it(e,t,n){const o="`".repeat(n);return e.indexOf(o,t+n)}function Dt(e){const t=[];let n=0;for(;n<e.length;){if(e[n]==="`"){let o=1;for(;e[n+o]==="`";)o+=1;const i=it(e,n,o);if(i===-1){n+=o;continue}n=i+o;continue}if(e.startsWith(nt,n)){const o=e.indexOf(Ce,n+2);if(o===-1){n+=2;continue}const i=e.slice(n+2,o),s=ot(i);if(s){t.push({from:n,to:o+2,meta:s}),n=o+2;continue}n+=2;continue}n+=1}return t}const Oe=new RegExp("(?:^|(?<=\\s))#([a-zA-Z][\\w/-]*)","g");function Nt(e){const t=[],n=[];let o;const i=/`+/g;for(;(o=i.exec(e))!==null;){const r=o[0].length,l=it(e,o.index,r);l!==-1&&(n.push({from:o.index,to:l+r}),i.lastIndex=l+r)}const s=r=>n.some(l=>r>=l.from&&r<l.to);Oe.lastIndex=0;let a;for(;(a=Oe.exec(e))!==null;){const r=a.index+(a[0].startsWith("#")?0:a[0].indexOf("#"));s(r)||t.push({from:r,to:r+1+a[1].length,tag:a[1]})}return t}const W=new vt({html:!1,linkify:!0,breaks:!1,typographer:!1});W.use(St.full);function Rt(e){e.inline.ruler.before("link","wikilink",(t,n)=>{if(!t.env||t.env.enableWikiLinks!==!0)return!1;const o=t.pos;if(t.src.charCodeAt(o)!==91||t.src.charCodeAt(o+1)!==91)return!1;const i=t.src.indexOf(Ce,o+2);if(i===-1)return!1;const s=t.src.slice(o+2,i),a=ot(s);if(!a)return!1;if(!n){const r=t.push("wikilink","",0);r.meta=a}return t.pos=i+2,!0}),e.renderer.rules.wikilink=(t,n)=>{const o=t[n].meta||{},i=e.utils.escapeHtml,s=['class="md-wikilink"',`data-wikilink="${i(o.raw||"")}"`,`data-wikilink-title="${i(o.title||"")}"`];o.section&&s.push(`data-wikilink-section="${i(o.section)}"`),o.alias&&s.push(`data-wikilink-alias="${i(o.alias)}"`);const a=i(o.display||o.title||"");return`<span ${s.join(" ")}>${a}</span>`}}const It=/^#([a-zA-Z][\w/-]*)/;function Wt(e){e.inline.ruler.before("link","tag",(t,n)=>{if(!t.env||t.env.enableTags!==!0)return!1;const o=t.pos;if(t.src.charCodeAt(o)!==35)return!1;if(o>0){const r=t.src.charCodeAt(o-1);if(r!==32&&r!==9&&r!==10&&r!==13)return!1}const s=t.src.slice(o).match(It);if(!s)return!1;const a=s[1];if(!n){const r=t.push("tag","",0);r.meta={tag:a}}return t.pos=o+1+a.length,!0}),e.renderer.rules.tag=(t,n)=>{const o=t[n].meta||{},i=e.utils.escapeHtml,s=i(o.tag||"");return`<span class="md-tag" data-tag="${s}">#${s}</span>`}}function Pt(e){e.inline.ruler.before("escape","katex_inline",(t,n)=>{const o=t.pos;if(t.src.charCodeAt(o)!==36||t.src.charCodeAt(o+1)===36)return!1;let i=o+1;for(;(i=t.src.indexOf("$",i))!==-1&&t.src.charCodeAt(i-1)===92;)i+=1;if(i===-1)return!1;const s=t.src.slice(o+1,i);if(!s||s.includes(`
`))return!1;if(!n){const a=t.push("math_inline","",0);a.content=s}return t.pos=i+1,!0}),e.renderer.rules.math_inline=(t,n)=>{try{return Qe.renderToString(t[n].content,{displayMode:!1,throwOnError:!1})}catch{return t[n].content}}}function Bt(e){e.inline.ruler.before("emphasis","highlight",(t,n)=>{const o=t.pos;if(t.src.charCodeAt(o)!==61||t.src.charCodeAt(o+1)!==61)return!1;let i=o+2;for(;(i=t.src.indexOf("==",i))!==-1&&!(i>o+2);)i+=2;if(i===-1)return!1;const s=t.src.slice(o+2,i);return!s||s.includes(`
`)?!1:(n||(t.push("mark_open","mark",1).attrSet("class","md-highlight"),e.inline.parse(s,e,t.env,t.tokens),t.push("mark_close","mark",-1)),t.pos=i+2,!0)})}function At(e){e.inline.ruler.before("emphasis","subscript",(t,n)=>{const o=t.pos;if(t.src.charCodeAt(o)!==126||t.src.charCodeAt(o+1)===126)return!1;let i=o+1;for(;(i=t.src.indexOf("~",i))!==-1;){if(t.src.charCodeAt(i-1)===92){i+=1;continue}if(t.src.charCodeAt(i+1)===126){i+=1;continue}break}if(i===-1)return!1;const s=t.src.slice(o+1,i);return!s||s.includes(`
`)?!1:(n||(t.push("sub_open","sub",1).attrSet("class","md-subscript"),e.inline.parse(s,e,t.env,t.tokens),t.push("sub_close","sub",-1)),t.pos=i+1,!0)})}function Ot(e){e.inline.ruler.before("emphasis","superscript",(t,n)=>{const o=t.pos;if(t.src.charCodeAt(o)!==94||t.src.charCodeAt(o+1)===94)return!1;let i=o+1;for(;(i=t.src.indexOf("^",i))!==-1;){if(t.src.charCodeAt(i-1)===92){i+=1;continue}break}if(i===-1)return!1;const s=t.src.slice(o+1,i);return!s||s.includes(`
`)?!1:(n||(t.push("sup_open","sup",1).attrSet("class","md-superscript"),e.inline.parse(s,e,t.env,t.tokens),t.push("sup_close","sup",-1)),t.pos=i+1,!0)})}function zt(e){e.inline.ruler.before("link","footnote_ref",(t,n)=>{const o=t.pos;if(t.src.charCodeAt(o)!==91||t.src.charCodeAt(o+1)!==94)return!1;const i=t.src.indexOf("]",o+2);if(i===-1)return!1;const s=t.src.slice(o+2,i);if(!s)return!1;if(!n){const a=t.push("footnote_ref","",0);a.meta={id:s}}return t.pos=i+1,!0}),e.renderer.rules.footnote_ref=(t,n)=>{const o=t[n].meta.id;return`<sup class="footnote-ref"><span class="footnote-link" data-footnote="${o}">[${o}]</span></sup>`}}Pt(W);Bt(W);At(W);Ot(W);zt(W);Rt(W);Wt(W);function $t(e){try{return Qe.renderToString(e,{displayMode:!0,throwOnError:!1})}catch{return`<span class="math-error">${e}</span>`}}function Ht(e,t,n={}){const o=N(t,n);return`<span class="footnote-def">[${e}]: ${o} <span class="md-footnote-backref-link" data-footnote-ref="${e}" title="Back to reference">‚Ü©</span></span>`}function N(e,t={}){const n={enableWikiLinks:t.enableWikiLinks===!0,enableTags:t.enableTags===!0};return W.renderInline(e,n)}function jt(e,t,n={}){if(!t.length)return"";const o=t[0].match(/^\[\^([^\]]+)\]:\s*(.*)$/),i=o?o[2]:t[0],s=[],a=N(i,n);s.push(`<div class="md-footnote-line md-footnote-first">[${e}]: ${a}</div>`);for(let r=1;r<t.length;r++){const l=t[r].replace(/^\s{2,}|\t/,""),c=l.trim()?N(l,n):"";s.push(`<div class="md-footnote-line md-footnote-continuation">${c}</div>`)}return s.push(`<div class="md-footnote-backref"><span class="md-footnote-backref-link" data-footnote-ref="${e}" title="Back to reference">‚Ü©</span></div>`),`<div class="md-footnote-block" data-footnote="${e}">${s.join("")}</div>`}function qt(e,t={}){if(e.length===0)return"";const n=e[0].trim(),o=[];let i=null;for(let r=1;r<e.length;r++){const l=e[r],c=l.match(/^\s*:\s*(.*)$/);if(c){i&&o.push(i),i=[c[1]];continue}if(i){const d=l.replace(/^\s{2,}|\t/,"");i.push(d)}}i&&o.push(i);const s=N(n,t),a=o.map(r=>`<dd>${r.map(c=>N(c,t)).join("<br>")}</dd>`).join("");return`<dl class="md-definition-list"><dt>${s}</dt>${a}</dl>`}function rt(e,t={}){if(!e.trim())return e;const n=t.enableCustomTasks===!0,o=Array.isArray(t.customTaskTypes)?t.customTaskTypes:tt,i=t.customTaskTypeSet??new Set(o),s=t.enableWikiLinks===!0,a={...t,enableWikiLinks:s},r=e.match(/^\[\^([^\]]+)\]:\s*(.*)$/);if(r)return Ht(r[1],r[2],a);const l=e.match(/^(#{1,6})\s+(.*)$/);if(l){const d=l[1].length;let m=l[2],f=null;const p=m.match(/^(.*)\s+(?:\[#([A-Za-z0-9_-]+)\]|\{#([A-Za-z0-9_-]+)\})\s*$/);p&&(m=p[1],f=p[2]||p[3]);const k=f?` id="${f}" data-heading-id="${f}"`:"";return`<span class="md-header md-h${d}"${k}>${N(m,a)}</span>`}if(e.startsWith(">")){const d=e.replace(/^>\s*/,"");return`<span class="md-blockquote">${N(d,a)}</span>`}const c=e.match(/^(\s*)([-*+]|\d+\.)\s+(.*)$/);if(c){const d=c[2],m=c[3],f=m.match(/^\[([ xX])\]\s*(.*)$/);if(f){const p=f[1].toLowerCase()==="x",k=p?"‚úÖ":"‚¨úÔ∏è",h=p?"Completed":"Incomplete";return`<span class="md-list-item md-task-item"><span class="md-list-marker">${d}</span> <span class="md-task-icon md-task-${p?"complete":"incomplete"}" data-task="${p?"x":" "}" role="button" aria-label="${h}" title="${h}">${k}</span> ${N(f[2],a)}</span>`}if(n){const p=m.match(/^\[([!?>i*<])\]\s*(.*)$/);if(p){const k=p[1],h=Ft[k];if(h&&i.has(k))return`<span class="md-list-item md-task-item"><span class="md-list-marker">${d}</span> <span class="md-task-icon md-task-${h.className}" data-task="${k}" role="button" aria-label="${h.label}" title="${h.label}">${h.emoji}</span> ${N(p[2],a)}</span>`}}return`<span class="md-list-item"><span class="md-list-marker">${d}</span> ${N(m,a)}</span>`}if(/^(-{3,}|_{3,}|\*{3,})$/.test(e.trim()))return'<hr class="md-hr">';if(e.trim().startsWith("|")&&e.trim().endsWith("|")){const d=e.trim();return/^\|[-:\s|]+\|$/.test(d)&&d.includes("-")?'<span class="md-table-separator"></span>':`<span class="md-table-row">${d.slice(1,-1).split("|").map(p=>p.trim()).map(p=>`<span class="md-table-cell">${N(p,a)}</span>`).join("")}</span>`}return N(e,a)}function Vt(e,t={}){if(e.length===0)return"";const n=l=>{const c=l.trim();return!c.startsWith("|")||!c.endsWith("|")?null:c.slice(1,-1).split("|").map(d=>d.trim())},o=l=>{const c=l.trim();return/^\|[-:\s|]+\|$/.test(c)&&c.includes("-")};let i=null,s=[],a=!1;for(const l of e){if(o(l)){a=!0;continue}const c=n(l);c&&(!a&&!i?i=c:s.push(c))}let r='<table class="md-table">';if(i){r+="<thead><tr>";for(const l of i)r+=`<th>${N(l,t)}</th>`;r+="</tr></thead>"}if(s.length>0){r+="<tbody>";for(const l of s){r+="<tr>";for(const c of l)r+=`<td>${N(c,t)}</td>`;r+="</tr>"}r+="</tbody>"}return r+="</table>",r}const _t={javascript:V.javascript,js:V.javascript,typescript:()=>V.javascript({typescript:!0}),ts:()=>V.javascript({typescript:!0}),jsx:()=>V.javascript({jsx:!0}),tsx:()=>V.javascript({jsx:!0,typescript:!0}),python:Ae.python,py:Ae.python,css:Et.css,html:Tt.html,json:Mt.json};function te(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Kt(e,t){const n=_t[t==null?void 0:t.toLowerCase()];if(!n)return te(e);const i=n().language.parser.parse(e);let s="",a=0;return Be.highlightTree(i,Be.classHighlighter,(r,l,c)=>{r>a&&(s+=te(e.slice(a,r))),s+=`<span class="${c}">${te(e.slice(r,l))}</span>`,a=l}),a<e.length&&(s+=te(e.slice(a))),s}const st=b.Facet.define({combine(e){return e.length>0?e[e.length-1]:!0}}),we=tt,ct=/^(\s*(?:[-*+]|\d+\.)\s+)\[([ xX!?>i*<])\]/;function Ut(e){if(!Array.isArray(e))return[...we];const t=[],n=new Set;for(const o of e){if(typeof o!="string"||o.length===0)continue;const i=o.toLowerCase();we.includes(i)&&(n.has(i)||(n.add(i),t.push(i)))}return t}function Yt(e){return[" ","x",...e]}function at(e,t){const n=Ut(t);return{enableCustomTasks:e===!0,customTaskTypes:n,customTaskTypeSet:new Set(n),taskCycle:Yt(n)}}const ie=b.Facet.define({combine(e){return e.length===0?at(!1,we):e[e.length-1]}});function lt(e,t,n){const o=e===!0;return{enableWikiLinks:o,renderWikiLinks:o&&t!==!1,onWikiLinkClick:typeof n=="function"?n:null}}const q=b.Facet.define({combine(e){return e.length===0?lt(!1,!1,null):e[e.length-1]}});function dt(e,t){return{enableTags:e===!0,onTagClick:typeof t=="function"?t:null}}const se=b.Facet.define({combine(e){return e.length===0?dt(!1,null):e[e.length-1]}});function Xt(e,t){const n=e.match(ct);if(!n)return null;const o=n[2].toLowerCase();return o===" "||o==="x"||t.enableCustomTasks&&t.customTaskTypeSet.has(o)?o:null}function Gt(e,t){if(!Array.isArray(t)||t.length===0)return e;const n=t.indexOf(e);return n===-1?t[0]:t[(n+1)%t.length]}function Jt(e,t){return e.replace(ct,`$1[${t}]`)}function Y(e){return{raw:e.getAttribute("data-wikilink")||"",title:e.getAttribute("data-wikilink-title")||"",section:e.getAttribute("data-wikilink-section")||"",alias:e.getAttribute("data-wikilink-alias")||"",display:e.textContent||""}}const xe=b.StateEffect.define(),mt=b.StateField.define({create(){return new Set},update(e,t){let n=e;for(const o of t.effects)o.is(xe)&&(n=new Set(e),n.has(o.value)?n.delete(o.value):n.add(o.value));if(t.docChanged&&n.size>0){const o=new Set;for(const i of n){const s=t.startState.doc;if(i<=s.lines){const a=s.line(i),r=t.changes.mapPos(a.from),l=t.newDoc.lineAt(r).number,c=t.newDoc.line(l).text;/^#{1,6}\s/.test(c)&&o.add(l)}}n=o}return n}});et.initialize({startOnLoad:!1,theme:"base",securityLevel:"loose",themeVariables:{primaryColor:"#f5f5f5",secondaryColor:"#f5f5f5",tertiaryColor:"#f5f5f5",primaryBorderColor:"#ddd",secondaryBorderColor:"#ddd",tertiaryBorderColor:"#ddd",lineColor:"#aaa",edgeLabelBackground:"#fff"}});class Zt extends u.WidgetType{constructor(t,n,o){super(),this.content=t,this.lineFrom=n,this.lineTo=o}toDOM(t){const n=document.createElement("span");n.className="cm-markdown-preview";const o=t.state.facet(ie),i=t.state.facet(q),s=t.state.facet(se);n.innerHTML=rt(this.content,{...o,enableWikiLinks:i.renderWikiLinks,enableTags:s.enableTags});const a=this.lineFrom,r=this.lineTo,l=this.content;return n.addEventListener("mousedown",c=>{const d=c.target.closest("[data-tag]");if(d&&s.onTagClick){c.preventDefault(),c.stopPropagation(),s.onTagClick(d.getAttribute("data-tag"));return}const m=c.target.closest("[data-footnote]");if(m){c.preventDefault(),c.stopPropagation();const x=m.getAttribute("data-footnote"),T=t.state.doc;for(let S=1;S<=T.lines;S++){const F=T.line(S);if(F.text.match(new RegExp(`^\\[\\^${x}\\]:`))){t.dispatch({selection:{anchor:F.from},scrollIntoView:!0}),t.focus();return}}return}const f=c.target.closest("[data-footnote-ref]");if(f){c.preventDefault(),c.stopPropagation();const x=f.getAttribute("data-footnote-ref"),T=t.state.doc;for(let S=1;S<=T.lines;S++){const F=T.line(S);if(F.text.match(new RegExp(`\\[\\^${x}\\](?!:)`))){t.dispatch({selection:{anchor:F.from},scrollIntoView:!0}),t.focus();return}}return}const p=c.target.closest("[data-wikilink]");if(p&&i.onWikiLinkClick){c.preventDefault(),c.stopPropagation(),i.onWikiLinkClick(Y(p));return}const k=c.target.closest("a");if(k&&k.href){c.preventDefault(),c.stopPropagation(),window.open(k.href,"_blank","noopener,noreferrer");return}if(c.target.closest('input[type="checkbox"], .md-task-icon')){c.preventDefault(),c.stopPropagation();const x=t.state.facet(ie),T=Xt(l,x);if(!T)return;const S=x.enableCustomTasks?Gt(T,x.taskCycle):T==="x"?" ":"x",F=Jt(l,S);F!==l&&t.dispatch({changes:{from:a,to:r,insert:F},annotations:R.of(!0)});return}c.preventDefault(),c.stopPropagation();const w=n.getBoundingClientRect(),g=c.clientX-w.left,y=w.width,C=l.length;let L;if(y>0&&C>0){const x=g/y;L=Math.round(x*C),L=Math.max(0,Math.min(L,C))}else L=0;const v=a+L;t.dispatch({selection:{anchor:v},scrollIntoView:!0}),t.focus()}),n}eq(t){return t.content===this.content&&t.lineFrom===this.lineFrom&&t.lineTo===this.lineTo}ignoreEvent(t){return t.type!=="mousedown"}}class Qt extends u.WidgetType{constructor(t,n,o,i,s,a,r){super(),this.content=t,this.lineFrom=n,this.lineTo=o,this.lineNumber=i,this.level=s,this.isCollapsed=a,this.hasContent=r}toDOM(t){const n=document.createElement("span");if(n.className="cm-markdown-preview cm-heading-preview",this.hasContent){const c=document.createElement("span");c.className=`cm-collapse-toggle ${this.isCollapsed?"collapsed":"expanded"}`,c.textContent="‚Ä∫",c.title=this.isCollapsed?"Expand":"Collapse";const d=this.lineNumber;c.addEventListener("click",m=>{m.preventDefault(),m.stopPropagation(),m.stopImmediatePropagation(),t.dispatch({effects:xe.of(d)})}),c.addEventListener("mousedown",m=>{m.preventDefault(),m.stopPropagation(),m.stopImmediatePropagation()}),n.appendChild(c)}const o=document.createElement("span"),i=t.state.facet(ie),s=t.state.facet(q),a=t.state.facet(se);o.innerHTML=rt(this.content,{...i,enableWikiLinks:s.renderWikiLinks,enableTags:a.enableTags}),n.appendChild(o);const r=this.lineFrom;this.lineTo;const l=this.content;return o.addEventListener("mousedown",c=>{const d=c.target.closest("[data-tag]");if(d&&a.onTagClick){c.preventDefault(),c.stopPropagation(),a.onTagClick(d.getAttribute("data-tag"));return}const m=c.target.closest("[data-wikilink]");if(m&&s.onWikiLinkClick){c.preventDefault(),c.stopPropagation(),s.onWikiLinkClick(Y(m));return}const f=c.target.closest("a");if(f&&f.href){c.preventDefault(),c.stopPropagation(),window.open(f.href,"_blank","noopener,noreferrer");return}c.preventDefault(),c.stopPropagation();const p=o.getBoundingClientRect(),k=c.clientX-p.left,h=p.width,w=l.length;let g;if(h>0&&w>0){const C=k/h;g=Math.round(C*w),g=Math.max(0,Math.min(g,w))}else g=0;const y=r+g;t.dispatch({selection:{anchor:y},scrollIntoView:!0}),t.focus()}),n}eq(t){return t.content===this.content&&t.lineFrom===this.lineFrom&&t.lineTo===this.lineTo&&t.isCollapsed===this.isCollapsed&&t.hasContent===this.hasContent}ignoreEvent(t){return t.type!=="mousedown"}}function I(e){const t=new Set;for(const n of e.selection.ranges){const o=e.doc.lineAt(n.from).number,i=e.doc.lineAt(n.to).number;for(let s=o;s<=i;s++)t.add(s)}return t}function en(e){if(e.lines<2||e.line(1).text.trim()!=="---")return null;for(let n=2;n<=e.lines;n++){const o=e.line(n).text.trim();if(o==="---"||o==="...")return{start:1,end:n}}return null}function tn(e){const t=[];let n=!1,o=0,i="";for(let s=1;s<=e.lines;s++){const r=e.line(s).text;r.startsWith("```")&&(n?(t.push({start:o,end:s,language:i}),n=!1,i=""):(n=!0,o=s,i=r.slice(3).trim()))}return n&&t.push({start:o,end:e.lines,language:i}),t}function nn(e,t){const n=[];let o=null;for(let i=1;i<=e.lines;i++){if(t.has(i)){o!==null&&(o=null);continue}e.line(i).text.trim()==="$$"&&(o===null?o=i:(n.push({start:o,end:i}),o=null))}return n}function on(e,t){const n=[];let o=null;for(let i=1;i<=e.lines;i++){if(t.has(i)){o!==null&&(n.push({start:o,end:i-1}),o=null);continue}const a=e.line(i).text.trim();a.startsWith("|")&&a.endsWith("|")?o===null&&(o=i):o!==null&&(n.push({start:o,end:i-1}),o=null)}return o!==null&&n.push({start:o,end:e.lines}),n}function ft(e){return/^(\s{2,}|\t)/.test(e)}function rn(e,t){const n=[];for(let o=1;o<=e.lines;o++){if(t.has(o))continue;const s=e.line(o).text.match(/^\[\^([^\]]+)\]:\s*(.*)$/);if(!s)continue;const a=s[1];let r=o;for(let l=o+1;l<=e.lines&&!t.has(l);l++){const c=e.line(l).text;if(!ft(c))break;r=l}n.push({start:o,end:r,id:a}),o=r}return n}function sn(e,t,n){const o=[],i=a=>/^\s*:\s*/.test(a),s=a=>{if(!a.trim()||/^\s/.test(a)||/^[-*+]\s+/.test(a)||/^\d+\.\s+/.test(a)||/^>/.test(a)||/^#{1,6}\s+/.test(a))return!1;const r=a.trim();return!(r.startsWith("|")&&r.endsWith("|")||/^\[\^([^\]]+)\]:/.test(a))};for(let a=1;a<=e.lines;a++){if(t.has(a)||n.has(a))continue;const r=e.line(a).text;if(!s(r))continue;const l=a+1;if(l>e.lines||t.has(l)||n.has(l))continue;const c=e.line(l).text;if(!i(c))continue;let d=l;for(let m=l+1;m<=e.lines&&!(t.has(m)||n.has(m));m++){const f=e.line(m).text;if(i(f)||ft(f)){d=m;continue}break}o.push({start:a,end:d}),a=d}return o}function z(e){const t=new Set;for(const n of e)for(let o=n.start;o<=n.end;o++)t.add(o);return t}function cn(e,t){const n=[];for(let o=1;o<=e.lines;o++){if(t.has(o))continue;const s=e.line(o).text.match(/^(#{1,6})\s+/);s&&n.push({line:o,level:s[1].length,endLine:e.lines})}for(let o=0;o<n.length;o++){const i=n[o];for(let s=o+1;s<n.length;s++)if(n[s].level<=i.level){i.endLine=n[s].line-1;break}}return n}function an(e){const t=new Map;for(const n of e)for(let o=n.line+1;o<=n.endLine;o++)t.has(o)||t.set(o,n.line);return t}const M=b.StateField.define({create(e){return ze(e.doc)},update(e,t){return t.docChanged?ze(t.newDoc):e}});function ze(e){const t=en(e),n=t?z([t]):new Set,o=tn(e),i=z(o),s=nn(e,i),a=z(s),r=on(e,i),l=z(r),c=rn(e,i),d=z(c),m=sn(e,i,d),f=z(m),p=o.filter(g=>g.language==="mermaid"),k=z(p),h=cn(e,i),w=an(h);return{frontmatter:t,frontmatterLines:n,codeBlocks:o,codeBlockLines:i,mathBlocks:s,mathBlockLines:a,tables:r,tableLines:l,footnoteBlocks:c,footnoteBlockLines:d,definitionLists:m,definitionListLines:f,mermaidBlocks:p,mermaidBlockLines:k,headings:h,headingMap:w}}class ln extends u.WidgetType{constructor(t,n,o){super(),this.content=t,this.mathFrom=n,this.mathTo=o}toDOM(t){const n=document.createElement("div");n.className="cm-math-preview",n.innerHTML=$t(this.content);const o=this.mathFrom;return n.addEventListener("mousedown",i=>{i.preventDefault(),i.stopPropagation(),t.dispatch({selection:{anchor:o},scrollIntoView:!0}),t.focus()}),n}eq(t){return t.content===this.content}ignoreEvent(t){return t.type!=="mousedown"}}class dn extends u.WidgetType{constructor(t,n,o){super(),this.content=t,this.mermaidFrom=n,this.mermaidTo=o,this.id="mermaid-"+Math.random().toString(36).substr(2,9)}toDOM(t){const n=document.createElement("div");n.className="cm-mermaid-preview";const o=this.mermaidFrom,i=this.content,s=this.id;return(async()=>{try{const{svg:a}=await et.render(s,i);n.innerHTML=a}catch(a){n.innerHTML=`<pre class="mermaid-error">${a.message}</pre>`}})(),n.addEventListener("mousedown",a=>{a.preventDefault(),a.stopPropagation(),t.dispatch({selection:{anchor:o},scrollIntoView:!0}),t.focus()}),n}eq(t){return t.content===this.content}ignoreEvent(t){return t.type!=="mousedown"}}class mn extends u.WidgetType{constructor(t,n,o){super(),this.rows=t,this.tableFrom=n,this.tableTo=o}toDOM(t){const n=document.createElement("div");n.className="cm-table-preview";const o=t.state.facet(q);n.innerHTML=Vt(this.rows,{enableWikiLinks:o.renderWikiLinks});const i=this.tableFrom;return n.addEventListener("mousedown",s=>{const a=s.target.closest("[data-wikilink]");if(a&&o.onWikiLinkClick){s.preventDefault(),s.stopPropagation(),o.onWikiLinkClick(Y(a));return}s.preventDefault(),s.stopPropagation(),t.dispatch({selection:{anchor:i},scrollIntoView:!0}),t.focus()}),n}eq(t){if(t.rows.length!==this.rows.length)return!1;for(let n=0;n<this.rows.length;n++)if(t.rows[n]!==this.rows[n])return!1;return!0}ignoreEvent(t){return t.type!=="mousedown"}}class fn extends u.WidgetType{constructor(t,n,o,i){super(),this.id=t,this.lines=n,this.from=o,this.to=i}toDOM(t){const n=document.createElement("div");n.className="cm-footnote-preview";const o=t.state.facet(q);n.innerHTML=jt(this.id,this.lines,{enableWikiLinks:o.renderWikiLinks});const i=this.from;return n.addEventListener("mousedown",s=>{const a=s.target.closest("[data-wikilink]");if(a&&o.onWikiLinkClick){s.preventDefault(),s.stopPropagation(),o.onWikiLinkClick(Y(a));return}const r=s.target.closest("[data-footnote-ref]");if(r){s.preventDefault(),s.stopPropagation();const l=r.getAttribute("data-footnote-ref"),c=t.state.doc;for(let d=1;d<=c.lines;d++){const m=c.line(d);if(m.text.match(new RegExp(`\\[\\^${l}\\](?!:)`))){t.dispatch({selection:{anchor:m.from},scrollIntoView:!0}),t.focus();return}}}s.preventDefault(),s.stopPropagation(),t.dispatch({selection:{anchor:i},scrollIntoView:!0}),t.focus()}),n}eq(t){if(t.id!==this.id||t.lines.length!==this.lines.length)return!1;for(let n=0;n<this.lines.length;n++)if(t.lines[n]!==this.lines[n])return!1;return!0}ignoreEvent(t){return t.type!=="mousedown"}}class un extends u.WidgetType{constructor(t,n,o){super(),this.lines=t,this.from=n,this.to=o}toDOM(t){const n=document.createElement("div");n.className="cm-definition-list-preview";const o=t.state.facet(q);n.innerHTML=qt(this.lines,{enableWikiLinks:o.renderWikiLinks});const i=this.from;return n.addEventListener("mousedown",s=>{const a=s.target.closest("[data-wikilink]");if(a&&o.onWikiLinkClick){s.preventDefault(),s.stopPropagation(),o.onWikiLinkClick(Y(a));return}s.preventDefault(),s.stopPropagation(),t.dispatch({selection:{anchor:i},scrollIntoView:!0}),t.focus()}),n}eq(t){if(t.lines.length!==this.lines.length)return!1;for(let n=0;n<this.lines.length;n++)if(t.lines[n]!==this.lines[n])return!1;return!0}ignoreEvent(t){return t.type!=="mousedown"}}function pn(e,t,n){for(const o of t)if(n.has(o.line)&&e>o.line&&e<=o.endLine)return!0;return!1}function hn(e,t){for(const n of t)if(n.line===e)return n;return null}function $e(e,t){const{state:n}=e,i=e.hasFocus?I(n):new Set,{frontmatterLines:s,codeBlockLines:a,tableLines:r,mathBlockLines:l,footnoteBlockLines:c,definitionListLines:d,headings:m}=t,f=[],p=n.facet(st),k=p?n.field(mt):new Set;for(const{from:h,to:w}of e.visibleRanges){const g=n.doc.lineAt(h).number,y=n.doc.lineAt(w).number;for(let C=g;C<=y;C++){if(p&&pn(C,m,k)){const x=n.doc.line(C);f.push(u.Decoration.line({class:"cm-collapsed-line"}).range(x.from));continue}if(s.has(C)||i.has(C)||a.has(C)||r.has(C)||l.has(C)||c.has(C)||d.has(C))continue;const L=n.doc.line(C),v=L.text;if(!ut(v)&&v.trim()){if(p){const x=hn(C,m);if(x){const T=x.endLine>x.line,S=k.has(C);f.push(u.Decoration.replace({widget:new Qt(v,L.from,L.to,C,x.level,S,T),inclusive:!1,block:!1}).range(L.from,L.to));continue}}f.push(u.Decoration.replace({widget:new Zt(v,L.from,L.to),inclusive:!1,block:!1}).range(L.from,L.to))}}}return u.Decoration.set(f,!0)}function He(e,t){if(!e.state.facet(q).enableWikiLinks||!e.hasFocus)return u.Decoration.none;const{state:o}=e,i=I(o),{codeBlockLines:s}=t,a=[];for(const{from:r,to:l}of e.visibleRanges){const c=o.doc.lineAt(r).number,d=o.doc.lineAt(l).number;for(let m=c;m<=d;m++){if(!i.has(m)||s.has(m))continue;const f=o.doc.line(m);if(!f.text.includes("[["))continue;const p=Dt(f.text);for(const k of p)a.push(u.Decoration.mark({class:"cm-wikilink"}).range(f.from+k.from,f.from+k.to))}}return u.Decoration.set(a,!0)}const gn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(M);this.decorations=$e(e,t)}update(e){const t=e.transactions.some(n=>n.effects.some(o=>o.is(xe)));if(e.docChanged||e.selectionSet||e.viewportChanged||e.focusChanged||t){const n=e.state.field(M);this.decorations=$e(e.view,n)}}},{decorations:e=>e.decorations}),kn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(M);this.decorations=He(e,t)}update(e){if(e.docChanged||e.selectionSet||e.viewportChanged||e.focusChanged){const t=e.state.field(M);this.decorations=He(e.view,t)}}},{decorations:e=>e.decorations});function je(e,t){if(!e.state.facet(se).enableTags||!e.hasFocus)return u.Decoration.none;const{state:o}=e,i=I(o),{codeBlockLines:s}=t,a=[];for(const{from:r,to:l}of e.visibleRanges){const c=o.doc.lineAt(r).number,d=o.doc.lineAt(l).number;for(let m=c;m<=d;m++){if(!i.has(m)||s.has(m))continue;const f=o.doc.line(m);if(!f.text.includes("#"))continue;const p=Nt(f.text);for(const k of p)a.push(u.Decoration.mark({class:"cm-tag-mark"}).range(f.from+k.from,f.from+k.to))}}return u.Decoration.set(a,!0)}const bn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(M);this.decorations=je(e,t)}update(e){if(e.docChanged||e.selectionSet||e.viewportChanged||e.focusChanged){const t=e.state.field(M);this.decorations=je(e.view,t)}}},{decorations:e=>e.decorations});class wn extends u.WidgetType{constructor(t,n,o,i){super(),this.content=t,this.language=n,this.lineFrom=o,this.lineTo=i}toDOM(t){const n=document.createElement("span");n.className="cm-highlighted-code",n.innerHTML=Kt(this.content,this.language);const o=this.lineFrom;this.lineTo;const i=this.content;return n.addEventListener("mousedown",s=>{s.preventDefault(),s.stopPropagation();const a=n.getBoundingClientRect(),r=s.clientX-a.left,l=a.width,c=i.length;let d=0;if(l>0&&c>0){const f=r/l;d=Math.round(f*c),d=Math.max(0,Math.min(d,c))}const m=o+d;t.dispatch({selection:{anchor:m},scrollIntoView:!0}),t.focus()}),n}eq(t){return t.content===this.content&&t.language===this.language}ignoreEvent(t){return t.type!=="mousedown"}}function qe(e,t){const{state:n}=e,o=e.hasFocus,i=[],{codeBlocks:s}=t,a=o?I(n):new Set;for(const r of s){if(r.language==="mermaid")continue;let l=!1;for(let d=r.start;d<=r.end;d++)if(a.has(d)){l=!0;break}const c=r.end-r.start>1;for(let d=r.start;d<=r.end;d++){const m=n.doc.line(d),f=d===r.start||d===r.end;if(f&&!l&&c){i.push(u.Decoration.replace({}).range(m.from,m.to));continue}const p=l?"cm-code-block-line cm-code-block-focused":"cm-code-block-line";i.push(u.Decoration.line({class:p}).range(m.from));const k=a.has(d);!f&&!k&&m.text.length>0&&i.push(u.Decoration.replace({widget:new wn(m.text,r.language,m.from,m.to)}).range(m.from,m.to))}}return u.Decoration.set(i,!0)}const Cn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(M);this.decorations=qe(e,t)}update(e){if(e.docChanged||e.selectionSet||e.focusChanged){const t=e.state.field(M);this.decorations=qe(e.view,t)}}},{decorations:e=>e.decorations});function Ve(e,t){const{state:n}=e,o=e.hasFocus,i=[],{tables:s}=t,a=o?I(n):new Set;for(const r of s){let l=!1;for(let c=r.start;c<=r.end;c++)if(a.has(c)){l=!0;break}if(l)for(let c=r.start;c<=r.end;c++){const d=n.doc.line(c);i.push(u.Decoration.line({class:"cm-table-line"}).range(d.from))}else{const c=[];for(let m=r.start;m<=r.end;m++)c.push(n.doc.line(m).text);const d=n.doc.line(r.start);i.push(u.Decoration.replace({widget:new mn(c,d.from,d.to)}).range(d.from,d.to));for(let m=r.start+1;m<=r.end;m++){const f=n.doc.line(m);i.push(u.Decoration.line({class:"cm-hidden-line"}).range(f.from),u.Decoration.replace({}).range(f.from,f.to))}}}return u.Decoration.set(i,!0)}const xn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(M);this.decorations=Ve(e,t)}update(e){if(e.docChanged||e.selectionSet||e.focusChanged){const t=e.state.field(M);this.decorations=Ve(e.view,t)}}},{decorations:e=>e.decorations});function _e(e,t){const{state:n}=e,o=e.hasFocus,i=[],{footnoteBlocks:s}=t,a=o?I(n):new Set;for(const r of s){let l=!1;for(let c=r.start;c<=r.end;c++)if(a.has(c)){l=!0;break}if(l)for(let c=r.start;c<=r.end;c++){const d=n.doc.line(c);i.push(u.Decoration.line({class:"cm-footnote-line"}).range(d.from))}else{const c=[];for(let m=r.start;m<=r.end;m++)c.push(n.doc.line(m).text);const d=n.doc.line(r.start);i.push(u.Decoration.replace({widget:new fn(r.id,c,d.from,d.to)}).range(d.from,d.to));for(let m=r.start+1;m<=r.end;m++){const f=n.doc.line(m);i.push(u.Decoration.line({class:"cm-hidden-line"}).range(f.from),u.Decoration.replace({}).range(f.from,f.to))}}}return u.Decoration.set(i,!0)}const yn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(M);this.decorations=_e(e,t)}update(e){if(e.docChanged||e.selectionSet||e.focusChanged){const t=e.state.field(M);this.decorations=_e(e.view,t)}}},{decorations:e=>e.decorations});function Ke(e,t){const{state:n}=e,o=e.hasFocus,i=[],{definitionLists:s}=t,a=o?I(n):new Set;for(const r of s){let l=!1;for(let c=r.start;c<=r.end;c++)if(a.has(c)){l=!0;break}if(l)for(let c=r.start;c<=r.end;c++){const d=n.doc.line(c);i.push(u.Decoration.line({class:"cm-definition-list-line"}).range(d.from))}else{const c=[];for(let m=r.start;m<=r.end;m++)c.push(n.doc.line(m).text);const d=n.doc.line(r.start);i.push(u.Decoration.replace({widget:new un(c,d.from,d.to)}).range(d.from,d.to));for(let m=r.start+1;m<=r.end;m++){const f=n.doc.line(m);i.push(u.Decoration.line({class:"cm-hidden-line"}).range(f.from),u.Decoration.replace({}).range(f.from,f.to))}}}return u.Decoration.set(i,!0)}const Ln=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(M);this.decorations=Ke(e,t)}update(e){if(e.docChanged||e.selectionSet||e.focusChanged){const t=e.state.field(M);this.decorations=Ke(e.view,t)}}},{decorations:e=>e.decorations});function Ue(e,t){const{state:n}=e,o=e.hasFocus,i=[],{mathBlocks:s}=t,a=o?I(n):new Set;for(const r of s){let l=!1;for(let c=r.start;c<=r.end;c++)if(a.has(c)){l=!0;break}if(l)for(let c=r.start;c<=r.end;c++){const d=n.doc.line(c);i.push(u.Decoration.line({class:"cm-math-block-line"}).range(d.from))}else{const c=[];for(let f=r.start+1;f<r.end;f++)c.push(n.doc.line(f).text);const d=c.join(`
`),m=n.doc.line(r.start);i.push(u.Decoration.replace({widget:new ln(d,m.from,m.to)}).range(m.from,m.to));for(let f=r.start+1;f<=r.end;f++){const p=n.doc.line(f);i.push(u.Decoration.line({class:"cm-hidden-line"}).range(p.from),u.Decoration.replace({}).range(p.from,p.to))}}}return u.Decoration.set(i,!0)}const vn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(M);this.decorations=Ue(e,t)}update(e){if(e.docChanged||e.selectionSet||e.focusChanged){const t=e.state.field(M);this.decorations=Ue(e.view,t)}}},{decorations:e=>e.decorations});function Ye(e,t){const{state:n}=e,o=e.hasFocus,i=[],{mermaidBlocks:s}=t,a=o?I(n):new Set;for(const r of s){let l=!1;for(let c=r.start;c<=r.end;c++)if(a.has(c)){l=!0;break}if(l)for(let c=r.start;c<=r.end;c++){const d=n.doc.line(c);i.push(u.Decoration.line({class:"cm-mermaid-block-line"}).range(d.from))}else{const c=[];for(let f=r.start+1;f<r.end;f++)c.push(n.doc.line(f).text);const d=c.join(`
`),m=n.doc.line(r.start);i.push(u.Decoration.replace({widget:new dn(d,m.from,m.to)}).range(m.from,m.to));for(let f=r.start+1;f<=r.end;f++){const p=n.doc.line(f);i.push(u.Decoration.line({class:"cm-hidden-line"}).range(p.from),u.Decoration.replace({}).range(p.from,p.to))}}}return u.Decoration.set(i,!0)}const Sn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(M);this.decorations=Ye(e,t)}update(e){if(e.docChanged||e.selectionSet||e.focusChanged){const t=e.state.field(M);this.decorations=Ye(e.view,t)}}},{decorations:e=>e.decorations}),En=/^!\[([^\]]*)\]\(([^)]+)\)$/;function ut(e){const t=e.trim().match(En);return t?{alt:t[1],url:t[2].trim()}:null}class Tn extends u.WidgetType{constructor(t,n,o,i){super(),this.alt=t,this.url=n,this.lineFrom=o,this.lineTo=i}toDOM(t){const n=document.createElement("div");n.className="cm-image-preview";const o=document.createElement("img");if(o.src=this.url,o.alt=this.alt,o.loading="lazy",o.addEventListener("error",()=>{n.textContent="";const s=document.createElement("div");s.className="cm-image-error",s.textContent=`Image not found: ${this.url}`,n.appendChild(s)}),n.appendChild(o),this.alt){const s=document.createElement("span");s.className="cm-image-alt",s.textContent=this.alt,n.appendChild(s)}const i=this.lineFrom;return n.addEventListener("mousedown",s=>{s.preventDefault(),s.stopPropagation(),t.dispatch({selection:{anchor:i},scrollIntoView:!0}),t.focus()}),n}eq(t){return t.url===this.url&&t.alt===this.alt}ignoreEvent(t){return t.type!=="mousedown"}}function Xe(e,t){const{state:n}=e,o=e.hasFocus,i=[],s=o?I(n):new Set,{frontmatterLines:a,codeBlockLines:r,tableLines:l,mathBlockLines:c,footnoteBlockLines:d,definitionListLines:m,mermaidBlockLines:f}=t;for(const{from:p,to:k}of e.visibleRanges){const h=n.doc.lineAt(p).number,w=n.doc.lineAt(k).number;for(let g=h;g<=w;g++){if(s.has(g)||a.has(g)||r.has(g)||l.has(g)||c.has(g)||d.has(g)||m.has(g)||f.has(g))continue;const y=n.doc.line(g),C=ut(y.text);C&&i.push(u.Decoration.replace({widget:new Tn(C.alt,C.url,y.from,y.to)}).range(y.from,y.to))}}return u.Decoration.set(i,!0)}const Mn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(M);this.decorations=Xe(e,t)}update(e){if(e.docChanged||e.selectionSet||e.viewportChanged||e.focusChanged){const t=e.state.field(M);this.decorations=Xe(e.view,t)}}},{decorations:e=>e.decorations}),_=b.StateEffect.define(),U=b.StateField.define({create(){return!1},update(e,t){for(const n of t.effects)if(n.is(_))return n.value;return e}});function P(e){return!e||typeof e!="object"||Object.keys(e).length===0?"":Ze.dump(e,{indent:2,lineWidth:-1,noRefs:!0,quotingType:'"',forceQuotes:!1}).trimEnd()}function Fn(e,t,n,o,i,s){const a=document.createElement("span");if(a.className="cm-frontmatter-value",typeof t=="boolean"){const l=document.createElement("input");return l.type="checkbox",l.checked=t,l.className="cm-frontmatter-checkbox",l.addEventListener("change",c=>{c.stopPropagation();const d={...n,[e]:l.checked},m=P(d);s.dispatch({changes:{from:o,to:i,insert:m},annotations:R.of(!0)})}),a.appendChild(l),a}if(Array.isArray(t)){for(let c=0;c<t.length;c++){const d=document.createElement("span");d.className="cm-frontmatter-tag",d.textContent=String(t[c]),d.contentEditable="true",d.spellcheck=!1;const m=c;d.addEventListener("blur",f=>{f.stopPropagation();const p=[...t],k=d.textContent.trim();k===""?p.splice(m,1):p[m]=k;const h={...n,[e]:p},w=P(h);s.dispatch({changes:{from:o,to:i,insert:w},annotations:R.of(!0)})}),d.addEventListener("keydown",f=>{f.key==="Enter"&&(f.preventDefault(),d.blur()),f.stopPropagation()}),d.addEventListener("mousedown",f=>f.stopPropagation()),a.appendChild(d)}const l=document.createElement("span");return l.className="cm-frontmatter-add-tag",l.textContent="+",l.title="Add item",l.addEventListener("mousedown",c=>{c.preventDefault(),c.stopPropagation()}),l.addEventListener("click",c=>{c.stopPropagation();const d=[...t,"new"],m={...n,[e]:d},f=P(m);s.dispatch({changes:{from:o,to:i,insert:f},annotations:R.of(!0)})}),a.appendChild(l),a}if(t!==null&&typeof t=="object"){const l=document.createElement("input");return l.type="text",l.className="cm-frontmatter-input",l.value=JSON.stringify(t),l.addEventListener("blur",c=>{c.stopPropagation();try{const d=JSON.parse(l.value),m={...n,[e]:d},f=P(m);s.dispatch({changes:{from:o,to:i,insert:f},annotations:R.of(!0)})}catch{l.value=JSON.stringify(t)}}),l.addEventListener("keydown",c=>{c.key==="Enter"&&(c.preventDefault(),l.blur()),c.stopPropagation()}),l.addEventListener("mousedown",c=>c.stopPropagation()),a.appendChild(l),a}const r=document.createElement("input");return r.type="text",r.className="cm-frontmatter-input",r.value=t===null?"":String(t),r.placeholder=t===null?"empty":"",r.addEventListener("blur",l=>{l.stopPropagation();const c=r.value;let d;c===""||c==="null"?d=null:c==="true"?d=!0:c==="false"?d=!1:!isNaN(c)&&c.trim()!==""?d=Number(c):d=c;const m={...n,[e]:d},f=P(m);s.dispatch({changes:{from:o,to:i,insert:f},annotations:R.of(!0)})}),r.addEventListener("keydown",l=>{l.key==="Enter"&&(l.preventDefault(),r.blur()),l.stopPropagation()}),r.addEventListener("mousedown",l=>l.stopPropagation()),a.appendChild(r),a}function Dn(e,t,n,o,i,s={}){const{knownKeys:a=[]}=s,r=document.createElement("div");r.className="cm-frontmatter-preview";let l;try{l=Ze.load(e)}catch{const h=document.createElement("div");return h.className="cm-frontmatter-error",h.textContent="Invalid YAML frontmatter ‚Äî click to edit",r.appendChild(h),{dom:r,error:!0}}(!l||typeof l!="object")&&(l={});const c=document.createElement("table");c.className="cm-frontmatter-table";const d="cm-fm-keys-"+Math.random().toString(36).slice(2,8),m=document.createElement("datalist");m.id=d;const f=new Set(Object.keys(l));for(const h of a)if(!f.has(h)){const w=document.createElement("option");w.value=h,m.appendChild(w)}r.appendChild(m);const p=Object.keys(l);for(const h of p){const w=document.createElement("tr"),g=document.createElement("td");g.className="cm-frontmatter-key";const y=document.createElement("input");y.type="text",y.className="cm-frontmatter-key-input",y.value=h,y.size=Math.max(h.length,1),y.spellcheck=!1,y.setAttribute("list",d),y.addEventListener("blur",x=>{x.stopPropagation();const T=y.value.trim();if(T===""||T===h){y.value=h;return}const S={};for(const D of Object.keys(l))D===h?S[T]=l[D]:S[D]=l[D];const F=P(S);i.dispatch({changes:{from:t,to:n,insert:F},annotations:R.of(!0)})}),y.addEventListener("keydown",x=>{x.key==="Enter"&&(x.preventDefault(),y.blur()),x.stopPropagation()}),y.addEventListener("mousedown",x=>x.stopPropagation()),g.appendChild(y),w.appendChild(g);const C=document.createElement("td");C.className="cm-frontmatter-value-cell",C.appendChild(Fn(h,l[h],l,t,n,i)),w.appendChild(C);const L=document.createElement("td");L.className="cm-frontmatter-action-cell";const v=document.createElement("span");v.className="cm-frontmatter-delete",v.textContent="√ó",v.title="Remove property",v.addEventListener("mousedown",x=>{x.preventDefault(),x.stopPropagation()}),v.addEventListener("click",x=>{x.stopPropagation();const T={...l};delete T[h];const S=P(T);i.dispatch({changes:{from:t,to:n,insert:S},annotations:R.of(!0)})}),L.appendChild(v),w.appendChild(L),c.appendChild(w)}r.appendChild(c);const k=document.createElement("div");return k.className="cm-frontmatter-add",k.textContent="+ Add property",k.addEventListener("mousedown",h=>{h.preventDefault(),h.stopPropagation()}),k.addEventListener("click",h=>{h.stopPropagation();let w="property",g=1;for(;l[w]!==void 0;)w=`property${g}`,g++;const y={...l,[w]:""},C=P(y);i.dispatch({changes:{from:t,to:n,insert:C},annotations:R.of(!0)})}),r.appendChild(k),{dom:r,error:!1}}function Ge(e,t){const{state:n}=e,{frontmatter:o}=t;if(!o)return u.Decoration.none;const i=[],s=n.doc.line(o.start);i.push(u.Decoration.replace({}).range(s.from,s.to)),i.push(u.Decoration.line({class:"cm-hidden-line"}).range(s.from));for(let a=o.start+1;a<=o.end;a++){const r=n.doc.line(a);i.push(u.Decoration.line({class:"cm-hidden-line"}).range(r.from),u.Decoration.replace({}).range(r.from,r.to))}return u.Decoration.set(i,!0)}const Nn=u.ViewPlugin.fromClass(class{constructor(e){const t=e.state.field(M);this.decorations=Ge(e,t)}update(e){if(e.docChanged){const t=e.state.field(M);this.decorations=Ge(e.view,t)}}},{decorations:e=>e.decorations});function ce(e={}){const{enableCollapse:t=!0,enableCustomTasks:n=!1,customTaskTypes:o,enableWikiLinks:i=!1,renderWikiLinks:s=!0,onWikiLinkClick:a,enableTags:r=!1,onTagClick:l}=e,c=at(n,o),d=lt(i,s,a),m=dt(r,l);return[st.of(t),ie.of(c),q.of(d),se.of(m),mt,U,M,Nn,Mn,gn,kn,bn,Cn,xn,yn,Ln,vn,Sn]}function Rn(e){requestAnimationFrame(()=>{const t=e.dom.querySelector(".cm-search"),n=t==null?void 0:t.querySelector('input[name="replace"]');n instanceof HTMLInputElement&&(n.focus(),n.select())})}function ne(e,t,n){const{from:o,to:i}=e.state.selection.main,s=e.state.sliceDoc(o,i);e.dispatch({changes:{from:o,to:i,insert:t+s+n},selection:{anchor:o+t.length,head:i+t.length}})}function In(e,t){const{from:n}=e.state.selection.main,o=e.state.doc.lineAt(n);e.dispatch({changes:{from:o.from,to:o.from,insert:t}})}function pe(e,t){const{from:n}=e.state.selection.main,o=e.state.doc.lineAt(n),s=o.text.match(/^(#{1,6})\s/),a="#".repeat(t)+" ";if(s){const r=s[0];r===a?e.dispatch({changes:{from:o.from,to:o.from+r.length,insert:""}}):e.dispatch({changes:{from:o.from,to:o.from+r.length,insert:a}})}else e.dispatch({changes:{from:o.from,to:o.from,insert:a}})}function he(e,t){const{from:n}=e.state.selection.main,o=e.state.doc.lineAt(n),i=o.text,s=i.match(/^(-|\*|\+)\s(?!\[[ xX]\])/),a=i.match(/^(\d+)\.\s/),r=i.match(/^(-|\*|\+)\s\[[ xX]\]\s/),c={bullet:"- ",numbered:"1. ",task:"- [ ] "}[t];let d=null,m=null;r?(d=r[0],m="task"):a?(d=a[0],m="numbered"):s&&(d=s[0],m="bullet"),d?m===t?e.dispatch({changes:{from:o.from,to:o.from+d.length,insert:""}}):e.dispatch({changes:{from:o.from,to:o.from+d.length,insert:c}}):e.dispatch({changes:{from:o.from,to:o.from,insert:c}})}function Wn(e){const{from:t,to:n}=e.state.selection.main;return t!==n?e.state.sliceDoc(t,n):null}const B={undo(e){H.undo(e)},redo(e){H.redo(e)},search(e){$.openSearchPanel(e)},replace(e){$.openSearchPanel(e),Rn(e)},selectNextOccurrence(e){$.selectNextOccurrence(e)},selectAllOccurrences(e){e.state.selection.main.empty&&$.selectNextOccurrence(e),$.selectSelectionMatches(e)},bold(e){ne(e,"**","**")},italic(e){ne(e,"_","_")},strikethrough(e){ne(e,"~~","~~")},h1(e){pe(e,1)},h2(e){pe(e,2)},h3(e){pe(e,3)},link(e){const t=Wn(e),n="https://example.com";if(t){const{from:o,to:i}=e.state.selection.main;e.dispatch({changes:{from:o,to:i,insert:`[${t}](${n})`},selection:{anchor:o+t.length+3,head:o+t.length+3+n.length}})}else{const{from:o}=e.state.selection.main;e.dispatch({changes:{from:o,insert:`[link text](${n})`},selection:{anchor:o+1,head:o+10}})}},image(e){const{from:t}=e.state.selection.main;e.dispatch({changes:{from:t,insert:"![alt text](https://placehold.co/400x200)"},selection:{anchor:t+2,head:t+10}})},bulletList(e){he(e,"bullet")},numberedList(e){he(e,"numbered")},taskList(e){he(e,"task")},inlineCode(e){ne(e,"`","`")},codeBlock(e){const{from:t,to:n}=e.state.selection.main,o=e.state.sliceDoc(t,n),s=o?"```\n"+o+"\n```":"```"+`javascript
function hello() {
  alert("hello world");
}
hello();`+"\n```";e.dispatch({changes:{from:t,to:n,insert:s},selection:{anchor:t+4}})},hr(e){const{from:t}=e.state.selection.main,n=e.state.doc.lineAt(t);e.dispatch({changes:{from:n.to,insert:`

---
`}})},quote(e){In(e,"> ")},table(e){const{from:t}=e.state.selection.main,n=e.state.doc.lineAt(t);e.dispatch({changes:{from:n.to,insert:`

`+`| Column 1 | Column 2 | Column 3 |
|----------|----------|----------|
| Cell 1   | Cell 2   | Cell 3   |
| Cell 4   | Cell 5   | Cell 6   |`+`
`},selection:{anchor:n.to+4}})},diagram(e){const{from:t}=e.state.selection.main,n=e.state.doc.lineAt(t);e.dispatch({changes:{from:n.to,insert:`

`+"```mermaid\nflowchart LR\n    A[Start] --> B[Process]\n    B --> C{Decision}\n    C -->|Yes| D[Result 1]\n    C -->|No| E[Result 2]\n```"+`
`},selection:{anchor:n.to+4}})},emoji(e){const{from:t}=e.state.selection.main;e.dispatch({changes:{from:t,insert:":smile:"},selection:{anchor:t+1,head:t+6}})}},pt=b.Facet.define({combine(e){return e.length===0?{}:e[e.length-1]}}),j=b.StateEffect.define(),A=b.StateEffect.define(),O=b.StateEffect.define(),X=b.StateEffect.define(),G=b.StateEffect.define(),K=b.StateField.define({create(e){const t=e.facet(pt);return{writingModeSheet:!1,typewriter:t.typewriter===!0,focusMode:t.focusMode===!0,focusLevel:t.focusLevel||"paragraph",dimIntensity:t.dimIntensity!=null?t.dimIntensity:30}},update(e,t){for(const n of t.effects)n.is(j)?e={...e,writingModeSheet:n.value}:n.is(A)?e={...e,typewriter:n.value}:n.is(O)?e={...e,focusMode:n.value}:n.is(X)?e={...e,focusLevel:n.value}:n.is(G)&&(e={...e,dimIntensity:n.value});return e}}),ht=u.keymap.of([{key:"Mod-Shift-t",run:e=>{const t=e.state.field(K).typewriter;return e.dispatch({effects:A.of(!t)}),!0}},{key:"Mod-Shift-f",run:e=>{const t=e.state.field(K).focusMode;return e.dispatch({effects:O.of(!t)}),!0}},{key:"Mod-b",run:e=>(B.bold(e),!0)},{key:"Mod-i",run:e=>(B.italic(e),!0)},{key:"Mod-k",run:e=>(B.link(e),!0)},{key:"Mod-`",run:e=>(B.inlineCode(e),!0)},{key:"Mod-Shift-`",run:e=>(B.codeBlock(e),!0)}]),Pn=u.Decoration.line({class:"cm-selectedLine"}),ae=u.ViewPlugin.fromClass(class{constructor(e){this.decorations=this.buildDecorations(e)}update(e){(e.docChanged||e.selectionSet||e.focusChanged)&&(this.decorations=this.buildDecorations(e.view))}buildDecorations(e){if(!e.hasFocus)return u.Decoration.none;const t=[],n=new Set,o=e.state;for(const i of o.selection.ranges){const s=o.doc.lineAt(i.from).number,a=o.doc.lineAt(i.to).number;for(let r=s;r<=a;r++)n.add(r)}for(const i of n){const s=o.doc.line(i);t.push(Pn.range(s.from))}return u.Decoration.set(t,!0)}},{decorations:e=>e.decorations}),ye=u.ViewPlugin.fromClass(class{constructor(e){this.view=e}update(e){!e.selectionSet&&!e.docChanged&&!e.geometryChanged||this.view.requestMeasure({key:"typewriter-scroll",read:t=>{const n=t.state.selection.main.head,o=t.coordsAtPos(n);if(!o)return null;const i=t.scrollDOM.getBoundingClientRect(),s=i.top+i.height/2,a=o.top-s;return Math.abs(a)<2?null:a},write:(t,n)=>{t!=null&&n.scrollDOM.scrollBy({top:t,behavior:"auto"})}})}}),Bn=u.Decoration.line({class:"cm-unfocused-line"});function An(e,t){const n=e.lineAt(t);let o=n.number,i=n.number;for(;o>1&&e.line(o-1).text.trim()!=="";)o--;for(;i<e.lines&&e.line(i+1).text.trim()!=="";)i++;return{from:o,to:i}}function On(e,t){const n=e.toString();let o=0;for(let r=t-1;r>=0;r--){const l=n[r];if((l==="."||l==="!"||l==="?")&&r+1<n.length&&/\s/.test(n[r+1])){for(o=r+1;o<t&&/\s/.test(n[o]);)o++;break}if(l===`
`&&r>0&&n[r-1]===`
`){o=r+1;break}}let i=n.length;for(let r=t;r<n.length;r++){const l=n[r];if((l==="."||l==="!"||l==="?")&&(r+1>=n.length||/\s/.test(n[r+1]))){i=r+1;break}if(l===`
`&&r+1<n.length&&n[r+1]===`
`){i=r;break}}const s=e.lineAt(Math.max(0,o)).number,a=e.lineAt(Math.min(n.length,Math.max(o,i-1))).number;return{from:s,to:a}}function le(e="paragraph",t=30){return u.ViewPlugin.fromClass(class{constructor(n){this.setIntensity(n,t),this.decorations=this.buildDecorations(n)}update(n){(n.selectionSet||n.docChanged||n.focusChanged)&&(this.decorations=this.buildDecorations(n.view))}setIntensity(n,o){const i=Math.max(0,Math.min(1,1-o/100));n.dom.style.setProperty("--cm-unfocused-opacity",String(i))}buildDecorations(n){if(!n.hasFocus)return b.RangeSet.empty;const o=n.state.doc,i=new Set;for(const a of n.state.selection.ranges){let r;if(e==="line"){const l=o.lineAt(a.head);r={from:l.number,to:l.number}}else e==="sentence"?r=On(o,a.head):r=An(o,a.head);for(let l=r.from;l<=r.to;l++)i.add(l)}const s=[];for(let a=1;a<=o.lines;a++)if(!i.has(a)){const r=o.line(a);s.push(Bn.range(r.from))}return b.RangeSet.of(s)}destroy(){}},{decorations:n=>n.decorations})}const zn=le("paragraph",30);function $n(e,t){const n=e.toString(),o=n.split(/\s+/).filter(d=>d.length>0).length,i=n.length,s=n.replace(/\s/g,"").length,a=Math.max(1,Math.ceil(o/238));let r=0,l=0;const c=t&&!t.main.empty;if(c){const d=e.sliceString(t.main.from,t.main.to);r=d.split(/\s+/).filter(m=>m.length>0).length,l=d.length}return{words:o,chars:i,charsNoSpaces:s,readingTime:a,selWords:r,selChars:l,hasSelection:c}}function Hn(e){return e<1?"< 1 min read":e===1?"1 min read":`${e} min read`}function ge(e,t){const n=document.createElement("span");n.className="cm-word-count-stat";const o=document.createElement("span");o.className="cm-word-count-value",o.textContent=t;const i=document.createElement("span");return i.className="cm-word-count-label",i.textContent=` ${e}`,n.appendChild(o),n.appendChild(i),n}function ke(){const e=document.createElement("span");return e.className="cm-word-count-divider",e}function jn(e){const t=document.createElement("div");t.className="cm-word-count-panel";function n(o){const i=$n(o.doc,o.selection);if(t.textContent="",t.appendChild(ge("words",i.words.toLocaleString())),t.appendChild(ke()),t.appendChild(ge("characters",i.chars.toLocaleString())),t.appendChild(ke()),t.appendChild(ge("",Hn(i.readingTime))),i.hasSelection){t.appendChild(ke());const s=document.createElement("span");s.className="cm-word-count-stat cm-word-count-selection";const a=document.createElement("span");a.className="cm-word-count-value",a.textContent=`${i.selWords} words, ${i.selChars} chars`;const r=document.createElement("span");r.className="cm-word-count-label",r.textContent=" selected",s.appendChild(a),s.appendChild(r),t.appendChild(s)}}return n(e.state),{dom:t,top:!1,update(o){(o.docChanged||o.selectionSet)&&n(o.state)}}}const de=u.showPanel.of(jn),qn=[{icon:"‚Ü∂",title:"Undo",action:"undo"},{icon:"‚Ü∑",title:"Redo",action:"redo"},{icon:"B",title:"Bold",action:"bold"},{icon:"I",title:"Italic",action:"italic"},{icon:"S",title:"Strikethrough",action:"strikethrough"},{icon:"H‚ÇÅ",title:"Heading 1",action:"h1"},{icon:"H‚ÇÇ",title:"Heading 2",action:"h2"},{icon:"H‚ÇÉ",title:"Heading 3",action:"h3"},{icon:"üîó",title:"Link",action:"link"},{icon:"üñº",title:"Image",action:"image"},{icon:"‚Ä¢",title:"Bullet List",action:"bulletList"},{icon:"1.",title:"Numbered List",action:"numberedList"},{icon:"‚òë",title:"Task List",action:"taskList"},{icon:"< >",title:"Inline Code",action:"inlineCode"},{icon:"{ }",title:"Code Block",action:"codeBlock"},{icon:"‚Äî",title:"Horizontal Rule",action:"hr"},{icon:"‚Äú",title:"Blockquote",action:"quote"},{icon:"‚äû",title:"Table",action:"table"}],Vn=u.EditorView.baseTheme({".cm-bottom-toolbar":{display:"flex",alignItems:"center",gap:"2px",padding:"6px 8px",paddingBottom:"max(6px, env(safe-area-inset-bottom))",overflowX:"auto",WebkitOverflowScrolling:"touch",scrollbarWidth:"none",whiteSpace:"nowrap",borderTop:"1px solid #dee2e6",fontFamily:'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',background:"#f8f9fa",overscrollBehaviorX:"contain",touchAction:"pan-x"},".cm-bottom-toolbar::-webkit-scrollbar":{display:"none"},".cm-bottom-toolbar-btn":{minWidth:"36px",height:"36px",flexShrink:"0",display:"inline-flex",alignItems:"center",justifyContent:"center",border:"none",background:"transparent",borderRadius:"6px",cursor:"pointer",fontSize:"15px",color:"inherit",transition:"background 0.1s",padding:"0 4px",fontFamily:"inherit"},".cm-bottom-toolbar-btn:hover":{background:"rgba(0, 0, 0, 0.08)"},".cm-bottom-toolbar-btn:active":{background:"rgba(0, 0, 0, 0.15)"},".cm-bottom-toolbar-btn:disabled":{opacity:"0.3",cursor:"not-allowed"},"&dark .cm-bottom-toolbar":{background:"#252526",borderTopColor:"#3c3c3c",color:"#d4d4d4"},"&dark .cm-bottom-toolbar-btn:hover":{background:"rgba(255, 255, 255, 0.1)"},"&dark .cm-bottom-toolbar-btn:active":{background:"rgba(255, 255, 255, 0.18)"}});function me(e={}){const t=e.buttons||qn,n=e.extraButtons||[];return[u.showPanel.of(i=>{const s=document.createElement("div");s.className="cm-bottom-toolbar";const a=new Map;for(const c of t){const d=document.createElement("button");d.className="cm-bottom-toolbar-btn",d.textContent=c.icon,d.title=c.title,c.action&&(a.set(c.action,d),d.addEventListener("click",m=>{m.preventDefault(),B[c.action]&&(B[c.action](i),i.focus())})),s.appendChild(d)}for(const c of n){const d=document.createElement("button");d.className="cm-bottom-toolbar-btn",d.textContent=c.icon,d.title=c.title,d.addEventListener("click",m=>{m.preventDefault(),c.handler&&c.handler(i),i.focus()}),s.appendChild(d)}let r=0;s.addEventListener("touchstart",c=>{r=c.touches[0].clientX},{passive:!0}),s.addEventListener("touchmove",c=>{const d=c.touches[0].clientX-r,m=s.scrollLeft<=0,f=s.scrollLeft+s.clientWidth>=s.scrollWidth-1;(m&&d>0||f&&d<0)&&c.preventDefault()},{passive:!1});const l=c=>{const d=a.get("undo");d&&(d.disabled=H.undoDepth(c)===0);const m=a.get("redo");m&&(m.disabled=H.redoDepth(c)===0)};return l(i.state),{dom:s,top:!1,update(c){l(c.state)}}}),Vn]}const oe=b.Facet.define({combine(e){return e.length===0?{docTitle:null,onBacklinksRequested:null,onBacklinkClick:null}:e[e.length-1]}});function _n(e){if(e.lines<2||e.line(1).text.trim()!=="---")return null;for(let n=2;n<=e.lines;n++){const o=e.line(n).text.trim();if(o==="---"||o==="..."){for(let i=2;i<n;i++){const a=e.line(i).text.match(/^title:\s*(.+)$/);if(a){let r=a[1].trim();return(r.startsWith('"')&&r.endsWith('"')||r.startsWith("'")&&r.endsWith("'"))&&(r=r.slice(1,-1)),r}}return null}}return null}function be(e,t,n){e.textContent="";const o=document.createElement("span");if(o.className="cm-backlinks-label",o.textContent="Backlinks",e.appendChild(o),!t||t.length===0){const s=document.createElement("span");s.className="cm-backlinks-empty",s.textContent="None",e.appendChild(s);return}const i=document.createElement("span");i.className="cm-backlinks-list";for(const s of t){const a=document.createElement("span");a.className="cm-backlinks-link",a.textContent=s.title,s.excerpt&&(a.title=s.excerpt),a.addEventListener("mousedown",r=>{r.preventDefault(),n&&n(s)}),i.appendChild(a)}e.appendChild(i)}function Kn(e){const t=document.createElement("div");t.className="cm-backlinks-panel",e.state.facet(oe);let n=null,o=0;function i(a){const r=a.facet(oe);return r.docTitle?r.docTitle:_n(a.doc)}async function s(a){const r=a.facet(oe);if(!r.onBacklinksRequested){t.textContent="";return}const l=i(a);if(l===n)return;if(n=l,!l){be(t,[],r.onBacklinkClick);return}t.textContent="";const c=document.createElement("span");c.className="cm-backlinks-label",c.textContent="Backlinks",t.appendChild(c);const d=document.createElement("span");d.className="cm-backlinks-empty",d.textContent="Loading‚Ä¶",t.appendChild(d);const m=++o;try{const f=await r.onBacklinksRequested(l);m===o&&be(t,f,r.onBacklinkClick)}catch{m===o&&be(t,[],r.onBacklinkClick)}}return s(e.state),{dom:t,top:!1,update(a){a.docChanged&&s(a.state)}}}const fe=u.showPanel.of(Kn),gt=b.Facet.define({combine(e){return e.length===0?[]:e[e.length-1]}}),Un=u.ViewPlugin.fromClass(class{constructor(e){this.view=e,this.backdrop=null,this.sheet=null,this.escHandler=null,this.isOpen=e.state.field(U),this.isOpen&&this.open()}update(e){const t=this.isOpen;this.isOpen=e.state.field(U),!t&&this.isOpen?this.open():t&&!this.isOpen?this.close():this.isOpen&&e.docChanged&&this.rebuildContent()}open(){const e=this.view;this.backdrop=document.createElement("div"),this.backdrop.className="cm-frontmatter-sheet-backdrop",this.backdrop.addEventListener("mousedown",i=>{i.preventDefault(),i.stopPropagation(),e.dispatch({effects:_.of(!1)})}),this.sheet=document.createElement("div"),this.sheet.className="cm-frontmatter-sheet";const t=document.createElement("div");t.className="cm-frontmatter-sheet-header";const n=document.createElement("span");n.className="cm-frontmatter-sheet-title",n.textContent="Properties",t.appendChild(n);const o=document.createElement("button");o.className="cm-frontmatter-sheet-close",o.textContent="√ó",o.title="Close",o.addEventListener("mousedown",i=>{i.preventDefault(),i.stopPropagation()}),o.addEventListener("click",i=>{i.stopPropagation(),e.dispatch({effects:_.of(!1)})}),t.appendChild(o),this.sheet.appendChild(t),this.contentEl=document.createElement("div"),this.contentEl.className="cm-frontmatter-sheet-content",this.sheet.appendChild(this.contentEl),this.buildContent(),e.dom.appendChild(this.backdrop),e.dom.appendChild(this.sheet),e.scrollDOM.style.overflow="hidden",this.escHandler=i=>{i.key==="Escape"&&(i.preventDefault(),i.stopPropagation(),e.dispatch({effects:_.of(!1)}))},e.dom.addEventListener("keydown",this.escHandler,!0),requestAnimationFrame(()=>{this.backdrop&&this.backdrop.classList.add("cm-frontmatter-sheet-backdrop-visible"),this.sheet&&this.sheet.classList.add("cm-frontmatter-sheet-open")})}close(){const e=this.view;e.scrollDOM.style.overflow="",this.escHandler&&(e.dom.removeEventListener("keydown",this.escHandler,!0),this.escHandler=null),this.sheet&&this.sheet.classList.remove("cm-frontmatter-sheet-open"),this.backdrop&&this.backdrop.classList.remove("cm-frontmatter-sheet-backdrop-visible");const t=this.sheet,n=this.backdrop;setTimeout(()=>{t==null||t.remove(),n==null||n.remove()},200),this.sheet=null,this.backdrop=null,this.contentEl=null}buildContent(){if(!this.contentEl)return;this.contentEl.innerHTML="";const e=this.view.state,t=e.field(M),{frontmatter:n}=t;if(!n){const m=document.createElement("div");m.className="cm-frontmatter-sheet-empty",m.textContent="No frontmatter in this document.",this.contentEl.appendChild(m);const f=document.createElement("button");f.className="cm-frontmatter-sheet-add-btn",f.textContent="Add Frontmatter",f.addEventListener("click",p=>{p.stopPropagation(),this.view.dispatch({changes:{from:0,to:0,insert:`---
---
`},annotations:R.of(!0)})}),this.contentEl.appendChild(f);return}const o=n.end-n.start>1,i=o?e.doc.line(n.start+1).from:e.doc.line(n.start).to+1,s=o?e.doc.line(n.end-1).to:i,a=[];for(let m=n.start+1;m<n.end;m++)a.push(e.doc.line(m).text);const r=a.join(`
`),l=e.doc.line(n.start).from,c=this.view.state.facet(gt),{dom:d}=Dn(r,i,s,l,this.view,{knownKeys:c});this.contentEl.appendChild(d)}rebuildContent(){this.buildContent()}destroy(){var e,t;this.isOpen&&(this.escHandler&&this.view.dom.removeEventListener("keydown",this.escHandler,!0),(e=this.sheet)==null||e.remove(),(t=this.backdrop)==null||t.remove(),this.view.scrollDOM.style.overflow="")}}),Yn=typeof navigator<"u"&&/Mac/.test(navigator.platform),Je=Yn?"‚åò":"Ctrl+",kt=u.ViewPlugin.fromClass(class{constructor(e){this.view=e,this.backdrop=null,this.sheet=null,this.escHandler=null,this.isOpen=e.state.field(K).writingModeSheet,this.isOpen&&this.open()}update(e){const t=this.isOpen,n=e.state.field(K);this.isOpen=n.writingModeSheet,!t&&this.isOpen?this.open():t&&!this.isOpen?this.close():this.isOpen&&this.rebuildContent()}open(){const e=this.view;this.backdrop=document.createElement("div"),this.backdrop.className="cm-writing-mode-sheet-backdrop",this.backdrop.addEventListener("mousedown",i=>{i.preventDefault(),i.stopPropagation(),e.dispatch({effects:j.of(!1)})}),this.sheet=document.createElement("div"),this.sheet.className="cm-writing-mode-sheet";const t=document.createElement("div");t.className="cm-writing-mode-sheet-header";const n=document.createElement("span");n.className="cm-writing-mode-sheet-title",n.textContent="Writing Mode",t.appendChild(n);const o=document.createElement("button");o.className="cm-writing-mode-sheet-close",o.textContent="√ó",o.title="Close",o.addEventListener("mousedown",i=>{i.preventDefault(),i.stopPropagation()}),o.addEventListener("click",i=>{i.stopPropagation(),e.dispatch({effects:j.of(!1)})}),t.appendChild(o),this.sheet.appendChild(t),this.contentEl=document.createElement("div"),this.contentEl.className="cm-writing-mode-sheet-content",this.sheet.appendChild(this.contentEl),this.buildContent(),e.dom.appendChild(this.backdrop),e.dom.appendChild(this.sheet),e.scrollDOM.style.overflow="hidden",this.escHandler=i=>{i.key==="Escape"&&(i.preventDefault(),i.stopPropagation(),e.dispatch({effects:j.of(!1)}))},e.dom.addEventListener("keydown",this.escHandler,!0),requestAnimationFrame(()=>{this.backdrop&&this.backdrop.classList.add("cm-writing-mode-sheet-backdrop-visible"),this.sheet&&this.sheet.classList.add("cm-writing-mode-sheet-open")})}close(){const e=this.view;e.scrollDOM.style.overflow="",this.escHandler&&(e.dom.removeEventListener("keydown",this.escHandler,!0),this.escHandler=null),this.sheet&&this.sheet.classList.remove("cm-writing-mode-sheet-open"),this.backdrop&&this.backdrop.classList.remove("cm-writing-mode-sheet-backdrop-visible");const t=this.sheet,n=this.backdrop;setTimeout(()=>{t==null||t.remove(),n==null||n.remove()},200),this.sheet=null,this.backdrop=null,this.contentEl=null}buildContent(){if(!this.contentEl)return;this.contentEl.innerHTML="";const e=this.view,t=e.state.field(K),{typewriter:n,focusMode:o,focusLevel:i,dimIntensity:s}=t;let a="normal";n&&o?a="both":n?a="typewriter":o&&(a="focus");const r=this.createSection("MODE"),l=document.createElement("div");l.className="cm-writing-mode-options";const c=[{id:"normal",label:"Normal",icon:"‚Äî"},{id:"typewriter",label:"Typewriter",icon:"‚å∏"},{id:"focus",label:"Focus",icon:"‚óé"},{id:"both",label:"Both",icon:"‚¶ø"}];for(const w of c){const g=document.createElement("button");g.className="cm-writing-mode-option",w.id===a&&g.classList.add("cm-writing-mode-option-active"),g.title=w.label;const y=document.createElement("span");y.className="cm-writing-mode-option-icon",y.textContent=w.icon,g.appendChild(y);const C=document.createElement("span");C.className="cm-writing-mode-option-label",C.textContent=w.label,g.appendChild(C),g.addEventListener("mousedown",L=>L.preventDefault()),g.addEventListener("click",L=>{L.stopPropagation();const v=w.id==="typewriter"||w.id==="both",x=w.id==="focus"||w.id==="both";e.dispatch({effects:[A.of(v),O.of(x)]})}),l.appendChild(g)}if(r.appendChild(l),this.contentEl.appendChild(r),o){const w=this.createSection("FOCUS LEVEL"),g=document.createElement("div");g.className="cm-writing-mode-pills";const y=[{id:"line",label:"Line"},{id:"sentence",label:"Sentence"},{id:"paragraph",label:"Paragraph"}];for(const F of y){const D=document.createElement("button");D.className="cm-writing-mode-pill",F.id===i&&D.classList.add("cm-writing-mode-pill-active"),D.textContent=F.label,D.addEventListener("mousedown",ue=>ue.preventDefault()),D.addEventListener("click",ue=>{ue.stopPropagation(),e.dispatch({effects:X.of(F.id)})}),g.appendChild(D)}w.appendChild(g),this.contentEl.appendChild(w);const C=this.createSection(`DIM INTENSITY: ${s}%`);this.dimLabel=C.querySelector(".cm-writing-mode-section-label");const L=document.createElement("div");L.className="cm-writing-mode-slider-wrap";const v=document.createElement("input");v.type="range",v.className="cm-writing-mode-slider",v.min="0",v.max="100",v.value=String(s),v.addEventListener("mousedown",F=>F.stopPropagation()),v.addEventListener("input",F=>{F.stopPropagation();const D=Number(F.target.value);this.dimLabel&&(this.dimLabel.textContent=`DIM INTENSITY: ${D}%`),e.dispatch({effects:G.of(D)})});const x=document.createElement("div");x.className="cm-writing-mode-slider-labels";const T=document.createElement("span");T.textContent="Less dim";const S=document.createElement("span");S.textContent="More dim",x.appendChild(T),x.appendChild(S),L.appendChild(v),L.appendChild(x),C.appendChild(L),this.contentEl.appendChild(C)}const d=document.createElement("div");d.className="cm-writing-mode-shortcuts";const m=document.createElement("span");m.className="cm-writing-mode-shortcuts-label",m.textContent="Shortcuts:",d.appendChild(m);const f=document.createElement("kbd");f.className="cm-writing-mode-kbd",f.textContent=`${Je}Shift+T`,d.appendChild(f);const p=document.createElement("span");p.className="cm-writing-mode-kbd-desc",p.textContent="Typewriter",d.appendChild(p);const k=document.createElement("kbd");k.className="cm-writing-mode-kbd",k.textContent=`${Je}Shift+F`,d.appendChild(k);const h=document.createElement("span");h.className="cm-writing-mode-kbd-desc",h.textContent="Focus",d.appendChild(h),this.contentEl.appendChild(d)}createSection(e){const t=document.createElement("div");t.className="cm-writing-mode-section";const n=document.createElement("label");return n.className="cm-writing-mode-section-label",n.textContent=e,t.appendChild(n),t}rebuildContent(){this.buildContent()}destroy(){var e,t;this.isOpen&&(this.escHandler&&this.view.dom.removeEventListener("keydown",this.escHandler,!0),(e=this.sheet)==null||e.remove(),(t=this.backdrop)==null||t.remove(),this.view.scrollDOM.style.overflow="")}});if(typeof document<"u"){const e=document.createElement("style");e.textContent="@keyframes cmFadeIn { from { opacity: 0 } to { opacity: 1 } }",document.head.appendChild(e)}const bt=u.EditorView.baseTheme({"&":{height:"100%",fontSize:"17px"},".cm-content":{fontFamily:'Charter, "Bitstream Charter", "Sitka Text", Cambria, serif',padding:"20px 48px",lineHeight:"1.75"},".cm-line":{padding:"4px 0"},".cm-scroller":{overflow:"auto",fontFamily:'Charter, "Bitstream Charter", "Sitka Text", Cambria, serif'},"&.cm-focused":{outline:"none"},".cm-markdown-preview":{display:"inline",animation:"cmFadeIn 0.12s ease-out"},".cm-markdown-preview .md-header":{display:"inline",fontWeight:"600",lineHeight:"1.4"},".cm-markdown-preview .md-h1":{fontSize:"2em"},".cm-markdown-preview .md-h2":{fontSize:"1.5em"},".cm-markdown-preview .md-h3":{fontSize:"1.25em"},".cm-markdown-preview .md-h4":{fontSize:"1.1em"},".cm-markdown-preview .md-h5":{fontSize:"1em"},".cm-markdown-preview .md-h6":{fontSize:"0.9em"},".cm-markdown-preview strong":{fontWeight:"700"},".cm-markdown-preview em":{fontStyle:"italic"},".cm-markdown-preview del":{textDecoration:"line-through"},".cm-markdown-preview .md-highlight, .cm-markdown-preview mark":{backgroundColor:"#fde68a",color:"inherit",padding:"0 2px",borderRadius:"3px"},".cm-markdown-preview .md-subscript, .cm-markdown-preview sub":{fontSize:"0.85em",verticalAlign:"sub"},".cm-markdown-preview .md-superscript, .cm-markdown-preview sup":{fontSize:"0.85em",verticalAlign:"super"},".cm-markdown-preview code":{padding:"2px 6px",borderRadius:"4px",fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace',fontSize:"0.9em"},".cm-markdown-preview a":{textDecoration:"none",cursor:"pointer"},".cm-markdown-preview a:hover":{textDecoration:"underline"},".cm-markdown-preview img":{maxWidth:"100%",height:"auto",borderRadius:"4px"},".cm-markdown-preview .md-blockquote":{display:"inline",fontStyle:"italic",paddingLeft:"16px",marginLeft:"0"},".cm-markdown-preview .md-list-item":{display:"inline"},".cm-markdown-preview .md-list-marker":{marginRight:"4px"},".cm-markdown-preview .md-hr, .cm-markdown-preview hr":{display:"block",border:"none",margin:"16px 0",height:"1px"},'.cm-markdown-preview input[type="checkbox"]':{width:"19.2px",height:"19.2px",marginRight:"6px",cursor:"pointer"},".cm-markdown-preview .md-task-icon":{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"1.2em",marginRight:"6px",cursor:"pointer",userSelect:"none"},".cm-markdown-preview .md-task-idea":{color:"#0ea5e9"},".cm-markdown-preview .md-task-urgent":{color:"#ef4444"},".cm-markdown-preview .md-task-question":{color:"#a855f7"},".cm-markdown-preview .md-task-important":{color:"#ec4899"},".cm-markdown-preview .md-task-forwarded":{color:"#3b82f6"},".cm-markdown-preview .md-task-scheduled":{color:"#f59e0b"},".cm-code-block-line":{fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace',fontSize:"0.9em"},".cm-highlighted-code":{fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace'},".cm-table-preview":{display:"block",margin:"0",animation:"cmFadeIn 0.15s ease-out"},".cm-definition-list-preview":{display:"block",margin:"0",animation:"cmFadeIn 0.15s ease-out"},".md-definition-list":{margin:"4px 0 8px 0"},".md-definition-list dt":{fontWeight:"600"},".md-definition-list dd":{margin:"2px 0 6px 16px"},".cm-footnote-preview":{display:"block",margin:"4px 0",animation:"cmFadeIn 0.15s ease-out"},".md-footnote-block":{display:"block"},".md-footnote-line":{display:"block"},".md-footnote-backref":{display:"block"},".md-footnote-backref-link":{cursor:"pointer",fontSize:"0.85em"},".md-wikilink":{cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px"},".cm-wikilink":{textDecoration:"underline",textUnderlineOffset:"2px"},".md-table":{borderCollapse:"collapse",borderRadius:"6px",overflow:"hidden"},".md-table th, .md-table td":{padding:"8px 12px",textAlign:"left"},".md-table th":{fontWeight:"600"},".cm-markdown-preview .md-table-row":{display:"inline-flex",borderRadius:"4px"},".cm-markdown-preview .md-table-cell":{display:"inline-block",padding:"6px 12px",minWidth:"80px"},".cm-markdown-preview .md-table-cell:last-child":{borderRight:"none"},".cm-markdown-preview .md-table-separator":{display:"none"},".cm-math-preview":{display:"block",padding:"8px 0",animation:"cmFadeIn 0.15s ease-out"},".cm-math-preview .katex-display":{textAlign:"left !important",margin:"0 !important",justifyContent:"flex-start !important"},".cm-math-preview .katex-display > .katex":{textAlign:"left !important"},".cm-mermaid-preview":{display:"block",padding:"16px 0",cursor:"pointer",animation:"cmFadeIn 0.15s ease-out"},".cm-mermaid-preview svg":{maxWidth:"100%",height:"auto"},".cm-mermaid-preview .mermaid-error":{color:"#d73a49",fontFamily:"monospace",fontSize:"0.9em"},".cm-mermaid-block-line":{fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace',fontSize:"0.9em"},".cm-hidden-line":{height:"0 !important",padding:"0 !important",minHeight:"0 !important"},".cm-collapsed-line":{height:"0 !important",minHeight:"0 !important",padding:"0 !important",margin:"0 !important",overflow:"hidden !important",opacity:"0",lineHeight:"0 !important",transition:"height 0.15s ease-out, opacity 0.1s ease-out, padding 0.15s ease-out"},".cm-heading-preview":{display:"inline-flex",alignItems:"center",animation:"cmFadeIn 0.12s ease-out"},".cm-collapse-toggle":{display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",userSelect:"none",fontSize:"0.8em",opacity:"0",transition:"opacity 0.15s ease, transform 0.15s ease",marginLeft:"-20px",width:"20px",height:"1em",flexShrink:"0"},".cm-collapse-toggle.collapsed":{transform:"rotate(0deg)",opacity:"0.4"},".cm-collapse-toggle.collapsed:hover":{opacity:"1"},".cm-collapse-toggle.expanded":{transform:"rotate(90deg)"},".cm-line:hover .cm-collapse-toggle.expanded":{opacity:"0.4"},".cm-line:hover .cm-collapse-toggle.expanded:hover":{opacity:"1"},".footnote-ref .footnote-link":{cursor:"pointer",fontSize:"0.85em"},".footnote-def":{display:"inline",fontSize:"0.9em"},".footnote-def sup":{marginRight:"4px"},".tok-keyword":{},".tok-operator":{},".tok-variableName":{},".tok-function, .tok-definition":{},".tok-string, .tok-string2":{},".tok-number":{},".tok-bool, .tok-null":{},".tok-comment":{fontStyle:"italic"},".tok-punctuation":{},".tok-propertyName":{},".tok-typeName, .tok-className":{},".tok-tagName":{},".tok-attributeName":{},".tok-attributeValue":{},".tok-regexp":{},".tok-meta":{},".cm-image-preview":{display:"block",padding:"8px 0",cursor:"pointer",animation:"cmFadeIn 0.15s ease-out"},".cm-image-preview img":{maxWidth:"100%",maxHeight:"400px",objectFit:"contain",borderRadius:"6px",display:"block"},".cm-image-alt":{display:"block",fontSize:"0.8em",marginTop:"4px",fontStyle:"italic"},".cm-image-error":{display:"block",padding:"12px",fontSize:"0.85em",borderRadius:"6px",fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace'},".cm-frontmatter-preview":{display:"block",margin:"0",padding:"8px 12px",borderRadius:"6px",animation:"cmFadeIn 0.15s ease-out"},".cm-frontmatter-table":{width:"100%",borderCollapse:"collapse",fontSize:"0.9em"},".cm-frontmatter-table td":{padding:"3px 8px",verticalAlign:"middle"},".cm-frontmatter-key":{fontWeight:"600",whiteSpace:"nowrap",fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace',fontSize:"0.9em",width:"1%",paddingRight:"16px"},".cm-frontmatter-key-input":{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",color:"inherit",background:"transparent",border:"none",outline:"none",padding:"2px 4px",borderRadius:"3px",boxSizing:"border-box",minWidth:"3ch",appearance:"none",MozAppearance:"none",WebkitAppearance:"none"},".cm-frontmatter-key-input::-webkit-calendar-picker-indicator":{display:"none !important"},".cm-frontmatter-value-cell":{width:"100%"},".cm-frontmatter-value":{display:"flex",flexWrap:"wrap",gap:"4px",alignItems:"center"},".cm-frontmatter-input":{border:"none",background:"transparent",width:"100%",font:"inherit",fontSize:"1em",outline:"none",padding:"2px 4px",borderRadius:"3px"},".cm-frontmatter-input:focus":{outline:"none"},".cm-frontmatter-checkbox":{width:"16px",height:"16px",cursor:"pointer",margin:"0"},".cm-frontmatter-tag":{display:"inline-block",padding:"1px 8px",borderRadius:"10px",fontSize:"0.9em",cursor:"text",outline:"none",lineHeight:"1.5"},".cm-frontmatter-add-tag":{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px",borderRadius:"50%",cursor:"pointer",fontSize:"0.85em",opacity:"0.4",userSelect:"none"},".cm-frontmatter-add-tag:hover":{opacity:"1"},".cm-frontmatter-action-cell":{width:"1%",whiteSpace:"nowrap"},".cm-frontmatter-delete":{cursor:"pointer",opacity:"0",fontSize:"1.1em",padding:"0 4px",userSelect:"none",transition:"opacity 0.1s ease"},".cm-frontmatter-table tr:hover .cm-frontmatter-delete":{opacity:"0.3"},".cm-frontmatter-table tr:hover .cm-frontmatter-delete:hover":{opacity:"1"},".cm-frontmatter-add":{cursor:"pointer",opacity:"0.4",fontSize:"0.85em",padding:"4px 8px",userSelect:"none"},".cm-frontmatter-add:hover":{opacity:"0.8"},".cm-frontmatter-error":{fontStyle:"italic",fontSize:"0.9em",padding:"4px 0",cursor:"pointer"},".cm-frontmatter-line":{fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace',fontSize:"0.9em",animation:"cmFadeIn 0.1s ease-out"},".cm-frontmatter-sheet-backdrop":{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",zIndex:"10",opacity:"0",transition:"opacity 0.2s ease"},".cm-frontmatter-sheet-backdrop-visible":{opacity:"1"},".cm-frontmatter-sheet":{position:"absolute",top:"0",left:"0",right:"0",zIndex:"11",maxHeight:"70%",overflowY:"auto",transform:"translateY(-100%)",transition:"transform 0.2s ease",borderBottomLeftRadius:"8px",borderBottomRightRadius:"8px"},".cm-frontmatter-sheet-open":{transform:"translateY(0)"},".cm-frontmatter-sheet-header":{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 20px 0"},".cm-frontmatter-sheet-title":{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',fontSize:"0.9em",fontWeight:"600"},".cm-frontmatter-sheet-close":{background:"none",border:"none",fontSize:"18px",cursor:"pointer",padding:"0 4px",lineHeight:"1",opacity:"0.5"},".cm-frontmatter-sheet-close:hover":{opacity:"1"},".cm-frontmatter-sheet-content":{padding:"8px 20px 16px"},".cm-frontmatter-sheet-content .cm-frontmatter-preview":{border:"none",padding:"0",margin:"0",borderRadius:"0",animation:"none"},".cm-frontmatter-sheet-empty":{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',fontSize:"0.9em",padding:"8px 0",opacity:"0.6"},".cm-frontmatter-sheet-add-btn":{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',fontSize:"0.85em",padding:"6px 16px",borderRadius:"6px",cursor:"pointer",border:"1px solid",marginTop:"8px"},".cm-word-count-panel":{display:"flex",alignItems:"center",gap:"0",padding:"4px 16px",fontSize:"12px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',userSelect:"none"},".cm-word-count-stat":{display:"inline-flex",alignItems:"center",padding:"0 10px"},".cm-word-count-value":{fontWeight:"600",fontVariantNumeric:"tabular-nums"},".cm-word-count-label":{fontWeight:"400"},".cm-word-count-divider":{width:"1px",height:"12px",flexShrink:"0"},".md-tag":{display:"inline-block",padding:"1px 8px",borderRadius:"10px",fontSize:"0.9em",cursor:"pointer",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',lineHeight:"1.5",verticalAlign:"baseline"},".cm-tag-mark":{borderRadius:"3px"},".cm-selectedLine":{animation:"cmFadeIn 0.1s ease-out"},".cm-table-line":{animation:"cmFadeIn 0.1s ease-out"},".cm-math-block-line":{animation:"cmFadeIn 0.1s ease-out"},".cm-mermaid-block-line":{animation:"cmFadeIn 0.1s ease-out"},".cm-backlinks-panel":{display:"flex",alignItems:"center",gap:"8px",padding:"4px 16px",fontSize:"12px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',userSelect:"none"},".cm-backlinks-label":{fontWeight:"600",flexShrink:"0"},".cm-backlinks-list":{display:"flex",flexWrap:"wrap",gap:"4px",alignItems:"center"},".cm-backlinks-link":{display:"inline-block",padding:"1px 8px",borderRadius:"10px",cursor:"pointer",fontSize:"11px",lineHeight:"1.5"},".cm-backlinks-link:hover":{textDecoration:"underline"},".cm-backlinks-empty":{fontStyle:"italic",opacity:"0.6"},".cm-unfocused-line":{opacity:"var(--cm-unfocused-opacity, 0.25)",transition:"opacity 0.2s ease"},".cm-writing-mode-sheet-backdrop":{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",zIndex:"10",opacity:"0",transition:"opacity 0.2s ease"},".cm-writing-mode-sheet-backdrop-visible":{opacity:"1"},".cm-writing-mode-sheet":{position:"absolute",bottom:"0",left:"0",right:"0",zIndex:"11",maxHeight:"70%",overflowY:"auto",transform:"translateY(100%)",transition:"transform 0.2s ease",borderTopLeftRadius:"12px",borderTopRightRadius:"12px"},".cm-writing-mode-sheet-open":{transform:"translateY(0)"},".cm-writing-mode-sheet-header":{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px 0"},".cm-writing-mode-sheet-title":{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',fontSize:"0.95em",fontWeight:"600"},".cm-writing-mode-sheet-close":{background:"none",border:"none",fontSize:"18px",cursor:"pointer",padding:"0 4px",lineHeight:"1",opacity:"0.5"},".cm-writing-mode-sheet-close:hover":{opacity:"1"},".cm-writing-mode-sheet-content":{padding:"12px 20px 20px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},".cm-writing-mode-section":{marginBottom:"16px"},".cm-writing-mode-section-label":{display:"block",fontSize:"0.7em",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"8px"},".cm-writing-mode-options":{display:"flex",gap:"8px"},".cm-writing-mode-option":{flex:"1",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",padding:"10px 8px",borderRadius:"8px",border:"1px solid transparent",cursor:"pointer",fontSize:"0.85em",background:"none",transition:"background 0.15s ease, border-color 0.15s ease"},".cm-writing-mode-option-icon":{fontSize:"1.4em",lineHeight:"1"},".cm-writing-mode-option-label":{fontSize:"0.8em"},".cm-writing-mode-pills":{display:"flex",gap:"6px"},".cm-writing-mode-pill":{padding:"5px 14px",borderRadius:"16px",border:"1px solid transparent",cursor:"pointer",fontSize:"0.82em",fontWeight:"500",background:"none",transition:"background 0.15s ease, border-color 0.15s ease",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},".cm-writing-mode-slider-wrap":{display:"flex",flexDirection:"column",gap:"4px"},".cm-writing-mode-slider":{width:"100%",height:"4px",appearance:"none",WebkitAppearance:"none",borderRadius:"2px",outline:"none",cursor:"pointer"},".cm-writing-mode-slider-labels":{display:"flex",justifyContent:"space-between",fontSize:"0.7em"},".cm-writing-mode-shortcuts":{display:"flex",alignItems:"center",gap:"6px",fontSize:"0.75em",flexWrap:"wrap",marginTop:"4px",paddingTop:"12px"},".cm-writing-mode-shortcuts-label":{fontWeight:"500"},".cm-writing-mode-kbd":{display:"inline-block",padding:"2px 6px",borderRadius:"4px",fontSize:"0.9em",fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace',lineHeight:"1.4"},".cm-writing-mode-kbd-desc":{marginRight:"8px"}}),wt=u.EditorView.theme({"&":{backgroundColor:"#fff"},".cm-content":{caretColor:"#333"},".cm-cursor":{borderLeftColor:"#333",borderLeftWidth:"2px"},".cm-selectionBackground":{backgroundColor:"#b4d5fe"},"&.cm-focused .cm-selectionBackground":{backgroundColor:"#b4d5fe"},".cm-markdown-preview .md-h1":{color:"#1a1a2e"},".cm-markdown-preview .md-h2":{color:"#2d2d3f"},".cm-markdown-preview .md-h3":{color:"#3d3d4d"},".cm-markdown-preview .md-h4":{color:"#555566"},".cm-markdown-preview .md-h5":{color:"#666677"},".cm-markdown-preview .md-h6":{color:"#777788"},".cm-markdown-preview del":{color:"#868e96"},".cm-markdown-preview code":{backgroundColor:"#f1f3f5",color:"#e83e8c"},".cm-markdown-preview a":{color:"#228be6"},".cm-markdown-preview .md-blockquote":{color:"#555",borderLeft:"3px solid #c0c8d0"},".cm-markdown-preview .md-list-marker":{color:"#888"},".cm-markdown-preview .md-hr, .cm-markdown-preview hr":{background:"linear-gradient(to right, transparent, #c0c8d0, transparent)"},".cm-code-block-line":{backgroundColor:"#f6f8fa !important",borderLeft:"3px solid #e1e4e8"},".cm-code-block-line.cm-code-block-focused":{backgroundColor:"#e8f4fc !important",borderLeft:"3px solid #228be6"},".cm-selectedLine, .cm-table-line, .cm-math-block-line, .cm-mermaid-block-line":{backgroundColor:"#1e1e1e !important",color:"#d4d4d4 !important",caretColor:"#fff !important",borderRadius:"4px",fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace',fontSize:"0.90em"},".cm-selectedLine.cm-code-block-line":{backgroundColor:"#1e1e1e !important",borderLeft:"3px solid #569cd6",color:"#d4d4d4 !important",caretColor:"#fff !important",borderRadius:"0"},".cm-selectedLine.cm-code-block-line .tok-keyword":{color:"#569cd6 !important"},".cm-selectedLine.cm-code-block-line .tok-operator":{color:"#d4d4d4 !important"},".cm-selectedLine.cm-code-block-line .tok-variableName":{color:"#9cdcfe !important"},".cm-selectedLine.cm-code-block-line .tok-function, .cm-selectedLine.cm-code-block-line .tok-definition":{color:"#dcdcaa !important"},".cm-selectedLine.cm-code-block-line .tok-string, .cm-selectedLine.cm-code-block-line .tok-string2":{color:"#ce9178 !important"},".cm-selectedLine.cm-code-block-line .tok-number":{color:"#b5cea8 !important"},".cm-selectedLine.cm-code-block-line .tok-bool, .cm-selectedLine.cm-code-block-line .tok-null":{color:"#569cd6 !important"},".cm-selectedLine.cm-code-block-line .tok-comment":{color:"#6a9955 !important"},".cm-selectedLine.cm-code-block-line .tok-punctuation":{color:"#d4d4d4 !important"},".cm-selectedLine.cm-code-block-line .tok-propertyName":{color:"#9cdcfe !important"},".cm-selectedLine.cm-code-block-line .tok-typeName, .cm-selectedLine.cm-code-block-line .tok-className":{color:"#4ec9b0 !important"},".cm-selectedLine.cm-code-block-line .tok-tagName":{color:"#569cd6 !important"},".cm-selectedLine.cm-code-block-line .tok-attributeName":{color:"#9cdcfe !important"},".cm-selectedLine.cm-code-block-line .tok-attributeValue":{color:"#ce9178 !important"},".cm-selectedLine.cm-code-block-line .tok-regexp":{color:"#d16969 !important"},".cm-selectedLine.cm-code-block-line .tok-meta":{color:"#6a9955 !important"},".cm-image-preview img":{boxShadow:"0 1px 4px rgba(0, 0, 0, 0.1)"},".cm-image-alt":{color:"#888"},".cm-image-error":{backgroundColor:"#fff3f3",color:"#d73a49",border:"1px solid #fdd"},".cm-frontmatter-preview":{backgroundColor:"#f8f9fa",border:"1px solid #e1e4e8"},".cm-frontmatter-table td":{borderBottom:"1px solid #eee"},".cm-frontmatter-table tr:last-child td":{borderBottom:"none"},".cm-frontmatter-key":{color:"#555"},".cm-frontmatter-key-input:focus":{backgroundColor:"#fff",boxShadow:"0 0 0 1px #228be6"},".cm-frontmatter-input:focus":{backgroundColor:"#fff",boxShadow:"0 0 0 1px #228be6"},".cm-frontmatter-tag":{backgroundColor:"#e8f0fe",color:"#1a73e8",border:"1px solid #d2e3fc"},".cm-frontmatter-add-tag":{backgroundColor:"#e8f0fe",color:"#1a73e8"},".cm-frontmatter-delete":{color:"#d73a49"},".cm-frontmatter-error":{color:"#d73a49"},".cm-frontmatter-line":{backgroundColor:"#f6f8fa !important",borderLeft:"3px solid #e1e4e8"},".cm-frontmatter-sheet-backdrop":{backgroundColor:"rgba(0, 0, 0, 0.3)"},".cm-frontmatter-sheet":{backgroundColor:"#fff",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.12)"},".cm-frontmatter-sheet-title":{color:"#333"},".cm-frontmatter-sheet-close":{color:"#666"},".cm-frontmatter-sheet-add-btn":{backgroundColor:"#f8f9fa",borderColor:"#e1e4e8",color:"#333"},".cm-frontmatter-sheet-add-btn:hover":{backgroundColor:"#e9ecef"},".cm-word-count-panel":{backgroundColor:"#f8f9fa",borderTop:"1px solid #e1e4e8",color:"#555"},".cm-word-count-value":{color:"#333"},".cm-word-count-label":{color:"#888"},".cm-word-count-divider":{backgroundColor:"#dee2e6"},".cm-word-count-selection":{color:"#228be6"},".cm-word-count-selection .cm-word-count-value":{color:"#228be6"},".cm-word-count-selection .cm-word-count-label":{color:"#228be6",opacity:"0.7"},".cm-gutters":{background:"#f8f9fa",borderRight:"1px solid #dee2e6"},".md-table":{border:"1px solid #d0d7de"},".md-table th, .md-table td":{border:"1px solid #d0d7de"},".md-table th":{background:"#f6f8fa"},".md-table tbody tr:hover":{background:"#f6f8fa"},".cm-markdown-preview .md-table-row":{background:"#fff",border:"1px solid #d0d7de"},".cm-markdown-preview .md-table-cell":{borderRight:"1px solid #d0d7de"},".tok-keyword":{color:"#d73a49"},".tok-operator":{color:"#d73a49"},".tok-variableName":{color:"#24292e"},".tok-function, .tok-definition":{color:"#6f42c1"},".tok-string, .tok-string2":{color:"#032f62"},".tok-number":{color:"#005cc5"},".tok-bool, .tok-null":{color:"#005cc5"},".tok-comment":{color:"#6a737d"},".tok-punctuation":{color:"#24292e"},".tok-propertyName":{color:"#005cc5"},".tok-typeName, .tok-className":{color:"#22863a"},".tok-tagName":{color:"#22863a"},".tok-attributeName":{color:"#6f42c1"},".tok-attributeValue":{color:"#032f62"},".tok-regexp":{color:"#032f62"},".tok-meta":{color:"#6a737d"},".cm-backlinks-panel":{backgroundColor:"#f8f9fa",borderTop:"1px solid #e1e4e8",color:"#555"},".cm-backlinks-label":{color:"#333"},".cm-backlinks-link":{backgroundColor:"#e8f0fe",color:"#1a73e8",border:"1px solid #d2e3fc"},".md-tag":{backgroundColor:"#e8f5e9",color:"#2e7d32",border:"1px solid #c8e6c9"},".cm-tag-mark":{color:"#2e7d32"},".cm-writing-mode-sheet-backdrop":{backgroundColor:"rgba(0, 0, 0, 0.3)"},".cm-writing-mode-sheet":{backgroundColor:"#fff",boxShadow:"0 -4px 16px rgba(0, 0, 0, 0.12)"},".cm-writing-mode-sheet-title":{color:"#333"},".cm-writing-mode-sheet-close":{color:"#666"},".cm-writing-mode-section-label":{color:"#888"},".cm-writing-mode-option":{color:"#555",backgroundColor:"#f5f5f5"},".cm-writing-mode-option:hover":{backgroundColor:"#eee"},".cm-writing-mode-option-active":{backgroundColor:"#e8f0fe !important",borderColor:"#1a73e8 !important",color:"#1a73e8 !important"},".cm-writing-mode-pill":{color:"#555",backgroundColor:"#f5f5f5"},".cm-writing-mode-pill:hover":{backgroundColor:"#eee"},".cm-writing-mode-pill-active":{backgroundColor:"#e8f0fe !important",borderColor:"#1a73e8 !important",color:"#1a73e8 !important"},".cm-writing-mode-slider":{background:"#ddd"},".cm-writing-mode-slider-labels":{color:"#999"},".cm-writing-mode-shortcuts":{color:"#888",borderTop:"1px solid #eee"},".cm-writing-mode-kbd":{backgroundColor:"#f0f0f0",border:"1px solid #ddd",color:"#555"},".footnote-ref .footnote-link":{color:"#228be6"},".footnote-def":{color:"#666"},".footnote-def sup":{color:"#228be6"},".md-wikilink, .cm-wikilink":{color:"#228be6"}}),Ct=u.EditorView.theme({"&":{backgroundColor:"#1e1e1e"},".cm-content":{caretColor:"#fff",color:"#d4d4d4"},".cm-cursor":{borderLeftColor:"#fff",borderLeftWidth:"2px"},".cm-selectionBackground":{backgroundColor:"#264f78"},"&.cm-focused .cm-selectionBackground":{backgroundColor:"#264f78"},".cm-markdown-preview .md-h1":{color:"#e8e8ec"},".cm-markdown-preview .md-h2":{color:"#d5d5db"},".cm-markdown-preview .md-h3":{color:"#c2c2ca"},".cm-markdown-preview .md-h4":{color:"#acacb8"},".cm-markdown-preview .md-h5":{color:"#9696a4"},".cm-markdown-preview .md-h6":{color:"#808090"},".cm-markdown-preview del":{color:"#777"},".cm-markdown-preview code":{backgroundColor:"#2d2d2d",color:"#ce9178"},".cm-markdown-preview a":{color:"#228be6"},".cm-markdown-preview .md-blockquote":{color:"#aaa",borderLeft:"3px solid #4a4a5a"},".cm-markdown-preview .md-list-marker":{color:"#888"},".cm-markdown-preview .md-hr, .cm-markdown-preview hr":{background:"linear-gradient(to right, transparent, #4a4a5a, transparent)"},".cm-code-block-line":{backgroundColor:"#2d2d2d !important",borderLeft:"3px solid #444"},".cm-code-block-line.cm-code-block-focused":{backgroundColor:"#3a3d41 !important",borderLeft:"3px solid #569cd6"},".cm-selectedLine, .cm-table-line, .cm-math-block-line, .cm-mermaid-block-line":{backgroundColor:"#fff !important",color:"#1e1e1e !important",caretColor:"#333 !important",borderRadius:"4px",fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace',fontSize:"0.90em"},".cm-selectedLine.cm-code-block-line":{backgroundColor:"#fff !important",borderLeft:"3px solid #228be6",color:"#1e1e1e !important",caretColor:"#333 !important",borderRadius:"0"},".cm-selectedLine.cm-code-block-line .tok-keyword":{color:"#d73a49 !important"},".cm-selectedLine.cm-code-block-line .tok-operator":{color:"#d73a49 !important"},".cm-selectedLine.cm-code-block-line .tok-variableName":{color:"#24292e !important"},".cm-selectedLine.cm-code-block-line .tok-function, .cm-selectedLine.cm-code-block-line .tok-definition":{color:"#6f42c1 !important"},".cm-selectedLine.cm-code-block-line .tok-string, .cm-selectedLine.cm-code-block-line .tok-string2":{color:"#032f62 !important"},".cm-selectedLine.cm-code-block-line .tok-number":{color:"#005cc5 !important"},".cm-selectedLine.cm-code-block-line .tok-bool, .cm-selectedLine.cm-code-block-line .tok-null":{color:"#005cc5 !important"},".cm-selectedLine.cm-code-block-line .tok-comment":{color:"#6a737d !important"},".cm-selectedLine.cm-code-block-line .tok-punctuation":{color:"#24292e !important"},".cm-selectedLine.cm-code-block-line .tok-propertyName":{color:"#005cc5 !important"},".cm-selectedLine.cm-code-block-line .tok-typeName, .cm-selectedLine.cm-code-block-line .tok-className":{color:"#22863a !important"},".cm-selectedLine.cm-code-block-line .tok-tagName":{color:"#22863a !important"},".cm-selectedLine.cm-code-block-line .tok-attributeName":{color:"#6f42c1 !important"},".cm-selectedLine.cm-code-block-line .tok-attributeValue":{color:"#032f62 !important"},".cm-selectedLine.cm-code-block-line .tok-regexp":{color:"#032f62 !important"},".cm-selectedLine.cm-code-block-line .tok-meta":{color:"#6a737d !important"},".cm-image-preview img":{boxShadow:"0 1px 4px rgba(0, 0, 0, 0.3)"},".cm-image-alt":{color:"#888"},".cm-image-error":{backgroundColor:"#3a2020",color:"#f48771",border:"1px solid #5a3030"},".cm-frontmatter-preview":{backgroundColor:"#2d2d2d",border:"1px solid #444"},".cm-frontmatter-table td":{borderBottom:"1px solid #3c3c3c"},".cm-frontmatter-table tr:last-child td":{borderBottom:"none"},".cm-frontmatter-key":{color:"#9cdcfe"},".cm-frontmatter-input":{color:"#d4d4d4"},".cm-frontmatter-key-input:focus":{backgroundColor:"#3a3d41",boxShadow:"0 0 0 1px #569cd6"},".cm-frontmatter-input:focus":{backgroundColor:"#3a3d41",boxShadow:"0 0 0 1px #569cd6"},".cm-frontmatter-tag":{backgroundColor:"#264f78",color:"#9cdcfe",border:"1px solid #3a6ea5"},".cm-frontmatter-add-tag":{backgroundColor:"#264f78",color:"#9cdcfe"},".cm-frontmatter-delete":{color:"#f48771"},".cm-frontmatter-error":{color:"#f48771"},".cm-frontmatter-line":{backgroundColor:"#2d2d2d !important",borderLeft:"3px solid #444"},".cm-frontmatter-sheet-backdrop":{backgroundColor:"rgba(0, 0, 0, 0.5)"},".cm-frontmatter-sheet":{backgroundColor:"#252526",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.4)"},".cm-frontmatter-sheet-title":{color:"#d4d4d4"},".cm-frontmatter-sheet-close":{color:"#aaa"},".cm-frontmatter-sheet-add-btn":{backgroundColor:"#3c3c3c",borderColor:"#555",color:"#d4d4d4"},".cm-frontmatter-sheet-add-btn:hover":{backgroundColor:"#4a4a4a"},".cm-word-count-panel":{backgroundColor:"#252526",borderTop:"1px solid #3c3c3c",color:"#aaa"},".cm-word-count-value":{color:"#d4d4d4"},".cm-word-count-label":{color:"#777"},".cm-word-count-divider":{backgroundColor:"#444"},".cm-word-count-selection":{color:"#569cd6"},".cm-word-count-selection .cm-word-count-value":{color:"#569cd6"},".cm-word-count-selection .cm-word-count-label":{color:"#569cd6",opacity:"0.7"},".cm-gutters":{background:"#252526",borderRight:"1px solid #3c3c3c"},".md-table":{border:"1px solid #444"},".md-table th, .md-table td":{border:"1px solid #444"},".md-table th":{background:"#2d2d2d"},".md-table tbody tr:hover":{background:"#2d2d2d"},".cm-markdown-preview .md-table-row":{background:"#1e1e1e",border:"1px solid #444"},".cm-markdown-preview .md-table-cell":{borderRight:"1px solid #444"},".tok-keyword":{color:"#569cd6"},".tok-operator":{color:"#d4d4d4"},".tok-variableName":{color:"#9cdcfe"},".tok-function, .tok-definition":{color:"#dcdcaa"},".tok-string, .tok-string2":{color:"#ce9178"},".tok-number":{color:"#b5cea8"},".tok-bool, .tok-null":{color:"#569cd6"},".tok-comment":{color:"#6a9955"},".tok-punctuation":{color:"#d4d4d4"},".tok-propertyName":{color:"#9cdcfe"},".tok-typeName, .tok-className":{color:"#4ec9b0"},".tok-tagName":{color:"#569cd6"},".tok-attributeName":{color:"#9cdcfe"},".tok-attributeValue":{color:"#ce9178"},".tok-regexp":{color:"#d16969"},".tok-meta":{color:"#6a9955"},".cm-backlinks-panel":{backgroundColor:"#252526",borderTop:"1px solid #3c3c3c",color:"#aaa"},".cm-backlinks-label":{color:"#d4d4d4"},".cm-backlinks-link":{backgroundColor:"#264f78",color:"#9cdcfe",border:"1px solid #3a6ea5"},".md-tag":{backgroundColor:"#1b3a1b",color:"#81c784",border:"1px solid #2e5a2e"},".cm-tag-mark":{color:"#81c784"},".cm-writing-mode-sheet-backdrop":{backgroundColor:"rgba(0, 0, 0, 0.5)"},".cm-writing-mode-sheet":{backgroundColor:"#252526",boxShadow:"0 -4px 16px rgba(0, 0, 0, 0.4)"},".cm-writing-mode-sheet-title":{color:"#d4d4d4"},".cm-writing-mode-sheet-close":{color:"#aaa"},".cm-writing-mode-section-label":{color:"#777"},".cm-writing-mode-option":{color:"#aaa",backgroundColor:"#2d2d2d"},".cm-writing-mode-option:hover":{backgroundColor:"#3a3a3a"},".cm-writing-mode-option-active":{backgroundColor:"#264f78 !important",borderColor:"#569cd6 !important",color:"#9cdcfe !important"},".cm-writing-mode-pill":{color:"#aaa",backgroundColor:"#2d2d2d"},".cm-writing-mode-pill:hover":{backgroundColor:"#3a3a3a"},".cm-writing-mode-pill-active":{backgroundColor:"#264f78 !important",borderColor:"#569cd6 !important",color:"#9cdcfe !important"},".cm-writing-mode-slider":{background:"#444"},".cm-writing-mode-slider-labels":{color:"#666"},".cm-writing-mode-shortcuts":{color:"#666",borderTop:"1px solid #3c3c3c"},".cm-writing-mode-kbd":{backgroundColor:"#3c3c3c",border:"1px solid #555",color:"#aaa"},".footnote-ref .footnote-link":{color:"#228be6"},".footnote-def":{color:"#aaa"},".footnote-def sup":{color:"#228be6"},".md-wikilink, .cm-wikilink":{color:"#228be6"}}),Xn=u.EditorView.theme({".cm-scroller, .cm-content, .cm-line":{fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace !important'},".cm-selectedLine, .cm-selectedLine.cm-code-block-line":{backgroundColor:"rgba(0, 0, 0, 0.05) !important",color:"inherit !important",caretColor:"#333 !important",filter:"none !important",borderRadius:"0",fontSize:"inherit !important"}}),Gn=u.EditorView.theme({".cm-scroller, .cm-content, .cm-line":{fontFamily:'"SF Mono", Monaco, "Cascadia Code", Consolas, monospace !important'},".cm-selectedLine, .cm-selectedLine.cm-code-block-line":{backgroundColor:"rgba(255, 255, 255, 0.1) !important",color:"inherit !important",caretColor:"#fff !important",filter:"none !important",borderRadius:"0",fontSize:"inherit !important"}});function Jn({tags:e=[]}={}){return t=>{const n=t.matchBefore(/#[\w/-]*$/);if(!n)return null;const i=t.state.doc.lineAt(n.from).text;if(/^#{1,6}\s/.test(i))return null;const s=n.text.slice(1).toLowerCase(),a=e.filter(r=>r.toLowerCase().includes(s)).sort((r,l)=>{const c=r.toLowerCase(),d=l.toLowerCase(),m=c.startsWith(s)?0:1,f=d.startsWith(s)?0:1;return m!==f?m-f:c.localeCompare(d)}).map(r=>({label:`#${r}`,apply:`#${r}`,type:"keyword"}));return{from:n.from,to:n.to,options:a,validFor:/^#[\w/-]*$/}}}function Zn(e=[]){const t=e.map(n=>({title:n.title,aliases:Array.isArray(n.aliases)?n.aliases:[],normalizedTitle:n.title.toLowerCase(),normalizedAliases:Array.isArray(n.aliases)?n.aliases.map(o=>o.toLowerCase()):[]}));return{search(n){const o=n.trim().toLowerCase();return o?t.map(s=>{const a=s.normalizedTitle.indexOf(o),r=s.normalizedAliases.length?Math.min(...s.normalizedAliases.map(c=>c.indexOf(o)).filter(c=>c!==-1)):-1,l=Math.min(a===-1?Number.POSITIVE_INFINITY:a,r===-1?Number.POSITIVE_INFINITY:r);return{entry:s,score:l}}).filter(s=>Number.isFinite(s.score)).sort((s,a)=>s.score-a.score).map(s=>s.entry):t},resolve(n){const o=n.trim().toLowerCase();return t.find(i=>i.normalizedTitle===o)||t.find(i=>i.normalizedAliases.includes(o))||null}}}function Qn(e){return`${e.title}]]`}function eo(e,t){return!e||!t||!t.title?null:e.resolve(t.title)}function to({noteIndex:e,formatLink:t}={}){const n=typeof t=="function"?t:Qn;return o=>{if(!e)return null;const i=o.matchBefore(/\[\[[^\[\]\n]*$/);if(!i)return null;const s=i.text.slice(2),r=e.search(s).map(l=>({label:l.title,detail:l.aliases.length?`aliases: ${l.aliases.join(", ")}`:void 0,apply:n(l),type:"text"}));return{from:i.from+2,to:i.to,options:r,validFor:/^[^\[\]\n]*$/}}}const no=u.EditorView.baseTheme({".cm-more-menu-container":{position:"absolute",top:"8px",right:"8px",zIndex:"6"},".cm-more-menu-trigger":{width:"32px",height:"32px",borderRadius:"6px",border:"none",background:"rgba(0, 0, 0, 0.05)",cursor:"pointer",fontSize:"18px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",color:"#555",fontFamily:'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},".cm-more-menu-trigger:hover":{background:"rgba(0, 0, 0, 0.1)"},".cm-more-menu-dropdown":{position:"absolute",top:"100%",right:"0",marginTop:"4px",minWidth:"180px",background:"#fff",borderRadius:"8px",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(0, 0, 0, 0.06)",padding:"4px 0",fontFamily:'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',fontSize:"14px",overflow:"hidden"},".cm-more-menu-item":{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"8px 12px",border:"none",background:"transparent",cursor:"pointer",textAlign:"left",color:"#333",fontSize:"inherit",fontFamily:"inherit",lineHeight:"1.3"},".cm-more-menu-item:hover":{background:"rgba(0, 0, 0, 0.05)"},".cm-more-menu-check":{width:"16px",textAlign:"center",flexShrink:"0",fontSize:"13px",color:"#555"},"&dark .cm-more-menu-trigger":{background:"rgba(255, 255, 255, 0.08)",color:"#aaa"},"&dark .cm-more-menu-trigger:hover":{background:"rgba(255, 255, 255, 0.14)"},"&dark .cm-more-menu-dropdown":{background:"#2d2d2d",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.08)"},"&dark .cm-more-menu-item":{color:"#d4d4d4"},"&dark .cm-more-menu-item:hover":{background:"rgba(255, 255, 255, 0.08)"},"&dark .cm-more-menu-check":{color:"#aaa"}});function oo(e={}){const t=e.items||[];return[u.ViewPlugin.fromClass(class{constructor(o){this.view=o,this.open=!1,this.container=document.createElement("div"),this.container.className="cm-more-menu-container",Object.assign(this.container.style,{position:"absolute",top:"8px",right:"8px",zIndex:"6"}),this.trigger=document.createElement("button"),this.trigger.className="cm-more-menu-trigger",this.trigger.textContent="‚ãØ",this.trigger.title="More options",this.trigger.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.toggle()}),this.container.appendChild(this.trigger),this.dropdown=document.createElement("div"),this.dropdown.className="cm-more-menu-dropdown",this.dropdown.style.display="none",this.container.appendChild(this.dropdown),this.checkEls=[];for(const i of t){const s=document.createElement("button");s.className="cm-more-menu-item";const a=document.createElement("span");a.className="cm-more-menu-check",a.textContent=i.getState&&i.getState(o)?"‚úì":"",this.checkEls.push({check:a,item:i});const r=document.createElement("span");r.textContent=i.label,s.appendChild(a),s.appendChild(r),s.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation(),i.handler(o),this.refreshChecks()}),this.dropdown.appendChild(s)}this._onDocClick=i=>{this.open&&!this.container.contains(i.target)&&this.close()},this._onKeyDown=i=>{this.open&&i.key==="Escape"&&this.close()},document.addEventListener("click",this._onDocClick,!0),document.addEventListener("keydown",this._onKeyDown),o.dom.appendChild(this.container)}toggle(){this.open?this.close():this.show()}show(){this.open=!0,this.refreshChecks(),this.dropdown.style.display=""}close(){this.open=!1,this.dropdown.style.display="none"}refreshChecks(){for(const{check:o,item:i}of this.checkEls)o.textContent=i.getState&&i.getState(this.view)?"‚úì":""}update(o){this.open&&this.refreshChecks()}destroy(){document.removeEventListener("click",this._onDocClick,!0),document.removeEventListener("keydown",this._onKeyDown),this.container.remove()}}),no]}const J=b.Facet.define({combine(e){return{enablePreview:e.reduce((t,n)=>n.enablePreview??t,!0),enableKeymap:e.reduce((t,n)=>n.enableKeymap??t,!0),enableCollapse:e.reduce((t,n)=>n.enableCollapse??t,!0),enableCustomTasks:e.reduce((t,n)=>n.enableCustomTasks??t,!1),customTaskTypes:e.reduce((t,n)=>n.customTaskTypes??t,void 0),enableWikiLinks:e.reduce((t,n)=>n.enableWikiLinks??t,!1),enableTags:e.reduce((t,n)=>n.enableTags??t,!1),onTagClick:e.reduce((t,n)=>n.onTagClick??t,void 0),renderWikiLinks:e.reduce((t,n)=>n.renderWikiLinks??t,!0),onWikiLinkClick:e.reduce((t,n)=>n.onWikiLinkClick??t,void 0),readOnly:e.reduce((t,n)=>n.readOnly??t,!1),typewriter:e.reduce((t,n)=>n.typewriter??t,!1),focusMode:e.reduce((t,n)=>n.focusMode??t,!1),focusLevel:e.reduce((t,n)=>n.focusLevel??t,"paragraph"),dimIntensity:e.reduce((t,n)=>n.dimIntensity??t,30),toolbar:e.reduce((t,n)=>n.toolbar??t,!0),wordCount:e.reduce((t,n)=>n.wordCount??t,!1),backlinks:e.reduce((t,n)=>n.backlinks??t,!1),docTitle:e.reduce((t,n)=>n.docTitle??t,void 0),onBacklinksRequested:e.reduce((t,n)=>n.onBacklinksRequested??t,void 0),onBacklinkClick:e.reduce((t,n)=>n.onBacklinkClick??t,void 0),frontmatterKeys:e.reduce((t,n)=>n.frontmatterKeys??t,void 0),theme:e.reduce((t,n)=>n.theme??t,"light")}}}),Le=b.StateEffect.define(),ve=b.StateEffect.define(),Se=b.StateEffect.define(),Ee=b.StateEffect.define(),Te=b.StateEffect.define(),Me=b.StateEffect.define(),E=b.StateField.define({create(e){const t=e.facet(J);return{theme:t.theme||"light",mode:t.enablePreview!==!1?"hybrid":"raw",readOnly:t.readOnly===!0,typewriter:t.typewriter===!0,focusMode:t.focusMode===!0,focusLevel:t.focusLevel||"paragraph",dimIntensity:t.dimIntensity!=null?t.dimIntensity:30,writingModeSheet:!1,toolbar:t.toolbar!==!1,wordCount:t.wordCount===!0,backlinks:t.backlinks===!0}},update(e,t){for(const n of t.effects)n.is(Le)?e={...e,theme:n.value}:n.is(ve)?e={...e,mode:n.value}:n.is(Se)?e={...e,readOnly:n.value}:n.is(A)?e={...e,typewriter:n.value}:n.is(O)?e={...e,focusMode:n.value}:n.is(X)?e={...e,focusLevel:n.value}:n.is(G)?e={...e,dimIntensity:n.value}:n.is(j)?e={...e,writingModeSheet:n.value}:n.is(Ee)?e={...e,toolbar:n.value}:n.is(Te)?e={...e,wordCount:n.value}:n.is(Me)&&(e={...e,backlinks:n.value});return e}}),Fe=new b.Compartment,re=new b.Compartment,Z=new b.Compartment,De=new b.Compartment,Ne=new b.Compartment,xt=new b.Compartment,yt=new b.Compartment,Re=new b.Compartment,Ie=new b.Compartment,We=new b.Compartment,io=b.EditorState.transactionFilter.of(e=>!e.startState.readOnly||!e.docChanged||e.annotation(R)?e:{changes:[]}),ro=b.EditorState.transactionExtender.of(e=>{const t=[];let n=null,o=null,i=null,s=null;for(const r of e.effects)r.is(A)&&(n=r.value),r.is(O)&&(o=r.value),r.is(X)&&(i=r.value),r.is(G)&&(s=r.value);const a=e.startState.field(E);if(n!==null&&t.push(xt.reconfigure(n?ye:[])),o!==null||i!==null||s!==null){const r=o!==null?o:a.focusMode,l=i!==null?i:a.focusLevel,c=s!==null?s:a.dimIntensity;t.push(yt.reconfigure(r?le(l,c):[]))}return t.length>0?{effects:t}:null});function Pe(e){return e==="dark"?Ct:wt}function Q(e,t){return t?e==="dark"?Gn:Xn:[]}function so(e={}){const{enablePreview:t=!0,enableKeymap:n=!0,enableCollapse:o=!0,theme:i="light",enableCustomTasks:s=!1,customTaskTypes:a,enableWikiLinks:r=!1,renderWikiLinks:l=!0,onWikiLinkClick:c,enableTags:d=!1,onTagClick:m,readOnly:f=!1,typewriter:p=!1,focusMode:k=!1,focusLevel:h="paragraph",dimIntensity:w=30,toolbar:g=!0,wordCount:y=!1,backlinks:C=!1,docTitle:L,onBacklinksRequested:v,onBacklinkClick:x,frontmatterKeys:T}=e,S=[J.of(e),E,io,ro,Ne.of(b.EditorState.readOnly.of(f)),H.history(),u.keymap.of([...H.defaultKeymap,...H.historyKeymap,...$.searchKeymap]),$.search(),u.rectangularSelection(),u.crosshairCursor(),Lt.markdown(),bt,Fe.of(Pe(i)),Z.of(Q(i,!t)),De.of(t?ae:[]),xt.of(p?ye:[]),yt.of(k?le(h,w):[]),Re.of(g?me():[]),Ie.of(y?de:[]),oe.of({docTitle:L||null,onBacklinksRequested:typeof v=="function"?v:null,onBacklinkClick:typeof x=="function"?x:null}),We.of(C?fe:[]),gt.of(Array.isArray(T)?T:[]),Un,pt.of({typewriter:p,focusMode:k,focusLevel:h,dimIntensity:w}),K,kt,u.EditorView.lineWrapping];return t?S.push(re.of(ce({enableCollapse:o,enableCustomTasks:s,customTaskTypes:a,enableWikiLinks:r,renderWikiLinks:l,onWikiLinkClick:c,enableTags:d,onTagClick:m}))):S.push(re.of([])),n&&S.push(ht),S}function co(e){const t=e.state.field(E),n=t.theme==="light"?"dark":"light";return e.dispatch({effects:[Le.of(n),Fe.reconfigure(Pe(n)),Z.reconfigure(Q(n,t.mode==="raw"))]}),n==="dark"}function ao(e){const t=e.state.field(E),n=t.mode==="hybrid"?"raw":"hybrid",o=n==="hybrid",i=e.state.facet(J);return e.dispatch({effects:[ve.of(n),re.reconfigure(o?ce({enableCollapse:i.enableCollapse,enableCustomTasks:i.enableCustomTasks,customTaskTypes:i.customTaskTypes}):[]),Z.reconfigure(Q(t.theme,!o)),De.reconfigure(o?ae:[])]}),o}function lo(e){const n=!e.state.field(E).readOnly;return e.dispatch({effects:[Se.of(n),Ne.reconfigure(b.EditorState.readOnly.of(n))]}),n}function mo(e,t){e.dispatch({effects:[Se.of(t),Ne.reconfigure(b.EditorState.readOnly.of(t))]})}function fo(e){const n=!e.state.field(E).typewriter;return e.dispatch({effects:A.of(n)}),n}function uo(e,t){e.dispatch({effects:A.of(t)})}function po(e){return e.state.field(E).typewriter}function ho(e){const n=!e.state.field(E).focusMode;return e.dispatch({effects:O.of(n)}),n}function go(e,t){e.dispatch({effects:O.of(t)})}function ko(e){return e.state.field(E).focusMode}function bo(e,t){e.dispatch({effects:X.of(t)})}function wo(e){return e.state.field(E).focusLevel}function Co(e,t){e.dispatch({effects:G.of(t)})}function xo(e){return e.state.field(E).dimIntensity}function yo(e){const t=e.state.field(E);return t.typewriter&&t.focusMode?"both":t.typewriter?"typewriter":t.focusMode?"focus":"normal"}function Lo(e,t){const n=t==="typewriter"||t==="both",o=t==="focus"||t==="both";e.dispatch({effects:[A.of(n),O.of(o)]})}function vo(e){const t=e.state.field(E).writingModeSheet;return e.dispatch({effects:j.of(!t)}),!t}function So(e,t){e.dispatch({effects:j.of(t)})}function Eo(e){return e.state.field(E).writingModeSheet}function To(e){const n=!e.state.field(E).toolbar;return e.dispatch({effects:[Ee.of(n),Re.reconfigure(n?me():[])]}),n}function Mo(e,t){e.dispatch({effects:[Ee.of(t),Re.reconfigure(t?me():[])]})}function Fo(e){return e.state.field(E).toolbar}function Do(e){const n=!e.state.field(E).wordCount;return e.dispatch({effects:[Te.of(n),Ie.reconfigure(n?de:[])]}),n}function No(e,t){e.dispatch({effects:[Te.of(t),Ie.reconfigure(t?de:[])]})}function Ro(e){return e.state.field(E).wordCount}function Io(e){const n=!e.state.field(E).backlinks;return e.dispatch({effects:[Me.of(n),We.reconfigure(n?fe:[])]}),n}function Wo(e,t){e.dispatch({effects:[Me.of(t),We.reconfigure(t?fe:[])]})}function Po(e){return e.state.field(E).backlinks}function Bo(e){const t=e.state.field(U);return e.dispatch({effects:_.of(!t)}),!t}function Ao(e,t){e.dispatch({effects:_.of(t)})}function Oo(e){return e.state.field(U)}function zo(e,t){const n=e.state.field(E);e.dispatch({effects:[Le.of(t),Fe.reconfigure(Pe(t)),Z.reconfigure(Q(t,n.mode==="raw"))]})}function $o(e,t){const n=e.state.field(E),o=t==="hybrid",i=e.state.facet(J);e.dispatch({effects:[ve.of(t),re.reconfigure(o?ce({enableCollapse:i.enableCollapse,enableCustomTasks:i.enableCustomTasks,customTaskTypes:i.customTaskTypes}):[]),Z.reconfigure(Q(n.theme,!o)),De.reconfigure(o?ae:[])]})}function Ho(e){return e.state.field(E).readOnly}function jo(e){return e.state.field(E).theme}function qo(e){return e.state.field(E).mode}exports.HybridMarkdownConfig=J;exports.actions=B;exports.backlinksPanel=fe;exports.baseTheme=bt;exports.bottomToolbar=me;exports.createFocusModePlugin=le;exports.createNoteIndex=Zn;exports.darkTheme=Ct;exports.focusModePlugin=zn;exports.getDimIntensity=xo;exports.getFocusLevel=wo;exports.getMode=qo;exports.getTheme=jo;exports.getWritingMode=yo;exports.highlightSelectedLines=ae;exports.hybridMarkdown=so;exports.hybridPreview=ce;exports.isBacklinks=Po;exports.isFocusMode=ko;exports.isFrontmatterSheet=Oo;exports.isReadOnly=Ho;exports.isToolbar=Fo;exports.isTypewriter=po;exports.isWordCount=Ro;exports.isWritingModeSheet=Eo;exports.lightTheme=wt;exports.markdownKeymap=ht;exports.moreMenu=oo;exports.resolveWikiLink=eo;exports.setBacklinks=Wo;exports.setDimIntensity=Co;exports.setFocusLevel=bo;exports.setFocusMode=go;exports.setFrontmatterSheet=Ao;exports.setMode=$o;exports.setReadOnly=mo;exports.setTheme=zo;exports.setToolbar=Mo;exports.setTypewriter=uo;exports.setWordCount=No;exports.setWritingMode=Lo;exports.setWritingModeSheet=So;exports.tagAutocomplete=Jn;exports.toggleBacklinks=Io;exports.toggleFocusMode=ho;exports.toggleFrontmatterSheet=Bo;exports.toggleHybridMode=ao;exports.toggleReadOnly=lo;exports.toggleTheme=co;exports.toggleToolbar=To;exports.toggleTypewriter=fo;exports.toggleWordCount=Do;exports.toggleWritingModeSheet=vo;exports.typewriterPlugin=ye;exports.wikiLinkAutocomplete=to;exports.wordCountPanel=de;exports.writingModeSheetPlugin=kt;
//# sourceMappingURL=index.cjs.map
